\hypertarget{linux_2flow__netlink_8c}{}\section{/home/vladn/git/ovs/datapath/linux/flow\+\_\+netlink.c File Reference}
\label{linux_2flow__netlink_8c}\index{/home/vladn/git/ovs/datapath/linux/flow\+\_\+netlink.\+c@{/home/vladn/git/ovs/datapath/linux/flow\+\_\+netlink.\+c}}
{\ttfamily \#include $<$linux/uaccess.\+h$>$}\\*
{\ttfamily \#include $<$linux/netdevice.\+h$>$}\\*
{\ttfamily \#include $<$linux/etherdevice.\+h$>$}\\*
{\ttfamily \#include $<$linux/if\+\_\+ether.\+h$>$}\\*
{\ttfamily \#include $<$linux/if\+\_\+vlan.\+h$>$}\\*
{\ttfamily \#include $<$net/llc\+\_\+pdu.\+h$>$}\\*
{\ttfamily \#include $<$linux/kernel.\+h$>$}\\*
{\ttfamily \#include $<$linux/jhash.\+h$>$}\\*
{\ttfamily \#include $<$linux/jiffies.\+h$>$}\\*
{\ttfamily \#include $<$linux/llc.\+h$>$}\\*
{\ttfamily \#include $<$linux/module.\+h$>$}\\*
{\ttfamily \#include $<$linux/in.\+h$>$}\\*
{\ttfamily \#include $<$linux/rcupdate.\+h$>$}\\*
{\ttfamily \#include $<$linux/if\+\_\+arp.\+h$>$}\\*
{\ttfamily \#include $<$linux/ip.\+h$>$}\\*
{\ttfamily \#include $<$linux/ipv6.\+h$>$}\\*
{\ttfamily \#include $<$linux/sctp.\+h$>$}\\*
{\ttfamily \#include $<$linux/tcp.\+h$>$}\\*
{\ttfamily \#include $<$linux/udp.\+h$>$}\\*
{\ttfamily \#include $<$linux/icmp.\+h$>$}\\*
{\ttfamily \#include $<$linux/icmpv6.\+h$>$}\\*
{\ttfamily \#include $<$linux/rculist.\+h$>$}\\*
{\ttfamily \#include $<$net/geneve.\+h$>$}\\*
{\ttfamily \#include $<$net/ip.\+h$>$}\\*
{\ttfamily \#include $<$net/ipv6.\+h$>$}\\*
{\ttfamily \#include $<$net/ndisc.\+h$>$}\\*
{\ttfamily \#include $<$net/mpls.\+h$>$}\\*
{\ttfamily \#include \char`\"{}datapath.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}flow.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}flow\+\_\+netlink.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}vport-\/vxlan.\+h\char`\"{}}\\*
Include dependency graph for flow\+\_\+netlink.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{linux_2flow__netlink_8c__incl}
\end{center}
\end{figure}
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structovs__len__tbl}{ovs\+\_\+len\+\_\+tbl}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{linux_2flow__netlink_8c_a1f8c165bf4196327bc3abff648276d92}{pr\+\_\+fmt}(fmt)~K\+B\+U\+I\+L\+D\+\_\+\+M\+O\+D\+N\+A\+M\+E \char`\"{}\+: \char`\"{} fmt
\item 
\#define \hyperlink{linux_2flow__netlink_8c_aa45250c738c1a22be7f5e711887c8547}{O\+V\+S\+\_\+\+A\+T\+T\+R\+\_\+\+N\+E\+S\+T\+E\+D}~-\/1
\item 
\#define \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+P\+U\+T}(match,  field,  value,  is\+\_\+mask)
\item 
\#define \hyperlink{linux_2flow__netlink_8c_aceedf9228ebbe5291ac9e12d1d011278}{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+C\+P\+Y\+\_\+\+O\+F\+F\+S\+E\+T}(match,  offset,  value\+\_\+p,  len,  is\+\_\+mask)
\item 
\#define \hyperlink{linux_2flow__netlink_8c_aa303fd044db169fb22013e1279c18dd1}{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+C\+P\+Y}(match,  field,  value\+\_\+p,  len,  is\+\_\+mask)
\item 
\#define \hyperlink{linux_2flow__netlink_8c_a428fac9f6cc49614e07de128b9e4869f}{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+S\+E\+T\+\_\+\+F\+I\+E\+L\+D}(match,  field,  value,  is\+\_\+mask)
\item 
\#define \hyperlink{linux_2flow__netlink_8c_a429e7a37f3797cd9870c534467a7f762}{M\+A\+X\+\_\+\+A\+C\+T\+I\+O\+N\+S\+\_\+\+B\+U\+F\+S\+I\+Z\+E}~(32 $\ast$ 1024)
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{linux_2flow__netlink_8c_ac21a080dcc5b01d3da9b75d32b13fb40}{update\+\_\+range} (struct \hyperlink{structsw__flow__match}{sw\+\_\+flow\+\_\+match} $\ast$match, size\+\_\+t offset, size\+\_\+t size, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} is\+\_\+mask)
\item 
static \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} \hyperlink{linux_2flow__netlink_8c_ab4be6b01938d3a8f5a14bc787cb2b0b2}{match\+\_\+validate} (const struct \hyperlink{structsw__flow__match}{sw\+\_\+flow\+\_\+match} $\ast$match, u64 key\+\_\+attrs, u64 mask\+\_\+attrs, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
size\+\_\+t \hyperlink{linux_2flow__netlink_8c_ac920825ffe4fa75e7ca3c5e76ad4ec2a}{ovs\+\_\+tun\+\_\+key\+\_\+attr\+\_\+size} (void)
\item 
size\+\_\+t \hyperlink{linux_2flow__netlink_8c_a4ea1ec7f3650fd324fc1538c97e795d0}{ovs\+\_\+key\+\_\+attr\+\_\+size} (void)
\item 
static \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} \hyperlink{linux_2flow__netlink_8c_a237e69cf49fbb7f26d6f886bdf4e4aad}{is\+\_\+all\+\_\+zero} (const u8 $\ast$fp, size\+\_\+t size)
\item 
static int \hyperlink{linux_2flow__netlink_8c_acc907c6eed2beccfb3d8564a9f627e93}{\+\_\+\+\_\+parse\+\_\+flow\+\_\+nlattrs} (const struct nlattr $\ast$attr, const struct nlattr $\ast$a\mbox{[}$\,$\mbox{]}, u64 $\ast$attrsp, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} nz)
\item 
static int \hyperlink{linux_2flow__netlink_8c_a4a090c5659903b6b8d125ab7598ad1a6}{parse\+\_\+flow\+\_\+mask\+\_\+nlattrs} (const struct nlattr $\ast$attr, const struct nlattr $\ast$a\mbox{[}$\,$\mbox{]}, u64 $\ast$attrsp, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static int \hyperlink{linux_2flow__netlink_8c_aafe0de49242cd0276fd5ced0fd81514f}{parse\+\_\+flow\+\_\+nlattrs} (const struct nlattr $\ast$attr, const struct nlattr $\ast$a\mbox{[}$\,$\mbox{]}, u64 $\ast$attrsp, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static int \hyperlink{linux_2flow__netlink_8c_a5f31d9f0798910742b360bbdfe29eeae}{genev\+\_\+tun\+\_\+opt\+\_\+from\+\_\+nlattr} (const struct nlattr $\ast$a, struct \hyperlink{structsw__flow__match}{sw\+\_\+flow\+\_\+match} $\ast$match, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} is\+\_\+mask, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static int \hyperlink{linux_2flow__netlink_8c_aef546829167c0fe738dd9db84c3848d4}{vxlan\+\_\+tun\+\_\+opt\+\_\+from\+\_\+nlattr} (const struct nlattr $\ast$a, struct \hyperlink{structsw__flow__match}{sw\+\_\+flow\+\_\+match} $\ast$match, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} is\+\_\+mask, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static int \hyperlink{linux_2flow__netlink_8c_aa9ad124d7dc9f5042d10b1237ce02f28}{ipv4\+\_\+tun\+\_\+from\+\_\+nlattr} (const struct nlattr $\ast$attr, struct \hyperlink{structsw__flow__match}{sw\+\_\+flow\+\_\+match} $\ast$match, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} is\+\_\+mask, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static int \hyperlink{linux_2flow__netlink_8c_a9283dd76011434d73c43654a9c32ecfb}{vxlan\+\_\+opt\+\_\+to\+\_\+nlattr} (struct sk\+\_\+buff $\ast$skb, const void $\ast$\hyperlink{flow_8h_a58d612a14e56d9b6c782667cd2e89799}{tun\+\_\+opts}, int swkey\+\_\+tun\+\_\+opts\+\_\+len)
\item 
static int \hyperlink{linux_2flow__netlink_8c_ac7f453fb68977c7a24d7af50f18b43db}{\+\_\+\+\_\+ipv4\+\_\+tun\+\_\+to\+\_\+nlattr} (struct sk\+\_\+buff $\ast$skb, const struct \hyperlink{structovs__key__ipv4__tunnel}{ovs\+\_\+key\+\_\+ipv4\+\_\+tunnel} $\ast$output, const void $\ast$\hyperlink{flow_8h_a58d612a14e56d9b6c782667cd2e89799}{tun\+\_\+opts}, int swkey\+\_\+tun\+\_\+opts\+\_\+len)
\item 
static int \hyperlink{linux_2flow__netlink_8c_a534ea0693e07f81a7a00f4b3125fbb1a}{ipv4\+\_\+tun\+\_\+to\+\_\+nlattr} (struct sk\+\_\+buff $\ast$skb, const struct \hyperlink{structovs__key__ipv4__tunnel}{ovs\+\_\+key\+\_\+ipv4\+\_\+tunnel} $\ast$output, const void $\ast$\hyperlink{flow_8h_a58d612a14e56d9b6c782667cd2e89799}{tun\+\_\+opts}, int swkey\+\_\+tun\+\_\+opts\+\_\+len)
\item 
int \hyperlink{linux_2flow__netlink_8c_a8a7309f6247775b5682061576c039e22}{ovs\+\_\+nla\+\_\+put\+\_\+egress\+\_\+tunnel\+\_\+key} (struct sk\+\_\+buff $\ast$skb, const struct \hyperlink{structovs__tunnel__info}{ovs\+\_\+tunnel\+\_\+info} $\ast$egress\+\_\+tun\+\_\+info)
\item 
static int \hyperlink{linux_2flow__netlink_8c_aed17f75c6136e01aa609132d5bbc9b2a}{metadata\+\_\+from\+\_\+nlattrs} (struct \hyperlink{structsw__flow__match}{sw\+\_\+flow\+\_\+match} $\ast$match, u64 $\ast$attrs, const struct nlattr $\ast$$\ast$a, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} is\+\_\+mask, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static int \hyperlink{linux_2flow__netlink_8c_a7e2f54c332f7bdac73756972da69ad53}{ovs\+\_\+key\+\_\+from\+\_\+nlattrs} (struct \hyperlink{structsw__flow__match}{sw\+\_\+flow\+\_\+match} $\ast$match, u64 attrs, const struct nlattr $\ast$$\ast$a, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} is\+\_\+mask, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static void \hyperlink{linux_2flow__netlink_8c_a412721fb459cda8f2b25400f8832d84f}{nlattr\+\_\+set} (struct nlattr $\ast$attr, u8 val, const struct \hyperlink{structovs__len__tbl}{ovs\+\_\+len\+\_\+tbl} $\ast$tbl)
\item 
static void \hyperlink{linux_2flow__netlink_8c_aa862995e0363dbb698ee51eb1be8a40c}{mask\+\_\+set\+\_\+nlattr} (struct nlattr $\ast$attr, u8 val)
\item 
int \hyperlink{linux_2flow__netlink_8c_a074547b2bcb32890a72ae873700391d5}{ovs\+\_\+nla\+\_\+get\+\_\+match} (struct \hyperlink{structsw__flow__match}{sw\+\_\+flow\+\_\+match} $\ast$match, const struct nlattr $\ast$nla\+\_\+key, const struct nlattr $\ast$nla\+\_\+mask, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static size\+\_\+t \hyperlink{linux_2flow__netlink_8c_a5189e471b5832c9371b45c5e58ca5b41}{get\+\_\+ufid\+\_\+len} (const struct nlattr $\ast$attr, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
\hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} \hyperlink{linux_2flow__netlink_8c_a81e0cfe1c434ecde4ad684c8b8586877}{ovs\+\_\+nla\+\_\+get\+\_\+ufid} (struct \hyperlink{structsw__flow__id}{sw\+\_\+flow\+\_\+id} $\ast$sfid, const struct nlattr $\ast$attr, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
int \hyperlink{linux_2flow__netlink_8c_aa416ab3b06ce40eee0be66306129c8d5}{ovs\+\_\+nla\+\_\+get\+\_\+identifier} (struct \hyperlink{structsw__flow__id}{sw\+\_\+flow\+\_\+id} $\ast$sfid, const struct nlattr $\ast$ufid, const struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$key, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
u32 \hyperlink{linux_2flow__netlink_8c_a415cb727697a02d62b8ff40795337d40}{ovs\+\_\+nla\+\_\+get\+\_\+ufid\+\_\+flags} (const struct nlattr $\ast$attr)
\item 
int \hyperlink{linux_2flow__netlink_8c_a90428a389e4ba65133d2cf837d5a8dc3}{ovs\+\_\+nla\+\_\+get\+\_\+flow\+\_\+metadata} (const struct nlattr $\ast$attr, struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$key, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static int \hyperlink{linux_2flow__netlink_8c_a469e9434d0bedd721b2e31a106799335}{\+\_\+\+\_\+ovs\+\_\+nla\+\_\+put\+\_\+key} (const struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$swkey, const struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$output, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} is\+\_\+mask, struct sk\+\_\+buff $\ast$skb)
\item 
int \hyperlink{linux_2flow__netlink_8c_a845412e2f8f2bcb48df005e857474fcb}{ovs\+\_\+nla\+\_\+put\+\_\+key} (const struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$swkey, const struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$output, int attr, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} is\+\_\+mask, struct sk\+\_\+buff $\ast$skb)
\item 
int \hyperlink{linux_2flow__netlink_8c_a636f7d3cbe8656ceda87373110a4abc4}{ovs\+\_\+nla\+\_\+put\+\_\+identifier} (const struct \hyperlink{structsw__flow}{sw\+\_\+flow} $\ast$flow, struct sk\+\_\+buff $\ast$skb)
\item 
int \hyperlink{linux_2flow__netlink_8c_a2f6c3ab02b8e5d6296278dc9214500eb}{ovs\+\_\+nla\+\_\+put\+\_\+masked\+\_\+key} (const struct \hyperlink{structsw__flow}{sw\+\_\+flow} $\ast$flow, struct sk\+\_\+buff $\ast$skb)
\item 
int \hyperlink{linux_2flow__netlink_8c_af5ab12e938f8564945464a9e110eace3}{ovs\+\_\+nla\+\_\+put\+\_\+mask} (const struct \hyperlink{structsw__flow}{sw\+\_\+flow} $\ast$flow, struct sk\+\_\+buff $\ast$skb)
\item 
static struct \hyperlink{structsw__flow__actions}{sw\+\_\+flow\+\_\+actions} $\ast$ \hyperlink{linux_2flow__netlink_8c_acf3273c812551499c4b4d48651548286}{nla\+\_\+alloc\+\_\+flow\+\_\+actions} (int size, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static void \hyperlink{linux_2flow__netlink_8c_a386dd5cb0c8be8ce91e59761cbf820b4}{rcu\+\_\+free\+\_\+acts\+\_\+callback} (struct rcu\+\_\+head $\ast$rcu)
\item 
void \hyperlink{linux_2flow__netlink_8c_a5e773c3bb49bbeb0c0a4eb356c779a22}{ovs\+\_\+nla\+\_\+free\+\_\+flow\+\_\+actions} (struct \hyperlink{structsw__flow__actions}{sw\+\_\+flow\+\_\+actions} $\ast$sf\+\_\+acts)
\item 
static struct nlattr $\ast$ \hyperlink{linux_2flow__netlink_8c_a5ce53ec8a0a126f8e33e1d9af6e1e083}{reserve\+\_\+sfa\+\_\+size} (struct \hyperlink{structsw__flow__actions}{sw\+\_\+flow\+\_\+actions} $\ast$$\ast$sfa, int attr\+\_\+len, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static struct nlattr $\ast$ \hyperlink{linux_2flow__netlink_8c_ad6fb4bf743e36b42c72eaa09db192e87}{\+\_\+\+\_\+add\+\_\+action} (struct \hyperlink{structsw__flow__actions}{sw\+\_\+flow\+\_\+actions} $\ast$$\ast$sfa, int attrtype, void $\ast$data, int len, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static int \hyperlink{linux_2flow__netlink_8c_a4316343b483e9a6b4d8885147036beb2}{add\+\_\+action} (struct \hyperlink{structsw__flow__actions}{sw\+\_\+flow\+\_\+actions} $\ast$$\ast$sfa, int attrtype, void $\ast$data, int len, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static int \hyperlink{linux_2flow__netlink_8c_a08778088a1f3c3c88aee0055bcd05110}{add\+\_\+nested\+\_\+action\+\_\+start} (struct \hyperlink{structsw__flow__actions}{sw\+\_\+flow\+\_\+actions} $\ast$$\ast$sfa, int attrtype, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static void \hyperlink{linux_2flow__netlink_8c_ab0176001eff016bfad478f0f06cefa0a}{add\+\_\+nested\+\_\+action\+\_\+end} (struct \hyperlink{structsw__flow__actions}{sw\+\_\+flow\+\_\+actions} $\ast$sfa, int st\+\_\+offset)
\item 
static int \hyperlink{linux_2flow__netlink_8c_ae5c58b498948d3c5564b7916505d8455}{\+\_\+\+\_\+ovs\+\_\+nla\+\_\+copy\+\_\+actions} (const struct nlattr $\ast$attr, const struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$key, int depth, struct \hyperlink{structsw__flow__actions}{sw\+\_\+flow\+\_\+actions} $\ast$$\ast$sfa, \+\_\+\+\_\+be16 eth\+\_\+type, \+\_\+\+\_\+be16 vlan\+\_\+tci, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static int \hyperlink{linux_2flow__netlink_8c_a0dcf3429559610cf8b8204e04151728b}{validate\+\_\+and\+\_\+copy\+\_\+sample} (const struct nlattr $\ast$attr, const struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$key, int depth, struct \hyperlink{structsw__flow__actions}{sw\+\_\+flow\+\_\+actions} $\ast$$\ast$sfa, \+\_\+\+\_\+be16 eth\+\_\+type, \+\_\+\+\_\+be16 vlan\+\_\+tci, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
void \hyperlink{linux_2flow__netlink_8c_a1a09e9d38844c59332975789573e994c}{ovs\+\_\+match\+\_\+init} (struct \hyperlink{structsw__flow__match}{sw\+\_\+flow\+\_\+match} $\ast$match, struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$key, struct \hyperlink{structsw__flow__mask}{sw\+\_\+flow\+\_\+mask} $\ast$mask)
\item 
static int \hyperlink{linux_2flow__netlink_8c_af4e9606a99a9ccc71de18c0531a99808}{validate\+\_\+geneve\+\_\+opts} (struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$key)
\item 
static int \hyperlink{linux_2flow__netlink_8c_ac06cff749bd68b0a91ecacc196b4892f}{validate\+\_\+and\+\_\+copy\+\_\+set\+\_\+tun} (const struct nlattr $\ast$attr, struct \hyperlink{structsw__flow__actions}{sw\+\_\+flow\+\_\+actions} $\ast$$\ast$sfa, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} \hyperlink{linux_2flow__netlink_8c_ae01edbfa96ed8cef19cb86caf0512d7a}{validate\+\_\+masked} (u8 $\ast$data, int len)
\item 
static int \hyperlink{linux_2flow__netlink_8c_afabdbd008e8fb3c515063cafaf267e02}{validate\+\_\+set} (const struct nlattr $\ast$a, const struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$flow\+\_\+key, struct \hyperlink{structsw__flow__actions}{sw\+\_\+flow\+\_\+actions} $\ast$$\ast$sfa, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} $\ast$skip\+\_\+copy, \+\_\+\+\_\+be16 eth\+\_\+type, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} masked, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static int \hyperlink{linux_2flow__netlink_8c_ab7c5d132ac3085d8c2da993c66138ab0}{validate\+\_\+userspace} (const struct nlattr $\ast$attr)
\item 
static int \hyperlink{linux_2flow__netlink_8c_a746e2c558f7350550b1734826a8c25f7}{copy\+\_\+action} (const struct nlattr $\ast$from, struct \hyperlink{structsw__flow__actions}{sw\+\_\+flow\+\_\+actions} $\ast$$\ast$sfa, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
int \hyperlink{linux_2flow__netlink_8c_a10dc93f8c379eae7a557d54d9b387dd6}{ovs\+\_\+nla\+\_\+copy\+\_\+actions} (const struct nlattr $\ast$attr, const struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$key, struct \hyperlink{structsw__flow__actions}{sw\+\_\+flow\+\_\+actions} $\ast$$\ast$sfa, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static int \hyperlink{linux_2flow__netlink_8c_a92621d7eaed9e960f5e5d7b72e501db0}{sample\+\_\+action\+\_\+to\+\_\+attr} (const struct nlattr $\ast$attr, struct sk\+\_\+buff $\ast$skb)
\item 
static int \hyperlink{linux_2flow__netlink_8c_af38f12c35d382eb717bb6e5b4fba2309}{set\+\_\+action\+\_\+to\+\_\+attr} (const struct nlattr $\ast$a, struct sk\+\_\+buff $\ast$skb)
\item 
static int \hyperlink{linux_2flow__netlink_8c_a14e859cc22996f05850ca737daf2ee09}{masked\+\_\+set\+\_\+action\+\_\+to\+\_\+set\+\_\+action\+\_\+attr} (const struct nlattr $\ast$a, struct sk\+\_\+buff $\ast$skb)
\item 
int \hyperlink{linux_2flow__netlink_8c_a923304ee69be1cfa52197b0f73c29e49}{ovs\+\_\+nla\+\_\+put\+\_\+actions} (const struct nlattr $\ast$attr, int len, struct sk\+\_\+buff $\ast$skb)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static const struct \hyperlink{structovs__len__tbl}{ovs\+\_\+len\+\_\+tbl} \hyperlink{linux_2flow__netlink_8c_abcfd7a34b15e86938f3646cda1522e07}{ovs\+\_\+tunnel\+\_\+key\+\_\+lens} \mbox{[}\hyperlink{openvswitch_8h_a1c8eef7445d1c45bb90eb65de59a81e4}{O\+V\+S\+\_\+\+T\+U\+N\+N\+E\+L\+\_\+\+K\+E\+Y\+\_\+\+A\+T\+T\+R\+\_\+\+M\+A\+X}+1\mbox{]}
\item 
static const struct \hyperlink{structovs__len__tbl}{ovs\+\_\+len\+\_\+tbl} \hyperlink{linux_2flow__netlink_8c_a5565daa559332f47a1d214007d97e0d7}{ovs\+\_\+key\+\_\+lens} \mbox{[}\hyperlink{openvswitch_8h_a2a2adc6c47c38f0e7889580602ccbe22}{O\+V\+S\+\_\+\+K\+E\+Y\+\_\+\+A\+T\+T\+R\+\_\+\+M\+A\+X}+1\mbox{]}
\item 
static const struct nla\+\_\+policy \hyperlink{linux_2flow__netlink_8c_ac262f3819d334e0cbbdf8198d6d2aed8}{vxlan\+\_\+opt\+\_\+policy} \mbox{[}\hyperlink{openvswitch_8h_ac764e78fe2e06d11f39448e337292c7c}{O\+V\+S\+\_\+\+V\+X\+L\+A\+N\+\_\+\+E\+X\+T\+\_\+\+M\+A\+X}+1\mbox{]}
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{linux_2flow__netlink_8c_a429e7a37f3797cd9870c534467a7f762}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!M\+A\+X\+\_\+\+A\+C\+T\+I\+O\+N\+S\+\_\+\+B\+U\+F\+S\+I\+Z\+E@{M\+A\+X\+\_\+\+A\+C\+T\+I\+O\+N\+S\+\_\+\+B\+U\+F\+S\+I\+Z\+E}}
\index{M\+A\+X\+\_\+\+A\+C\+T\+I\+O\+N\+S\+\_\+\+B\+U\+F\+S\+I\+Z\+E@{M\+A\+X\+\_\+\+A\+C\+T\+I\+O\+N\+S\+\_\+\+B\+U\+F\+S\+I\+Z\+E}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{M\+A\+X\+\_\+\+A\+C\+T\+I\+O\+N\+S\+\_\+\+B\+U\+F\+S\+I\+Z\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+A\+C\+T\+I\+O\+N\+S\+\_\+\+B\+U\+F\+S\+I\+Z\+E~(32 $\ast$ 1024)}\label{linux_2flow__netlink_8c_a429e7a37f3797cd9870c534467a7f762}
\hypertarget{linux_2flow__netlink_8c_aa45250c738c1a22be7f5e711887c8547}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!O\+V\+S\+\_\+\+A\+T\+T\+R\+\_\+\+N\+E\+S\+T\+E\+D@{O\+V\+S\+\_\+\+A\+T\+T\+R\+\_\+\+N\+E\+S\+T\+E\+D}}
\index{O\+V\+S\+\_\+\+A\+T\+T\+R\+\_\+\+N\+E\+S\+T\+E\+D@{O\+V\+S\+\_\+\+A\+T\+T\+R\+\_\+\+N\+E\+S\+T\+E\+D}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{O\+V\+S\+\_\+\+A\+T\+T\+R\+\_\+\+N\+E\+S\+T\+E\+D}]{\setlength{\rightskip}{0pt plus 5cm}\#define O\+V\+S\+\_\+\+A\+T\+T\+R\+\_\+\+N\+E\+S\+T\+E\+D~-\/1}\label{linux_2flow__netlink_8c_aa45250c738c1a22be7f5e711887c8547}
\hypertarget{linux_2flow__netlink_8c_a1f8c165bf4196327bc3abff648276d92}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!pr\+\_\+fmt@{pr\+\_\+fmt}}
\index{pr\+\_\+fmt@{pr\+\_\+fmt}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{pr\+\_\+fmt}]{\setlength{\rightskip}{0pt plus 5cm}\#define pr\+\_\+fmt(
\begin{DoxyParamCaption}
\item[{}]{fmt}
\end{DoxyParamCaption}
)~K\+B\+U\+I\+L\+D\+\_\+\+M\+O\+D\+N\+A\+M\+E \char`\"{}\+: \char`\"{} fmt}\label{linux_2flow__netlink_8c_a1f8c165bf4196327bc3abff648276d92}
\hypertarget{linux_2flow__netlink_8c_aa303fd044db169fb22013e1279c18dd1}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+C\+P\+Y@{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+C\+P\+Y}}
\index{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+C\+P\+Y@{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+C\+P\+Y}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+C\+P\+Y}]{\setlength{\rightskip}{0pt plus 5cm}\#define S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+C\+P\+Y(
\begin{DoxyParamCaption}
\item[{}]{match, }
\item[{}]{field, }
\item[{}]{value\+\_\+p, }
\item[{}]{len, }
\item[{}]{is\+\_\+mask}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_aa303fd044db169fb22013e1279c18dd1}
{\bfseries Value\+:}
\begin{DoxyCode}
\hyperlink{linux_2flow__netlink_8c_aceedf9228ebbe5291ac9e12d1d011278}{SW\_FLOW\_KEY\_MEMCPY\_OFFSET}(match, offsetof(\textcolor{keyword}{struct} 
      \hyperlink{structsw__flow__key}{sw\_flow\_key}, field), \(\backslash\)
                  value\_p, len, is\_mask)
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_aceedf9228ebbe5291ac9e12d1d011278}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+C\+P\+Y\+\_\+\+O\+F\+F\+S\+E\+T@{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+C\+P\+Y\+\_\+\+O\+F\+F\+S\+E\+T}}
\index{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+C\+P\+Y\+\_\+\+O\+F\+F\+S\+E\+T@{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+C\+P\+Y\+\_\+\+O\+F\+F\+S\+E\+T}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+C\+P\+Y\+\_\+\+O\+F\+F\+S\+E\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+C\+P\+Y\+\_\+\+O\+F\+F\+S\+E\+T(
\begin{DoxyParamCaption}
\item[{}]{match, }
\item[{}]{offset, }
\item[{}]{value\+\_\+p, }
\item[{}]{len, }
\item[{}]{is\+\_\+mask}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_aceedf9228ebbe5291ac9e12d1d011278}
{\bfseries Value\+:}
\begin{DoxyCode}
\textcolor{keywordflow}{do} \{                                    \hyperlink{linux_2flow__netlink_8c_ac21a080dcc5b01d3da9b75d32b13fb40}{\(\backslash\)}
\hyperlink{linux_2flow__netlink_8c_ac21a080dcc5b01d3da9b75d32b13fb40}{        update\_range}(match, offset, len, is\_mask);            \(\backslash\)
        if (is\_mask)                            \(\backslash\)
            memcpy((u8 *)&(match)->mask->key + offset, value\_p, len);\(\backslash\)
        else                                \(\backslash\)
            memcpy((u8 *)(match)->key + offset, value\_p, len);  \(\backslash\)
    \} \textcolor{keywordflow}{while} (0)
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a428fac9f6cc49614e07de128b9e4869f}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+S\+E\+T\+\_\+\+F\+I\+E\+L\+D@{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+S\+E\+T\+\_\+\+F\+I\+E\+L\+D}}
\index{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+S\+E\+T\+\_\+\+F\+I\+E\+L\+D@{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+S\+E\+T\+\_\+\+F\+I\+E\+L\+D}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+S\+E\+T\+\_\+\+F\+I\+E\+L\+D}]{\setlength{\rightskip}{0pt plus 5cm}\#define S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+M\+E\+M\+S\+E\+T\+\_\+\+F\+I\+E\+L\+D(
\begin{DoxyParamCaption}
\item[{}]{match, }
\item[{}]{field, }
\item[{}]{value, }
\item[{}]{is\+\_\+mask}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_a428fac9f6cc49614e07de128b9e4869f}
{\bfseries Value\+:}
\begin{DoxyCode}
\textcolor{keywordflow}{do} \{                                    \hyperlink{linux_2flow__netlink_8c_ac21a080dcc5b01d3da9b75d32b13fb40}{\(\backslash\)}
\hyperlink{linux_2flow__netlink_8c_ac21a080dcc5b01d3da9b75d32b13fb40}{        update\_range}(match, offsetof(\textcolor{keyword}{struct} \hyperlink{structsw__flow__key}{sw\_flow\_key}, field),    \(\backslash\)
                 \textcolor{keyword}{sizeof}((match)->key->field), is\_mask);     \(\backslash\)
        if (is\_mask)                            \(\backslash\)
            memset((u8 *)&(match)->mask->key.field, value,      \(\backslash\)
                   \textcolor{keyword}{sizeof}((match)->mask->key.field));       \(\backslash\)
        else                                \(\backslash\)
            memset((u8 *)&(match)->key->field, value,           \(\backslash\)
                   \textcolor{keyword}{sizeof}((match)->key->field));                \(\backslash\)
    \} \textcolor{keywordflow}{while} (0)
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+P\+U\+T@{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+P\+U\+T}}
\index{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+P\+U\+T@{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+P\+U\+T}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+P\+U\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define S\+W\+\_\+\+F\+L\+O\+W\+\_\+\+K\+E\+Y\+\_\+\+P\+U\+T(
\begin{DoxyParamCaption}
\item[{}]{match, }
\item[{}]{field, }
\item[{}]{value, }
\item[{}]{is\+\_\+mask}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}
{\bfseries Value\+:}
\begin{DoxyCode}
\textcolor{keywordflow}{do} \{ \hyperlink{linux_2flow__netlink_8c_ac21a080dcc5b01d3da9b75d32b13fb40}{\(\backslash\)}
\hyperlink{linux_2flow__netlink_8c_ac21a080dcc5b01d3da9b75d32b13fb40}{        update\_range}(match, offsetof(\textcolor{keyword}{struct} \hyperlink{structsw__flow__key}{sw\_flow\_key}, field),    \(\backslash\)
                 \textcolor{keyword}{sizeof}((match)->key->field), is\_mask);     \(\backslash\)
        if (is\_mask)                            \(\backslash\)
            (match)->mask->key.field = value;           \(\backslash\)
        \textcolor{keywordflow}{else}                                \(\backslash\)
            (match)->key->field = value;                    \(\backslash\)
    \} \textcolor{keywordflow}{while} (0)
\end{DoxyCode}


\subsection{Function Documentation}
\hypertarget{linux_2flow__netlink_8c_ad6fb4bf743e36b42c72eaa09db192e87}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!\+\_\+\+\_\+add\+\_\+action@{\+\_\+\+\_\+add\+\_\+action}}
\index{\+\_\+\+\_\+add\+\_\+action@{\+\_\+\+\_\+add\+\_\+action}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{\+\_\+\+\_\+add\+\_\+action}]{\setlength{\rightskip}{0pt plus 5cm}static struct nlattr$\ast$ \+\_\+\+\_\+add\+\_\+action (
\begin{DoxyParamCaption}
\item[{struct {\bf sw\+\_\+flow\+\_\+actions} $\ast$$\ast$}]{sfa, }
\item[{int}]{attrtype, }
\item[{void $\ast$}]{data, }
\item[{int}]{len, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_ad6fb4bf743e36b42c72eaa09db192e87}

\begin{DoxyCode}
1604 \{
1605     \textcolor{keyword}{struct }nlattr *a;
1606 
1607     a = \hyperlink{linux_2flow__netlink_8c_a5ce53ec8a0a126f8e33e1d9af6e1e083}{reserve\_sfa\_size}(sfa, nla\_attr\_size(len), log);
1608     \textcolor{keywordflow}{if} (IS\_ERR(a))
1609         \textcolor{keywordflow}{return} a;
1610 
1611     a->nla\_type = attrtype;
1612     a->nla\_len = nla\_attr\_size(len);
1613 
1614     \textcolor{keywordflow}{if} (data)
1615         memcpy(nla\_data(a), data, len);
1616     memset((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *) a + a->nla\_len, 0, nla\_padlen(len));
1617 
1618     \textcolor{keywordflow}{return} a;
1619 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_ac7f453fb68977c7a24d7af50f18b43db}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!\+\_\+\+\_\+ipv4\+\_\+tun\+\_\+to\+\_\+nlattr@{\+\_\+\+\_\+ipv4\+\_\+tun\+\_\+to\+\_\+nlattr}}
\index{\+\_\+\+\_\+ipv4\+\_\+tun\+\_\+to\+\_\+nlattr@{\+\_\+\+\_\+ipv4\+\_\+tun\+\_\+to\+\_\+nlattr}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{\+\_\+\+\_\+ipv4\+\_\+tun\+\_\+to\+\_\+nlattr}]{\setlength{\rightskip}{0pt plus 5cm}static int \+\_\+\+\_\+ipv4\+\_\+tun\+\_\+to\+\_\+nlattr (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{const struct {\bf ovs\+\_\+key\+\_\+ipv4\+\_\+tunnel} $\ast$}]{output, }
\item[{const void $\ast$}]{tun\+\_\+opts, }
\item[{int}]{swkey\+\_\+tun\+\_\+opts\+\_\+len}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_ac7f453fb68977c7a24d7af50f18b43db}

\begin{DoxyCode}
646 \{
647     \textcolor{keywordflow}{if} (output->\hyperlink{structovs__key__ipv4__tunnel_a7459e66ecf90329eb2fa6cf3fc4781db}{tun\_flags} & \hyperlink{ip__tunnels_8h_a5438f4a0ea8e58438776fffbed3f08a8}{TUNNEL\_KEY} &&
648         \hyperlink{net_2netlink_8h_a610b2c7f3f7996a3b2406ce1bc708b5e}{nla\_put\_be64}(skb, \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427abba6b12276aaae09ecdf61a2189edda5}{OVS\_TUNNEL\_KEY\_ATTR\_ID}, output->
      \hyperlink{structovs__key__ipv4__tunnel_ae36132bc05ca6257b572edddffcb867a}{tun\_id}))
649         \textcolor{keywordflow}{return} -EMSGSIZE;
650     \textcolor{keywordflow}{if} (output->\hyperlink{structovs__key__ipv4__tunnel_a1e5a978f104d61e9694e914a109734a7}{ipv4\_src} &&
651         \hyperlink{net_2netlink_8h_a2e2a0bd10c5f5139dc80413fd8dcbbe7}{nla\_put\_be32}(skb, \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427add76f93836f5e1dcb33419c58aa1afd0}{OVS\_TUNNEL\_KEY\_ATTR\_IPV4\_SRC}, output->
      \hyperlink{structovs__key__ipv4__tunnel_a1e5a978f104d61e9694e914a109734a7}{ipv4\_src}))
652         \textcolor{keywordflow}{return} -EMSGSIZE;
653     \textcolor{keywordflow}{if} (output->\hyperlink{structovs__key__ipv4__tunnel_ae443d381a97f53bbc4139fe36c0aae30}{ipv4\_dst} &&
654         \hyperlink{net_2netlink_8h_a2e2a0bd10c5f5139dc80413fd8dcbbe7}{nla\_put\_be32}(skb, \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427aa8a1fb062a0a5c1c718096a530c1fee9}{OVS\_TUNNEL\_KEY\_ATTR\_IPV4\_DST}, output->
      \hyperlink{structovs__key__ipv4__tunnel_ae443d381a97f53bbc4139fe36c0aae30}{ipv4\_dst}))
655         \textcolor{keywordflow}{return} -EMSGSIZE;
656     \textcolor{keywordflow}{if} (output->\hyperlink{structovs__key__ipv4__tunnel_a69594eaf9d7dfc2824b264484e02498e}{ipv4\_tos} &&
657         nla\_put\_u8(skb, \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427ab452549b72cc81cc38c53a0487cded37}{OVS\_TUNNEL\_KEY\_ATTR\_TOS}, output->
      \hyperlink{structovs__key__ipv4__tunnel_a69594eaf9d7dfc2824b264484e02498e}{ipv4\_tos}))
658         \textcolor{keywordflow}{return} -EMSGSIZE;
659     \textcolor{keywordflow}{if} (nla\_put\_u8(skb, \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427ace9b9fe26daaf5d99409d1563cc68f5c}{OVS\_TUNNEL\_KEY\_ATTR\_TTL}, output->
      \hyperlink{structovs__key__ipv4__tunnel_a24de7472a8c22903fce96b73dab68a40}{ipv4\_ttl}))
660         \textcolor{keywordflow}{return} -EMSGSIZE;
661     \textcolor{keywordflow}{if} ((output->\hyperlink{structovs__key__ipv4__tunnel_a7459e66ecf90329eb2fa6cf3fc4781db}{tun\_flags} & \hyperlink{ip__tunnels_8h_a3b33c8fadb48f2281d5852e2a0d8eeff}{TUNNEL\_DONT\_FRAGMENT}) &&
662         nla\_put\_flag(skb, \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a2b4acde1fe308fb5cdb703d197ccad11}{OVS\_TUNNEL\_KEY\_ATTR\_DONT\_FRAGMENT}))
663         \textcolor{keywordflow}{return} -EMSGSIZE;
664     \textcolor{keywordflow}{if} ((output->\hyperlink{structovs__key__ipv4__tunnel_a7459e66ecf90329eb2fa6cf3fc4781db}{tun\_flags} & \hyperlink{ip__tunnels_8h_ac8dc03940c0621b1aeddafa9b620022c}{TUNNEL\_CSUM}) &&
665         nla\_put\_flag(skb, \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a0b2355fe72f1590f795e2febdcb3cafe}{OVS\_TUNNEL\_KEY\_ATTR\_CSUM}))
666         \textcolor{keywordflow}{return} -EMSGSIZE;
667     \textcolor{keywordflow}{if} (output->\hyperlink{structovs__key__ipv4__tunnel_acda46848fad6a931296f3e7a74b44a18}{tp\_src} &&
668         \hyperlink{net_2netlink_8h_aafa7ef6ea62a477fe1cf21d435e2a718}{nla\_put\_be16}(skb, \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a82ec563a3032a39aa9f9694276933101}{OVS\_TUNNEL\_KEY\_ATTR\_TP\_SRC}, output->
      \hyperlink{structovs__key__ipv4__tunnel_acda46848fad6a931296f3e7a74b44a18}{tp\_src}))
669         \textcolor{keywordflow}{return} -EMSGSIZE;
670     \textcolor{keywordflow}{if} (output->\hyperlink{structovs__key__ipv4__tunnel_a438707be6be24ab62236063bde726e9b}{tp\_dst} &&
671         \hyperlink{net_2netlink_8h_aafa7ef6ea62a477fe1cf21d435e2a718}{nla\_put\_be16}(skb, \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a3fa87a8982452cc6e68ddf8e91dfced2}{OVS\_TUNNEL\_KEY\_ATTR\_TP\_DST}, output->
      \hyperlink{structovs__key__ipv4__tunnel_a438707be6be24ab62236063bde726e9b}{tp\_dst}))
672         \textcolor{keywordflow}{return} -EMSGSIZE;
673     \textcolor{keywordflow}{if} ((output->\hyperlink{structovs__key__ipv4__tunnel_a7459e66ecf90329eb2fa6cf3fc4781db}{tun\_flags} & \hyperlink{ip__tunnels_8h_a348bd362fda2a6f1506a9709ac7d0a86}{TUNNEL\_OAM}) &&
674         nla\_put\_flag(skb, \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a72ef8de21b6623d09331a68f87038b95}{OVS\_TUNNEL\_KEY\_ATTR\_OAM}))
675         \textcolor{keywordflow}{return} -EMSGSIZE;
676     \textcolor{keywordflow}{if} (\hyperlink{flow_8h_a58d612a14e56d9b6c782667cd2e89799}{tun\_opts}) \{
677         \textcolor{keywordflow}{if} (output->\hyperlink{structovs__key__ipv4__tunnel_a7459e66ecf90329eb2fa6cf3fc4781db}{tun\_flags} & \hyperlink{ip__tunnels_8h_a730279275492612f215921bf96742457}{TUNNEL\_GENEVE\_OPT} &&
678             nla\_put(skb, \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a3a6f60bb79d6ad889a091b82667009b9}{OVS\_TUNNEL\_KEY\_ATTR\_GENEVE\_OPTS},
679                 swkey\_tun\_opts\_len, \hyperlink{flow_8h_a58d612a14e56d9b6c782667cd2e89799}{tun\_opts}))
680             \textcolor{keywordflow}{return} -EMSGSIZE;
681                \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (output->\hyperlink{structovs__key__ipv4__tunnel_a7459e66ecf90329eb2fa6cf3fc4781db}{tun\_flags} & \hyperlink{ip__tunnels_8h_a50cd9036253f584996011f418422a53f}{TUNNEL\_VXLAN\_OPT} &&
682             \hyperlink{linux_2flow__netlink_8c_a9283dd76011434d73c43654a9c32ecfb}{vxlan\_opt\_to\_nlattr}(skb, \hyperlink{flow_8h_a58d612a14e56d9b6c782667cd2e89799}{tun\_opts}, swkey\_tun\_opts\_len))
683             \textcolor{keywordflow}{return} -EMSGSIZE;
684     \}
685 
686     \textcolor{keywordflow}{return} 0;
687 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_ae5c58b498948d3c5564b7916505d8455}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!\+\_\+\+\_\+ovs\+\_\+nla\+\_\+copy\+\_\+actions@{\+\_\+\+\_\+ovs\+\_\+nla\+\_\+copy\+\_\+actions}}
\index{\+\_\+\+\_\+ovs\+\_\+nla\+\_\+copy\+\_\+actions@{\+\_\+\+\_\+ovs\+\_\+nla\+\_\+copy\+\_\+actions}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{\+\_\+\+\_\+ovs\+\_\+nla\+\_\+copy\+\_\+actions}]{\setlength{\rightskip}{0pt plus 5cm}static int \+\_\+\+\_\+ovs\+\_\+nla\+\_\+copy\+\_\+actions (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{attr, }
\item[{const struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{key, }
\item[{int}]{depth, }
\item[{struct {\bf sw\+\_\+flow\+\_\+actions} $\ast$$\ast$}]{sfa, }
\item[{\+\_\+\+\_\+be16}]{eth\+\_\+type, }
\item[{\+\_\+\+\_\+be16}]{vlan\+\_\+tci, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_ae5c58b498948d3c5564b7916505d8455}

\begin{DoxyCode}
2027 \{
2028     \textcolor{keyword}{const} \textcolor{keyword}{struct }nlattr *a;
2029     \textcolor{keywordtype}{int} rem, err;
2030 
2031     \textcolor{keywordflow}{if} (depth >= \hyperlink{datapath_8h_ad323527e924235c97bf936e4e85dfdba}{SAMPLE\_ACTION\_DEPTH})
2032         \textcolor{keywordflow}{return} -EOVERFLOW;
2033 
2034     \hyperlink{net_2netlink_8h_ac2634af90bda4393105b6323da2044fa}{nla\_for\_each\_nested}(a, attr, rem) \{
2035         \textcolor{comment}{/* Expected argument lengths, (u32)-1 for variable length. */}
2036         \textcolor{keyword}{static} \textcolor{keyword}{const} u32 action\_lens[\hyperlink{openvswitch_8h_a34e29226a74b68f20be64faf2130b7db}{OVS\_ACTION\_ATTR\_MAX} + 1] = \{
2037             [\hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eacad69687bf2bfae5092ea828cf0d4fe2}{OVS\_ACTION\_ATTR\_OUTPUT}] = \textcolor{keyword}{sizeof}(u32),
2038             [\hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26ea2cad0b08a7809d6e7cb1a9e86d73a47c}{OVS\_ACTION\_ATTR\_RECIRC}] = \textcolor{keyword}{sizeof}(u32),
2039             [\hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26ea17132af22505d8b1bb535a270f83a8bd}{OVS\_ACTION\_ATTR\_USERSPACE}] = (u32)-1,
2040             [\hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eafb68488325a1ab2d6bfb67ea115a5cdb}{OVS\_ACTION\_ATTR\_PUSH\_MPLS}] = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} 
      \hyperlink{structovs__action__push__mpls}{ovs\_action\_push\_mpls}),
2041             [\hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eafe4ec9b68459771a3ffd07d20cd628e1}{OVS\_ACTION\_ATTR\_POP\_MPLS}] = \textcolor{keyword}{sizeof}(\_\_be16),
2042             [\hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26ea6f41b7751556ff0acc2f4c6f94963ba6}{OVS\_ACTION\_ATTR\_PUSH\_VLAN}] = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} 
      \hyperlink{structovs__action__push__vlan}{ovs\_action\_push\_vlan}),
2043             [\hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26ea9cd4ec18560c7c3f81276cba51a96a24}{OVS\_ACTION\_ATTR\_POP\_VLAN}] = 0,
2044             [\hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eaff937deb7687d0dd4b073c27aed9c8be}{OVS\_ACTION\_ATTR\_SET}] = (u32)-1,
2045             [\hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26ea50a466abca8b11394e9364de28ebe03f}{OVS\_ACTION\_ATTR\_SET\_MASKED}] = (u32)-1,
2046             [\hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eaddc6f70b9e8501e5bb90548373faf734}{OVS\_ACTION\_ATTR\_SAMPLE}] = (u32)-1,
2047             [\hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eaa783c1e8488baea181d3497e0e9676f9}{OVS\_ACTION\_ATTR\_HASH}] = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} 
      \hyperlink{structovs__action__hash}{ovs\_action\_hash})
2048         \};
2049         \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__action__push__vlan}{ovs\_action\_push\_vlan} *vlan;
2050         \textcolor{keywordtype}{int} \hyperlink{flow_8h_ab22aaab04f806700def00f32823fcb9e}{type} = nla\_type(a);
2051         \textcolor{keywordtype}{bool} skip\_copy;
2052 
2053         \textcolor{keywordflow}{if} (type > \hyperlink{openvswitch_8h_a34e29226a74b68f20be64faf2130b7db}{OVS\_ACTION\_ATTR\_MAX} ||
2054             (action\_lens[type] != nla\_len(a) &&
2055              action\_lens[type] != (u32)-1))
2056             \textcolor{keywordflow}{return} -EINVAL;
2057 
2058         skip\_copy = \textcolor{keyword}{false};
2059         \textcolor{keywordflow}{switch} (type) \{
2060         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26ea7ea71a1f3bf51504d9ee79e77578287b}{OVS\_ACTION\_ATTR\_UNSPEC}:
2061             \textcolor{keywordflow}{return} -EINVAL;
2062 
2063         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26ea17132af22505d8b1bb535a270f83a8bd}{OVS\_ACTION\_ATTR\_USERSPACE}:
2064             err = \hyperlink{linux_2flow__netlink_8c_ab7c5d132ac3085d8c2da993c66138ab0}{validate\_userspace}(a);
2065             \textcolor{keywordflow}{if} (err)
2066                 \textcolor{keywordflow}{return} err;
2067             \textcolor{keywordflow}{break};
2068 
2069         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eacad69687bf2bfae5092ea828cf0d4fe2}{OVS\_ACTION\_ATTR\_OUTPUT}:
2070             \textcolor{keywordflow}{if} (nla\_get\_u32(a) >= \hyperlink{datapath_8h_a73b117dd1ebe456eecfb7688047a03f1}{DP\_MAX\_PORTS})
2071                 \textcolor{keywordflow}{return} -EINVAL;
2072             \textcolor{keywordflow}{break};
2073 
2074         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eaa783c1e8488baea181d3497e0e9676f9}{OVS\_ACTION\_ATTR\_HASH}: \{
2075             \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__action__hash}{ovs\_action\_hash} *act\_hash = nla\_data(a);
2076 
2077             \textcolor{keywordflow}{switch} (act\_hash->\hyperlink{structovs__action__hash_a8dde1557790d7fc7c2cae50f4e6d65e8}{hash\_alg}) \{
2078             \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a26bab1f427f0d834e49cf627cd869b05abc58a227eae8b0c6e494642dd6e62903}{OVS\_HASH\_ALG\_L4}:
2079                 \textcolor{keywordflow}{break};
2080             \textcolor{keywordflow}{default}:
2081                 \textcolor{keywordflow}{return}  -EINVAL;
2082             \}
2083 
2084             \textcolor{keywordflow}{break};
2085         \}
2086 
2087         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26ea9cd4ec18560c7c3f81276cba51a96a24}{OVS\_ACTION\_ATTR\_POP\_VLAN}:
2088             vlan\_tci = htons(0);
2089             \textcolor{keywordflow}{break};
2090 
2091         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26ea6f41b7751556ff0acc2f4c6f94963ba6}{OVS\_ACTION\_ATTR\_PUSH\_VLAN}:
2092             vlan = nla\_data(a);
2093             \textcolor{keywordflow}{if} (vlan->\hyperlink{structovs__action__push__vlan_af2e36cd70149cf03ebf29586fc765722}{vlan\_tpid} != htons(ETH\_P\_8021Q))
2094                 \textcolor{keywordflow}{return} -EINVAL;
2095             \textcolor{keywordflow}{if} (!(vlan->\hyperlink{structovs__action__push__vlan_ab17c8db02bffc32a072bd23687dd712c}{vlan\_tci} & htons(\hyperlink{if__vlan_8h_ac8bf15be3fd1a3a63a2452fa05a83217}{VLAN\_TAG\_PRESENT})))
2096                 \textcolor{keywordflow}{return} -EINVAL;
2097             vlan\_tci = vlan->\hyperlink{structovs__action__push__vlan_ab17c8db02bffc32a072bd23687dd712c}{vlan\_tci};
2098             \textcolor{keywordflow}{break};
2099 
2100         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26ea2cad0b08a7809d6e7cb1a9e86d73a47c}{OVS\_ACTION\_ATTR\_RECIRC}:
2101             \textcolor{keywordflow}{break};
2102 
2103         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eafb68488325a1ab2d6bfb67ea115a5cdb}{OVS\_ACTION\_ATTR\_PUSH\_MPLS}: \{
2104             \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__action__push__mpls}{ovs\_action\_push\_mpls} *\hyperlink{flow_8h_aeab2d67b4ec58a9575da76c323ad95ce}{mpls} = nla\_data(a);
2105 
2106             \textcolor{keywordflow}{if} (!\hyperlink{net_2mpls_8h_aab48ab242fbafafc869b3e98df4ace8f}{eth\_p\_mpls}(mpls->\hyperlink{structovs__action__push__mpls_adea8de7c1e924d0665c4eb62901ce521}{mpls\_ethertype}))
2107                 \textcolor{keywordflow}{return} -EINVAL;
2108             \textcolor{comment}{/* Prohibit push MPLS other than to a white list}
2109 \textcolor{comment}{             * for packets that have a known tag order.}
2110 \textcolor{comment}{             */}
2111             \textcolor{keywordflow}{if} (vlan\_tci & htons(\hyperlink{if__vlan_8h_ac8bf15be3fd1a3a63a2452fa05a83217}{VLAN\_TAG\_PRESENT}) ||
2112                 (eth\_type != htons(ETH\_P\_IP) &&
2113                  eth\_type != htons(ETH\_P\_IPV6) &&
2114                  eth\_type != htons(ETH\_P\_ARP) &&
2115                  eth\_type != htons(ETH\_P\_RARP) &&
2116                  !\hyperlink{net_2mpls_8h_aab48ab242fbafafc869b3e98df4ace8f}{eth\_p\_mpls}(eth\_type)))
2117                 \textcolor{keywordflow}{return} -EINVAL;
2118             eth\_type = mpls->\hyperlink{structovs__action__push__mpls_adea8de7c1e924d0665c4eb62901ce521}{mpls\_ethertype};
2119             \textcolor{keywordflow}{break};
2120         \}
2121 
2122         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eafe4ec9b68459771a3ffd07d20cd628e1}{OVS\_ACTION\_ATTR\_POP\_MPLS}:
2123             \textcolor{keywordflow}{if} (vlan\_tci & htons(\hyperlink{if__vlan_8h_ac8bf15be3fd1a3a63a2452fa05a83217}{VLAN\_TAG\_PRESENT}) ||
2124                 !\hyperlink{net_2mpls_8h_aab48ab242fbafafc869b3e98df4ace8f}{eth\_p\_mpls}(eth\_type))
2125                 \textcolor{keywordflow}{return} -EINVAL;
2126 
2127             \textcolor{comment}{/* Disallow subsequent L2.5+ set and mpls\_pop actions}
2128 \textcolor{comment}{             * as there is no check here to ensure that the new}
2129 \textcolor{comment}{             * eth\_type is valid and thus set actions could}
2130 \textcolor{comment}{             * write off the end of the packet or otherwise}
2131 \textcolor{comment}{             * corrupt it.}
2132 \textcolor{comment}{             *}
2133 \textcolor{comment}{             * Support for these actions is planned using packet}
2134 \textcolor{comment}{             * recirculation.}
2135 \textcolor{comment}{             */}
2136             eth\_type = htons(0);
2137             \textcolor{keywordflow}{break};
2138 
2139         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eaff937deb7687d0dd4b073c27aed9c8be}{OVS\_ACTION\_ATTR\_SET}:
2140             err = \hyperlink{linux_2flow__netlink_8c_afabdbd008e8fb3c515063cafaf267e02}{validate\_set}(a, key, sfa,
2141                        &skip\_copy, eth\_type, \textcolor{keyword}{false}, log);
2142             \textcolor{keywordflow}{if} (err)
2143                 \textcolor{keywordflow}{return} err;
2144             \textcolor{keywordflow}{break};
2145 
2146         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26ea50a466abca8b11394e9364de28ebe03f}{OVS\_ACTION\_ATTR\_SET\_MASKED}:
2147             err = \hyperlink{linux_2flow__netlink_8c_afabdbd008e8fb3c515063cafaf267e02}{validate\_set}(a, key, sfa,
2148                        &skip\_copy, eth\_type, \textcolor{keyword}{true}, log);
2149             \textcolor{keywordflow}{if} (err)
2150                 \textcolor{keywordflow}{return} err;
2151             \textcolor{keywordflow}{break};
2152 
2153         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eaddc6f70b9e8501e5bb90548373faf734}{OVS\_ACTION\_ATTR\_SAMPLE}:
2154             err = \hyperlink{linux_2flow__netlink_8c_a0dcf3429559610cf8b8204e04151728b}{validate\_and\_copy\_sample}(a, key, depth, sfa,
2155                                eth\_type, vlan\_tci, log);
2156             \textcolor{keywordflow}{if} (err)
2157                 \textcolor{keywordflow}{return} err;
2158             skip\_copy = \textcolor{keyword}{true};
2159             \textcolor{keywordflow}{break};
2160 
2161         \textcolor{keywordflow}{default}:
2162             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Unknown Action type %d"}, type);
2163             \textcolor{keywordflow}{return} -EINVAL;
2164         \}
2165         \textcolor{keywordflow}{if} (!skip\_copy) \{
2166             err = \hyperlink{linux_2flow__netlink_8c_a746e2c558f7350550b1734826a8c25f7}{copy\_action}(a, sfa, log);
2167             \textcolor{keywordflow}{if} (err)
2168                 \textcolor{keywordflow}{return} err;
2169         \}
2170     \}
2171 
2172     \textcolor{keywordflow}{if} (rem > 0)
2173         \textcolor{keywordflow}{return} -EINVAL;
2174 
2175     \textcolor{keywordflow}{return} 0;
2176 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a469e9434d0bedd721b2e31a106799335}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!\+\_\+\+\_\+ovs\+\_\+nla\+\_\+put\+\_\+key@{\+\_\+\+\_\+ovs\+\_\+nla\+\_\+put\+\_\+key}}
\index{\+\_\+\+\_\+ovs\+\_\+nla\+\_\+put\+\_\+key@{\+\_\+\+\_\+ovs\+\_\+nla\+\_\+put\+\_\+key}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{\+\_\+\+\_\+ovs\+\_\+nla\+\_\+put\+\_\+key}]{\setlength{\rightskip}{0pt plus 5cm}static int \+\_\+\+\_\+ovs\+\_\+nla\+\_\+put\+\_\+key (
\begin{DoxyParamCaption}
\item[{const struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{swkey, }
\item[{const struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{output, }
\item[{{\bf bool}}]{is\+\_\+mask, }
\item[{struct sk\+\_\+buff $\ast$}]{skb}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a469e9434d0bedd721b2e31a106799335}

\begin{DoxyCode}
1277 \{
1278     \textcolor{keyword}{struct }\hyperlink{structovs__key__ethernet}{ovs\_key\_ethernet} *eth\_key;
1279     \textcolor{keyword}{struct }nlattr *nla, *encap;
1280 
1281     \textcolor{keywordflow}{if} (nla\_put\_u32(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864afa5af2b14a419c06035a864807572a69}{OVS\_KEY\_ATTR\_RECIRC\_ID}, output->
      \hyperlink{structsw__flow__key_a7e51857c88ad6b0bf90551d0b6e2607b}{recirc\_id}))
1282         \textcolor{keywordflow}{goto} nla\_put\_failure;
1283 
1284     \textcolor{keywordflow}{if} (nla\_put\_u32(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a8f119543030b5cafc424d37ef817208d}{OVS\_KEY\_ATTR\_DP\_HASH}, output->
      \hyperlink{structsw__flow__key_a73dd9402f1f54c321f6d704d9b018d15}{ovs\_flow\_hash}))
1285         \textcolor{keywordflow}{goto} nla\_put\_failure;
1286 
1287     \textcolor{keywordflow}{if} (nla\_put\_u32(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a3dee91d2ad17f698e34ebb913fcef8bf}{OVS\_KEY\_ATTR\_PRIORITY}, output->\hyperlink{structsw__flow__key_a57cbddb75a8d4fd859300bd34d98e84a}{phy}.
      \hyperlink{structsw__flow__key_a9dd898913d9faaec1ec970029e7fbb71}{priority}))
1288         \textcolor{keywordflow}{goto} nla\_put\_failure;
1289 
1290     \textcolor{keywordflow}{if} ((swkey->\hyperlink{structsw__flow__key_a2f87b7690c0cc2797f1f4347589472c3}{tun\_key}.\hyperlink{structovs__key__ipv4__tunnel_ae443d381a97f53bbc4139fe36c0aae30}{ipv4\_dst} || is\_mask)) \{
1291         \textcolor{keyword}{const} \textcolor{keywordtype}{void} *opts = NULL;
1292 
1293         \textcolor{keywordflow}{if} (output->\hyperlink{structsw__flow__key_a2f87b7690c0cc2797f1f4347589472c3}{tun\_key}.\hyperlink{structovs__key__ipv4__tunnel_a7459e66ecf90329eb2fa6cf3fc4781db}{tun\_flags} & \hyperlink{ip__tunnels_8h_ac6f5dad11c0e109bffb0a6dd5afdf8fb}{TUNNEL\_OPTIONS\_PRESENT})
1294             opts = \hyperlink{flow_8h_a5d74524a15e17551a8d8235f4375c296}{TUN\_METADATA\_OPTS}(output, swkey->
      \hyperlink{structsw__flow__key_aef0ea317d3bd0125e0d6390261ba3e2d}{tun\_opts\_len});
1295 
1296         \textcolor{keywordflow}{if} (\hyperlink{linux_2flow__netlink_8c_a534ea0693e07f81a7a00f4b3125fbb1a}{ipv4\_tun\_to\_nlattr}(skb, &output->\hyperlink{structsw__flow__key_a2f87b7690c0cc2797f1f4347589472c3}{tun\_key}, opts,
1297                        swkey->\hyperlink{structsw__flow__key_aef0ea317d3bd0125e0d6390261ba3e2d}{tun\_opts\_len}))
1298             \textcolor{keywordflow}{goto} nla\_put\_failure;
1299     \}
1300 
1301     \textcolor{keywordflow}{if} (swkey->\hyperlink{structsw__flow__key_a57cbddb75a8d4fd859300bd34d98e84a}{phy}.\hyperlink{structsw__flow__key_a5848de18caa80d36d9bc60cc686a2c6e}{in\_port} == \hyperlink{datapath_8h_a73b117dd1ebe456eecfb7688047a03f1}{DP\_MAX\_PORTS}) \{
1302         \textcolor{keywordflow}{if} (is\_mask && (output->\hyperlink{structsw__flow__key_a57cbddb75a8d4fd859300bd34d98e84a}{phy}.\hyperlink{structsw__flow__key_a5848de18caa80d36d9bc60cc686a2c6e}{in\_port} == 0xffff))
1303             \textcolor{keywordflow}{if} (nla\_put\_u32(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a84a968b0e1dd75ba2f6b543c7fcde5b4}{OVS\_KEY\_ATTR\_IN\_PORT}, 0xffffffff))
1304                 \textcolor{keywordflow}{goto} nla\_put\_failure;
1305     \} \textcolor{keywordflow}{else} \{
1306         u16 upper\_u16;
1307         upper\_u16 = !is\_mask ? 0 : 0xffff;
1308 
1309         \textcolor{keywordflow}{if} (nla\_put\_u32(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a84a968b0e1dd75ba2f6b543c7fcde5b4}{OVS\_KEY\_ATTR\_IN\_PORT},
1310                 (upper\_u16 << 16) | output->\hyperlink{structsw__flow__key_a57cbddb75a8d4fd859300bd34d98e84a}{phy}.\hyperlink{structsw__flow__key_a5848de18caa80d36d9bc60cc686a2c6e}{in\_port}))
1311             \textcolor{keywordflow}{goto} nla\_put\_failure;
1312     \}
1313 
1314     \textcolor{keywordflow}{if} (nla\_put\_u32(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a32f36d9e41b0fbae0746d67fa34340ad}{OVS\_KEY\_ATTR\_SKB\_MARK}, output->\hyperlink{structsw__flow__key_a57cbddb75a8d4fd859300bd34d98e84a}{phy}.
      \hyperlink{structsw__flow__key_ae02571657f29397dcc45de8528f4ed05}{skb\_mark}))
1315         \textcolor{keywordflow}{goto} nla\_put\_failure;
1316 
1317     nla = nla\_reserve(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a75127b87d8a2f36ae2c9aae2cf42cd56}{OVS\_KEY\_ATTR\_ETHERNET}, \textcolor{keyword}{sizeof}(*eth\_key));
1318     \textcolor{keywordflow}{if} (!nla)
1319         \textcolor{keywordflow}{goto} nla\_put\_failure;
1320 
1321     eth\_key = nla\_data(nla);
1322     \hyperlink{etherdevice_8h_a564a2ea461aa6add2fa94a6864ee494d}{ether\_addr\_copy}(eth\_key->\hyperlink{structovs__key__ethernet_adc19d64e3aa45c9383f332981780b79b}{eth\_src}, output->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_a2fbd4aa7a500630627eff0630f864117}{src});
1323     \hyperlink{etherdevice_8h_a564a2ea461aa6add2fa94a6864ee494d}{ether\_addr\_copy}(eth\_key->\hyperlink{structovs__key__ethernet_a12fa99b386c86f65221f6d2394a9d7c9}{eth\_dst}, output->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_a44a0cdfe7471df8bb73762085da4cda9}{dst});
1324 
1325     \textcolor{keywordflow}{if} (swkey->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_a56b27b9b9eafa8f79acd544eba98c7b0}{tci} || swkey->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(ETH\_P\_8021Q)) \{
1326         \_\_be16 eth\_type;
1327         eth\_type = !is\_mask ? htons(ETH\_P\_8021Q) : htons(0xffff);
1328         \textcolor{keywordflow}{if} (\hyperlink{net_2netlink_8h_aafa7ef6ea62a477fe1cf21d435e2a718}{nla\_put\_be16}(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aaccef1ecf941c78c70cf8a6a3374235a}{OVS\_KEY\_ATTR\_ETHERTYPE}, eth\_type) ||
1329             \hyperlink{net_2netlink_8h_aafa7ef6ea62a477fe1cf21d435e2a718}{nla\_put\_be16}(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864ae513231d4612ed9b19551a7e70648005}{OVS\_KEY\_ATTR\_VLAN}, output->
      \hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_a56b27b9b9eafa8f79acd544eba98c7b0}{tci}))
1330             \textcolor{keywordflow}{goto} nla\_put\_failure;
1331         encap = nla\_nest\_start(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a869b60116d7d6ac79bfad91cc808cf75}{OVS\_KEY\_ATTR\_ENCAP});
1332         \textcolor{keywordflow}{if} (!swkey->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_a56b27b9b9eafa8f79acd544eba98c7b0}{tci})
1333             \textcolor{keywordflow}{goto} unencap;
1334     \} \textcolor{keywordflow}{else}
1335         encap = NULL;
1336 
1337     \textcolor{keywordflow}{if} (swkey->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(ETH\_P\_802\_2)) \{
1338         \textcolor{comment}{/*}
1339 \textcolor{comment}{         * Ethertype 802.2 is represented in the netlink with omitted}
1340 \textcolor{comment}{         * OVS\_KEY\_ATTR\_ETHERTYPE in the flow key attribute, and}
1341 \textcolor{comment}{         * 0xffff in the mask attribute.  Ethertype can also}
1342 \textcolor{comment}{         * be wildcarded.}
1343 \textcolor{comment}{         */}
1344         \textcolor{keywordflow}{if} (is\_mask && output->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type})
1345             \textcolor{keywordflow}{if} (\hyperlink{net_2netlink_8h_aafa7ef6ea62a477fe1cf21d435e2a718}{nla\_put\_be16}(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aaccef1ecf941c78c70cf8a6a3374235a}{OVS\_KEY\_ATTR\_ETHERTYPE},
1346                         output->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type}))
1347                 \textcolor{keywordflow}{goto} nla\_put\_failure;
1348         \textcolor{keywordflow}{goto} unencap;
1349     \}
1350 
1351     \textcolor{keywordflow}{if} (\hyperlink{net_2netlink_8h_aafa7ef6ea62a477fe1cf21d435e2a718}{nla\_put\_be16}(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aaccef1ecf941c78c70cf8a6a3374235a}{OVS\_KEY\_ATTR\_ETHERTYPE}, output->
      \hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type}))
1352         \textcolor{keywordflow}{goto} nla\_put\_failure;
1353 
1354     \textcolor{keywordflow}{if} (swkey->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(ETH\_P\_IP)) \{
1355         \textcolor{keyword}{struct }\hyperlink{structovs__key__ipv4}{ovs\_key\_ipv4} *ipv4\_key;
1356 
1357         nla = nla\_reserve(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a67c672ef69eb0c5db9136812e3cdd92e}{OVS\_KEY\_ATTR\_IPV4}, \textcolor{keyword}{sizeof}(*ipv4\_key));
1358         \textcolor{keywordflow}{if} (!nla)
1359             \textcolor{keywordflow}{goto} nla\_put\_failure;
1360         ipv4\_key = nla\_data(nla);
1361         ipv4\_key->\hyperlink{structovs__key__ipv4_a3577eccaa5f978ba303d2424e3e31a13}{ipv4\_src} = output->\hyperlink{structsw__flow__key_aeb4295bcb2fb4efea5c30337b871a423}{ipv4}.addr.src;
1362         ipv4\_key->\hyperlink{structovs__key__ipv4_aa15aabd69c2881215e666585cea50064}{ipv4\_dst} = output->\hyperlink{structsw__flow__key_aeb4295bcb2fb4efea5c30337b871a423}{ipv4}.addr.dst;
1363         ipv4\_key->\hyperlink{structovs__key__ipv4_ac973a2efc8d310948e3713a5c5a7fabf}{ipv4\_proto} = output->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto;
1364         ipv4\_key->\hyperlink{structovs__key__ipv4_a0097feb04c0db1cc6621a58f74ac0e33}{ipv4\_tos} = output->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.tos;
1365         ipv4\_key->\hyperlink{structovs__key__ipv4_ac2142e7329a6e522b3a0d504bec22678}{ipv4\_ttl} = output->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.ttl;
1366         ipv4\_key->\hyperlink{structovs__key__ipv4_a47225bcfead6875052b2678c96d3f9b3}{ipv4\_frag} = output->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.frag;
1367     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (swkey->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(ETH\_P\_IPV6)) \{
1368         \textcolor{keyword}{struct }\hyperlink{structovs__key__ipv6}{ovs\_key\_ipv6} *ipv6\_key;
1369 
1370         nla = nla\_reserve(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aff74bae1efeecfd5d6cf28d8987a8bfd}{OVS\_KEY\_ATTR\_IPV6}, \textcolor{keyword}{sizeof}(*ipv6\_key));
1371         \textcolor{keywordflow}{if} (!nla)
1372             \textcolor{keywordflow}{goto} nla\_put\_failure;
1373         ipv6\_key = nla\_data(nla);
1374         memcpy(ipv6\_key->\hyperlink{structovs__key__ipv6_ac1ff8dfd6a3b86196c2267b64077517e}{ipv6\_src}, &output->\hyperlink{structsw__flow__key_a6b13e14d62eb632b05378784a2d61f87}{ipv6}.addr.src,
1375                 \textcolor{keyword}{sizeof}(ipv6\_key->\hyperlink{structovs__key__ipv6_ac1ff8dfd6a3b86196c2267b64077517e}{ipv6\_src}));
1376         memcpy(ipv6\_key->\hyperlink{structovs__key__ipv6_a32109125c4fc7b02b01ac84e9af8e447}{ipv6\_dst}, &output->\hyperlink{structsw__flow__key_a6b13e14d62eb632b05378784a2d61f87}{ipv6}.addr.dst,
1377                 \textcolor{keyword}{sizeof}(ipv6\_key->\hyperlink{structovs__key__ipv6_a32109125c4fc7b02b01ac84e9af8e447}{ipv6\_dst}));
1378         ipv6\_key->\hyperlink{structovs__key__ipv6_a723a1a03d115ebe2a9fdada09e63bd0c}{ipv6\_label} = output->\hyperlink{structsw__flow__key_a6b13e14d62eb632b05378784a2d61f87}{ipv6}.label;
1379         ipv6\_key->\hyperlink{structovs__key__ipv6_a194ad047677db5a081bdd730b20f8007}{ipv6\_proto} = output->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto;
1380         ipv6\_key->\hyperlink{structovs__key__ipv6_a391295d87ca76a365cc78fd92c4e4615}{ipv6\_tclass} = output->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.tos;
1381         ipv6\_key->\hyperlink{structovs__key__ipv6_a5273b4aa4bba11f547cfa0687acaaeae}{ipv6\_hlimit} = output->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.ttl;
1382         ipv6\_key->\hyperlink{structovs__key__ipv6_ace1ae2a8c22670bde77abadde9101d27}{ipv6\_frag} = output->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.frag;
1383     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (swkey->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(ETH\_P\_ARP) ||
1384            swkey->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(ETH\_P\_RARP)) \{
1385         \textcolor{keyword}{struct }\hyperlink{structovs__key__arp}{ovs\_key\_arp} *arp\_key;
1386 
1387         nla = nla\_reserve(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a78599a1574b0b24244c2911e420a951b}{OVS\_KEY\_ATTR\_ARP}, \textcolor{keyword}{sizeof}(*arp\_key));
1388         \textcolor{keywordflow}{if} (!nla)
1389             \textcolor{keywordflow}{goto} nla\_put\_failure;
1390         arp\_key = nla\_data(nla);
1391         memset(arp\_key, 0, \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structovs__key__arp}{ovs\_key\_arp}));
1392         arp\_key->\hyperlink{structovs__key__arp_a25ce3912d909430a080dd3264d858892}{arp\_sip} = output->\hyperlink{structsw__flow__key_aeb4295bcb2fb4efea5c30337b871a423}{ipv4}.addr.src;
1393         arp\_key->\hyperlink{structovs__key__arp_a84a3d1edd8ba5960d41a69155e721d20}{arp\_tip} = output->\hyperlink{structsw__flow__key_aeb4295bcb2fb4efea5c30337b871a423}{ipv4}.addr.dst;
1394         arp\_key->\hyperlink{structovs__key__arp_a560ecc1caa0ae74b43abe0d5dd30306d}{arp\_op} = htons(output->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto);
1395         \hyperlink{etherdevice_8h_a564a2ea461aa6add2fa94a6864ee494d}{ether\_addr\_copy}(arp\_key->\hyperlink{structovs__key__arp_a99f6141da2e3151181663f27ab1a3560}{arp\_sha}, output->\hyperlink{structsw__flow__key_aeb4295bcb2fb4efea5c30337b871a423}{ipv4}.arp.sha);
1396         \hyperlink{etherdevice_8h_a564a2ea461aa6add2fa94a6864ee494d}{ether\_addr\_copy}(arp\_key->\hyperlink{structovs__key__arp_ab9f27ebc29aee381031d9b89d1b954ac}{arp\_tha}, output->\hyperlink{structsw__flow__key_aeb4295bcb2fb4efea5c30337b871a423}{ipv4}.arp.tha);
1397     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{net_2mpls_8h_aab48ab242fbafafc869b3e98df4ace8f}{eth\_p\_mpls}(swkey->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type})) \{
1398         \textcolor{keyword}{struct }\hyperlink{structovs__key__mpls}{ovs\_key\_mpls} *mpls\_key;
1399 
1400         nla = nla\_reserve(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864ac46f7c8520cb93d091b4247ef8707f7b}{OVS\_KEY\_ATTR\_MPLS}, \textcolor{keyword}{sizeof}(*mpls\_key));
1401         \textcolor{keywordflow}{if} (!nla)
1402             \textcolor{keywordflow}{goto} nla\_put\_failure;
1403         mpls\_key = nla\_data(nla);
1404         mpls\_key->\hyperlink{structovs__key__mpls_a44b32d5066667b5b1bf474b53a335fb1}{mpls\_lse} = output->\hyperlink{structsw__flow__key_a005840d04ee5b462be3c8e21809dc9aa}{mpls}.top\_lse;
1405     \}
1406 
1407     \textcolor{keywordflow}{if} ((swkey->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(ETH\_P\_IP) ||
1408          swkey->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(ETH\_P\_IPV6)) &&
1409          swkey->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.frag != \hyperlink{openvswitch_8h_ad843f713a855bfcacd0adfe3e98eb447a1d1c9f89ced33419ec870391d8954c10}{OVS\_FRAG\_TYPE\_LATER}) \{
1410 
1411         \textcolor{keywordflow}{if} (swkey->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == IPPROTO\_TCP) \{
1412             \textcolor{keyword}{struct }\hyperlink{structovs__key__tcp}{ovs\_key\_tcp} *tcp\_key;
1413 
1414             nla = nla\_reserve(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a120ca2131b2881b0c52b6fcc8f6cccb5}{OVS\_KEY\_ATTR\_TCP}, \textcolor{keyword}{sizeof}(*tcp\_key));
1415             \textcolor{keywordflow}{if} (!nla)
1416                 \textcolor{keywordflow}{goto} nla\_put\_failure;
1417             tcp\_key = nla\_data(nla);
1418             tcp\_key->\hyperlink{structovs__key__tcp_a6ce4cb2971be0b952a5a7cde1eefc28e}{tcp\_src} = output->\hyperlink{structsw__flow__key_a9c1944a39db1bf91141048df6d85ce8b}{tp}.\hyperlink{structsw__flow__key_a2fbd4aa7a500630627eff0630f864117}{src};
1419             tcp\_key->\hyperlink{structovs__key__tcp_a37a5793e8ba3701ac70693073a24668a}{tcp\_dst} = output->\hyperlink{structsw__flow__key_a9c1944a39db1bf91141048df6d85ce8b}{tp}.\hyperlink{structsw__flow__key_a44a0cdfe7471df8bb73762085da4cda9}{dst};
1420             \textcolor{keywordflow}{if} (\hyperlink{net_2netlink_8h_aafa7ef6ea62a477fe1cf21d435e2a718}{nla\_put\_be16}(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a79bb45fd4c1a62364eec929283795161}{OVS\_KEY\_ATTR\_TCP\_FLAGS},
1421                      output->\hyperlink{structsw__flow__key_a9c1944a39db1bf91141048df6d85ce8b}{tp}.\hyperlink{structsw__flow__key_a910f5e4408d113dbc9211190b44e0880}{flags}))
1422                 \textcolor{keywordflow}{goto} nla\_put\_failure;
1423         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (swkey->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == IPPROTO\_UDP) \{
1424             \textcolor{keyword}{struct }\hyperlink{structovs__key__udp}{ovs\_key\_udp} *udp\_key;
1425 
1426             nla = nla\_reserve(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a4dea7a1acfa9eeffb8f09838bb9f9a7d}{OVS\_KEY\_ATTR\_UDP}, \textcolor{keyword}{sizeof}(*udp\_key));
1427             \textcolor{keywordflow}{if} (!nla)
1428                 \textcolor{keywordflow}{goto} nla\_put\_failure;
1429             udp\_key = nla\_data(nla);
1430             udp\_key->\hyperlink{structovs__key__udp_a771fb692264276a6e170a01d54295b61}{udp\_src} = output->\hyperlink{structsw__flow__key_a9c1944a39db1bf91141048df6d85ce8b}{tp}.\hyperlink{structsw__flow__key_a2fbd4aa7a500630627eff0630f864117}{src};
1431             udp\_key->\hyperlink{structovs__key__udp_ab9a32a0e306acdbf2b5468710836a4d8}{udp\_dst} = output->\hyperlink{structsw__flow__key_a9c1944a39db1bf91141048df6d85ce8b}{tp}.\hyperlink{structsw__flow__key_a44a0cdfe7471df8bb73762085da4cda9}{dst};
1432         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (swkey->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == IPPROTO\_SCTP) \{
1433             \textcolor{keyword}{struct }\hyperlink{structovs__key__sctp}{ovs\_key\_sctp} *sctp\_key;
1434 
1435             nla = nla\_reserve(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a33b7870d10d17ea1604aa83edf40e452}{OVS\_KEY\_ATTR\_SCTP}, \textcolor{keyword}{sizeof}(*sctp\_key));
1436             \textcolor{keywordflow}{if} (!nla)
1437                 \textcolor{keywordflow}{goto} nla\_put\_failure;
1438             sctp\_key = nla\_data(nla);
1439             sctp\_key->\hyperlink{structovs__key__sctp_af10ce527eb1894b4080bd8024e82a1cc}{sctp\_src} = output->\hyperlink{structsw__flow__key_a9c1944a39db1bf91141048df6d85ce8b}{tp}.\hyperlink{structsw__flow__key_a2fbd4aa7a500630627eff0630f864117}{src};
1440             sctp\_key->\hyperlink{structovs__key__sctp_a1fa757d8e013ccfc5672df04cfa3aa7d}{sctp\_dst} = output->\hyperlink{structsw__flow__key_a9c1944a39db1bf91141048df6d85ce8b}{tp}.\hyperlink{structsw__flow__key_a44a0cdfe7471df8bb73762085da4cda9}{dst};
1441         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (swkey->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(ETH\_P\_IP) &&
1442                swkey->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == IPPROTO\_ICMP) \{
1443             \textcolor{keyword}{struct }\hyperlink{structovs__key__icmp}{ovs\_key\_icmp} *icmp\_key;
1444 
1445             nla = nla\_reserve(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a7059323c7b14c529cc9d2ff8d3134de9}{OVS\_KEY\_ATTR\_ICMP}, \textcolor{keyword}{sizeof}(*icmp\_key));
1446             \textcolor{keywordflow}{if} (!nla)
1447                 \textcolor{keywordflow}{goto} nla\_put\_failure;
1448             icmp\_key = nla\_data(nla);
1449             icmp\_key->\hyperlink{structovs__key__icmp_aa1880a0c32ed20143e19948c0169060a}{icmp\_type} = ntohs(output->\hyperlink{structsw__flow__key_a9c1944a39db1bf91141048df6d85ce8b}{tp}.\hyperlink{structsw__flow__key_a2fbd4aa7a500630627eff0630f864117}{src});
1450             icmp\_key->\hyperlink{structovs__key__icmp_ae65b58144b376be4a05f68e7e979497d}{icmp\_code} = ntohs(output->\hyperlink{structsw__flow__key_a9c1944a39db1bf91141048df6d85ce8b}{tp}.\hyperlink{structsw__flow__key_a44a0cdfe7471df8bb73762085da4cda9}{dst});
1451         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (swkey->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(ETH\_P\_IPV6) &&
1452                swkey->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == IPPROTO\_ICMPV6) \{
1453             \textcolor{keyword}{struct }\hyperlink{structovs__key__icmpv6}{ovs\_key\_icmpv6} *icmpv6\_key;
1454 
1455             nla = nla\_reserve(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864af4093db51c9d12b98e1b18d7ddc2b5e3}{OVS\_KEY\_ATTR\_ICMPV6},
1456                         \textcolor{keyword}{sizeof}(*icmpv6\_key));
1457             \textcolor{keywordflow}{if} (!nla)
1458                 \textcolor{keywordflow}{goto} nla\_put\_failure;
1459             icmpv6\_key = nla\_data(nla);
1460             icmpv6\_key->\hyperlink{structovs__key__icmpv6_a2bc3cf02c7b239b7f6f316aa26d9950e}{icmpv6\_type} = ntohs(output->\hyperlink{structsw__flow__key_a9c1944a39db1bf91141048df6d85ce8b}{tp}.\hyperlink{structsw__flow__key_a2fbd4aa7a500630627eff0630f864117}{src});
1461             icmpv6\_key->\hyperlink{structovs__key__icmpv6_a3c3aab85ec0e772e50fbff5c9848558c}{icmpv6\_code} = ntohs(output->\hyperlink{structsw__flow__key_a9c1944a39db1bf91141048df6d85ce8b}{tp}.\hyperlink{structsw__flow__key_a44a0cdfe7471df8bb73762085da4cda9}{dst});
1462 
1463             \textcolor{keywordflow}{if} (icmpv6\_key->\hyperlink{structovs__key__icmpv6_a2bc3cf02c7b239b7f6f316aa26d9950e}{icmpv6\_type} == NDISC\_NEIGHBOUR\_SOLICITATION ||
1464                 icmpv6\_key->\hyperlink{structovs__key__icmpv6_a2bc3cf02c7b239b7f6f316aa26d9950e}{icmpv6\_type} == NDISC\_NEIGHBOUR\_ADVERTISEMENT) \{
1465                 \textcolor{keyword}{struct }\hyperlink{structovs__key__nd}{ovs\_key\_nd} *nd\_key;
1466 
1467                 nla = nla\_reserve(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a6049f54211f31d444025675813d3881b}{OVS\_KEY\_ATTR\_ND}, \textcolor{keyword}{sizeof}(*nd\_key));
1468                 \textcolor{keywordflow}{if} (!nla)
1469                     \textcolor{keywordflow}{goto} nla\_put\_failure;
1470                 nd\_key = nla\_data(nla);
1471                 memcpy(nd\_key->\hyperlink{structovs__key__nd_ab37fa98a8363f7c9600780df6b88a2e7}{nd\_target}, &output->\hyperlink{structsw__flow__key_a6b13e14d62eb632b05378784a2d61f87}{ipv6}.nd.target,
1472                             \textcolor{keyword}{sizeof}(nd\_key->\hyperlink{structovs__key__nd_ab37fa98a8363f7c9600780df6b88a2e7}{nd\_target}));
1473                 \hyperlink{etherdevice_8h_a564a2ea461aa6add2fa94a6864ee494d}{ether\_addr\_copy}(nd\_key->\hyperlink{structovs__key__nd_ad127c3fcbfc08dbf63e762c387f57b12}{nd\_sll}, output->
      \hyperlink{structsw__flow__key_a6b13e14d62eb632b05378784a2d61f87}{ipv6}.nd.sll);
1474                 \hyperlink{etherdevice_8h_a564a2ea461aa6add2fa94a6864ee494d}{ether\_addr\_copy}(nd\_key->\hyperlink{structovs__key__nd_a66559abec4bf299ada50794d2f43f30d}{nd\_tll}, output->
      \hyperlink{structsw__flow__key_a6b13e14d62eb632b05378784a2d61f87}{ipv6}.nd.tll);
1475             \}
1476         \}
1477     \}
1478 
1479 unencap:
1480     \textcolor{keywordflow}{if} (encap)
1481         nla\_nest\_end(skb, encap);
1482 
1483     \textcolor{keywordflow}{return} 0;
1484 
1485 nla\_put\_failure:
1486     \textcolor{keywordflow}{return} -EMSGSIZE;
1487 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_acc907c6eed2beccfb3d8564a9f627e93}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!\+\_\+\+\_\+parse\+\_\+flow\+\_\+nlattrs@{\+\_\+\+\_\+parse\+\_\+flow\+\_\+nlattrs}}
\index{\+\_\+\+\_\+parse\+\_\+flow\+\_\+nlattrs@{\+\_\+\+\_\+parse\+\_\+flow\+\_\+nlattrs}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{\+\_\+\+\_\+parse\+\_\+flow\+\_\+nlattrs}]{\setlength{\rightskip}{0pt plus 5cm}static int \+\_\+\+\_\+parse\+\_\+flow\+\_\+nlattrs (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{attr, }
\item[{const struct nlattr $\ast$}]{a\mbox{[}$\,$\mbox{]}, }
\item[{u64 $\ast$}]{attrsp, }
\item[{{\bf bool}}]{log, }
\item[{{\bf bool}}]{nz}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_acc907c6eed2beccfb3d8564a9f627e93}

\begin{DoxyCode}
361 \{
362     \textcolor{keyword}{const} \textcolor{keyword}{struct }nlattr *nla;
363     u64 attrs;
364     \textcolor{keywordtype}{int} rem;
365 
366     attrs = *attrsp;
367     \hyperlink{net_2netlink_8h_ac2634af90bda4393105b6323da2044fa}{nla\_for\_each\_nested}(nla, attr, rem) \{
368         u16 \hyperlink{flow_8h_ab22aaab04f806700def00f32823fcb9e}{type} = nla\_type(nla);
369         \textcolor{keywordtype}{int} expected\_len;
370 
371         \textcolor{keywordflow}{if} (type > \hyperlink{openvswitch_8h_a2a2adc6c47c38f0e7889580602ccbe22}{OVS\_KEY\_ATTR\_MAX}) \{
372             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Key type %d is out of range max %d"},
373                   type, \hyperlink{openvswitch_8h_a2a2adc6c47c38f0e7889580602ccbe22}{OVS\_KEY\_ATTR\_MAX});
374             \textcolor{keywordflow}{return} -EINVAL;
375         \}
376 
377         \textcolor{keywordflow}{if} (attrs & (1ULL << type)) \{
378             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Duplicate key (type %d)."}, type);
379             \textcolor{keywordflow}{return} -EINVAL;
380         \}
381 
382         expected\_len = \hyperlink{linux_2flow__netlink_8c_a5565daa559332f47a1d214007d97e0d7}{ovs\_key\_lens}[\hyperlink{flow_8h_ab22aaab04f806700def00f32823fcb9e}{type}].\hyperlink{structovs__len__tbl_a70f2cb0cf35baf6a1941942a8b70318c}{len};
383         \textcolor{keywordflow}{if} (nla\_len(nla) != expected\_len && expected\_len != \hyperlink{linux_2flow__netlink_8c_aa45250c738c1a22be7f5e711887c8547}{OVS\_ATTR\_NESTED}) \{
384             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Key %d has unexpected len %d expected %d"},
385                   type, nla\_len(nla), expected\_len);
386             \textcolor{keywordflow}{return} -EINVAL;
387         \}
388 
389         \textcolor{keywordflow}{if} (!nz || !\hyperlink{linux_2flow__netlink_8c_a237e69cf49fbb7f26d6f886bdf4e4aad}{is\_all\_zero}(nla\_data(nla), expected\_len)) \{
390             attrs |= 1ULL << \hyperlink{flow_8h_ab22aaab04f806700def00f32823fcb9e}{type};
391             a[\hyperlink{flow_8h_ab22aaab04f806700def00f32823fcb9e}{type}] = nla;
392         \}
393     \}
394     \textcolor{keywordflow}{if} (rem) \{
395         \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Message has %d unknown bytes."}, rem);
396         \textcolor{keywordflow}{return} -EINVAL;
397     \}
398 
399     *attrsp = attrs;
400     \textcolor{keywordflow}{return} 0;
401 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a4316343b483e9a6b4d8885147036beb2}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!add\+\_\+action@{add\+\_\+action}}
\index{add\+\_\+action@{add\+\_\+action}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{add\+\_\+action}]{\setlength{\rightskip}{0pt plus 5cm}static int add\+\_\+action (
\begin{DoxyParamCaption}
\item[{struct {\bf sw\+\_\+flow\+\_\+actions} $\ast$$\ast$}]{sfa, }
\item[{int}]{attrtype, }
\item[{void $\ast$}]{data, }
\item[{int}]{len, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a4316343b483e9a6b4d8885147036beb2}

\begin{DoxyCode}
1623 \{
1624     \textcolor{keyword}{struct }nlattr *a;
1625 
1626     a = \hyperlink{linux_2flow__netlink_8c_ad6fb4bf743e36b42c72eaa09db192e87}{\_\_add\_action}(sfa, attrtype, data, len, log);
1627     \textcolor{keywordflow}{if} (IS\_ERR(a))
1628         \textcolor{keywordflow}{return} PTR\_ERR(a);
1629 
1630     \textcolor{keywordflow}{return} 0;
1631 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_ab0176001eff016bfad478f0f06cefa0a}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!add\+\_\+nested\+\_\+action\+\_\+end@{add\+\_\+nested\+\_\+action\+\_\+end}}
\index{add\+\_\+nested\+\_\+action\+\_\+end@{add\+\_\+nested\+\_\+action\+\_\+end}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{add\+\_\+nested\+\_\+action\+\_\+end}]{\setlength{\rightskip}{0pt plus 5cm}static void add\+\_\+nested\+\_\+action\+\_\+end (
\begin{DoxyParamCaption}
\item[{struct {\bf sw\+\_\+flow\+\_\+actions} $\ast$}]{sfa, }
\item[{int}]{st\+\_\+offset}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}\label{linux_2flow__netlink_8c_ab0176001eff016bfad478f0f06cefa0a}

\begin{DoxyCode}
1648 \{
1649     \textcolor{keyword}{struct }nlattr *a = (\textcolor{keyword}{struct }nlattr *) ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *)sfa->\hyperlink{structsw__flow__actions_ae091e053b6fbc25174a28e97282cbe36}{actions} +
1650                                    st\_offset);
1651 
1652     a->nla\_len = sfa->\hyperlink{structsw__flow__actions_ad18c83862d211746fc0542eabff148a5}{actions\_len} - st\_offset;
1653 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a08778088a1f3c3c88aee0055bcd05110}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!add\+\_\+nested\+\_\+action\+\_\+start@{add\+\_\+nested\+\_\+action\+\_\+start}}
\index{add\+\_\+nested\+\_\+action\+\_\+start@{add\+\_\+nested\+\_\+action\+\_\+start}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{add\+\_\+nested\+\_\+action\+\_\+start}]{\setlength{\rightskip}{0pt plus 5cm}static int add\+\_\+nested\+\_\+action\+\_\+start (
\begin{DoxyParamCaption}
\item[{struct {\bf sw\+\_\+flow\+\_\+actions} $\ast$$\ast$}]{sfa, }
\item[{int}]{attrtype, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}\label{linux_2flow__netlink_8c_a08778088a1f3c3c88aee0055bcd05110}

\begin{DoxyCode}
1635 \{
1636     \textcolor{keywordtype}{int} used = (*sfa)->actions\_len;
1637     \textcolor{keywordtype}{int} err;
1638 
1639     err = \hyperlink{linux_2flow__netlink_8c_a4316343b483e9a6b4d8885147036beb2}{add\_action}(sfa, attrtype, NULL, 0, log);
1640     \textcolor{keywordflow}{if} (err)
1641         \textcolor{keywordflow}{return} err;
1642 
1643     \textcolor{keywordflow}{return} used;
1644 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a746e2c558f7350550b1734826a8c25f7}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!copy\+\_\+action@{copy\+\_\+action}}
\index{copy\+\_\+action@{copy\+\_\+action}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{copy\+\_\+action}]{\setlength{\rightskip}{0pt plus 5cm}static int copy\+\_\+action (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{from, }
\item[{struct {\bf sw\+\_\+flow\+\_\+actions} $\ast$$\ast$}]{sfa, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a746e2c558f7350550b1734826a8c25f7}

\begin{DoxyCode}
2011 \{
2012     \textcolor{keywordtype}{int} totlen = NLA\_ALIGN(from->nla\_len);
2013     \textcolor{keyword}{struct }nlattr *to;
2014 
2015     to = \hyperlink{linux_2flow__netlink_8c_a5ce53ec8a0a126f8e33e1d9af6e1e083}{reserve\_sfa\_size}(sfa, from->nla\_len, log);
2016     \textcolor{keywordflow}{if} (IS\_ERR(to))
2017         \textcolor{keywordflow}{return} PTR\_ERR(to);
2018 
2019     memcpy(to, from, totlen);
2020     \textcolor{keywordflow}{return} 0;
2021 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a5f31d9f0798910742b360bbdfe29eeae}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!genev\+\_\+tun\+\_\+opt\+\_\+from\+\_\+nlattr@{genev\+\_\+tun\+\_\+opt\+\_\+from\+\_\+nlattr}}
\index{genev\+\_\+tun\+\_\+opt\+\_\+from\+\_\+nlattr@{genev\+\_\+tun\+\_\+opt\+\_\+from\+\_\+nlattr}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{genev\+\_\+tun\+\_\+opt\+\_\+from\+\_\+nlattr}]{\setlength{\rightskip}{0pt plus 5cm}static int genev\+\_\+tun\+\_\+opt\+\_\+from\+\_\+nlattr (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{a, }
\item[{struct {\bf sw\+\_\+flow\+\_\+match} $\ast$}]{match, }
\item[{{\bf bool}}]{is\+\_\+mask, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a5f31d9f0798910742b360bbdfe29eeae}

\begin{DoxyCode}
420 \{
421     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} opt\_key\_offset;
422 
423     \textcolor{keywordflow}{if} (nla\_len(a) > \textcolor{keyword}{sizeof}(match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_a54b30752817dccb02665a7eecde52a72}{tun\_opts})) \{
424         \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Geneve option length err (len %d, max %zu)."},
425               nla\_len(a), \textcolor{keyword}{sizeof}(match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_a54b30752817dccb02665a7eecde52a72}{tun\_opts}));
426         \textcolor{keywordflow}{return} -EINVAL;
427     \}
428 
429     \textcolor{keywordflow}{if} (nla\_len(a) % 4 != 0) \{
430         \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Geneve opt len %d is not a multiple of 4."},
431               nla\_len(a));
432         \textcolor{keywordflow}{return} -EINVAL;
433     \}
434 
435     \textcolor{comment}{/* We need to record the length of the options passed}
436 \textcolor{comment}{     * down, otherwise packets with the same format but}
437 \textcolor{comment}{     * additional options will be silently matched.}
438 \textcolor{comment}{     */}
439     \textcolor{keywordflow}{if} (!is\_mask) \{
440         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_aed952827cbdce3601bca9c6501742ab9}{tun\_opts\_len}, nla\_len(a),
441                 \textcolor{keyword}{false});
442     \} \textcolor{keywordflow}{else} \{
443         \textcolor{comment}{/* This is somewhat unusual because it looks at}
444 \textcolor{comment}{         * both the key and mask while parsing the}
445 \textcolor{comment}{         * attributes (and by extension assumes the key}
446 \textcolor{comment}{         * is parsed first). Normally, we would verify}
447 \textcolor{comment}{         * that each is the correct length and that the}
448 \textcolor{comment}{         * attributes line up in the validate function.}
449 \textcolor{comment}{         * However, that is difficult because this is}
450 \textcolor{comment}{         * variable length and we won't have the}
451 \textcolor{comment}{         * information later.}
452 \textcolor{comment}{         */}
453         \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_aef0ea317d3bd0125e0d6390261ba3e2d}{tun\_opts\_len} != nla\_len(a)) \{
454             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Geneve option len %d != mask len %d"},
455                   match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_aef0ea317d3bd0125e0d6390261ba3e2d}{tun\_opts\_len}, nla\_len(a));
456             \textcolor{keywordflow}{return} -EINVAL;
457         \}
458 
459         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_aed952827cbdce3601bca9c6501742ab9}{tun\_opts\_len}, 0xff, \textcolor{keyword}{true});
460     \}
461 
462     opt\_key\_offset = \hyperlink{flow_8h_ae4d5099091881f55393347766667f4e5}{TUN\_METADATA\_OFFSET}(nla\_len(a));
463     \hyperlink{linux_2flow__netlink_8c_aceedf9228ebbe5291ac9e12d1d011278}{SW\_FLOW\_KEY\_MEMCPY\_OFFSET}(match, opt\_key\_offset, nla\_data(a),
464                   nla\_len(a), is\_mask);
465     \textcolor{keywordflow}{return} 0;
466 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a5189e471b5832c9371b45c5e58ca5b41}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!get\+\_\+ufid\+\_\+len@{get\+\_\+ufid\+\_\+len}}
\index{get\+\_\+ufid\+\_\+len@{get\+\_\+ufid\+\_\+len}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{get\+\_\+ufid\+\_\+len}]{\setlength{\rightskip}{0pt plus 5cm}static size\+\_\+t get\+\_\+ufid\+\_\+len (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{attr, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a5189e471b5832c9371b45c5e58ca5b41}

\begin{DoxyCode}
1185 \{
1186     \textcolor{keywordtype}{size\_t} len;
1187 
1188     \textcolor{keywordflow}{if} (!attr)
1189         \textcolor{keywordflow}{return} 0;
1190 
1191     len = nla\_len(attr);
1192     \textcolor{keywordflow}{if} (len < 1 || len > \hyperlink{flow_8h_a5cc1c8e559536cddce9d468214805527}{MAX\_UFID\_LENGTH}) \{
1193         \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"ufid size %u bytes exceeds the range (1, %d)"},
1194               nla\_len(attr), MAX\_UFID\_LENGTH);
1195         \textcolor{keywordflow}{return} 0;
1196     \}
1197 
1198     \textcolor{keywordflow}{return} len;
1199 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_aa9ad124d7dc9f5042d10b1237ce02f28}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ipv4\+\_\+tun\+\_\+from\+\_\+nlattr@{ipv4\+\_\+tun\+\_\+from\+\_\+nlattr}}
\index{ipv4\+\_\+tun\+\_\+from\+\_\+nlattr@{ipv4\+\_\+tun\+\_\+from\+\_\+nlattr}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ipv4\+\_\+tun\+\_\+from\+\_\+nlattr}]{\setlength{\rightskip}{0pt plus 5cm}static int ipv4\+\_\+tun\+\_\+from\+\_\+nlattr (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{attr, }
\item[{struct {\bf sw\+\_\+flow\+\_\+match} $\ast$}]{match, }
\item[{{\bf bool}}]{is\+\_\+mask, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_aa9ad124d7dc9f5042d10b1237ce02f28}

\begin{DoxyCode}
506 \{
507     \textcolor{keyword}{struct }nlattr *a;
508     \textcolor{keywordtype}{int} rem;
509     \textcolor{keywordtype}{bool} \hyperlink{flow_8h_af5ff054badb6c806a3ab62dfa146cde1}{ttl} = \textcolor{keyword}{false};
510     \_\_be16 \hyperlink{flow_8h_a51a0f47500f23a17c8e67bddee1911f8}{tun\_flags} = 0;
511     \textcolor{keywordtype}{int} opts\_type = 0;
512 
513     \hyperlink{net_2netlink_8h_ac2634af90bda4393105b6323da2044fa}{nla\_for\_each\_nested}(a, attr, rem) \{
514         \textcolor{keywordtype}{int} \hyperlink{flow_8h_ab22aaab04f806700def00f32823fcb9e}{type} = nla\_type(a);
515         \textcolor{keywordtype}{int} err;
516 
517         \textcolor{keywordflow}{if} (type > \hyperlink{openvswitch_8h_a1c8eef7445d1c45bb90eb65de59a81e4}{OVS\_TUNNEL\_KEY\_ATTR\_MAX}) \{
518             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Tunnel attr %d out of range max %d"},
519                   type, \hyperlink{openvswitch_8h_a1c8eef7445d1c45bb90eb65de59a81e4}{OVS\_TUNNEL\_KEY\_ATTR\_MAX});
520             \textcolor{keywordflow}{return} -EINVAL;
521         \}
522 
523         \textcolor{keywordflow}{if} (\hyperlink{linux_2flow__netlink_8c_abcfd7a34b15e86938f3646cda1522e07}{ovs\_tunnel\_key\_lens}[type].len != nla\_len(a) &&
524            \hyperlink{linux_2flow__netlink_8c_abcfd7a34b15e86938f3646cda1522e07}{ovs\_tunnel\_key\_lens}[type].len != \hyperlink{linux_2flow__netlink_8c_aa45250c738c1a22be7f5e711887c8547}{OVS\_ATTR\_NESTED}) \{
525             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Tunnel attr %d has unexpected len %d expected %d"},
526                   type, nla\_len(a), \hyperlink{linux_2flow__netlink_8c_abcfd7a34b15e86938f3646cda1522e07}{ovs\_tunnel\_key\_lens}[type].len);
527             \textcolor{keywordflow}{return} -EINVAL;
528         \}
529 
530         \textcolor{keywordflow}{switch} (type) \{
531         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427abba6b12276aaae09ecdf61a2189edda5}{OVS\_TUNNEL\_KEY\_ATTR\_ID}:
532             \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a904e9497acde49a1992636f77597c5c7}{tun\_key}.\hyperlink{structovs__key__ipv4__tunnel_ae36132bc05ca6257b572edddffcb867a}{tun\_id},
533                     nla\_get\_be64(a), is\_mask);
534             tun\_flags |= \hyperlink{ip__tunnels_8h_a5438f4a0ea8e58438776fffbed3f08a8}{TUNNEL\_KEY};
535             \textcolor{keywordflow}{break};
536         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427add76f93836f5e1dcb33419c58aa1afd0}{OVS\_TUNNEL\_KEY\_ATTR\_IPV4\_SRC}:
537             \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a904e9497acde49a1992636f77597c5c7}{tun\_key}.\hyperlink{structovs__key__ipv4__tunnel_a1e5a978f104d61e9694e914a109734a7}{ipv4\_src},
538                     nla\_get\_be32(a), is\_mask);
539             \textcolor{keywordflow}{break};
540         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427aa8a1fb062a0a5c1c718096a530c1fee9}{OVS\_TUNNEL\_KEY\_ATTR\_IPV4\_DST}:
541             \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a904e9497acde49a1992636f77597c5c7}{tun\_key}.\hyperlink{structovs__key__ipv4__tunnel_ae443d381a97f53bbc4139fe36c0aae30}{ipv4\_dst},
542                     nla\_get\_be32(a), is\_mask);
543             \textcolor{keywordflow}{break};
544         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427ab452549b72cc81cc38c53a0487cded37}{OVS\_TUNNEL\_KEY\_ATTR\_TOS}:
545             \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a904e9497acde49a1992636f77597c5c7}{tun\_key}.\hyperlink{structovs__key__ipv4__tunnel_a69594eaf9d7dfc2824b264484e02498e}{ipv4\_tos},
546                     nla\_get\_u8(a), is\_mask);
547             \textcolor{keywordflow}{break};
548         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427ace9b9fe26daaf5d99409d1563cc68f5c}{OVS\_TUNNEL\_KEY\_ATTR\_TTL}:
549             \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a904e9497acde49a1992636f77597c5c7}{tun\_key}.\hyperlink{structovs__key__ipv4__tunnel_a24de7472a8c22903fce96b73dab68a40}{ipv4\_ttl},
550                     nla\_get\_u8(a), is\_mask);
551             ttl = \textcolor{keyword}{true};
552             \textcolor{keywordflow}{break};
553         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a2b4acde1fe308fb5cdb703d197ccad11}{OVS\_TUNNEL\_KEY\_ATTR\_DONT\_FRAGMENT}:
554             tun\_flags |= \hyperlink{ip__tunnels_8h_a3b33c8fadb48f2281d5852e2a0d8eeff}{TUNNEL\_DONT\_FRAGMENT};
555             \textcolor{keywordflow}{break};
556         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a0b2355fe72f1590f795e2febdcb3cafe}{OVS\_TUNNEL\_KEY\_ATTR\_CSUM}:
557             tun\_flags |= \hyperlink{ip__tunnels_8h_ac8dc03940c0621b1aeddafa9b620022c}{TUNNEL\_CSUM};
558             \textcolor{keywordflow}{break};
559         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a82ec563a3032a39aa9f9694276933101}{OVS\_TUNNEL\_KEY\_ATTR\_TP\_SRC}:
560             \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a904e9497acde49a1992636f77597c5c7}{tun\_key}.\hyperlink{structovs__key__ipv4__tunnel_acda46848fad6a931296f3e7a74b44a18}{tp\_src},
561                     \hyperlink{net_2netlink_8h_a5a9bc877c8fdbf9b3f2f85536aabcae0}{nla\_get\_be16}(a), is\_mask);
562             \textcolor{keywordflow}{break};
563         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a3fa87a8982452cc6e68ddf8e91dfced2}{OVS\_TUNNEL\_KEY\_ATTR\_TP\_DST}:
564             \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a904e9497acde49a1992636f77597c5c7}{tun\_key}.\hyperlink{structovs__key__ipv4__tunnel_a438707be6be24ab62236063bde726e9b}{tp\_dst},
565                     \hyperlink{net_2netlink_8h_a5a9bc877c8fdbf9b3f2f85536aabcae0}{nla\_get\_be16}(a), is\_mask);
566             \textcolor{keywordflow}{break};
567         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a72ef8de21b6623d09331a68f87038b95}{OVS\_TUNNEL\_KEY\_ATTR\_OAM}:
568             tun\_flags |= \hyperlink{ip__tunnels_8h_a348bd362fda2a6f1506a9709ac7d0a86}{TUNNEL\_OAM};
569             \textcolor{keywordflow}{break};
570         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a3a6f60bb79d6ad889a091b82667009b9}{OVS\_TUNNEL\_KEY\_ATTR\_GENEVE\_OPTS}:
571             \textcolor{keywordflow}{if} (opts\_type) \{
572                 \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Multiple metadata blocks provided"});
573                 \textcolor{keywordflow}{return} -EINVAL;
574             \}
575 
576             err = \hyperlink{linux_2flow__netlink_8c_a5f31d9f0798910742b360bbdfe29eeae}{genev\_tun\_opt\_from\_nlattr}(a, match, is\_mask, log);
577             \textcolor{keywordflow}{if} (err)
578                 \textcolor{keywordflow}{return} err;
579 
580             tun\_flags |= \hyperlink{ip__tunnels_8h_a730279275492612f215921bf96742457}{TUNNEL\_GENEVE\_OPT};
581             opts\_type = \hyperlink{flow_8h_ab22aaab04f806700def00f32823fcb9e}{type};
582             \textcolor{keywordflow}{break};
583         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a97447e85c3c3a2f9d648911b727c16ee}{OVS\_TUNNEL\_KEY\_ATTR\_VXLAN\_OPTS}:
584             \textcolor{keywordflow}{if} (opts\_type) \{
585                 \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Multiple metadata blocks provided"});
586                 \textcolor{keywordflow}{return} -EINVAL;
587             \}
588 
589             err = \hyperlink{linux_2flow__netlink_8c_aef546829167c0fe738dd9db84c3848d4}{vxlan\_tun\_opt\_from\_nlattr}(a, match, is\_mask, log);
590             \textcolor{keywordflow}{if} (err)
591                 \textcolor{keywordflow}{return} err;
592 
593             tun\_flags |= \hyperlink{ip__tunnels_8h_a50cd9036253f584996011f418422a53f}{TUNNEL\_VXLAN\_OPT};
594             opts\_type = \hyperlink{flow_8h_ab22aaab04f806700def00f32823fcb9e}{type};
595             \textcolor{keywordflow}{break};
596         \textcolor{keywordflow}{default}:
597             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Unknown IPv4 tunnel attribute %d"},
598                   type);
599             \textcolor{keywordflow}{return} -EINVAL;
600         \}
601     \}
602 
603     \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a904e9497acde49a1992636f77597c5c7}{tun\_key}.\hyperlink{structovs__key__ipv4__tunnel_a7459e66ecf90329eb2fa6cf3fc4781db}{tun\_flags}, tun\_flags, is\_mask);
604 
605     \textcolor{keywordflow}{if} (rem > 0) \{
606         \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"IPv4 tunnel attribute has %d unknown bytes."},
607               rem);
608         \textcolor{keywordflow}{return} -EINVAL;
609     \}
610 
611     \textcolor{keywordflow}{if} (!is\_mask) \{
612         \textcolor{keywordflow}{if} (!match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_a2f87b7690c0cc2797f1f4347589472c3}{tun\_key}.\hyperlink{structovs__key__ipv4__tunnel_ae443d381a97f53bbc4139fe36c0aae30}{ipv4\_dst}) \{
613             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"IPv4 tunnel dst address is zero"});
614             \textcolor{keywordflow}{return} -EINVAL;
615         \}
616 
617         \textcolor{keywordflow}{if} (!ttl) \{
618             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"IPv4 tunnel TTL not specified."});
619             \textcolor{keywordflow}{return} -EINVAL;
620         \}
621     \}
622 
623     \textcolor{keywordflow}{return} opts\_type;
624 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a534ea0693e07f81a7a00f4b3125fbb1a}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ipv4\+\_\+tun\+\_\+to\+\_\+nlattr@{ipv4\+\_\+tun\+\_\+to\+\_\+nlattr}}
\index{ipv4\+\_\+tun\+\_\+to\+\_\+nlattr@{ipv4\+\_\+tun\+\_\+to\+\_\+nlattr}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ipv4\+\_\+tun\+\_\+to\+\_\+nlattr}]{\setlength{\rightskip}{0pt plus 5cm}static int ipv4\+\_\+tun\+\_\+to\+\_\+nlattr (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{const struct {\bf ovs\+\_\+key\+\_\+ipv4\+\_\+tunnel} $\ast$}]{output, }
\item[{const void $\ast$}]{tun\+\_\+opts, }
\item[{int}]{swkey\+\_\+tun\+\_\+opts\+\_\+len}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a534ea0693e07f81a7a00f4b3125fbb1a}

\begin{DoxyCode}
692 \{
693     \textcolor{keyword}{struct }nlattr *nla;
694     \textcolor{keywordtype}{int} err;
695 
696     nla = nla\_nest\_start(skb, \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a97fc8cc803ab65e231ad28def7bcbb5f}{OVS\_KEY\_ATTR\_TUNNEL});
697     \textcolor{keywordflow}{if} (!nla)
698         \textcolor{keywordflow}{return} -EMSGSIZE;
699 
700     err = \hyperlink{linux_2flow__netlink_8c_ac7f453fb68977c7a24d7af50f18b43db}{\_\_ipv4\_tun\_to\_nlattr}(skb, output, \hyperlink{flow_8h_a58d612a14e56d9b6c782667cd2e89799}{tun\_opts}, swkey\_tun\_opts\_len);
701     \textcolor{keywordflow}{if} (err)
702         \textcolor{keywordflow}{return} err;
703 
704     nla\_nest\_end(skb, nla);
705     \textcolor{keywordflow}{return} 0;
706 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a237e69cf49fbb7f26d6f886bdf4e4aad}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!is\+\_\+all\+\_\+zero@{is\+\_\+all\+\_\+zero}}
\index{is\+\_\+all\+\_\+zero@{is\+\_\+all\+\_\+zero}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{is\+\_\+all\+\_\+zero}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf bool} is\+\_\+all\+\_\+zero (
\begin{DoxyParamCaption}
\item[{const u8 $\ast$}]{fp, }
\item[{size\+\_\+t}]{size}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a237e69cf49fbb7f26d6f886bdf4e4aad}

\begin{DoxyCode}
345 \{
346     \textcolor{keywordtype}{int} i;
347 
348     \textcolor{keywordflow}{if} (!fp)
349         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
350 
351     \textcolor{keywordflow}{for} (i = 0; i < size; i++)
352         \textcolor{keywordflow}{if} (fp[i])
353             \textcolor{keywordflow}{return} \textcolor{keyword}{false};
354 
355     \textcolor{keywordflow}{return} \textcolor{keyword}{true};
356 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_aa862995e0363dbb698ee51eb1be8a40c}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!mask\+\_\+set\+\_\+nlattr@{mask\+\_\+set\+\_\+nlattr}}
\index{mask\+\_\+set\+\_\+nlattr@{mask\+\_\+set\+\_\+nlattr}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{mask\+\_\+set\+\_\+nlattr}]{\setlength{\rightskip}{0pt plus 5cm}static void mask\+\_\+set\+\_\+nlattr (
\begin{DoxyParamCaption}
\item[{struct nlattr $\ast$}]{attr, }
\item[{u8}]{val}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_aa862995e0363dbb698ee51eb1be8a40c}

\begin{DoxyCode}
1022 \{
1023     \hyperlink{linux_2flow__netlink_8c_a412721fb459cda8f2b25400f8832d84f}{nlattr\_set}(attr, val, \hyperlink{linux_2flow__netlink_8c_a5565daa559332f47a1d214007d97e0d7}{ovs\_key\_lens});
1024 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a14e859cc22996f05850ca737daf2ee09}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!masked\+\_\+set\+\_\+action\+\_\+to\+\_\+set\+\_\+action\+\_\+attr@{masked\+\_\+set\+\_\+action\+\_\+to\+\_\+set\+\_\+action\+\_\+attr}}
\index{masked\+\_\+set\+\_\+action\+\_\+to\+\_\+set\+\_\+action\+\_\+attr@{masked\+\_\+set\+\_\+action\+\_\+to\+\_\+set\+\_\+action\+\_\+attr}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{masked\+\_\+set\+\_\+action\+\_\+to\+\_\+set\+\_\+action\+\_\+attr}]{\setlength{\rightskip}{0pt plus 5cm}static int masked\+\_\+set\+\_\+action\+\_\+to\+\_\+set\+\_\+action\+\_\+attr (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{a, }
\item[{struct sk\+\_\+buff $\ast$}]{skb}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a14e859cc22996f05850ca737daf2ee09}

\begin{DoxyCode}
2268 \{
2269     \textcolor{keyword}{const} \textcolor{keyword}{struct }nlattr *ovs\_key = nla\_data(a);
2270     \textcolor{keywordtype}{size\_t} key\_len = nla\_len(ovs\_key) / 2;
2271 
2272     \textcolor{comment}{/* Revert the conversion we did from a non-masked set action to}
2273 \textcolor{comment}{     * masked set action.}
2274 \textcolor{comment}{     */}
2275     \textcolor{keywordflow}{if} (nla\_put(skb, \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eaff937deb7687d0dd4b073c27aed9c8be}{OVS\_ACTION\_ATTR\_SET}, nla\_len(a) - key\_len, ovs\_key))
2276         \textcolor{keywordflow}{return} -EMSGSIZE;
2277 
2278     \textcolor{keywordflow}{return} 0;
2279 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_ab4be6b01938d3a8f5a14bc787cb2b0b2}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!match\+\_\+validate@{match\+\_\+validate}}
\index{match\+\_\+validate@{match\+\_\+validate}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{match\+\_\+validate}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf bool} match\+\_\+validate (
\begin{DoxyParamCaption}
\item[{const struct {\bf sw\+\_\+flow\+\_\+match} $\ast$}]{match, }
\item[{u64}]{key\+\_\+attrs, }
\item[{u64}]{mask\+\_\+attrs, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_ab4be6b01938d3a8f5a14bc787cb2b0b2}

\begin{DoxyCode}
123 \{
124     u64 key\_expected = 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a75127b87d8a2f36ae2c9aae2cf42cd56}{OVS\_KEY\_ATTR\_ETHERNET};
125     u64 mask\_allowed = key\_attrs;  \textcolor{comment}{/* At most allow all key attributes */}
126 
127     \textcolor{comment}{/* The following mask attributes allowed only if they}
128 \textcolor{comment}{     * pass the validation tests.}
129 \textcolor{comment}{     */}
130     mask\_allowed &= ~((1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a67c672ef69eb0c5db9136812e3cdd92e}{OVS\_KEY\_ATTR\_IPV4})
131             | (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aff74bae1efeecfd5d6cf28d8987a8bfd}{OVS\_KEY\_ATTR\_IPV6})
132             | (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a120ca2131b2881b0c52b6fcc8f6cccb5}{OVS\_KEY\_ATTR\_TCP})
133             | (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a79bb45fd4c1a62364eec929283795161}{OVS\_KEY\_ATTR\_TCP\_FLAGS})
134             | (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a4dea7a1acfa9eeffb8f09838bb9f9a7d}{OVS\_KEY\_ATTR\_UDP})
135             | (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a33b7870d10d17ea1604aa83edf40e452}{OVS\_KEY\_ATTR\_SCTP})
136             | (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a7059323c7b14c529cc9d2ff8d3134de9}{OVS\_KEY\_ATTR\_ICMP})
137             | (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864af4093db51c9d12b98e1b18d7ddc2b5e3}{OVS\_KEY\_ATTR\_ICMPV6})
138             | (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a78599a1574b0b24244c2911e420a951b}{OVS\_KEY\_ATTR\_ARP})
139             | (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a6049f54211f31d444025675813d3881b}{OVS\_KEY\_ATTR\_ND})
140             | (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864ac46f7c8520cb93d091b4247ef8707f7b}{OVS\_KEY\_ATTR\_MPLS}));
141 
142     \textcolor{comment}{/* Always allowed mask fields. */}
143     mask\_allowed |= ((1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a97fc8cc803ab65e231ad28def7bcbb5f}{OVS\_KEY\_ATTR\_TUNNEL})
144                | (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a84a968b0e1dd75ba2f6b543c7fcde5b4}{OVS\_KEY\_ATTR\_IN\_PORT})
145                | (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aaccef1ecf941c78c70cf8a6a3374235a}{OVS\_KEY\_ATTR\_ETHERTYPE}));
146 
147     \textcolor{comment}{/* Check key attributes. */}
148     \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(ETH\_P\_ARP)
149             || match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(ETH\_P\_RARP)) \{
150         key\_expected |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a78599a1574b0b24244c2911e420a951b}{OVS\_KEY\_ATTR\_ARP};
151         \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask} && (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask}->\hyperlink{structsw__flow__mask_a52db0284fdd4579a5f30dee0837a7485}{key}.\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(0xffff)))
152             mask\_allowed |= 1ULL << OVS\_KEY\_ATTR\_ARP;
153     \}
154 
155     \textcolor{keywordflow}{if} (\hyperlink{net_2mpls_8h_aab48ab242fbafafc869b3e98df4ace8f}{eth\_p\_mpls}(match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type})) \{
156         key\_expected |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864ac46f7c8520cb93d091b4247ef8707f7b}{OVS\_KEY\_ATTR\_MPLS};
157         \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask} && (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask}->\hyperlink{structsw__flow__mask_a52db0284fdd4579a5f30dee0837a7485}{key}.\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(0xffff)))
158             mask\_allowed |= 1ULL << OVS\_KEY\_ATTR\_MPLS;
159     \}
160 
161     \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(ETH\_P\_IP)) \{
162         key\_expected |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a67c672ef69eb0c5db9136812e3cdd92e}{OVS\_KEY\_ATTR\_IPV4};
163         \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask} && (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask}->\hyperlink{structsw__flow__mask_a52db0284fdd4579a5f30dee0837a7485}{key}.\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(0xffff)))
164             mask\_allowed |= 1ULL << OVS\_KEY\_ATTR\_IPV4;
165 
166         \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.frag != \hyperlink{openvswitch_8h_ad843f713a855bfcacd0adfe3e98eb447a1d1c9f89ced33419ec870391d8954c10}{OVS\_FRAG\_TYPE\_LATER}) \{
167             \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == IPPROTO\_UDP) \{
168                 key\_expected |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a4dea7a1acfa9eeffb8f09838bb9f9a7d}{OVS\_KEY\_ATTR\_UDP};
169                 \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask} && (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask}->\hyperlink{structsw__flow__mask_a52db0284fdd4579a5f30dee0837a7485}{key}.\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == 0xff))
170                     mask\_allowed |= 1ULL << OVS\_KEY\_ATTR\_UDP;
171             \}
172 
173             \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == IPPROTO\_SCTP) \{
174                 key\_expected |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a33b7870d10d17ea1604aa83edf40e452}{OVS\_KEY\_ATTR\_SCTP};
175                 \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask} && (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask}->\hyperlink{structsw__flow__mask_a52db0284fdd4579a5f30dee0837a7485}{key}.\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == 0xff))
176                     mask\_allowed |= 1ULL << OVS\_KEY\_ATTR\_SCTP;
177             \}
178 
179             \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == IPPROTO\_TCP) \{
180                 key\_expected |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a120ca2131b2881b0c52b6fcc8f6cccb5}{OVS\_KEY\_ATTR\_TCP};
181                 key\_expected |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a79bb45fd4c1a62364eec929283795161}{OVS\_KEY\_ATTR\_TCP\_FLAGS};
182                 \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask} && (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask}->\hyperlink{structsw__flow__mask_a52db0284fdd4579a5f30dee0837a7485}{key}.\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == 0xff)) \{
183                     mask\_allowed |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a120ca2131b2881b0c52b6fcc8f6cccb5}{OVS\_KEY\_ATTR\_TCP};
184                     mask\_allowed |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a79bb45fd4c1a62364eec929283795161}{OVS\_KEY\_ATTR\_TCP\_FLAGS};
185                 \}
186             \}
187 
188             \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == IPPROTO\_ICMP) \{
189                 key\_expected |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a7059323c7b14c529cc9d2ff8d3134de9}{OVS\_KEY\_ATTR\_ICMP};
190                 \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask} && (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask}->\hyperlink{structsw__flow__mask_a52db0284fdd4579a5f30dee0837a7485}{key}.\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == 0xff))
191                     mask\_allowed |= 1ULL << OVS\_KEY\_ATTR\_ICMP;
192             \}
193         \}
194     \}
195 
196     \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(ETH\_P\_IPV6)) \{
197         key\_expected |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aff74bae1efeecfd5d6cf28d8987a8bfd}{OVS\_KEY\_ATTR\_IPV6};
198         \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask} && (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask}->\hyperlink{structsw__flow__mask_a52db0284fdd4579a5f30dee0837a7485}{key}.\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type} == htons(0xffff)))
199             mask\_allowed |= 1ULL << OVS\_KEY\_ATTR\_IPV6;
200 
201         \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.frag != \hyperlink{openvswitch_8h_ad843f713a855bfcacd0adfe3e98eb447a1d1c9f89ced33419ec870391d8954c10}{OVS\_FRAG\_TYPE\_LATER}) \{
202             \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == IPPROTO\_UDP) \{
203                 key\_expected |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a4dea7a1acfa9eeffb8f09838bb9f9a7d}{OVS\_KEY\_ATTR\_UDP};
204                 \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask} && (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask}->\hyperlink{structsw__flow__mask_a52db0284fdd4579a5f30dee0837a7485}{key}.\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == 0xff))
205                     mask\_allowed |= 1ULL << OVS\_KEY\_ATTR\_UDP;
206             \}
207 
208             \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == IPPROTO\_SCTP) \{
209                 key\_expected |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a33b7870d10d17ea1604aa83edf40e452}{OVS\_KEY\_ATTR\_SCTP};
210                 \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask} && (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask}->\hyperlink{structsw__flow__mask_a52db0284fdd4579a5f30dee0837a7485}{key}.\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == 0xff))
211                     mask\_allowed |= 1ULL << OVS\_KEY\_ATTR\_SCTP;
212             \}
213 
214             \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == IPPROTO\_TCP) \{
215                 key\_expected |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a120ca2131b2881b0c52b6fcc8f6cccb5}{OVS\_KEY\_ATTR\_TCP};
216                 key\_expected |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a79bb45fd4c1a62364eec929283795161}{OVS\_KEY\_ATTR\_TCP\_FLAGS};
217                 \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask} && (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask}->\hyperlink{structsw__flow__mask_a52db0284fdd4579a5f30dee0837a7485}{key}.\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == 0xff)) \{
218                     mask\_allowed |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a120ca2131b2881b0c52b6fcc8f6cccb5}{OVS\_KEY\_ATTR\_TCP};
219                     mask\_allowed |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a79bb45fd4c1a62364eec929283795161}{OVS\_KEY\_ATTR\_TCP\_FLAGS};
220                 \}
221             \}
222 
223             \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == IPPROTO\_ICMPV6) \{
224                 key\_expected |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864af4093db51c9d12b98e1b18d7ddc2b5e3}{OVS\_KEY\_ATTR\_ICMPV6};
225                 \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask} && (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask}->\hyperlink{structsw__flow__mask_a52db0284fdd4579a5f30dee0837a7485}{key}.\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto == 0xff))
226                     mask\_allowed |= 1ULL << OVS\_KEY\_ATTR\_ICMPV6;
227 
228                 \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_a9c1944a39db1bf91141048df6d85ce8b}{tp}.\hyperlink{structsw__flow__key_a2fbd4aa7a500630627eff0630f864117}{src} ==
229                         htons(NDISC\_NEIGHBOUR\_SOLICITATION) ||
230                     match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_a9c1944a39db1bf91141048df6d85ce8b}{tp}.\hyperlink{structsw__flow__key_a2fbd4aa7a500630627eff0630f864117}{src} == htons(NDISC\_NEIGHBOUR\_ADVERTISEMENT)) \{
231                     key\_expected |= 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a6049f54211f31d444025675813d3881b}{OVS\_KEY\_ATTR\_ND};
232                     \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask} && (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask}->\hyperlink{structsw__flow__mask_a52db0284fdd4579a5f30dee0837a7485}{key}.\hyperlink{structsw__flow__key_a9c1944a39db1bf91141048df6d85ce8b}{tp}.\hyperlink{structsw__flow__key_a2fbd4aa7a500630627eff0630f864117}{src} == htons(0xff)))
233                         mask\_allowed |= 1ULL << OVS\_KEY\_ATTR\_ND;
234                 \}
235             \}
236         \}
237     \}
238 
239     \textcolor{keywordflow}{if} ((key\_attrs & key\_expected) != key\_expected) \{
240         \textcolor{comment}{/* Key attributes check failed. */}
241         \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Missing key (keys=%llx, expected=%llx)"},
242               (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long})key\_attrs,
243               (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long})key\_expected);
244         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
245     \}
246 
247     \textcolor{keywordflow}{if} ((mask\_attrs & mask\_allowed) != mask\_attrs) \{
248         \textcolor{comment}{/* Mask attributes check failed. */}
249         \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Unexpected mask (mask=%llx, allowed=%llx)"},
250               (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long})mask\_attrs,
251               (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long})mask\_allowed);
252         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
253     \}
254 
255     \textcolor{keywordflow}{return} \textcolor{keyword}{true};
256 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_aed17f75c6136e01aa609132d5bbc9b2a}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!metadata\+\_\+from\+\_\+nlattrs@{metadata\+\_\+from\+\_\+nlattrs}}
\index{metadata\+\_\+from\+\_\+nlattrs@{metadata\+\_\+from\+\_\+nlattrs}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{metadata\+\_\+from\+\_\+nlattrs}]{\setlength{\rightskip}{0pt plus 5cm}static int metadata\+\_\+from\+\_\+nlattrs (
\begin{DoxyParamCaption}
\item[{struct {\bf sw\+\_\+flow\+\_\+match} $\ast$}]{match, }
\item[{u64 $\ast$}]{attrs, }
\item[{const struct nlattr $\ast$$\ast$}]{a, }
\item[{{\bf bool}}]{is\+\_\+mask, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_aed17f75c6136e01aa609132d5bbc9b2a}

\begin{DoxyCode}
719 \{
720     \textcolor{keywordflow}{if} (*attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a8f119543030b5cafc424d37ef817208d}{OVS\_KEY\_ATTR\_DP\_HASH})) \{
721         u32 hash\_val = nla\_get\_u32(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a8f119543030b5cafc424d37ef817208d}{OVS\_KEY\_ATTR\_DP\_HASH}]);
722 
723         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a281fd67e00043582d1244246f268743d}{ovs\_flow\_hash}, hash\_val, is\_mask);
724         *attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a8f119543030b5cafc424d37ef817208d}{OVS\_KEY\_ATTR\_DP\_HASH});
725     \}
726 
727     \textcolor{keywordflow}{if} (*attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864afa5af2b14a419c06035a864807572a69}{OVS\_KEY\_ATTR\_RECIRC\_ID})) \{
728         u32 \hyperlink{flow_8h_af52a436bf08cde2c2bff8b9f9594bea5}{recirc\_id} = nla\_get\_u32(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864afa5af2b14a419c06035a864807572a69}{OVS\_KEY\_ATTR\_RECIRC\_ID}]);
729 
730         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, recirc\_id, recirc\_id, is\_mask);
731         *attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864afa5af2b14a419c06035a864807572a69}{OVS\_KEY\_ATTR\_RECIRC\_ID});
732     \}
733 
734     \textcolor{keywordflow}{if} (*attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a3dee91d2ad17f698e34ebb913fcef8bf}{OVS\_KEY\_ATTR\_PRIORITY})) \{
735         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a1c873ea83e1b749c669b501016e967fe}{phy}.priority,
736               nla\_get\_u32(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a3dee91d2ad17f698e34ebb913fcef8bf}{OVS\_KEY\_ATTR\_PRIORITY}]), is\_mask);
737         *attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a3dee91d2ad17f698e34ebb913fcef8bf}{OVS\_KEY\_ATTR\_PRIORITY});
738     \}
739 
740     \textcolor{keywordflow}{if} (*attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a84a968b0e1dd75ba2f6b543c7fcde5b4}{OVS\_KEY\_ATTR\_IN\_PORT})) \{
741         u32 \hyperlink{flow_8h_add5c49cf0b0c4a57943c76d4d2b93373}{in\_port} = nla\_get\_u32(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a84a968b0e1dd75ba2f6b543c7fcde5b4}{OVS\_KEY\_ATTR\_IN\_PORT}]);
742 
743         \textcolor{keywordflow}{if} (is\_mask) \{
744             in\_port = 0xffffffff; \textcolor{comment}{/* Always exact match in\_port. */}
745         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (in\_port >= \hyperlink{datapath_8h_a73b117dd1ebe456eecfb7688047a03f1}{DP\_MAX\_PORTS}) \{
746             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Port %d exceeds max allowable %d"},
747                   in\_port, \hyperlink{datapath_8h_a73b117dd1ebe456eecfb7688047a03f1}{DP\_MAX\_PORTS});
748             \textcolor{keywordflow}{return} -EINVAL;
749         \}
750 
751         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a1c873ea83e1b749c669b501016e967fe}{phy}.in\_port, in\_port, is\_mask);
752         *attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a84a968b0e1dd75ba2f6b543c7fcde5b4}{OVS\_KEY\_ATTR\_IN\_PORT});
753     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!is\_mask) \{
754         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a1c873ea83e1b749c669b501016e967fe}{phy}.in\_port, \hyperlink{datapath_8h_a73b117dd1ebe456eecfb7688047a03f1}{DP\_MAX\_PORTS}, is\_mask);
755     \}
756 
757     \textcolor{keywordflow}{if} (*attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a32f36d9e41b0fbae0746d67fa34340ad}{OVS\_KEY\_ATTR\_SKB\_MARK})) \{
758         uint32\_t mark = nla\_get\_u32(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a32f36d9e41b0fbae0746d67fa34340ad}{OVS\_KEY\_ATTR\_SKB\_MARK}]);
759 
760         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a1c873ea83e1b749c669b501016e967fe}{phy}.skb\_mark, mark, is\_mask);
761         *attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a32f36d9e41b0fbae0746d67fa34340ad}{OVS\_KEY\_ATTR\_SKB\_MARK});
762     \}
763     \textcolor{keywordflow}{if} (*attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a97fc8cc803ab65e231ad28def7bcbb5f}{OVS\_KEY\_ATTR\_TUNNEL})) \{
764         \textcolor{keywordflow}{if} (\hyperlink{linux_2flow__netlink_8c_aa9ad124d7dc9f5042d10b1237ce02f28}{ipv4\_tun\_from\_nlattr}(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a97fc8cc803ab65e231ad28def7bcbb5f}{OVS\_KEY\_ATTR\_TUNNEL}], match,
765                      is\_mask, log) < 0)
766             \textcolor{keywordflow}{return} -EINVAL;
767         *attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a97fc8cc803ab65e231ad28def7bcbb5f}{OVS\_KEY\_ATTR\_TUNNEL});
768     \}
769     \textcolor{keywordflow}{return} 0;
770 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_acf3273c812551499c4b4d48651548286}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!nla\+\_\+alloc\+\_\+flow\+\_\+actions@{nla\+\_\+alloc\+\_\+flow\+\_\+actions}}
\index{nla\+\_\+alloc\+\_\+flow\+\_\+actions@{nla\+\_\+alloc\+\_\+flow\+\_\+actions}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{nla\+\_\+alloc\+\_\+flow\+\_\+actions}]{\setlength{\rightskip}{0pt plus 5cm}static struct {\bf sw\+\_\+flow\+\_\+actions}$\ast$ nla\+\_\+alloc\+\_\+flow\+\_\+actions (
\begin{DoxyParamCaption}
\item[{int}]{size, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_acf3273c812551499c4b4d48651548286}

\begin{DoxyCode}
1535 \{
1536     \textcolor{keyword}{struct }\hyperlink{structsw__flow__actions}{sw\_flow\_actions} *sfa;
1537 
1538     \textcolor{keywordflow}{if} (size > \hyperlink{linux_2flow__netlink_8c_a429e7a37f3797cd9870c534467a7f762}{MAX\_ACTIONS\_BUFSIZE}) \{
1539         \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Flow action size %u bytes exceeds max"}, size);
1540         \textcolor{keywordflow}{return} ERR\_PTR(-EINVAL);
1541     \}
1542 
1543     sfa = kmalloc(\textcolor{keyword}{sizeof}(*sfa) + size, GFP\_KERNEL);
1544     \textcolor{keywordflow}{if} (!sfa)
1545         \textcolor{keywordflow}{return} ERR\_PTR(-ENOMEM);
1546 
1547     sfa->\hyperlink{structsw__flow__actions_ad18c83862d211746fc0542eabff148a5}{actions\_len} = 0;
1548     \textcolor{keywordflow}{return} sfa;
1549 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a412721fb459cda8f2b25400f8832d84f}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!nlattr\+\_\+set@{nlattr\+\_\+set}}
\index{nlattr\+\_\+set@{nlattr\+\_\+set}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{nlattr\+\_\+set}]{\setlength{\rightskip}{0pt plus 5cm}static void nlattr\+\_\+set (
\begin{DoxyParamCaption}
\item[{struct nlattr $\ast$}]{attr, }
\item[{u8}]{val, }
\item[{const struct {\bf ovs\+\_\+len\+\_\+tbl} $\ast$}]{tbl}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a412721fb459cda8f2b25400f8832d84f}

\begin{DoxyCode}
1008 \{
1009     \textcolor{keyword}{struct }nlattr *nla;
1010     \textcolor{keywordtype}{int} rem;
1011 
1012     \textcolor{comment}{/* The nlattr stream should already have been validated */}
1013     \hyperlink{net_2netlink_8h_ac2634af90bda4393105b6323da2044fa}{nla\_for\_each\_nested}(nla, attr, rem) \{
1014         \textcolor{keywordflow}{if} (tbl && tbl[nla\_type(nla)].len == \hyperlink{linux_2flow__netlink_8c_aa45250c738c1a22be7f5e711887c8547}{OVS\_ATTR\_NESTED})
1015             \hyperlink{linux_2flow__netlink_8c_a412721fb459cda8f2b25400f8832d84f}{nlattr\_set}(nla, val, tbl[nla\_type(nla)].next);
1016         \textcolor{keywordflow}{else}
1017             memset(nla\_data(nla), val, nla\_len(nla));
1018     \}
1019 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a4ea1ec7f3650fd324fc1538c97e795d0}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+key\+\_\+attr\+\_\+size@{ovs\+\_\+key\+\_\+attr\+\_\+size}}
\index{ovs\+\_\+key\+\_\+attr\+\_\+size@{ovs\+\_\+key\+\_\+attr\+\_\+size}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+key\+\_\+attr\+\_\+size}]{\setlength{\rightskip}{0pt plus 5cm}size\+\_\+t ovs\+\_\+key\+\_\+attr\+\_\+size (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_a4ea1ec7f3650fd324fc1538c97e795d0}

\begin{DoxyCode}
280 \{
281     \textcolor{comment}{/* Whenever adding new OVS\_KEY\_ FIELDS, we should consider}
282 \textcolor{comment}{     * updating this function.}
283 \textcolor{comment}{     */}
284     BUILD\_BUG\_ON(OVS\_KEY\_ATTR\_TUNNEL\_INFO != 22);
285 
286     \textcolor{keywordflow}{return}    nla\_total\_size(4)   \textcolor{comment}{/* OVS\_KEY\_ATTR\_PRIORITY */}
287         + nla\_total\_size(0)   \textcolor{comment}{/* OVS\_KEY\_ATTR\_TUNNEL */}
288           + \hyperlink{flow__netlink_8c_ac920825ffe4fa75e7ca3c5e76ad4ec2a}{ovs\_tun\_key\_attr\_size}()
289         + nla\_total\_size(4)   \textcolor{comment}{/* OVS\_KEY\_ATTR\_IN\_PORT */}
290         + nla\_total\_size(4)   \textcolor{comment}{/* OVS\_KEY\_ATTR\_SKB\_MARK */}
291         + nla\_total\_size(4)   \textcolor{comment}{/* OVS\_KEY\_ATTR\_DP\_HASH */}
292         + nla\_total\_size(4)   \textcolor{comment}{/* OVS\_KEY\_ATTR\_RECIRC\_ID */}
293         + nla\_total\_size(12)  \textcolor{comment}{/* OVS\_KEY\_ATTR\_ETHERNET */}
294         + nla\_total\_size(2)   \textcolor{comment}{/* OVS\_KEY\_ATTR\_ETHERTYPE */}
295         + nla\_total\_size(4)   \textcolor{comment}{/* OVS\_KEY\_ATTR\_VLAN */}
296         + nla\_total\_size(0)   \textcolor{comment}{/* OVS\_KEY\_ATTR\_ENCAP */}
297         + nla\_total\_size(2)   \textcolor{comment}{/* OVS\_KEY\_ATTR\_ETHERTYPE */}
298         + nla\_total\_size(40)  \textcolor{comment}{/* OVS\_KEY\_ATTR\_IPV6 */}
299         + nla\_total\_size(2)   \textcolor{comment}{/* OVS\_KEY\_ATTR\_ICMPV6 */}
300         + nla\_total\_size(28); \textcolor{comment}{/* OVS\_KEY\_ATTR\_ND */}
301 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a7e2f54c332f7bdac73756972da69ad53}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+key\+\_\+from\+\_\+nlattrs@{ovs\+\_\+key\+\_\+from\+\_\+nlattrs}}
\index{ovs\+\_\+key\+\_\+from\+\_\+nlattrs@{ovs\+\_\+key\+\_\+from\+\_\+nlattrs}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+key\+\_\+from\+\_\+nlattrs}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+key\+\_\+from\+\_\+nlattrs (
\begin{DoxyParamCaption}
\item[{struct {\bf sw\+\_\+flow\+\_\+match} $\ast$}]{match, }
\item[{u64}]{attrs, }
\item[{const struct nlattr $\ast$$\ast$}]{a, }
\item[{{\bf bool}}]{is\+\_\+mask, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a7e2f54c332f7bdac73756972da69ad53}

\begin{DoxyCode}
775 \{
776     \textcolor{keywordtype}{int} err;
777 
778     err = \hyperlink{linux_2flow__netlink_8c_aed17f75c6136e01aa609132d5bbc9b2a}{metadata\_from\_nlattrs}(match, &attrs, a, is\_mask, log);
779     \textcolor{keywordflow}{if} (err)
780         \textcolor{keywordflow}{return} err;
781 
782     \textcolor{keywordflow}{if} (attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a75127b87d8a2f36ae2c9aae2cf42cd56}{OVS\_KEY\_ATTR\_ETHERNET})) \{
783         \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__key__ethernet}{ovs\_key\_ethernet} *eth\_key;
784 
785         eth\_key = nla\_data(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a75127b87d8a2f36ae2c9aae2cf42cd56}{OVS\_KEY\_ATTR\_ETHERNET}]);
786         \hyperlink{linux_2flow__netlink_8c_aa303fd044db169fb22013e1279c18dd1}{SW\_FLOW\_KEY\_MEMCPY}(match, \hyperlink{flow_8h_a1679a3c93391059deba58179f52c86a6}{eth}.src,
787                 eth\_key->\hyperlink{structovs__key__ethernet_adc19d64e3aa45c9383f332981780b79b}{eth\_src}, ETH\_ALEN, is\_mask);
788         \hyperlink{linux_2flow__netlink_8c_aa303fd044db169fb22013e1279c18dd1}{SW\_FLOW\_KEY\_MEMCPY}(match, \hyperlink{flow_8h_a1679a3c93391059deba58179f52c86a6}{eth}.dst,
789                 eth\_key->\hyperlink{structovs__key__ethernet_a12fa99b386c86f65221f6d2394a9d7c9}{eth\_dst}, ETH\_ALEN, is\_mask);
790         attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a75127b87d8a2f36ae2c9aae2cf42cd56}{OVS\_KEY\_ATTR\_ETHERNET});
791     \}
792 
793     \textcolor{keywordflow}{if} (attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864ae513231d4612ed9b19551a7e70648005}{OVS\_KEY\_ATTR\_VLAN})) \{
794         \_\_be16 \hyperlink{flow_8h_a4528fe4db43b403cd959b50285d71b0c}{tci};
795 
796         tci = \hyperlink{net_2netlink_8h_a5a9bc877c8fdbf9b3f2f85536aabcae0}{nla\_get\_be16}(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864ae513231d4612ed9b19551a7e70648005}{OVS\_KEY\_ATTR\_VLAN}]);
797         \textcolor{keywordflow}{if} (!(tci & htons(\hyperlink{if__vlan_8h_ac8bf15be3fd1a3a63a2452fa05a83217}{VLAN\_TAG\_PRESENT}))) \{
798             \textcolor{keywordflow}{if} (is\_mask)
799                 \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"VLAN TCI mask does not have exact match for VLAN\_TAG\_PRESENT bit."}
      );
800             \textcolor{keywordflow}{else}
801                 \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"VLAN TCI does not have VLAN\_TAG\_PRESENT bit set."});
802 
803             \textcolor{keywordflow}{return} -EINVAL;
804         \}
805 
806         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a1679a3c93391059deba58179f52c86a6}{eth}.tci, tci, is\_mask);
807         attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864ae513231d4612ed9b19551a7e70648005}{OVS\_KEY\_ATTR\_VLAN});
808     \}
809 
810     \textcolor{keywordflow}{if} (attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aaccef1ecf941c78c70cf8a6a3374235a}{OVS\_KEY\_ATTR\_ETHERTYPE})) \{
811         \_\_be16 eth\_type;
812 
813         eth\_type = \hyperlink{net_2netlink_8h_a5a9bc877c8fdbf9b3f2f85536aabcae0}{nla\_get\_be16}(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aaccef1ecf941c78c70cf8a6a3374235a}{OVS\_KEY\_ATTR\_ETHERTYPE}]);
814         \textcolor{keywordflow}{if} (is\_mask) \{
815             \textcolor{comment}{/* Always exact match EtherType. */}
816             eth\_type = htons(0xffff);
817         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!eth\_proto\_is\_802\_3(eth\_type)) \{
818             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"EtherType %x is less than min %x"},
819                   ntohs(eth\_type), \hyperlink{if__ether_8h_aced3d1a29021565e5068c78fd384a4af}{ETH\_P\_802\_3\_MIN});
820             \textcolor{keywordflow}{return} -EINVAL;
821         \}
822 
823         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a1679a3c93391059deba58179f52c86a6}{eth}.type, eth\_type, is\_mask);
824         attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aaccef1ecf941c78c70cf8a6a3374235a}{OVS\_KEY\_ATTR\_ETHERTYPE});
825     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!is\_mask) \{
826         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a1679a3c93391059deba58179f52c86a6}{eth}.type, htons(ETH\_P\_802\_2), is\_mask);
827     \}
828 
829     \textcolor{keywordflow}{if} (attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a67c672ef69eb0c5db9136812e3cdd92e}{OVS\_KEY\_ATTR\_IPV4})) \{
830         \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__key__ipv4}{ovs\_key\_ipv4} *ipv4\_key;
831 
832         ipv4\_key = nla\_data(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a67c672ef69eb0c5db9136812e3cdd92e}{OVS\_KEY\_ATTR\_IPV4}]);
833         \textcolor{keywordflow}{if} (!is\_mask && ipv4\_key->\hyperlink{structovs__key__ipv4_a47225bcfead6875052b2678c96d3f9b3}{ipv4\_frag} > \hyperlink{openvswitch_8h_a7a00d1a09983e101f17ccb4fbf9e3ba2}{OVS\_FRAG\_TYPE\_MAX}) \{
834             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"IPv4 frag type %d is out of range max %d"},
835                   ipv4\_key->\hyperlink{structovs__key__ipv4_a47225bcfead6875052b2678c96d3f9b3}{ipv4\_frag}, \hyperlink{openvswitch_8h_a7a00d1a09983e101f17ccb4fbf9e3ba2}{OVS\_FRAG\_TYPE\_MAX});
836             \textcolor{keywordflow}{return} -EINVAL;
837         \}
838         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a898dda7a587e3b8e5f8e257c1cea69f6}{ip}.proto,
839                 ipv4\_key->\hyperlink{structovs__key__ipv4_ac973a2efc8d310948e3713a5c5a7fabf}{ipv4\_proto}, is\_mask);
840         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a898dda7a587e3b8e5f8e257c1cea69f6}{ip}.tos,
841                 ipv4\_key->\hyperlink{structovs__key__ipv4_a0097feb04c0db1cc6621a58f74ac0e33}{ipv4\_tos}, is\_mask);
842         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a898dda7a587e3b8e5f8e257c1cea69f6}{ip}.ttl,
843                 ipv4\_key->\hyperlink{structovs__key__ipv4_ac2142e7329a6e522b3a0d504bec22678}{ipv4\_ttl}, is\_mask);
844         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a898dda7a587e3b8e5f8e257c1cea69f6}{ip}.frag,
845                 ipv4\_key->\hyperlink{structovs__key__ipv4_a47225bcfead6875052b2678c96d3f9b3}{ipv4\_frag}, is\_mask);
846         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a1aa186097721b0d2190865057a49f0f9}{ipv4}.addr.src,
847                 ipv4\_key->\hyperlink{structovs__key__ipv4_a3577eccaa5f978ba303d2424e3e31a13}{ipv4\_src}, is\_mask);
848         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a1aa186097721b0d2190865057a49f0f9}{ipv4}.addr.dst,
849                 ipv4\_key->\hyperlink{structovs__key__ipv4_aa15aabd69c2881215e666585cea50064}{ipv4\_dst}, is\_mask);
850         attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a67c672ef69eb0c5db9136812e3cdd92e}{OVS\_KEY\_ATTR\_IPV4});
851     \}
852 
853     \textcolor{keywordflow}{if} (attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aff74bae1efeecfd5d6cf28d8987a8bfd}{OVS\_KEY\_ATTR\_IPV6})) \{
854         \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__key__ipv6}{ovs\_key\_ipv6} *ipv6\_key;
855 
856         ipv6\_key = nla\_data(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aff74bae1efeecfd5d6cf28d8987a8bfd}{OVS\_KEY\_ATTR\_IPV6}]);
857         \textcolor{keywordflow}{if} (!is\_mask && ipv6\_key->\hyperlink{structovs__key__ipv6_ace1ae2a8c22670bde77abadde9101d27}{ipv6\_frag} > \hyperlink{openvswitch_8h_a7a00d1a09983e101f17ccb4fbf9e3ba2}{OVS\_FRAG\_TYPE\_MAX}) \{
858             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"IPv6 frag type %d is out of range max %d"},
859                   ipv6\_key->\hyperlink{structovs__key__ipv6_ace1ae2a8c22670bde77abadde9101d27}{ipv6\_frag}, \hyperlink{openvswitch_8h_a7a00d1a09983e101f17ccb4fbf9e3ba2}{OVS\_FRAG\_TYPE\_MAX});
860             \textcolor{keywordflow}{return} -EINVAL;
861         \}
862 
863         \textcolor{keywordflow}{if} (!is\_mask && ipv6\_key->\hyperlink{structovs__key__ipv6_a723a1a03d115ebe2a9fdada09e63bd0c}{ipv6\_label} & htonl(0xFFF00000)) \{
864             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log,
865                   \textcolor{stringliteral}{"Invalid IPv6 flow label value (value=%x, max=%x)."},
866                   ntohl(ipv6\_key->\hyperlink{structovs__key__ipv6_a723a1a03d115ebe2a9fdada09e63bd0c}{ipv6\_label}), (1 << 20) - 1);
867             \textcolor{keywordflow}{return} -EINVAL;
868         \}
869 
870         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a0e15caa0bf708962ec6aa94137d5bbae}{ipv6}.label,
871                 ipv6\_key->\hyperlink{structovs__key__ipv6_a723a1a03d115ebe2a9fdada09e63bd0c}{ipv6\_label}, is\_mask);
872         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a898dda7a587e3b8e5f8e257c1cea69f6}{ip}.proto,
873                 ipv6\_key->\hyperlink{structovs__key__ipv6_a194ad047677db5a081bdd730b20f8007}{ipv6\_proto}, is\_mask);
874         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a898dda7a587e3b8e5f8e257c1cea69f6}{ip}.tos,
875                 ipv6\_key->\hyperlink{structovs__key__ipv6_a391295d87ca76a365cc78fd92c4e4615}{ipv6\_tclass}, is\_mask);
876         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a898dda7a587e3b8e5f8e257c1cea69f6}{ip}.ttl,
877                 ipv6\_key->\hyperlink{structovs__key__ipv6_a5273b4aa4bba11f547cfa0687acaaeae}{ipv6\_hlimit}, is\_mask);
878         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a898dda7a587e3b8e5f8e257c1cea69f6}{ip}.frag,
879                 ipv6\_key->\hyperlink{structovs__key__ipv6_ace1ae2a8c22670bde77abadde9101d27}{ipv6\_frag}, is\_mask);
880         \hyperlink{linux_2flow__netlink_8c_aa303fd044db169fb22013e1279c18dd1}{SW\_FLOW\_KEY\_MEMCPY}(match, \hyperlink{flow_8h_a0e15caa0bf708962ec6aa94137d5bbae}{ipv6}.addr.src,
881                 ipv6\_key->\hyperlink{structovs__key__ipv6_ac1ff8dfd6a3b86196c2267b64077517e}{ipv6\_src},
882                 \textcolor{keyword}{sizeof}(match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_a6b13e14d62eb632b05378784a2d61f87}{ipv6}.addr.src),
883                 is\_mask);
884         \hyperlink{linux_2flow__netlink_8c_aa303fd044db169fb22013e1279c18dd1}{SW\_FLOW\_KEY\_MEMCPY}(match, \hyperlink{flow_8h_a0e15caa0bf708962ec6aa94137d5bbae}{ipv6}.addr.dst,
885                 ipv6\_key->\hyperlink{structovs__key__ipv6_a32109125c4fc7b02b01ac84e9af8e447}{ipv6\_dst},
886                 \textcolor{keyword}{sizeof}(match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_a6b13e14d62eb632b05378784a2d61f87}{ipv6}.addr.dst),
887                 is\_mask);
888 
889         attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aff74bae1efeecfd5d6cf28d8987a8bfd}{OVS\_KEY\_ATTR\_IPV6});
890     \}
891 
892     \textcolor{keywordflow}{if} (attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a78599a1574b0b24244c2911e420a951b}{OVS\_KEY\_ATTR\_ARP})) \{
893         \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__key__arp}{ovs\_key\_arp} *arp\_key;
894 
895         arp\_key = nla\_data(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a78599a1574b0b24244c2911e420a951b}{OVS\_KEY\_ATTR\_ARP}]);
896         \textcolor{keywordflow}{if} (!is\_mask && (arp\_key->\hyperlink{structovs__key__arp_a560ecc1caa0ae74b43abe0d5dd30306d}{arp\_op} & htons(0xff00))) \{
897             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Unknown ARP opcode (opcode=%d)."},
898                   arp\_key->\hyperlink{structovs__key__arp_a560ecc1caa0ae74b43abe0d5dd30306d}{arp\_op});
899             \textcolor{keywordflow}{return} -EINVAL;
900         \}
901 
902         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a1aa186097721b0d2190865057a49f0f9}{ipv4}.addr.src,
903                 arp\_key->\hyperlink{structovs__key__arp_a25ce3912d909430a080dd3264d858892}{arp\_sip}, is\_mask);
904         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a1aa186097721b0d2190865057a49f0f9}{ipv4}.addr.dst,
905             arp\_key->\hyperlink{structovs__key__arp_a84a3d1edd8ba5960d41a69155e721d20}{arp\_tip}, is\_mask);
906         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a898dda7a587e3b8e5f8e257c1cea69f6}{ip}.proto,
907                 ntohs(arp\_key->\hyperlink{structovs__key__arp_a560ecc1caa0ae74b43abe0d5dd30306d}{arp\_op}), is\_mask);
908         \hyperlink{linux_2flow__netlink_8c_aa303fd044db169fb22013e1279c18dd1}{SW\_FLOW\_KEY\_MEMCPY}(match, \hyperlink{flow_8h_a1aa186097721b0d2190865057a49f0f9}{ipv4}.arp.sha,
909                 arp\_key->\hyperlink{structovs__key__arp_a99f6141da2e3151181663f27ab1a3560}{arp\_sha}, ETH\_ALEN, is\_mask);
910         \hyperlink{linux_2flow__netlink_8c_aa303fd044db169fb22013e1279c18dd1}{SW\_FLOW\_KEY\_MEMCPY}(match, \hyperlink{flow_8h_a1aa186097721b0d2190865057a49f0f9}{ipv4}.arp.tha,
911                 arp\_key->\hyperlink{structovs__key__arp_ab9f27ebc29aee381031d9b89d1b954ac}{arp\_tha}, ETH\_ALEN, is\_mask);
912 
913         attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a78599a1574b0b24244c2911e420a951b}{OVS\_KEY\_ATTR\_ARP});
914     \}
915 
916     \textcolor{keywordflow}{if} (attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864ac46f7c8520cb93d091b4247ef8707f7b}{OVS\_KEY\_ATTR\_MPLS})) \{
917         \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__key__mpls}{ovs\_key\_mpls} *mpls\_key;
918 
919         mpls\_key = nla\_data(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864ac46f7c8520cb93d091b4247ef8707f7b}{OVS\_KEY\_ATTR\_MPLS}]);
920         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_aeab2d67b4ec58a9575da76c323ad95ce}{mpls}.top\_lse,
921                 mpls\_key->\hyperlink{structovs__key__mpls_a44b32d5066667b5b1bf474b53a335fb1}{mpls\_lse}, is\_mask);
922 
923         attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864ac46f7c8520cb93d091b4247ef8707f7b}{OVS\_KEY\_ATTR\_MPLS});
924     \}
925 
926     \textcolor{keywordflow}{if} (attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a120ca2131b2881b0c52b6fcc8f6cccb5}{OVS\_KEY\_ATTR\_TCP})) \{
927         \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__key__tcp}{ovs\_key\_tcp} *tcp\_key;
928 
929         tcp\_key = nla\_data(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a120ca2131b2881b0c52b6fcc8f6cccb5}{OVS\_KEY\_ATTR\_TCP}]);
930         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_ad44c86ae49f219522bcd4fb2744b81b2}{tp}.src, tcp\_key->\hyperlink{structovs__key__tcp_a6ce4cb2971be0b952a5a7cde1eefc28e}{tcp\_src}, is\_mask);
931         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_ad44c86ae49f219522bcd4fb2744b81b2}{tp}.dst, tcp\_key->\hyperlink{structovs__key__tcp_a37a5793e8ba3701ac70693073a24668a}{tcp\_dst}, is\_mask);
932         attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a120ca2131b2881b0c52b6fcc8f6cccb5}{OVS\_KEY\_ATTR\_TCP});
933     \}
934 
935     \textcolor{keywordflow}{if} (attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a79bb45fd4c1a62364eec929283795161}{OVS\_KEY\_ATTR\_TCP\_FLAGS})) \{
936         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_ad44c86ae49f219522bcd4fb2744b81b2}{tp}.flags,
937                 \hyperlink{net_2netlink_8h_a5a9bc877c8fdbf9b3f2f85536aabcae0}{nla\_get\_be16}(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a79bb45fd4c1a62364eec929283795161}{OVS\_KEY\_ATTR\_TCP\_FLAGS}]),
938                 is\_mask);
939         attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a79bb45fd4c1a62364eec929283795161}{OVS\_KEY\_ATTR\_TCP\_FLAGS});
940     \}
941 
942     \textcolor{keywordflow}{if} (attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a4dea7a1acfa9eeffb8f09838bb9f9a7d}{OVS\_KEY\_ATTR\_UDP})) \{
943         \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__key__udp}{ovs\_key\_udp} *udp\_key;
944 
945         udp\_key = nla\_data(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a4dea7a1acfa9eeffb8f09838bb9f9a7d}{OVS\_KEY\_ATTR\_UDP}]);
946         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_ad44c86ae49f219522bcd4fb2744b81b2}{tp}.src, udp\_key->\hyperlink{structovs__key__udp_a771fb692264276a6e170a01d54295b61}{udp\_src}, is\_mask);
947         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_ad44c86ae49f219522bcd4fb2744b81b2}{tp}.dst, udp\_key->\hyperlink{structovs__key__udp_ab9a32a0e306acdbf2b5468710836a4d8}{udp\_dst}, is\_mask);
948         attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a4dea7a1acfa9eeffb8f09838bb9f9a7d}{OVS\_KEY\_ATTR\_UDP});
949     \}
950 
951     \textcolor{keywordflow}{if} (attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a33b7870d10d17ea1604aa83edf40e452}{OVS\_KEY\_ATTR\_SCTP})) \{
952         \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__key__sctp}{ovs\_key\_sctp} *sctp\_key;
953 
954         sctp\_key = nla\_data(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a33b7870d10d17ea1604aa83edf40e452}{OVS\_KEY\_ATTR\_SCTP}]);
955         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_ad44c86ae49f219522bcd4fb2744b81b2}{tp}.src, sctp\_key->\hyperlink{structovs__key__sctp_af10ce527eb1894b4080bd8024e82a1cc}{sctp\_src}, is\_mask);
956         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_ad44c86ae49f219522bcd4fb2744b81b2}{tp}.dst, sctp\_key->\hyperlink{structovs__key__sctp_a1fa757d8e013ccfc5672df04cfa3aa7d}{sctp\_dst}, is\_mask);
957         attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a33b7870d10d17ea1604aa83edf40e452}{OVS\_KEY\_ATTR\_SCTP});
958     \}
959 
960     \textcolor{keywordflow}{if} (attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a7059323c7b14c529cc9d2ff8d3134de9}{OVS\_KEY\_ATTR\_ICMP})) \{
961         \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__key__icmp}{ovs\_key\_icmp} *icmp\_key;
962 
963         icmp\_key = nla\_data(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a7059323c7b14c529cc9d2ff8d3134de9}{OVS\_KEY\_ATTR\_ICMP}]);
964         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_ad44c86ae49f219522bcd4fb2744b81b2}{tp}.src,
965                 htons(icmp\_key->\hyperlink{structovs__key__icmp_aa1880a0c32ed20143e19948c0169060a}{icmp\_type}), is\_mask);
966         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_ad44c86ae49f219522bcd4fb2744b81b2}{tp}.dst,
967                 htons(icmp\_key->\hyperlink{structovs__key__icmp_ae65b58144b376be4a05f68e7e979497d}{icmp\_code}), is\_mask);
968         attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a7059323c7b14c529cc9d2ff8d3134de9}{OVS\_KEY\_ATTR\_ICMP});
969     \}
970 
971     \textcolor{keywordflow}{if} (attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864af4093db51c9d12b98e1b18d7ddc2b5e3}{OVS\_KEY\_ATTR\_ICMPV6})) \{
972         \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__key__icmpv6}{ovs\_key\_icmpv6} *icmpv6\_key;
973 
974         icmpv6\_key = nla\_data(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864af4093db51c9d12b98e1b18d7ddc2b5e3}{OVS\_KEY\_ATTR\_ICMPV6}]);
975         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_ad44c86ae49f219522bcd4fb2744b81b2}{tp}.src,
976                 htons(icmpv6\_key->\hyperlink{structovs__key__icmpv6_a2bc3cf02c7b239b7f6f316aa26d9950e}{icmpv6\_type}), is\_mask);
977         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_ad44c86ae49f219522bcd4fb2744b81b2}{tp}.dst,
978                 htons(icmpv6\_key->\hyperlink{structovs__key__icmpv6_a3c3aab85ec0e772e50fbff5c9848558c}{icmpv6\_code}), is\_mask);
979         attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864af4093db51c9d12b98e1b18d7ddc2b5e3}{OVS\_KEY\_ATTR\_ICMPV6});
980     \}
981 
982     \textcolor{keywordflow}{if} (attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a6049f54211f31d444025675813d3881b}{OVS\_KEY\_ATTR\_ND})) \{
983         \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__key__nd}{ovs\_key\_nd} *nd\_key;
984 
985         nd\_key = nla\_data(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a6049f54211f31d444025675813d3881b}{OVS\_KEY\_ATTR\_ND}]);
986         \hyperlink{linux_2flow__netlink_8c_aa303fd044db169fb22013e1279c18dd1}{SW\_FLOW\_KEY\_MEMCPY}(match, \hyperlink{flow_8h_a0e15caa0bf708962ec6aa94137d5bbae}{ipv6}.nd.target,
987             nd\_key->\hyperlink{structovs__key__nd_ab37fa98a8363f7c9600780df6b88a2e7}{nd\_target},
988             \textcolor{keyword}{sizeof}(match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_a6b13e14d62eb632b05378784a2d61f87}{ipv6}.nd.target),
989             is\_mask);
990         \hyperlink{linux_2flow__netlink_8c_aa303fd044db169fb22013e1279c18dd1}{SW\_FLOW\_KEY\_MEMCPY}(match, \hyperlink{flow_8h_a0e15caa0bf708962ec6aa94137d5bbae}{ipv6}.nd.sll,
991             nd\_key->\hyperlink{structovs__key__nd_ad127c3fcbfc08dbf63e762c387f57b12}{nd\_sll}, ETH\_ALEN, is\_mask);
992         \hyperlink{linux_2flow__netlink_8c_aa303fd044db169fb22013e1279c18dd1}{SW\_FLOW\_KEY\_MEMCPY}(match, \hyperlink{flow_8h_a0e15caa0bf708962ec6aa94137d5bbae}{ipv6}.nd.tll,
993                 nd\_key->\hyperlink{structovs__key__nd_a66559abec4bf299ada50794d2f43f30d}{nd\_tll}, ETH\_ALEN, is\_mask);
994         attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a6049f54211f31d444025675813d3881b}{OVS\_KEY\_ATTR\_ND});
995     \}
996 
997     \textcolor{keywordflow}{if} (attrs != 0) \{
998         \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Unknown key attributes %llx"},
999               (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long})attrs);
1000         \textcolor{keywordflow}{return} -EINVAL;
1001     \}
1002 
1003     \textcolor{keywordflow}{return} 0;
1004 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a1a09e9d38844c59332975789573e994c}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+match\+\_\+init@{ovs\+\_\+match\+\_\+init}}
\index{ovs\+\_\+match\+\_\+init@{ovs\+\_\+match\+\_\+init}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+match\+\_\+init}]{\setlength{\rightskip}{0pt plus 5cm}void ovs\+\_\+match\+\_\+init (
\begin{DoxyParamCaption}
\item[{struct {\bf sw\+\_\+flow\+\_\+match} $\ast$}]{match, }
\item[{struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{key, }
\item[{struct {\bf sw\+\_\+flow\+\_\+mask} $\ast$}]{mask}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_a1a09e9d38844c59332975789573e994c}

\begin{DoxyCode}
1714 \{
1715     memset(match, 0, \textcolor{keyword}{sizeof}(*match));
1716     match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key} = key;
1717     match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask} = mask;
1718 
1719     memset(key, 0, \textcolor{keyword}{sizeof}(*key));
1720 
1721     \textcolor{keywordflow}{if} (mask) \{
1722         memset(&mask->\hyperlink{structsw__flow__mask_a52db0284fdd4579a5f30dee0837a7485}{key}, 0, \textcolor{keyword}{sizeof}(mask->\hyperlink{structsw__flow__mask_a52db0284fdd4579a5f30dee0837a7485}{key}));
1723         mask->\hyperlink{structsw__flow__mask_aa6062c0e580d516ff2d9ce8f9611432b}{range}.\hyperlink{structsw__flow__key__range_a3139158cea80b4e5af36967f3748e846}{start} = mask->\hyperlink{structsw__flow__mask_aa6062c0e580d516ff2d9ce8f9611432b}{range}.\hyperlink{structsw__flow__key__range_ab9c9d06e6ed2b9600d295dfdd94cc05a}{end} = 0;
1724     \}
1725 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a10dc93f8c379eae7a557d54d9b387dd6}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+nla\+\_\+copy\+\_\+actions@{ovs\+\_\+nla\+\_\+copy\+\_\+actions}}
\index{ovs\+\_\+nla\+\_\+copy\+\_\+actions@{ovs\+\_\+nla\+\_\+copy\+\_\+actions}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+nla\+\_\+copy\+\_\+actions}]{\setlength{\rightskip}{0pt plus 5cm}int ovs\+\_\+nla\+\_\+copy\+\_\+actions (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{attr, }
\item[{const struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{key, }
\item[{struct {\bf sw\+\_\+flow\+\_\+actions} $\ast$$\ast$}]{sfa, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_a10dc93f8c379eae7a557d54d9b387dd6}

\begin{DoxyCode}
2182 \{
2183     \textcolor{keywordtype}{int} err;
2184 
2185     *sfa = \hyperlink{linux_2flow__netlink_8c_acf3273c812551499c4b4d48651548286}{nla\_alloc\_flow\_actions}(nla\_len(attr), log);
2186     \textcolor{keywordflow}{if} (IS\_ERR(*sfa))
2187         \textcolor{keywordflow}{return} PTR\_ERR(*sfa);
2188 
2189     err = \hyperlink{linux_2flow__netlink_8c_ae5c58b498948d3c5564b7916505d8455}{\_\_ovs\_nla\_copy\_actions}(attr, key, 0, sfa, key->
      \hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_af30defbb2a81c997e8747594e1d937a0}{type},
2190                      key->\hyperlink{structsw__flow__key_af3e10c978a3a2bf303b7d953ac6ff361}{eth}.\hyperlink{structsw__flow__key_a56b27b9b9eafa8f79acd544eba98c7b0}{tci}, log);
2191     \textcolor{keywordflow}{if} (err)
2192         kfree(*sfa);
2193 
2194     \textcolor{keywordflow}{return} err;
2195 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a5e773c3bb49bbeb0c0a4eb356c779a22}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+nla\+\_\+free\+\_\+flow\+\_\+actions@{ovs\+\_\+nla\+\_\+free\+\_\+flow\+\_\+actions}}
\index{ovs\+\_\+nla\+\_\+free\+\_\+flow\+\_\+actions@{ovs\+\_\+nla\+\_\+free\+\_\+flow\+\_\+actions}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+nla\+\_\+free\+\_\+flow\+\_\+actions}]{\setlength{\rightskip}{0pt plus 5cm}void ovs\+\_\+nla\+\_\+free\+\_\+flow\+\_\+actions (
\begin{DoxyParamCaption}
\item[{struct {\bf sw\+\_\+flow\+\_\+actions} $\ast$}]{sf\+\_\+acts}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_a5e773c3bb49bbeb0c0a4eb356c779a22}

\begin{DoxyCode}
1563 \{
1564     call\_rcu(&sf\_acts->\hyperlink{structsw__flow__actions_aaf3da3f7607ed9dd956fd8c6e1290831}{rcu}, \hyperlink{linux_2flow__netlink_8c_a386dd5cb0c8be8ce91e59761cbf820b4}{rcu\_free\_acts\_callback});
1565 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a90428a389e4ba65133d2cf837d5a8dc3}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+nla\+\_\+get\+\_\+flow\+\_\+metadata@{ovs\+\_\+nla\+\_\+get\+\_\+flow\+\_\+metadata}}
\index{ovs\+\_\+nla\+\_\+get\+\_\+flow\+\_\+metadata@{ovs\+\_\+nla\+\_\+get\+\_\+flow\+\_\+metadata}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+nla\+\_\+get\+\_\+flow\+\_\+metadata}]{\setlength{\rightskip}{0pt plus 5cm}int ovs\+\_\+nla\+\_\+get\+\_\+flow\+\_\+metadata (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{attr, }
\item[{struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{key, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_a90428a389e4ba65133d2cf837d5a8dc3}
ovs\+\_\+nla\+\_\+get\+\_\+flow\+\_\+metadata -\/ parses Netlink attributes into a flow key. \+: Receives extracted in\+\_\+port, priority, tun\+\_\+key and skb\+\_\+mark. \+: Netlink attribute holding nested O\+V\+S\+\_\+\+K\+E\+Y\+\_\+\+A\+T\+T\+R\+\_\+$\ast$ Netlink attribute sequence. \+: Boolean to allow kernel error logging. Normally true, but when probing for feature compatibility this should be passed in as false to suppress unnecessary error logging.

This parses a series of Netlink attributes that form a flow key, which must take the same form accepted by flow\+\_\+from\+\_\+nlattrs(), but only enough of it to get the metadata, that is, the parts of the flow key that cannot be extracted from the packet itself. 
\begin{DoxyCode}
1255 \{
1256     \textcolor{keyword}{const} \textcolor{keyword}{struct }nlattr *a[\hyperlink{openvswitch_8h_a2a2adc6c47c38f0e7889580602ccbe22}{OVS\_KEY\_ATTR\_MAX} + 1];
1257     \textcolor{keyword}{struct }\hyperlink{structsw__flow__match}{sw\_flow\_match} match;
1258     u64 attrs = 0;
1259     \textcolor{keywordtype}{int} err;
1260 
1261     err = \hyperlink{linux_2flow__netlink_8c_aafe0de49242cd0276fd5ced0fd81514f}{parse\_flow\_nlattrs}(attr, a, &attrs, log);
1262     \textcolor{keywordflow}{if} (err)
1263         \textcolor{keywordflow}{return} -EINVAL;
1264 
1265     memset(&match, 0, \textcolor{keyword}{sizeof}(match));
1266     match.key = \hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key};
1267 
1268     memset(key, 0, \hyperlink{flow_8h_aa38104b9e3106537d588a65cdce52e3a}{OVS\_SW\_FLOW\_KEY\_METADATA\_SIZE});
1269     key->\hyperlink{structsw__flow__key_a57cbddb75a8d4fd859300bd34d98e84a}{phy}.\hyperlink{structsw__flow__key_a5848de18caa80d36d9bc60cc686a2c6e}{in\_port} = \hyperlink{datapath_8h_a73b117dd1ebe456eecfb7688047a03f1}{DP\_MAX\_PORTS};
1270 
1271     \textcolor{keywordflow}{return} \hyperlink{linux_2flow__netlink_8c_aed17f75c6136e01aa609132d5bbc9b2a}{metadata\_from\_nlattrs}(&match, &attrs, a, \textcolor{keyword}{false}, log);
1272 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_aa416ab3b06ce40eee0be66306129c8d5}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+nla\+\_\+get\+\_\+identifier@{ovs\+\_\+nla\+\_\+get\+\_\+identifier}}
\index{ovs\+\_\+nla\+\_\+get\+\_\+identifier@{ovs\+\_\+nla\+\_\+get\+\_\+identifier}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+nla\+\_\+get\+\_\+identifier}]{\setlength{\rightskip}{0pt plus 5cm}int ovs\+\_\+nla\+\_\+get\+\_\+identifier (
\begin{DoxyParamCaption}
\item[{struct {\bf sw\+\_\+flow\+\_\+id} $\ast$}]{sfid, }
\item[{const struct nlattr $\ast$}]{ufid, }
\item[{const struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{key, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_aa416ab3b06ce40eee0be66306129c8d5}

\begin{DoxyCode}
1216 \{
1217     \textcolor{keyword}{struct }\hyperlink{structsw__flow__key}{sw\_flow\_key} *new\_key;
1218 
1219     \textcolor{keywordflow}{if} (\hyperlink{flow__netlink_8c_a81e0cfe1c434ecde4ad684c8b8586877}{ovs\_nla\_get\_ufid}(sfid, ufid, log))
1220         \textcolor{keywordflow}{return} 0;
1221 
1222     \textcolor{comment}{/* If UFID was not provided, use unmasked key. */}
1223     new\_key = kmalloc(\textcolor{keyword}{sizeof}(*new\_key), GFP\_KERNEL);
1224     \textcolor{keywordflow}{if} (!new\_key)
1225         \textcolor{keywordflow}{return} -ENOMEM;
1226     memcpy(new\_key, key, \textcolor{keyword}{sizeof}(*key));
1227     sfid->\hyperlink{structsw__flow__id_a5d62dce79569cb8c25a43f4039e5df3c}{unmasked\_key} = new\_key;
1228 
1229     \textcolor{keywordflow}{return} 0;
1230 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a074547b2bcb32890a72ae873700391d5}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+nla\+\_\+get\+\_\+match@{ovs\+\_\+nla\+\_\+get\+\_\+match}}
\index{ovs\+\_\+nla\+\_\+get\+\_\+match@{ovs\+\_\+nla\+\_\+get\+\_\+match}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+nla\+\_\+get\+\_\+match}]{\setlength{\rightskip}{0pt plus 5cm}int ovs\+\_\+nla\+\_\+get\+\_\+match (
\begin{DoxyParamCaption}
\item[{struct {\bf sw\+\_\+flow\+\_\+match} $\ast$}]{match, }
\item[{const struct nlattr $\ast$}]{nla\+\_\+key, }
\item[{const struct nlattr $\ast$}]{nla\+\_\+mask, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_a074547b2bcb32890a72ae873700391d5}
ovs\+\_\+nla\+\_\+get\+\_\+match -\/ parses Netlink attributes into a flow key and mask. In case the \textquotesingle{}mask\textquotesingle{} is N\+U\+L\+L, the flow is treated as exact match flow. Otherwise, it is treated as a wildcarded flow, except the mask does not include any don\textquotesingle{}t care bit. \+: receives the extracted flow match information. \+: Netlink attribute holding nested O\+V\+S\+\_\+\+K\+E\+Y\+\_\+\+A\+T\+T\+R\+\_\+$\ast$ Netlink attribute sequence. The fields should of the packet that triggered the creation of this flow. \+: Optional. Netlink attribute holding nested O\+V\+S\+\_\+\+K\+E\+Y\+\_\+\+A\+T\+T\+R\+\_\+$\ast$ Netlink attribute specifies the mask field of the wildcarded flow. \+: Boolean to allow kernel error logging. Normally true, but when probing for feature compatibility this should be passed in as false to suppress unnecessary error logging. 
\begin{DoxyCode}
1045 \{
1046     \textcolor{keyword}{const} \textcolor{keyword}{struct }nlattr *a[\hyperlink{openvswitch_8h_a2a2adc6c47c38f0e7889580602ccbe22}{OVS\_KEY\_ATTR\_MAX} + 1];
1047     \textcolor{keyword}{const} \textcolor{keyword}{struct }nlattr *encap;
1048     \textcolor{keyword}{struct }nlattr *newmask = NULL;
1049     u64 key\_attrs = 0;
1050     u64 mask\_attrs = 0;
1051     \textcolor{keywordtype}{bool} encap\_valid = \textcolor{keyword}{false};
1052     \textcolor{keywordtype}{int} err;
1053 
1054     err = \hyperlink{linux_2flow__netlink_8c_aafe0de49242cd0276fd5ced0fd81514f}{parse\_flow\_nlattrs}(nla\_key, a, &key\_attrs, log);
1055     \textcolor{keywordflow}{if} (err)
1056         \textcolor{keywordflow}{return} err;
1057 
1058     \textcolor{keywordflow}{if} ((key\_attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a75127b87d8a2f36ae2c9aae2cf42cd56}{OVS\_KEY\_ATTR\_ETHERNET})) &&
1059         (key\_attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aaccef1ecf941c78c70cf8a6a3374235a}{OVS\_KEY\_ATTR\_ETHERTYPE})) &&
1060         (\hyperlink{net_2netlink_8h_a5a9bc877c8fdbf9b3f2f85536aabcae0}{nla\_get\_be16}(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aaccef1ecf941c78c70cf8a6a3374235a}{OVS\_KEY\_ATTR\_ETHERTYPE}]) == htons(ETH\_P\_8021Q))) 
      \{
1061         \_\_be16 \hyperlink{flow_8h_a4528fe4db43b403cd959b50285d71b0c}{tci};
1062 
1063         \textcolor{keywordflow}{if} (!((key\_attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864ae513231d4612ed9b19551a7e70648005}{OVS\_KEY\_ATTR\_VLAN})) &&
1064               (key\_attrs & (1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a869b60116d7d6ac79bfad91cc808cf75}{OVS\_KEY\_ATTR\_ENCAP})))) \{
1065             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Invalid Vlan frame."});
1066             \textcolor{keywordflow}{return} -EINVAL;
1067         \}
1068 
1069         key\_attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aaccef1ecf941c78c70cf8a6a3374235a}{OVS\_KEY\_ATTR\_ETHERTYPE});
1070         tci = \hyperlink{net_2netlink_8h_a5a9bc877c8fdbf9b3f2f85536aabcae0}{nla\_get\_be16}(a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864ae513231d4612ed9b19551a7e70648005}{OVS\_KEY\_ATTR\_VLAN}]);
1071         encap = a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a869b60116d7d6ac79bfad91cc808cf75}{OVS\_KEY\_ATTR\_ENCAP}];
1072         key\_attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a869b60116d7d6ac79bfad91cc808cf75}{OVS\_KEY\_ATTR\_ENCAP});
1073         encap\_valid = \textcolor{keyword}{true};
1074 
1075         \textcolor{keywordflow}{if} (tci & htons(\hyperlink{if__vlan_8h_ac8bf15be3fd1a3a63a2452fa05a83217}{VLAN\_TAG\_PRESENT})) \{
1076             err = \hyperlink{linux_2flow__netlink_8c_aafe0de49242cd0276fd5ced0fd81514f}{parse\_flow\_nlattrs}(encap, a, &key\_attrs, log);
1077             \textcolor{keywordflow}{if} (err)
1078                 \textcolor{keywordflow}{return} err;
1079         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!tci) \{
1080             \textcolor{comment}{/* Corner case for truncated 802.1Q header. */}
1081             \textcolor{keywordflow}{if} (nla\_len(encap)) \{
1082                 \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Truncated 802.1Q header has non-zero encap attribute."});
1083                 \textcolor{keywordflow}{return} -EINVAL;
1084             \}
1085         \} \textcolor{keywordflow}{else} \{
1086             \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Encap attr is set for non-VLAN frame"});
1087             \textcolor{keywordflow}{return}  -EINVAL;
1088         \}
1089     \}
1090 
1091     err = \hyperlink{linux_2flow__netlink_8c_a7e2f54c332f7bdac73756972da69ad53}{ovs\_key\_from\_nlattrs}(match, key\_attrs, a, \textcolor{keyword}{false}, log);
1092     \textcolor{keywordflow}{if} (err)
1093         \textcolor{keywordflow}{return} err;
1094 
1095     \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask}) \{
1096         \textcolor{keywordflow}{if} (!nla\_mask) \{
1097             \textcolor{comment}{/* Create an exact match mask. We need to set to 0xff}
1098 \textcolor{comment}{             * all the 'match->mask' fields that have been touched}
1099 \textcolor{comment}{             * in 'match->key'. We cannot simply memset}
1100 \textcolor{comment}{             * 'match->mask', because padding bytes and fields not}
1101 \textcolor{comment}{             * specified in 'match->key' should be left to 0.}
1102 \textcolor{comment}{             * Instead, we use a stream of netlink attributes,}
1103 \textcolor{comment}{             * copied from 'key' and set to 0xff.}
1104 \textcolor{comment}{             * ovs\_key\_from\_nlattrs() will take care of filling}
1105 \textcolor{comment}{             * 'match->mask' appropriately.}
1106 \textcolor{comment}{             */}
1107             newmask = kmemdup(nla\_key,
1108                       nla\_total\_size(nla\_len(nla\_key)),
1109                       GFP\_KERNEL);
1110             \textcolor{keywordflow}{if} (!newmask)
1111                 \textcolor{keywordflow}{return} -ENOMEM;
1112 
1113             \hyperlink{linux_2flow__netlink_8c_aa862995e0363dbb698ee51eb1be8a40c}{mask\_set\_nlattr}(newmask, 0xff);
1114 
1115             \textcolor{comment}{/* The userspace does not send tunnel attributes that}
1116 \textcolor{comment}{             * are 0, but we should not wildcard them nonetheless.}
1117 \textcolor{comment}{             */}
1118             \textcolor{keywordflow}{if} (match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_a2f87b7690c0cc2797f1f4347589472c3}{tun\_key}.\hyperlink{structovs__key__ipv4__tunnel_ae443d381a97f53bbc4139fe36c0aae30}{ipv4\_dst})
1119                 \hyperlink{linux_2flow__netlink_8c_a428fac9f6cc49614e07de128b9e4869f}{SW\_FLOW\_KEY\_MEMSET\_FIELD}(match, \hyperlink{flow_8h_a904e9497acde49a1992636f77597c5c7}{tun\_key},
1120                              0xff, \textcolor{keyword}{true});
1121 
1122             nla\_mask = newmask;
1123         \}
1124 
1125         err = \hyperlink{linux_2flow__netlink_8c_a4a090c5659903b6b8d125ab7598ad1a6}{parse\_flow\_mask\_nlattrs}(nla\_mask, a, &mask\_attrs, log);
1126         \textcolor{keywordflow}{if} (err)
1127             \textcolor{keywordflow}{goto} free\_newmask;
1128 
1129         \textcolor{comment}{/* Always match on tci. */}
1130         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_a1679a3c93391059deba58179f52c86a6}{eth}.tci, htons(0xffff), \textcolor{keyword}{true});
1131 
1132         \textcolor{keywordflow}{if} (mask\_attrs & 1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a869b60116d7d6ac79bfad91cc808cf75}{OVS\_KEY\_ATTR\_ENCAP}) \{
1133             \_\_be16 eth\_type = 0;
1134             \_\_be16 tci = 0;
1135 
1136             \textcolor{keywordflow}{if} (!encap\_valid) \{
1137                 \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Encap mask attribute is set for non-VLAN frame."});
1138                 err = -EINVAL;
1139                 \textcolor{keywordflow}{goto} free\_newmask;
1140             \}
1141 
1142             mask\_attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a869b60116d7d6ac79bfad91cc808cf75}{OVS\_KEY\_ATTR\_ENCAP});
1143             \textcolor{keywordflow}{if} (a[OVS\_KEY\_ATTR\_ETHERTYPE])
1144                 eth\_type = \hyperlink{net_2netlink_8h_a5a9bc877c8fdbf9b3f2f85536aabcae0}{nla\_get\_be16}(a[OVS\_KEY\_ATTR\_ETHERTYPE]);
1145 
1146             \textcolor{keywordflow}{if} (eth\_type == htons(0xffff)) \{
1147                 mask\_attrs &= ~(1ULL << \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aaccef1ecf941c78c70cf8a6a3374235a}{OVS\_KEY\_ATTR\_ETHERTYPE});
1148                 encap = a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a869b60116d7d6ac79bfad91cc808cf75}{OVS\_KEY\_ATTR\_ENCAP}];
1149                 err = \hyperlink{linux_2flow__netlink_8c_a4a090c5659903b6b8d125ab7598ad1a6}{parse\_flow\_mask\_nlattrs}(encap, a,
1150                                   &mask\_attrs, log);
1151                 \textcolor{keywordflow}{if} (err)
1152                     \textcolor{keywordflow}{goto} free\_newmask;
1153             \} \textcolor{keywordflow}{else} \{
1154                 \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"VLAN frames must have an exact match on the TPID (mask=%x)."},
1155                       ntohs(eth\_type));
1156                 err = -EINVAL;
1157                 \textcolor{keywordflow}{goto} free\_newmask;
1158             \}
1159 
1160             \textcolor{keywordflow}{if} (a[\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864ae513231d4612ed9b19551a7e70648005}{OVS\_KEY\_ATTR\_VLAN}])
1161                 tci = \hyperlink{net_2netlink_8h_a5a9bc877c8fdbf9b3f2f85536aabcae0}{nla\_get\_be16}(a[OVS\_KEY\_ATTR\_VLAN]);
1162 
1163             \textcolor{keywordflow}{if} (!(tci & htons(\hyperlink{if__vlan_8h_ac8bf15be3fd1a3a63a2452fa05a83217}{VLAN\_TAG\_PRESENT}))) \{
1164                 \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"VLAN tag present bit must have an exact match (tci\_mask=%x)."},
1165                       ntohs(tci));
1166                 err = -EINVAL;
1167                 \textcolor{keywordflow}{goto} free\_newmask;
1168             \}
1169         \}
1170 
1171         err = \hyperlink{linux_2flow__netlink_8c_a7e2f54c332f7bdac73756972da69ad53}{ovs\_key\_from\_nlattrs}(match, mask\_attrs, a, \textcolor{keyword}{true}, log);
1172         \textcolor{keywordflow}{if} (err)
1173             \textcolor{keywordflow}{goto} free\_newmask;
1174     \}
1175 
1176     \textcolor{keywordflow}{if} (!\hyperlink{linux_2flow__netlink_8c_ab4be6b01938d3a8f5a14bc787cb2b0b2}{match\_validate}(match, key\_attrs, mask\_attrs, log))
1177         err = -EINVAL;
1178 
1179 free\_newmask:
1180     kfree(newmask);
1181     \textcolor{keywordflow}{return} err;
1182 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a81e0cfe1c434ecde4ad684c8b8586877}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+nla\+\_\+get\+\_\+ufid@{ovs\+\_\+nla\+\_\+get\+\_\+ufid}}
\index{ovs\+\_\+nla\+\_\+get\+\_\+ufid@{ovs\+\_\+nla\+\_\+get\+\_\+ufid}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+nla\+\_\+get\+\_\+ufid}]{\setlength{\rightskip}{0pt plus 5cm}{\bf bool} ovs\+\_\+nla\+\_\+get\+\_\+ufid (
\begin{DoxyParamCaption}
\item[{struct {\bf sw\+\_\+flow\+\_\+id} $\ast$}]{sfid, }
\item[{const struct nlattr $\ast$}]{attr, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_a81e0cfe1c434ecde4ad684c8b8586877}

\begin{DoxyCode}
1206 \{
1207     sfid->\hyperlink{structsw__flow__id_a7cfead96fedf295e55d6a17857adfbf5}{ufid\_len} = \hyperlink{linux_2flow__netlink_8c_a5189e471b5832c9371b45c5e58ca5b41}{get\_ufid\_len}(attr, log);
1208     \textcolor{keywordflow}{if} (sfid->\hyperlink{structsw__flow__id_a7cfead96fedf295e55d6a17857adfbf5}{ufid\_len})
1209         memcpy(sfid->\hyperlink{structsw__flow__id_a22ce2b1fed980149931fbccb05750f3e}{ufid}, nla\_data(attr), sfid->\hyperlink{structsw__flow__id_a7cfead96fedf295e55d6a17857adfbf5}{ufid\_len});
1210 
1211     \textcolor{keywordflow}{return} sfid->\hyperlink{structsw__flow__id_a7cfead96fedf295e55d6a17857adfbf5}{ufid\_len};
1212 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a415cb727697a02d62b8ff40795337d40}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+nla\+\_\+get\+\_\+ufid\+\_\+flags@{ovs\+\_\+nla\+\_\+get\+\_\+ufid\+\_\+flags}}
\index{ovs\+\_\+nla\+\_\+get\+\_\+ufid\+\_\+flags@{ovs\+\_\+nla\+\_\+get\+\_\+ufid\+\_\+flags}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+nla\+\_\+get\+\_\+ufid\+\_\+flags}]{\setlength{\rightskip}{0pt plus 5cm}u32 ovs\+\_\+nla\+\_\+get\+\_\+ufid\+\_\+flags (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{attr}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_a415cb727697a02d62b8ff40795337d40}

\begin{DoxyCode}
1233 \{
1234     \textcolor{keywordflow}{return} attr ? nla\_get\_u32(attr) : 0;
1235 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a923304ee69be1cfa52197b0f73c29e49}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+nla\+\_\+put\+\_\+actions@{ovs\+\_\+nla\+\_\+put\+\_\+actions}}
\index{ovs\+\_\+nla\+\_\+put\+\_\+actions@{ovs\+\_\+nla\+\_\+put\+\_\+actions}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+nla\+\_\+put\+\_\+actions}]{\setlength{\rightskip}{0pt plus 5cm}int ovs\+\_\+nla\+\_\+put\+\_\+actions (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{attr, }
\item[{int}]{len, }
\item[{struct sk\+\_\+buff $\ast$}]{skb}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_a923304ee69be1cfa52197b0f73c29e49}

\begin{DoxyCode}
2282 \{
2283     \textcolor{keyword}{const} \textcolor{keyword}{struct }nlattr *a;
2284     \textcolor{keywordtype}{int} rem, err;
2285 
2286     nla\_for\_each\_attr(a, attr, len, rem) \{
2287         \textcolor{keywordtype}{int} \hyperlink{flow_8h_ab22aaab04f806700def00f32823fcb9e}{type} = nla\_type(a);
2288 
2289         \textcolor{keywordflow}{switch} (type) \{
2290         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eaff937deb7687d0dd4b073c27aed9c8be}{OVS\_ACTION\_ATTR\_SET}:
2291             err = \hyperlink{linux_2flow__netlink_8c_af38f12c35d382eb717bb6e5b4fba2309}{set\_action\_to\_attr}(a, skb);
2292             \textcolor{keywordflow}{if} (err)
2293                 \textcolor{keywordflow}{return} err;
2294             \textcolor{keywordflow}{break};
2295 
2296         \textcolor{keywordflow}{case} OVS\_ACTION\_ATTR\_SET\_TO\_MASKED:
2297             err = \hyperlink{linux_2flow__netlink_8c_a14e859cc22996f05850ca737daf2ee09}{masked\_set\_action\_to\_set\_action\_attr}(a, skb);
2298             \textcolor{keywordflow}{if} (err)
2299                 \textcolor{keywordflow}{return} err;
2300             \textcolor{keywordflow}{break};
2301 
2302         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eaddc6f70b9e8501e5bb90548373faf734}{OVS\_ACTION\_ATTR\_SAMPLE}:
2303             err = \hyperlink{linux_2flow__netlink_8c_a92621d7eaed9e960f5e5d7b72e501db0}{sample\_action\_to\_attr}(a, skb);
2304             \textcolor{keywordflow}{if} (err)
2305                 \textcolor{keywordflow}{return} err;
2306             \textcolor{keywordflow}{break};
2307         \textcolor{keywordflow}{default}:
2308             \textcolor{keywordflow}{if} (nla\_put(skb, type, nla\_len(a), nla\_data(a)))
2309                 \textcolor{keywordflow}{return} -EMSGSIZE;
2310             \textcolor{keywordflow}{break};
2311         \}
2312     \}
2313 
2314     \textcolor{keywordflow}{return} 0;
2315 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a8a7309f6247775b5682061576c039e22}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+nla\+\_\+put\+\_\+egress\+\_\+tunnel\+\_\+key@{ovs\+\_\+nla\+\_\+put\+\_\+egress\+\_\+tunnel\+\_\+key}}
\index{ovs\+\_\+nla\+\_\+put\+\_\+egress\+\_\+tunnel\+\_\+key@{ovs\+\_\+nla\+\_\+put\+\_\+egress\+\_\+tunnel\+\_\+key}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+nla\+\_\+put\+\_\+egress\+\_\+tunnel\+\_\+key}]{\setlength{\rightskip}{0pt plus 5cm}int ovs\+\_\+nla\+\_\+put\+\_\+egress\+\_\+tunnel\+\_\+key (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{const struct {\bf ovs\+\_\+tunnel\+\_\+info} $\ast$}]{egress\+\_\+tun\+\_\+info}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_a8a7309f6247775b5682061576c039e22}

\begin{DoxyCode}
710 \{
711     \textcolor{keywordflow}{return} \hyperlink{linux_2flow__netlink_8c_ac7f453fb68977c7a24d7af50f18b43db}{\_\_ipv4\_tun\_to\_nlattr}(skb, &egress\_tun\_info->
      \hyperlink{structovs__tunnel__info_a007f0c7a9938884e6e8663cb4ab20d10}{tunnel},
712                     egress\_tun\_info->\hyperlink{structovs__tunnel__info_ae4fd786894f579a38a5955e7a0e68fd4}{options},
713                     egress\_tun\_info->\hyperlink{structovs__tunnel__info_ab50d289f61727b922831739affb28b18}{options\_len});
714 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a636f7d3cbe8656ceda87373110a4abc4}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+nla\+\_\+put\+\_\+identifier@{ovs\+\_\+nla\+\_\+put\+\_\+identifier}}
\index{ovs\+\_\+nla\+\_\+put\+\_\+identifier@{ovs\+\_\+nla\+\_\+put\+\_\+identifier}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+nla\+\_\+put\+\_\+identifier}]{\setlength{\rightskip}{0pt plus 5cm}int ovs\+\_\+nla\+\_\+put\+\_\+identifier (
\begin{DoxyParamCaption}
\item[{const struct {\bf sw\+\_\+flow} $\ast$}]{flow, }
\item[{struct sk\+\_\+buff $\ast$}]{skb}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_a636f7d3cbe8656ceda87373110a4abc4}

\begin{DoxyCode}
1509 \{
1510     \textcolor{keywordflow}{if} (\hyperlink{flow_8h_a995966854ceb0b5a72ff027c12ccf426}{ovs\_identifier\_is\_ufid}(&flow->\hyperlink{structsw__flow_a6e6645eec909d54871675be30000c0b9}{id}))
1511         \textcolor{keywordflow}{return} nla\_put(skb, \hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a0d2822e9d4b6fa37c54dd8b693c2b465}{OVS\_FLOW\_ATTR\_UFID}, flow->\hyperlink{structsw__flow_a6e6645eec909d54871675be30000c0b9}{id}.
      \hyperlink{structsw__flow__id_a7cfead96fedf295e55d6a17857adfbf5}{ufid\_len},
1512                    flow->\hyperlink{structsw__flow_a6e6645eec909d54871675be30000c0b9}{id}.\hyperlink{structsw__flow__id_a22ce2b1fed980149931fbccb05750f3e}{ufid});
1513 
1514     \textcolor{keywordflow}{return} \hyperlink{flow__netlink_8c_a845412e2f8f2bcb48df005e857474fcb}{ovs\_nla\_put\_key}(flow->\hyperlink{structsw__flow_a6e6645eec909d54871675be30000c0b9}{id}.\hyperlink{structsw__flow__id_a5d62dce79569cb8c25a43f4039e5df3c}{unmasked\_key}, flow->
      \hyperlink{structsw__flow_a6e6645eec909d54871675be30000c0b9}{id}.\hyperlink{structsw__flow__id_a5d62dce79569cb8c25a43f4039e5df3c}{unmasked\_key},
1515                    \hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a0d310e7624962a1b4c5212459995a5c9}{OVS\_FLOW\_ATTR\_KEY}, \textcolor{keyword}{false}, skb);
1516 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a845412e2f8f2bcb48df005e857474fcb}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+nla\+\_\+put\+\_\+key@{ovs\+\_\+nla\+\_\+put\+\_\+key}}
\index{ovs\+\_\+nla\+\_\+put\+\_\+key@{ovs\+\_\+nla\+\_\+put\+\_\+key}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+nla\+\_\+put\+\_\+key}]{\setlength{\rightskip}{0pt plus 5cm}int ovs\+\_\+nla\+\_\+put\+\_\+key (
\begin{DoxyParamCaption}
\item[{const struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{swkey, }
\item[{const struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{output, }
\item[{int}]{attr, }
\item[{{\bf bool}}]{is\+\_\+mask, }
\item[{struct sk\+\_\+buff $\ast$}]{skb}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_a845412e2f8f2bcb48df005e857474fcb}

\begin{DoxyCode}
1492 \{
1493     \textcolor{keywordtype}{int} err;
1494     \textcolor{keyword}{struct }nlattr *nla;
1495 
1496     nla = nla\_nest\_start(skb, attr);
1497     \textcolor{keywordflow}{if} (!nla)
1498         \textcolor{keywordflow}{return} -EMSGSIZE;
1499     err = \hyperlink{linux_2flow__netlink_8c_a469e9434d0bedd721b2e31a106799335}{\_\_ovs\_nla\_put\_key}(swkey, output, is\_mask, skb);
1500     \textcolor{keywordflow}{if} (err)
1501         \textcolor{keywordflow}{return} err;
1502     nla\_nest\_end(skb, nla);
1503 
1504     \textcolor{keywordflow}{return} 0;
1505 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_af5ab12e938f8564945464a9e110eace3}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+nla\+\_\+put\+\_\+mask@{ovs\+\_\+nla\+\_\+put\+\_\+mask}}
\index{ovs\+\_\+nla\+\_\+put\+\_\+mask@{ovs\+\_\+nla\+\_\+put\+\_\+mask}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+nla\+\_\+put\+\_\+mask}]{\setlength{\rightskip}{0pt plus 5cm}int ovs\+\_\+nla\+\_\+put\+\_\+mask (
\begin{DoxyParamCaption}
\item[{const struct {\bf sw\+\_\+flow} $\ast$}]{flow, }
\item[{struct sk\+\_\+buff $\ast$}]{skb}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_af5ab12e938f8564945464a9e110eace3}

\begin{DoxyCode}
1527 \{
1528     \textcolor{keywordflow}{return} \hyperlink{flow__netlink_8c_a845412e2f8f2bcb48df005e857474fcb}{ovs\_nla\_put\_key}(&flow->\hyperlink{structsw__flow_a14b83cbd65275bda4e97ae35500d26d8}{key}, &flow->\hyperlink{structsw__flow_a89c162e340693d0bb4977737e2b68c22}{mask}->\hyperlink{structsw__flow__mask_a52db0284fdd4579a5f30dee0837a7485}{key},
1529                 \hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a355a203b089e115abb28ea003dc5822c}{OVS\_FLOW\_ATTR\_MASK}, \textcolor{keyword}{true}, skb);
1530 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a2f6c3ab02b8e5d6296278dc9214500eb}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+nla\+\_\+put\+\_\+masked\+\_\+key@{ovs\+\_\+nla\+\_\+put\+\_\+masked\+\_\+key}}
\index{ovs\+\_\+nla\+\_\+put\+\_\+masked\+\_\+key@{ovs\+\_\+nla\+\_\+put\+\_\+masked\+\_\+key}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+nla\+\_\+put\+\_\+masked\+\_\+key}]{\setlength{\rightskip}{0pt plus 5cm}int ovs\+\_\+nla\+\_\+put\+\_\+masked\+\_\+key (
\begin{DoxyParamCaption}
\item[{const struct {\bf sw\+\_\+flow} $\ast$}]{flow, }
\item[{struct sk\+\_\+buff $\ast$}]{skb}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_a2f6c3ab02b8e5d6296278dc9214500eb}

\begin{DoxyCode}
1520 \{
1521     \textcolor{keywordflow}{return} \hyperlink{flow__netlink_8c_a845412e2f8f2bcb48df005e857474fcb}{ovs\_nla\_put\_key}(&flow->\hyperlink{structsw__flow_a14b83cbd65275bda4e97ae35500d26d8}{key}, &flow->\hyperlink{structsw__flow_a14b83cbd65275bda4e97ae35500d26d8}{key},
1522                 \hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a0d310e7624962a1b4c5212459995a5c9}{OVS\_FLOW\_ATTR\_KEY}, \textcolor{keyword}{false}, skb);
1523 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_ac920825ffe4fa75e7ca3c5e76ad4ec2a}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+tun\+\_\+key\+\_\+attr\+\_\+size@{ovs\+\_\+tun\+\_\+key\+\_\+attr\+\_\+size}}
\index{ovs\+\_\+tun\+\_\+key\+\_\+attr\+\_\+size@{ovs\+\_\+tun\+\_\+key\+\_\+attr\+\_\+size}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+tun\+\_\+key\+\_\+attr\+\_\+size}]{\setlength{\rightskip}{0pt plus 5cm}size\+\_\+t ovs\+\_\+tun\+\_\+key\+\_\+attr\+\_\+size (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\label{linux_2flow__netlink_8c_ac920825ffe4fa75e7ca3c5e76ad4ec2a}

\begin{DoxyCode}
259 \{
260     \textcolor{comment}{/* Whenever adding new OVS\_TUNNEL\_KEY\_ FIELDS, we should consider}
261 \textcolor{comment}{     * updating this function.}
262 \textcolor{comment}{     */}
263     \textcolor{keywordflow}{return}    nla\_total\_size(8)    \textcolor{comment}{/* OVS\_TUNNEL\_KEY\_ATTR\_ID */}
264         + nla\_total\_size(4)    \textcolor{comment}{/* OVS\_TUNNEL\_KEY\_ATTR\_IPV4\_SRC */}
265         + nla\_total\_size(4)    \textcolor{comment}{/* OVS\_TUNNEL\_KEY\_ATTR\_IPV4\_DST */}
266         + nla\_total\_size(1)    \textcolor{comment}{/* OVS\_TUNNEL\_KEY\_ATTR\_TOS */}
267         + nla\_total\_size(1)    \textcolor{comment}{/* OVS\_TUNNEL\_KEY\_ATTR\_TTL */}
268         + nla\_total\_size(0)    \textcolor{comment}{/* OVS\_TUNNEL\_KEY\_ATTR\_DONT\_FRAGMENT */}
269         + nla\_total\_size(0)    \textcolor{comment}{/* OVS\_TUNNEL\_KEY\_ATTR\_CSUM */}
270         + nla\_total\_size(0)    \textcolor{comment}{/* OVS\_TUNNEL\_KEY\_ATTR\_OAM */}
271         + nla\_total\_size(256)  \textcolor{comment}{/* OVS\_TUNNEL\_KEY\_ATTR\_GENEVE\_OPTS */}
272         \textcolor{comment}{/* OVS\_TUNNEL\_KEY\_ATTR\_VXLAN\_OPTS is mutually exclusive with}
273 \textcolor{comment}{         * OVS\_TUNNEL\_KEY\_ATTR\_GENEVE\_OPTS and covered by it.}
274 \textcolor{comment}{         */}
275         + nla\_total\_size(2)    \textcolor{comment}{/* OVS\_TUNNEL\_KEY\_ATTR\_TP\_SRC */}
276         + nla\_total\_size(2);   \textcolor{comment}{/* OVS\_TUNNEL\_KEY\_ATTR\_TP\_DST */}
277 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a4a090c5659903b6b8d125ab7598ad1a6}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!parse\+\_\+flow\+\_\+mask\+\_\+nlattrs@{parse\+\_\+flow\+\_\+mask\+\_\+nlattrs}}
\index{parse\+\_\+flow\+\_\+mask\+\_\+nlattrs@{parse\+\_\+flow\+\_\+mask\+\_\+nlattrs}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{parse\+\_\+flow\+\_\+mask\+\_\+nlattrs}]{\setlength{\rightskip}{0pt plus 5cm}static int parse\+\_\+flow\+\_\+mask\+\_\+nlattrs (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{attr, }
\item[{const struct nlattr $\ast$}]{a\mbox{[}$\,$\mbox{]}, }
\item[{u64 $\ast$}]{attrsp, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a4a090c5659903b6b8d125ab7598ad1a6}

\begin{DoxyCode}
406 \{
407     \textcolor{keywordflow}{return} \hyperlink{linux_2flow__netlink_8c_acc907c6eed2beccfb3d8564a9f627e93}{\_\_parse\_flow\_nlattrs}(attr, a, attrsp, log, \textcolor{keyword}{true});
408 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_aafe0de49242cd0276fd5ced0fd81514f}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!parse\+\_\+flow\+\_\+nlattrs@{parse\+\_\+flow\+\_\+nlattrs}}
\index{parse\+\_\+flow\+\_\+nlattrs@{parse\+\_\+flow\+\_\+nlattrs}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{parse\+\_\+flow\+\_\+nlattrs}]{\setlength{\rightskip}{0pt plus 5cm}static int parse\+\_\+flow\+\_\+nlattrs (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{attr, }
\item[{const struct nlattr $\ast$}]{a\mbox{[}$\,$\mbox{]}, }
\item[{u64 $\ast$}]{attrsp, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_aafe0de49242cd0276fd5ced0fd81514f}

\begin{DoxyCode}
413 \{
414     \textcolor{keywordflow}{return} \hyperlink{linux_2flow__netlink_8c_acc907c6eed2beccfb3d8564a9f627e93}{\_\_parse\_flow\_nlattrs}(attr, a, attrsp, log, \textcolor{keyword}{false});
415 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a386dd5cb0c8be8ce91e59761cbf820b4}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!rcu\+\_\+free\+\_\+acts\+\_\+callback@{rcu\+\_\+free\+\_\+acts\+\_\+callback}}
\index{rcu\+\_\+free\+\_\+acts\+\_\+callback@{rcu\+\_\+free\+\_\+acts\+\_\+callback}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{rcu\+\_\+free\+\_\+acts\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}static void rcu\+\_\+free\+\_\+acts\+\_\+callback (
\begin{DoxyParamCaption}
\item[{struct rcu\+\_\+head $\ast$}]{rcu}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a386dd5cb0c8be8ce91e59761cbf820b4}

\begin{DoxyCode}
1553 \{
1554     \textcolor{keyword}{struct }\hyperlink{structsw__flow__actions}{sw\_flow\_actions} *sf\_acts = container\_of(\hyperlink{structsw__flow__actions_aaf3da3f7607ed9dd956fd8c6e1290831}{rcu},
1555             \textcolor{keyword}{struct} \hyperlink{structsw__flow__actions}{sw\_flow\_actions}, \hyperlink{structsw__flow__actions_aaf3da3f7607ed9dd956fd8c6e1290831}{rcu});
1556     kfree(sf\_acts);
1557 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a5ce53ec8a0a126f8e33e1d9af6e1e083}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!reserve\+\_\+sfa\+\_\+size@{reserve\+\_\+sfa\+\_\+size}}
\index{reserve\+\_\+sfa\+\_\+size@{reserve\+\_\+sfa\+\_\+size}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{reserve\+\_\+sfa\+\_\+size}]{\setlength{\rightskip}{0pt plus 5cm}static struct nlattr$\ast$ reserve\+\_\+sfa\+\_\+size (
\begin{DoxyParamCaption}
\item[{struct {\bf sw\+\_\+flow\+\_\+actions} $\ast$$\ast$}]{sfa, }
\item[{int}]{attr\+\_\+len, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a5ce53ec8a0a126f8e33e1d9af6e1e083}

\begin{DoxyCode}
1569 \{
1570 
1571     \textcolor{keyword}{struct }\hyperlink{structsw__flow__actions}{sw\_flow\_actions} *acts;
1572     \textcolor{keywordtype}{int} new\_acts\_size;
1573     \textcolor{keywordtype}{int} req\_size = NLA\_ALIGN(attr\_len);
1574     \textcolor{keywordtype}{int} next\_offset = offsetof(\textcolor{keyword}{struct} \hyperlink{structsw__flow__actions}{sw\_flow\_actions}, \hyperlink{structsw__flow__actions_ae091e053b6fbc25174a28e97282cbe36}{actions}) +
1575                     (*sfa)->actions\_len;
1576 
1577     \textcolor{keywordflow}{if} (req\_size <= (ksize(*sfa) - next\_offset))
1578         \textcolor{keywordflow}{goto} out;
1579 
1580     new\_acts\_size = ksize(*sfa) * 2;
1581 
1582     \textcolor{keywordflow}{if} (new\_acts\_size > \hyperlink{linux_2flow__netlink_8c_a429e7a37f3797cd9870c534467a7f762}{MAX\_ACTIONS\_BUFSIZE}) \{
1583         \textcolor{keywordflow}{if} ((\hyperlink{linux_2flow__netlink_8c_a429e7a37f3797cd9870c534467a7f762}{MAX\_ACTIONS\_BUFSIZE} - next\_offset) < req\_size)
1584             \textcolor{keywordflow}{return} ERR\_PTR(-EMSGSIZE);
1585         new\_acts\_size = \hyperlink{linux_2flow__netlink_8c_a429e7a37f3797cd9870c534467a7f762}{MAX\_ACTIONS\_BUFSIZE};
1586     \}
1587 
1588     acts = \hyperlink{linux_2flow__netlink_8c_acf3273c812551499c4b4d48651548286}{nla\_alloc\_flow\_actions}(new\_acts\_size, log);
1589     \textcolor{keywordflow}{if} (IS\_ERR(acts))
1590         \textcolor{keywordflow}{return} (\textcolor{keywordtype}{void} *)acts;
1591 
1592     memcpy(acts->\hyperlink{structsw__flow__actions_ae091e053b6fbc25174a28e97282cbe36}{actions}, (*sfa)->actions, (*sfa)->actions\_len);
1593     acts->\hyperlink{structsw__flow__actions_ad18c83862d211746fc0542eabff148a5}{actions\_len} = (*sfa)->actions\_len;
1594     kfree(*sfa);
1595     *sfa = acts;
1596 
1597 out:
1598     (*sfa)->\hyperlink{structsw__flow__actions_ad18c83862d211746fc0542eabff148a5}{actions\_len} += req\_size;
1599     \textcolor{keywordflow}{return}  (\textcolor{keyword}{struct} nlattr *) ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *)(*sfa) + next\_offset);
1600 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a92621d7eaed9e960f5e5d7b72e501db0}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!sample\+\_\+action\+\_\+to\+\_\+attr@{sample\+\_\+action\+\_\+to\+\_\+attr}}
\index{sample\+\_\+action\+\_\+to\+\_\+attr@{sample\+\_\+action\+\_\+to\+\_\+attr}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{sample\+\_\+action\+\_\+to\+\_\+attr}]{\setlength{\rightskip}{0pt plus 5cm}static int sample\+\_\+action\+\_\+to\+\_\+attr (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{attr, }
\item[{struct sk\+\_\+buff $\ast$}]{skb}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a92621d7eaed9e960f5e5d7b72e501db0}

\begin{DoxyCode}
2198 \{
2199     \textcolor{keyword}{const} \textcolor{keyword}{struct }nlattr *a;
2200     \textcolor{keyword}{struct }nlattr *start;
2201     \textcolor{keywordtype}{int} err = 0, rem;
2202 
2203     start = nla\_nest\_start(skb, \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eaddc6f70b9e8501e5bb90548373faf734}{OVS\_ACTION\_ATTR\_SAMPLE});
2204     \textcolor{keywordflow}{if} (!start)
2205         \textcolor{keywordflow}{return} -EMSGSIZE;
2206 
2207     \hyperlink{net_2netlink_8h_ac2634af90bda4393105b6323da2044fa}{nla\_for\_each\_nested}(a, attr, rem) \{
2208         \textcolor{keywordtype}{int} \hyperlink{flow_8h_ab22aaab04f806700def00f32823fcb9e}{type} = nla\_type(a);
2209         \textcolor{keyword}{struct }nlattr *st\_sample;
2210 
2211         \textcolor{keywordflow}{switch} (type) \{
2212         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a5e170c4233862ef6223a7d26ffa980d6af761759afff1c7ca1663aab6fed71ebc}{OVS\_SAMPLE\_ATTR\_PROBABILITY}:
2213             \textcolor{keywordflow}{if} (nla\_put(skb, \hyperlink{openvswitch_8h_a5e170c4233862ef6223a7d26ffa980d6af761759afff1c7ca1663aab6fed71ebc}{OVS\_SAMPLE\_ATTR\_PROBABILITY},
2214                     \textcolor{keyword}{sizeof}(u32), nla\_data(a)))
2215                 \textcolor{keywordflow}{return} -EMSGSIZE;
2216             \textcolor{keywordflow}{break};
2217         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a5e170c4233862ef6223a7d26ffa980d6af557ec8d2fb56cf036384aab53211327}{OVS\_SAMPLE\_ATTR\_ACTIONS}:
2218             st\_sample = nla\_nest\_start(skb, \hyperlink{openvswitch_8h_a5e170c4233862ef6223a7d26ffa980d6af557ec8d2fb56cf036384aab53211327}{OVS\_SAMPLE\_ATTR\_ACTIONS});
2219             \textcolor{keywordflow}{if} (!st\_sample)
2220                 \textcolor{keywordflow}{return} -EMSGSIZE;
2221             err = \hyperlink{flow__netlink_8c_a923304ee69be1cfa52197b0f73c29e49}{ovs\_nla\_put\_actions}(nla\_data(a), nla\_len(a), skb);
2222             \textcolor{keywordflow}{if} (err)
2223                 \textcolor{keywordflow}{return} err;
2224             nla\_nest\_end(skb, st\_sample);
2225             \textcolor{keywordflow}{break};
2226         \}
2227     \}
2228 
2229     nla\_nest\_end(skb, start);
2230     \textcolor{keywordflow}{return} err;
2231 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_af38f12c35d382eb717bb6e5b4fba2309}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!set\+\_\+action\+\_\+to\+\_\+attr@{set\+\_\+action\+\_\+to\+\_\+attr}}
\index{set\+\_\+action\+\_\+to\+\_\+attr@{set\+\_\+action\+\_\+to\+\_\+attr}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{set\+\_\+action\+\_\+to\+\_\+attr}]{\setlength{\rightskip}{0pt plus 5cm}static int set\+\_\+action\+\_\+to\+\_\+attr (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{a, }
\item[{struct sk\+\_\+buff $\ast$}]{skb}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_af38f12c35d382eb717bb6e5b4fba2309}

\begin{DoxyCode}
2234 \{
2235     \textcolor{keyword}{const} \textcolor{keyword}{struct }nlattr *ovs\_key = nla\_data(a);
2236     \textcolor{keywordtype}{int} key\_type = nla\_type(ovs\_key);
2237     \textcolor{keyword}{struct }nlattr *start;
2238     \textcolor{keywordtype}{int} err;
2239 
2240     \textcolor{keywordflow}{switch} (key\_type) \{
2241     \textcolor{keywordflow}{case} OVS\_KEY\_ATTR\_TUNNEL\_INFO: \{
2242         \textcolor{keyword}{struct }\hyperlink{structovs__tunnel__info}{ovs\_tunnel\_info} *tun\_info = nla\_data(ovs\_key);
2243 
2244         start = nla\_nest\_start(skb, \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eaff937deb7687d0dd4b073c27aed9c8be}{OVS\_ACTION\_ATTR\_SET});
2245         \textcolor{keywordflow}{if} (!start)
2246             \textcolor{keywordflow}{return} -EMSGSIZE;
2247 
2248         err = \hyperlink{linux_2flow__netlink_8c_a534ea0693e07f81a7a00f4b3125fbb1a}{ipv4\_tun\_to\_nlattr}(skb, &tun\_info->\hyperlink{structovs__tunnel__info_a007f0c7a9938884e6e8663cb4ab20d10}{tunnel},
2249                      tun\_info->\hyperlink{structovs__tunnel__info_ab50d289f61727b922831739affb28b18}{options\_len} ?
2250                         tun\_info->\hyperlink{structovs__tunnel__info_ae4fd786894f579a38a5955e7a0e68fd4}{options} : NULL,
2251                      tun\_info->\hyperlink{structovs__tunnel__info_ab50d289f61727b922831739affb28b18}{options\_len});
2252         \textcolor{keywordflow}{if} (err)
2253             \textcolor{keywordflow}{return} err;
2254         nla\_nest\_end(skb, start);
2255         \textcolor{keywordflow}{break};
2256     \}
2257     \textcolor{keywordflow}{default}:
2258         \textcolor{keywordflow}{if} (nla\_put(skb, \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eaff937deb7687d0dd4b073c27aed9c8be}{OVS\_ACTION\_ATTR\_SET}, nla\_len(a), ovs\_key))
2259             \textcolor{keywordflow}{return} -EMSGSIZE;
2260         \textcolor{keywordflow}{break};
2261     \}
2262 
2263     \textcolor{keywordflow}{return} 0;
2264 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_ac21a080dcc5b01d3da9b75d32b13fb40}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!update\+\_\+range@{update\+\_\+range}}
\index{update\+\_\+range@{update\+\_\+range}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{update\+\_\+range}]{\setlength{\rightskip}{0pt plus 5cm}static void update\+\_\+range (
\begin{DoxyParamCaption}
\item[{struct {\bf sw\+\_\+flow\+\_\+match} $\ast$}]{match, }
\item[{size\+\_\+t}]{offset, }
\item[{size\+\_\+t}]{size, }
\item[{{\bf bool}}]{is\+\_\+mask}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_ac21a080dcc5b01d3da9b75d32b13fb40}

\begin{DoxyCode}
63 \{
64     \textcolor{keyword}{struct }\hyperlink{structsw__flow__key__range}{sw\_flow\_key\_range} *range;
65     \textcolor{keywordtype}{size\_t} \hyperlink{structsw__flow__key__range_a3139158cea80b4e5af36967f3748e846}{start} = \hyperlink{kernel_8h_abbacd255029bd6692704964758c8aa97}{rounddown}(offset, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{long}));
66     \textcolor{keywordtype}{size\_t} \hyperlink{structsw__flow__key__range_ab9c9d06e6ed2b9600d295dfdd94cc05a}{end} = roundup(offset + size, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{long}));
67 
68     \textcolor{keywordflow}{if} (!is\_mask)
69         range = &match->\hyperlink{structsw__flow__match_aed5e18f9a96464cce4b4e4443d550b2d}{range};
70     \textcolor{keywordflow}{else}
71         range = &match->\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask}->\hyperlink{structsw__flow__mask_aa6062c0e580d516ff2d9ce8f9611432b}{range};
72 
73     \textcolor{keywordflow}{if} (range->\hyperlink{structsw__flow__key__range_a3139158cea80b4e5af36967f3748e846}{start} == range->\hyperlink{structsw__flow__key__range_ab9c9d06e6ed2b9600d295dfdd94cc05a}{end}) \{
74         range->\hyperlink{structsw__flow__key__range_a3139158cea80b4e5af36967f3748e846}{start} = \hyperlink{structsw__flow__key__range_a3139158cea80b4e5af36967f3748e846}{start};
75         range->\hyperlink{structsw__flow__key__range_ab9c9d06e6ed2b9600d295dfdd94cc05a}{end} = \hyperlink{structsw__flow__key__range_ab9c9d06e6ed2b9600d295dfdd94cc05a}{end};
76         \textcolor{keywordflow}{return};
77     \}
78 
79     \textcolor{keywordflow}{if} (range->\hyperlink{structsw__flow__key__range_a3139158cea80b4e5af36967f3748e846}{start} > start)
80         range->\hyperlink{structsw__flow__key__range_a3139158cea80b4e5af36967f3748e846}{start} = \hyperlink{structsw__flow__key__range_a3139158cea80b4e5af36967f3748e846}{start};
81 
82     \textcolor{keywordflow}{if} (range->\hyperlink{structsw__flow__key__range_ab9c9d06e6ed2b9600d295dfdd94cc05a}{end} < end)
83         range->\hyperlink{structsw__flow__key__range_ab9c9d06e6ed2b9600d295dfdd94cc05a}{end} = \hyperlink{structsw__flow__key__range_ab9c9d06e6ed2b9600d295dfdd94cc05a}{end};
84 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a0dcf3429559610cf8b8204e04151728b}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!validate\+\_\+and\+\_\+copy\+\_\+sample@{validate\+\_\+and\+\_\+copy\+\_\+sample}}
\index{validate\+\_\+and\+\_\+copy\+\_\+sample@{validate\+\_\+and\+\_\+copy\+\_\+sample}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{validate\+\_\+and\+\_\+copy\+\_\+sample}]{\setlength{\rightskip}{0pt plus 5cm}static int validate\+\_\+and\+\_\+copy\+\_\+sample (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{attr, }
\item[{const struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{key, }
\item[{int}]{depth, }
\item[{struct {\bf sw\+\_\+flow\+\_\+actions} $\ast$$\ast$}]{sfa, }
\item[{\+\_\+\+\_\+be16}]{eth\+\_\+type, }
\item[{\+\_\+\+\_\+be16}]{vlan\+\_\+tci, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a0dcf3429559610cf8b8204e04151728b}

\begin{DoxyCode}
1664 \{
1665     \textcolor{keyword}{const} \textcolor{keyword}{struct }nlattr *attrs[\hyperlink{openvswitch_8h_a6883a5f7257928ebd7a37e7de10d3742}{OVS\_SAMPLE\_ATTR\_MAX} + 1];
1666     \textcolor{keyword}{const} \textcolor{keyword}{struct }nlattr *probability, *actions;
1667     \textcolor{keyword}{const} \textcolor{keyword}{struct }nlattr *a;
1668     \textcolor{keywordtype}{int} rem, start, err, st\_acts;
1669 
1670     memset(attrs, 0, \textcolor{keyword}{sizeof}(attrs));
1671     \hyperlink{net_2netlink_8h_ac2634af90bda4393105b6323da2044fa}{nla\_for\_each\_nested}(a, attr, rem) \{
1672         \textcolor{keywordtype}{int} \hyperlink{flow_8h_ab22aaab04f806700def00f32823fcb9e}{type} = nla\_type(a);
1673         \textcolor{keywordflow}{if} (!type || type > \hyperlink{openvswitch_8h_a6883a5f7257928ebd7a37e7de10d3742}{OVS\_SAMPLE\_ATTR\_MAX} || attrs[type])
1674             \textcolor{keywordflow}{return} -EINVAL;
1675         attrs[\hyperlink{flow_8h_ab22aaab04f806700def00f32823fcb9e}{type}] = a;
1676     \}
1677     \textcolor{keywordflow}{if} (rem)
1678         \textcolor{keywordflow}{return} -EINVAL;
1679 
1680     probability = attrs[\hyperlink{openvswitch_8h_a5e170c4233862ef6223a7d26ffa980d6af761759afff1c7ca1663aab6fed71ebc}{OVS\_SAMPLE\_ATTR\_PROBABILITY}];
1681     \textcolor{keywordflow}{if} (!probability || nla\_len(probability) != \textcolor{keyword}{sizeof}(u32))
1682         \textcolor{keywordflow}{return} -EINVAL;
1683 
1684     actions = attrs[\hyperlink{openvswitch_8h_a5e170c4233862ef6223a7d26ffa980d6af557ec8d2fb56cf036384aab53211327}{OVS\_SAMPLE\_ATTR\_ACTIONS}];
1685     \textcolor{keywordflow}{if} (!actions || (nla\_len(actions) && nla\_len(actions) < NLA\_HDRLEN))
1686         \textcolor{keywordflow}{return} -EINVAL;
1687 
1688     \textcolor{comment}{/* validation done, copy sample action. */}
1689     start = \hyperlink{linux_2flow__netlink_8c_a08778088a1f3c3c88aee0055bcd05110}{add\_nested\_action\_start}(sfa, 
      \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eaddc6f70b9e8501e5bb90548373faf734}{OVS\_ACTION\_ATTR\_SAMPLE}, log);
1690     \textcolor{keywordflow}{if} (start < 0)
1691         \textcolor{keywordflow}{return} start;
1692     err = \hyperlink{linux_2flow__netlink_8c_a4316343b483e9a6b4d8885147036beb2}{add\_action}(sfa, \hyperlink{openvswitch_8h_a5e170c4233862ef6223a7d26ffa980d6af761759afff1c7ca1663aab6fed71ebc}{OVS\_SAMPLE\_ATTR\_PROBABILITY},
1693              nla\_data(probability), \textcolor{keyword}{sizeof}(u32), log);
1694     \textcolor{keywordflow}{if} (err)
1695         \textcolor{keywordflow}{return} err;
1696     st\_acts = \hyperlink{linux_2flow__netlink_8c_a08778088a1f3c3c88aee0055bcd05110}{add\_nested\_action\_start}(sfa, 
      \hyperlink{openvswitch_8h_a5e170c4233862ef6223a7d26ffa980d6af557ec8d2fb56cf036384aab53211327}{OVS\_SAMPLE\_ATTR\_ACTIONS}, log);
1697     \textcolor{keywordflow}{if} (st\_acts < 0)
1698         \textcolor{keywordflow}{return} st\_acts;
1699 
1700     err = \hyperlink{linux_2flow__netlink_8c_ae5c58b498948d3c5564b7916505d8455}{\_\_ovs\_nla\_copy\_actions}(actions, key, depth + 1, sfa,
1701                      eth\_type, vlan\_tci, log);
1702     \textcolor{keywordflow}{if} (err)
1703         \textcolor{keywordflow}{return} err;
1704 
1705     \hyperlink{linux_2flow__netlink_8c_ab0176001eff016bfad478f0f06cefa0a}{add\_nested\_action\_end}(*sfa, st\_acts);
1706     \hyperlink{linux_2flow__netlink_8c_ab0176001eff016bfad478f0f06cefa0a}{add\_nested\_action\_end}(*sfa, start);
1707 
1708     \textcolor{keywordflow}{return} 0;
1709 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_ac06cff749bd68b0a91ecacc196b4892f}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!validate\+\_\+and\+\_\+copy\+\_\+set\+\_\+tun@{validate\+\_\+and\+\_\+copy\+\_\+set\+\_\+tun}}
\index{validate\+\_\+and\+\_\+copy\+\_\+set\+\_\+tun@{validate\+\_\+and\+\_\+copy\+\_\+set\+\_\+tun}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{validate\+\_\+and\+\_\+copy\+\_\+set\+\_\+tun}]{\setlength{\rightskip}{0pt plus 5cm}static int validate\+\_\+and\+\_\+copy\+\_\+set\+\_\+tun (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{attr, }
\item[{struct {\bf sw\+\_\+flow\+\_\+actions} $\ast$$\ast$}]{sfa, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_ac06cff749bd68b0a91ecacc196b4892f}

\begin{DoxyCode}
1757 \{
1758     \textcolor{keyword}{struct }\hyperlink{structsw__flow__match}{sw\_flow\_match} match;
1759     \textcolor{keyword}{struct }\hyperlink{structsw__flow__key}{sw\_flow\_key} key;
1760     \textcolor{keyword}{struct }\hyperlink{structovs__tunnel__info}{ovs\_tunnel\_info} *tun\_info;
1761     \textcolor{keyword}{struct }nlattr *a;
1762     \textcolor{keywordtype}{int} start, opts\_type;
1763     \textcolor{keywordtype}{int} err = 0;
1764 
1765     \hyperlink{flow__netlink_8c_a1a09e9d38844c59332975789573e994c}{ovs\_match\_init}(&match, &key, NULL);
1766     opts\_type = \hyperlink{linux_2flow__netlink_8c_aa9ad124d7dc9f5042d10b1237ce02f28}{ipv4\_tun\_from\_nlattr}(nla\_data(attr), &match, \textcolor{keyword}{false}, log);
1767     \textcolor{keywordflow}{if} (opts\_type < 0)
1768         \textcolor{keywordflow}{return} opts\_type;
1769 
1770     \textcolor{keywordflow}{if} (key.tun\_opts\_len) \{
1771         \textcolor{keywordflow}{switch} (opts\_type) \{
1772         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a3a6f60bb79d6ad889a091b82667009b9}{OVS\_TUNNEL\_KEY\_ATTR\_GENEVE\_OPTS}:
1773             err = \hyperlink{linux_2flow__netlink_8c_af4e9606a99a9ccc71de18c0531a99808}{validate\_geneve\_opts}(&key);
1774             \textcolor{keywordflow}{if} (err < 0)
1775                 \textcolor{keywordflow}{return} err;
1776             \textcolor{keywordflow}{break};
1777         \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a97447e85c3c3a2f9d648911b727c16ee}{OVS\_TUNNEL\_KEY\_ATTR\_VXLAN\_OPTS}:
1778             \textcolor{keywordflow}{break};
1779         \}
1780     \};
1781 
1782     start = \hyperlink{linux_2flow__netlink_8c_a08778088a1f3c3c88aee0055bcd05110}{add\_nested\_action\_start}(sfa, 
      \hyperlink{openvswitch_8h_affc4a4d29437ad03a23444243e2db26eaff937deb7687d0dd4b073c27aed9c8be}{OVS\_ACTION\_ATTR\_SET}, log);
1783     \textcolor{keywordflow}{if} (start < 0)
1784         \textcolor{keywordflow}{return} start;
1785 
1786     a = \hyperlink{linux_2flow__netlink_8c_ad6fb4bf743e36b42c72eaa09db192e87}{\_\_add\_action}(sfa, OVS\_KEY\_ATTR\_TUNNEL\_INFO, NULL,
1787              \textcolor{keyword}{sizeof}(*tun\_info) + key.tun\_opts\_len, log);
1788     \textcolor{keywordflow}{if} (IS\_ERR(a))
1789         \textcolor{keywordflow}{return} PTR\_ERR(a);
1790 
1791     tun\_info = nla\_data(a);
1792     tun\_info->\hyperlink{structovs__tunnel__info_a007f0c7a9938884e6e8663cb4ab20d10}{tunnel} = key.tun\_key;
1793     tun\_info->\hyperlink{structovs__tunnel__info_ab50d289f61727b922831739affb28b18}{options\_len} = key.tun\_opts\_len;
1794 
1795     \textcolor{keywordflow}{if} (tun\_info->\hyperlink{structovs__tunnel__info_ab50d289f61727b922831739affb28b18}{options\_len}) \{
1796         \textcolor{comment}{/* We need to store the options in the action itself since}
1797 \textcolor{comment}{         * everything else will go away after flow setup. We can append}
1798 \textcolor{comment}{         * it to tun\_info and then point there.}
1799 \textcolor{comment}{         */}
1800         memcpy((tun\_info + 1),
1801                \hyperlink{flow_8h_a5d74524a15e17551a8d8235f4375c296}{TUN\_METADATA\_OPTS}(&key, key.tun\_opts\_len), key.tun\_opts\_len);
1802         tun\_info->\hyperlink{structovs__tunnel__info_ae4fd786894f579a38a5955e7a0e68fd4}{options} = (tun\_info + 1);
1803     \} \textcolor{keywordflow}{else} \{
1804         tun\_info->\hyperlink{structovs__tunnel__info_ae4fd786894f579a38a5955e7a0e68fd4}{options} = NULL;
1805     \}
1806 
1807     \hyperlink{linux_2flow__netlink_8c_ab0176001eff016bfad478f0f06cefa0a}{add\_nested\_action\_end}(*sfa, start);
1808 
1809     \textcolor{keywordflow}{return} err;
1810 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_af4e9606a99a9ccc71de18c0531a99808}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!validate\+\_\+geneve\+\_\+opts@{validate\+\_\+geneve\+\_\+opts}}
\index{validate\+\_\+geneve\+\_\+opts@{validate\+\_\+geneve\+\_\+opts}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{validate\+\_\+geneve\+\_\+opts}]{\setlength{\rightskip}{0pt plus 5cm}static int validate\+\_\+geneve\+\_\+opts (
\begin{DoxyParamCaption}
\item[{struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_af4e9606a99a9ccc71de18c0531a99808}

\begin{DoxyCode}
1728 \{
1729     \textcolor{keyword}{struct }geneve\_opt *option;
1730     \textcolor{keywordtype}{int} opts\_len = key->\hyperlink{structsw__flow__key_aef0ea317d3bd0125e0d6390261ba3e2d}{tun\_opts\_len};
1731     \textcolor{keywordtype}{bool} crit\_opt = \textcolor{keyword}{false};
1732 
1733     option = (\textcolor{keyword}{struct }geneve\_opt *)\hyperlink{flow_8h_a5d74524a15e17551a8d8235f4375c296}{TUN\_METADATA\_OPTS}(key, key->
      \hyperlink{structsw__flow__key_aef0ea317d3bd0125e0d6390261ba3e2d}{tun\_opts\_len});
1734     \textcolor{keywordflow}{while} (opts\_len > 0) \{
1735         \textcolor{keywordtype}{int} len;
1736 
1737         \textcolor{keywordflow}{if} (opts\_len < \textcolor{keyword}{sizeof}(*option))
1738             \textcolor{keywordflow}{return} -EINVAL;
1739 
1740         len = \textcolor{keyword}{sizeof}(*option) + option->length * 4;
1741         \textcolor{keywordflow}{if} (len > opts\_len)
1742             \textcolor{keywordflow}{return} -EINVAL;
1743 
1744         crit\_opt |= !!(option->type & GENEVE\_CRIT\_OPT\_TYPE);
1745 
1746         option = (\textcolor{keyword}{struct }geneve\_opt *)((u8 *)option + len);
1747         opts\_len -= len;
1748     \};
1749 
1750     key->\hyperlink{structsw__flow__key_a2f87b7690c0cc2797f1f4347589472c3}{tun\_key}.\hyperlink{structovs__key__ipv4__tunnel_a7459e66ecf90329eb2fa6cf3fc4781db}{tun\_flags} |= crit\_opt ? \hyperlink{ip__tunnels_8h_a43c97214a6c4680f930191ffad41e269}{TUNNEL\_CRIT\_OPT} : 0;
1751 
1752     \textcolor{keywordflow}{return} 0;
1753 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_ae01edbfa96ed8cef19cb86caf0512d7a}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!validate\+\_\+masked@{validate\+\_\+masked}}
\index{validate\+\_\+masked@{validate\+\_\+masked}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{validate\+\_\+masked}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf bool} validate\+\_\+masked (
\begin{DoxyParamCaption}
\item[{u8 $\ast$}]{data, }
\item[{int}]{len}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_ae01edbfa96ed8cef19cb86caf0512d7a}

\begin{DoxyCode}
1816 \{
1817     u8 *mask = data + len;
1818 
1819     \textcolor{keywordflow}{while} (len--)
1820         \textcolor{keywordflow}{if} (*data++ & ~*mask++)
1821             \textcolor{keywordflow}{return} \textcolor{keyword}{false};
1822 
1823     \textcolor{keywordflow}{return} \textcolor{keyword}{true};
1824 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_afabdbd008e8fb3c515063cafaf267e02}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!validate\+\_\+set@{validate\+\_\+set}}
\index{validate\+\_\+set@{validate\+\_\+set}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{validate\+\_\+set}]{\setlength{\rightskip}{0pt plus 5cm}static int validate\+\_\+set (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{a, }
\item[{const struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{flow\+\_\+key, }
\item[{struct {\bf sw\+\_\+flow\+\_\+actions} $\ast$$\ast$}]{sfa, }
\item[{{\bf bool} $\ast$}]{skip\+\_\+copy, }
\item[{\+\_\+\+\_\+be16}]{eth\+\_\+type, }
\item[{{\bf bool}}]{masked, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_afabdbd008e8fb3c515063cafaf267e02}

\begin{DoxyCode}
1830 \{
1831     \textcolor{keyword}{const} \textcolor{keyword}{struct }nlattr *ovs\_key = nla\_data(a);
1832     \textcolor{keywordtype}{int} key\_type = nla\_type(ovs\_key);
1833     \textcolor{keywordtype}{size\_t} key\_len;
1834 
1835     \textcolor{comment}{/* There can be only one key in a action */}
1836     \textcolor{keywordflow}{if} (nla\_total\_size(nla\_len(ovs\_key)) != nla\_len(a))
1837         \textcolor{keywordflow}{return} -EINVAL;
1838 
1839     key\_len = nla\_len(ovs\_key);
1840     \textcolor{keywordflow}{if} (masked)
1841         key\_len /= 2;
1842 
1843     \textcolor{keywordflow}{if} (key\_type > \hyperlink{openvswitch_8h_a2a2adc6c47c38f0e7889580602ccbe22}{OVS\_KEY\_ATTR\_MAX} ||
1844         (\hyperlink{linux_2flow__netlink_8c_a5565daa559332f47a1d214007d97e0d7}{ovs\_key\_lens}[key\_type].len != key\_len &&
1845          \hyperlink{linux_2flow__netlink_8c_a5565daa559332f47a1d214007d97e0d7}{ovs\_key\_lens}[key\_type].len != \hyperlink{linux_2flow__netlink_8c_aa45250c738c1a22be7f5e711887c8547}{OVS\_ATTR\_NESTED}))
1846         \textcolor{keywordflow}{return} -EINVAL;
1847 
1848     \textcolor{keywordflow}{if} (masked && !\hyperlink{linux_2flow__netlink_8c_ae01edbfa96ed8cef19cb86caf0512d7a}{validate\_masked}(nla\_data(ovs\_key), key\_len))
1849         \textcolor{keywordflow}{return} -EINVAL;
1850 
1851     \textcolor{keywordflow}{switch} (key\_type) \{
1852     \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__key__ipv4}{ovs\_key\_ipv4} *ipv4\_key;
1853     \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__key__ipv6}{ovs\_key\_ipv6} *ipv6\_key;
1854     \textcolor{keywordtype}{int} err;
1855 
1856     \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a3dee91d2ad17f698e34ebb913fcef8bf}{OVS\_KEY\_ATTR\_PRIORITY}:
1857     \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a32f36d9e41b0fbae0746d67fa34340ad}{OVS\_KEY\_ATTR\_SKB\_MARK}:
1858     \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a75127b87d8a2f36ae2c9aae2cf42cd56}{OVS\_KEY\_ATTR\_ETHERNET}:
1859         \textcolor{keywordflow}{break};
1860 
1861     \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a97fc8cc803ab65e231ad28def7bcbb5f}{OVS\_KEY\_ATTR\_TUNNEL}:
1862         \textcolor{keywordflow}{if} (\hyperlink{net_2mpls_8h_aab48ab242fbafafc869b3e98df4ace8f}{eth\_p\_mpls}(eth\_type))
1863             \textcolor{keywordflow}{return} -EINVAL;
1864 
1865         \textcolor{keywordflow}{if} (masked)
1866             \textcolor{keywordflow}{return} -EINVAL; \textcolor{comment}{/* Masked tunnel set not supported. */}
1867 
1868         *skip\_copy = \textcolor{keyword}{true};
1869         err = \hyperlink{linux_2flow__netlink_8c_ac06cff749bd68b0a91ecacc196b4892f}{validate\_and\_copy\_set\_tun}(a, sfa, log);
1870         \textcolor{keywordflow}{if} (err)
1871             \textcolor{keywordflow}{return} err;
1872         \textcolor{keywordflow}{break};
1873 
1874     \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a67c672ef69eb0c5db9136812e3cdd92e}{OVS\_KEY\_ATTR\_IPV4}:
1875         \textcolor{keywordflow}{if} (eth\_type != htons(ETH\_P\_IP))
1876             \textcolor{keywordflow}{return} -EINVAL;
1877 
1878         ipv4\_key = nla\_data(ovs\_key);
1879 
1880         \textcolor{keywordflow}{if} (masked) \{
1881             \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__key__ipv4}{ovs\_key\_ipv4} *mask = ipv4\_key + 1;
1882 
1883             \textcolor{comment}{/* Non-writeable fields. */}
1884             \textcolor{keywordflow}{if} (mask->\hyperlink{structovs__key__ipv4_ac973a2efc8d310948e3713a5c5a7fabf}{ipv4\_proto} || mask->\hyperlink{structovs__key__ipv4_a47225bcfead6875052b2678c96d3f9b3}{ipv4\_frag})
1885                 \textcolor{keywordflow}{return} -EINVAL;
1886         \} \textcolor{keywordflow}{else} \{
1887             \textcolor{keywordflow}{if} (ipv4\_key->\hyperlink{structovs__key__ipv4_ac973a2efc8d310948e3713a5c5a7fabf}{ipv4\_proto} != flow\_key->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto)
1888                 \textcolor{keywordflow}{return} -EINVAL;
1889 
1890             \textcolor{keywordflow}{if} (ipv4\_key->\hyperlink{structovs__key__ipv4_a47225bcfead6875052b2678c96d3f9b3}{ipv4\_frag} != flow\_key->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.frag)
1891                 \textcolor{keywordflow}{return} -EINVAL;
1892         \}
1893         \textcolor{keywordflow}{break};
1894 
1895     \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aff74bae1efeecfd5d6cf28d8987a8bfd}{OVS\_KEY\_ATTR\_IPV6}:
1896         \textcolor{keywordflow}{if} (eth\_type != htons(ETH\_P\_IPV6))
1897             \textcolor{keywordflow}{return} -EINVAL;
1898 
1899         ipv6\_key = nla\_data(ovs\_key);
1900 
1901         \textcolor{keywordflow}{if} (masked) \{
1902             \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__key__ipv6}{ovs\_key\_ipv6} *mask = ipv6\_key + 1;
1903 
1904             \textcolor{comment}{/* Non-writeable fields. */}
1905             \textcolor{keywordflow}{if} (mask->\hyperlink{structovs__key__ipv6_a194ad047677db5a081bdd730b20f8007}{ipv6\_proto} || mask->\hyperlink{structovs__key__ipv6_ace1ae2a8c22670bde77abadde9101d27}{ipv6\_frag})
1906                 \textcolor{keywordflow}{return} -EINVAL;
1907 
1908             \textcolor{comment}{/* Invalid bits in the flow label mask? */}
1909             \textcolor{keywordflow}{if} (ntohl(mask->\hyperlink{structovs__key__ipv6_a723a1a03d115ebe2a9fdada09e63bd0c}{ipv6\_label}) & 0xFFF00000)
1910                 \textcolor{keywordflow}{return} -EINVAL;
1911         \} \textcolor{keywordflow}{else} \{
1912             \textcolor{keywordflow}{if} (ipv6\_key->\hyperlink{structovs__key__ipv6_a194ad047677db5a081bdd730b20f8007}{ipv6\_proto} != flow\_key->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto)
1913                 \textcolor{keywordflow}{return} -EINVAL;
1914 
1915             \textcolor{keywordflow}{if} (ipv6\_key->\hyperlink{structovs__key__ipv6_ace1ae2a8c22670bde77abadde9101d27}{ipv6\_frag} != flow\_key->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.frag)
1916                 \textcolor{keywordflow}{return} -EINVAL;
1917         \}
1918         \textcolor{keywordflow}{if} (ntohl(ipv6\_key->\hyperlink{structovs__key__ipv6_a723a1a03d115ebe2a9fdada09e63bd0c}{ipv6\_label}) & 0xFFF00000)
1919             \textcolor{keywordflow}{return} -EINVAL;
1920 
1921         \textcolor{keywordflow}{break};
1922 
1923     \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a120ca2131b2881b0c52b6fcc8f6cccb5}{OVS\_KEY\_ATTR\_TCP}:
1924         \textcolor{keywordflow}{if} ((eth\_type != htons(ETH\_P\_IP) &&
1925              eth\_type != htons(ETH\_P\_IPV6)) ||
1926             flow\_key->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto != IPPROTO\_TCP)
1927             \textcolor{keywordflow}{return} -EINVAL;
1928 
1929         \textcolor{keywordflow}{break};
1930 
1931     \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a4dea7a1acfa9eeffb8f09838bb9f9a7d}{OVS\_KEY\_ATTR\_UDP}:
1932         \textcolor{keywordflow}{if} ((eth\_type != htons(ETH\_P\_IP) &&
1933              eth\_type != htons(ETH\_P\_IPV6)) ||
1934             flow\_key->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto != IPPROTO\_UDP)
1935             \textcolor{keywordflow}{return} -EINVAL;
1936 
1937         \textcolor{keywordflow}{break};
1938 
1939     \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864ac46f7c8520cb93d091b4247ef8707f7b}{OVS\_KEY\_ATTR\_MPLS}:
1940         \textcolor{keywordflow}{if} (!\hyperlink{net_2mpls_8h_aab48ab242fbafafc869b3e98df4ace8f}{eth\_p\_mpls}(eth\_type))
1941             \textcolor{keywordflow}{return} -EINVAL;
1942         \textcolor{keywordflow}{break};
1943 
1944     \textcolor{keywordflow}{case} \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a33b7870d10d17ea1604aa83edf40e452}{OVS\_KEY\_ATTR\_SCTP}:
1945         \textcolor{keywordflow}{if} ((eth\_type != htons(ETH\_P\_IP) &&
1946              eth\_type != htons(ETH\_P\_IPV6)) ||
1947             flow\_key->\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.proto != IPPROTO\_SCTP)
1948             \textcolor{keywordflow}{return} -EINVAL;
1949 
1950         \textcolor{keywordflow}{break};
1951 
1952     \textcolor{keywordflow}{default}:
1953         \textcolor{keywordflow}{return} -EINVAL;
1954     \}
1955 
1956     \textcolor{comment}{/* Convert non-masked non-tunnel set actions to masked set actions. */}
1957     \textcolor{keywordflow}{if} (!masked && key\_type != \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a97fc8cc803ab65e231ad28def7bcbb5f}{OVS\_KEY\_ATTR\_TUNNEL}) \{
1958         \textcolor{keywordtype}{int} start, len = key\_len * 2;
1959         \textcolor{keyword}{struct }nlattr *at;
1960 
1961         *skip\_copy = \textcolor{keyword}{true};
1962 
1963         start = \hyperlink{linux_2flow__netlink_8c_a08778088a1f3c3c88aee0055bcd05110}{add\_nested\_action\_start}(sfa,
1964                         OVS\_ACTION\_ATTR\_SET\_TO\_MASKED,
1965                         log);
1966         \textcolor{keywordflow}{if} (start < 0)
1967             \textcolor{keywordflow}{return} start;
1968 
1969         at = \hyperlink{linux_2flow__netlink_8c_ad6fb4bf743e36b42c72eaa09db192e87}{\_\_add\_action}(sfa, key\_type, NULL, len, log);
1970         \textcolor{keywordflow}{if} (IS\_ERR(at))
1971             \textcolor{keywordflow}{return} PTR\_ERR(at);
1972 
1973         memcpy(nla\_data(at), nla\_data(ovs\_key), key\_len); \textcolor{comment}{/* Key. */}
1974         memset(nla\_data(at) + key\_len, 0xff, key\_len);    \textcolor{comment}{/* Mask. */}
1975         \textcolor{comment}{/* Clear non-writeable bits from otherwise writeable fields. */}
1976         \textcolor{keywordflow}{if} (key\_type == \hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aff74bae1efeecfd5d6cf28d8987a8bfd}{OVS\_KEY\_ATTR\_IPV6}) \{
1977             \textcolor{keyword}{struct }\hyperlink{structovs__key__ipv6}{ovs\_key\_ipv6} *mask = nla\_data(at) + key\_len;
1978 
1979             mask->\hyperlink{structovs__key__ipv6_a723a1a03d115ebe2a9fdada09e63bd0c}{ipv6\_label} &= htonl(0x000FFFFF);
1980         \}
1981         \hyperlink{linux_2flow__netlink_8c_ab0176001eff016bfad478f0f06cefa0a}{add\_nested\_action\_end}(*sfa, start);
1982     \}
1983 
1984     \textcolor{keywordflow}{return} 0;
1985 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_ab7c5d132ac3085d8c2da993c66138ab0}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!validate\+\_\+userspace@{validate\+\_\+userspace}}
\index{validate\+\_\+userspace@{validate\+\_\+userspace}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{validate\+\_\+userspace}]{\setlength{\rightskip}{0pt plus 5cm}static int validate\+\_\+userspace (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{attr}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_ab7c5d132ac3085d8c2da993c66138ab0}

\begin{DoxyCode}
1988 \{
1989     \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keyword}{struct }nla\_policy userspace\_policy[\hyperlink{openvswitch_8h_a45e803ca45e291e9053fc7494b090bd1}{OVS\_USERSPACE\_ATTR\_MAX} + 1] = \{
1990         [\hyperlink{openvswitch_8h_a0a23de2e1fb14024871505b857be9552a584c9f592b15980433c447e8ad68e8fb}{OVS\_USERSPACE\_ATTR\_PID}] = \{.type = NLA\_U32 \},
1991         [\hyperlink{openvswitch_8h_a0a23de2e1fb14024871505b857be9552ab137427ad093e922d4bc781a67aa3a7d}{OVS\_USERSPACE\_ATTR\_USERDATA}] = \{.type = NLA\_UNSPEC \},
1992         [\hyperlink{openvswitch_8h_a0a23de2e1fb14024871505b857be9552ac4708d2460d2517eea521efe780354ff}{OVS\_USERSPACE\_ATTR\_EGRESS\_TUN\_PORT}] = \{.type = NLA\_U32 \},
1993     \};
1994     \textcolor{keyword}{struct }nlattr *a[\hyperlink{openvswitch_8h_a45e803ca45e291e9053fc7494b090bd1}{OVS\_USERSPACE\_ATTR\_MAX} + 1];
1995     \textcolor{keywordtype}{int} error;
1996 
1997     error = nla\_parse\_nested(a, \hyperlink{openvswitch_8h_a45e803ca45e291e9053fc7494b090bd1}{OVS\_USERSPACE\_ATTR\_MAX},
1998                  attr, userspace\_policy);
1999     \textcolor{keywordflow}{if} (error)
2000         \textcolor{keywordflow}{return} error;
2001 
2002     \textcolor{keywordflow}{if} (!a[\hyperlink{openvswitch_8h_a0a23de2e1fb14024871505b857be9552a584c9f592b15980433c447e8ad68e8fb}{OVS\_USERSPACE\_ATTR\_PID}] ||
2003         !nla\_get\_u32(a[\hyperlink{openvswitch_8h_a0a23de2e1fb14024871505b857be9552a584c9f592b15980433c447e8ad68e8fb}{OVS\_USERSPACE\_ATTR\_PID}]))
2004         \textcolor{keywordflow}{return} -EINVAL;
2005 
2006     \textcolor{keywordflow}{return} 0;
2007 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_a9283dd76011434d73c43654a9c32ecfb}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!vxlan\+\_\+opt\+\_\+to\+\_\+nlattr@{vxlan\+\_\+opt\+\_\+to\+\_\+nlattr}}
\index{vxlan\+\_\+opt\+\_\+to\+\_\+nlattr@{vxlan\+\_\+opt\+\_\+to\+\_\+nlattr}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{vxlan\+\_\+opt\+\_\+to\+\_\+nlattr}]{\setlength{\rightskip}{0pt plus 5cm}static int vxlan\+\_\+opt\+\_\+to\+\_\+nlattr (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{const void $\ast$}]{tun\+\_\+opts, }
\item[{int}]{swkey\+\_\+tun\+\_\+opts\+\_\+len}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a9283dd76011434d73c43654a9c32ecfb}

\begin{DoxyCode}
628 \{
629     \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__vxlan__opts}{ovs\_vxlan\_opts} *opts = \hyperlink{flow_8h_a58d612a14e56d9b6c782667cd2e89799}{tun\_opts};
630     \textcolor{keyword}{struct }nlattr *nla;
631 
632     nla = nla\_nest\_start(skb, \hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a97447e85c3c3a2f9d648911b727c16ee}{OVS\_TUNNEL\_KEY\_ATTR\_VXLAN\_OPTS});
633     \textcolor{keywordflow}{if} (!nla)
634         \textcolor{keywordflow}{return} -EMSGSIZE;
635 
636     \textcolor{keywordflow}{if} (nla\_put\_u32(skb, \hyperlink{openvswitch_8h_a4caf8d8f829279fba122163d961608a4ac0ae9083a880298a86e9d28d46b541c1}{OVS\_VXLAN\_EXT\_GBP}, opts->\hyperlink{structovs__vxlan__opts_a9b035f7870829fa9116ca074ef1ac2b4}{gbp}) < 0)
637         \textcolor{keywordflow}{return} -EMSGSIZE;
638 
639     nla\_nest\_end(skb, nla);
640     \textcolor{keywordflow}{return} 0;
641 \}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_aef546829167c0fe738dd9db84c3848d4}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!vxlan\+\_\+tun\+\_\+opt\+\_\+from\+\_\+nlattr@{vxlan\+\_\+tun\+\_\+opt\+\_\+from\+\_\+nlattr}}
\index{vxlan\+\_\+tun\+\_\+opt\+\_\+from\+\_\+nlattr@{vxlan\+\_\+tun\+\_\+opt\+\_\+from\+\_\+nlattr}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{vxlan\+\_\+tun\+\_\+opt\+\_\+from\+\_\+nlattr}]{\setlength{\rightskip}{0pt plus 5cm}static int vxlan\+\_\+tun\+\_\+opt\+\_\+from\+\_\+nlattr (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{a, }
\item[{struct {\bf sw\+\_\+flow\+\_\+match} $\ast$}]{match, }
\item[{{\bf bool}}]{is\+\_\+mask, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_aef546829167c0fe738dd9db84c3848d4}

\begin{DoxyCode}
475 \{
476     \textcolor{keyword}{struct }nlattr *tb[\hyperlink{openvswitch_8h_ac764e78fe2e06d11f39448e337292c7c}{OVS\_VXLAN\_EXT\_MAX}+1];
477     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} opt\_key\_offset;
478     \textcolor{keyword}{struct }\hyperlink{structovs__vxlan__opts}{ovs\_vxlan\_opts} opts;
479     \textcolor{keywordtype}{int} err;
480 
481     BUILD\_BUG\_ON(\textcolor{keyword}{sizeof}(opts) > \textcolor{keyword}{sizeof}(match->\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}->\hyperlink{structsw__flow__key_a54b30752817dccb02665a7eecde52a72}{tun\_opts}));
482 
483     err = nla\_parse\_nested(tb, \hyperlink{openvswitch_8h_ac764e78fe2e06d11f39448e337292c7c}{OVS\_VXLAN\_EXT\_MAX}, a, 
      \hyperlink{linux_2flow__netlink_8c_ac262f3819d334e0cbbdf8198d6d2aed8}{vxlan\_opt\_policy});
484     \textcolor{keywordflow}{if} (err < 0)
485         \textcolor{keywordflow}{return} err;
486 
487     memset(&opts, 0, \textcolor{keyword}{sizeof}(opts));
488 
489     \textcolor{keywordflow}{if} (tb[\hyperlink{openvswitch_8h_a4caf8d8f829279fba122163d961608a4ac0ae9083a880298a86e9d28d46b541c1}{OVS\_VXLAN\_EXT\_GBP}])
490         opts.gbp = nla\_get\_u32(tb[OVS\_VXLAN\_EXT\_GBP]);
491 
492     \textcolor{keywordflow}{if} (!is\_mask)
493         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_aed952827cbdce3601bca9c6501742ab9}{tun\_opts\_len}, \textcolor{keyword}{sizeof}(opts), \textcolor{keyword}{false});
494     \textcolor{keywordflow}{else}
495         \hyperlink{linux_2flow__netlink_8c_a7cb040299f14f8ff8806dd868c321d7b}{SW\_FLOW\_KEY\_PUT}(match, \hyperlink{flow_8h_aed952827cbdce3601bca9c6501742ab9}{tun\_opts\_len}, 0xff, \textcolor{keyword}{true});
496 
497     opt\_key\_offset = \hyperlink{flow_8h_ae4d5099091881f55393347766667f4e5}{TUN\_METADATA\_OFFSET}(\textcolor{keyword}{sizeof}(opts));
498     \hyperlink{linux_2flow__netlink_8c_aceedf9228ebbe5291ac9e12d1d011278}{SW\_FLOW\_KEY\_MEMCPY\_OFFSET}(match, opt\_key\_offset, &opts, \textcolor{keyword}{sizeof}(opts),
499                   is\_mask);
500     \textcolor{keywordflow}{return} 0;
501 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{linux_2flow__netlink_8c_a5565daa559332f47a1d214007d97e0d7}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+key\+\_\+lens@{ovs\+\_\+key\+\_\+lens}}
\index{ovs\+\_\+key\+\_\+lens@{ovs\+\_\+key\+\_\+lens}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+key\+\_\+lens}]{\setlength{\rightskip}{0pt plus 5cm}const struct {\bf ovs\+\_\+len\+\_\+tbl} ovs\+\_\+key\+\_\+lens\mbox{[}{\bf O\+V\+S\+\_\+\+K\+E\+Y\+\_\+\+A\+T\+T\+R\+\_\+\+M\+A\+X}+1\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_a5565daa559332f47a1d214007d97e0d7}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a869b60116d7d6ac79bfad91cc808cf75}{OVS\_KEY\_ATTR\_ENCAP}]   = \{ .len = \hyperlink{linux_2flow__netlink_8c_aa45250c738c1a22be7f5e711887c8547}{OVS\_ATTR\_NESTED} \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a3dee91d2ad17f698e34ebb913fcef8bf}{OVS\_KEY\_ATTR\_PRIORITY}]     = \{ .len = \textcolor{keyword}{sizeof}(u32) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a84a968b0e1dd75ba2f6b543c7fcde5b4}{OVS\_KEY\_ATTR\_IN\_PORT}]   = \{ .len = \textcolor{keyword}{sizeof}(u32) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a32f36d9e41b0fbae0746d67fa34340ad}{OVS\_KEY\_ATTR\_SKB\_MARK}]     = \{ .len = \textcolor{keyword}{sizeof}(u32) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a75127b87d8a2f36ae2c9aae2cf42cd56}{OVS\_KEY\_ATTR\_ETHERNET}]     = \{ .len = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }
      \hyperlink{structovs__key__ethernet}{ovs\_key\_ethernet}) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864ae513231d4612ed9b19551a7e70648005}{OVS\_KEY\_ATTR\_VLAN}]     = \{ .len = \textcolor{keyword}{sizeof}(\_\_be16) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aaccef1ecf941c78c70cf8a6a3374235a}{OVS\_KEY\_ATTR\_ETHERTYPE}] = \{ .len = \textcolor{keyword}{sizeof}(\_\_be16) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a67c672ef69eb0c5db9136812e3cdd92e}{OVS\_KEY\_ATTR\_IPV4}]     = \{ .len = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }
      \hyperlink{structovs__key__ipv4}{ovs\_key\_ipv4}) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864aff74bae1efeecfd5d6cf28d8987a8bfd}{OVS\_KEY\_ATTR\_IPV6}]     = \{ .len = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }
      \hyperlink{structovs__key__ipv6}{ovs\_key\_ipv6}) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a120ca2131b2881b0c52b6fcc8f6cccb5}{OVS\_KEY\_ATTR\_TCP}]   = \{ .len = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }\hyperlink{structovs__key__tcp}{ovs\_key\_tcp}) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a79bb45fd4c1a62364eec929283795161}{OVS\_KEY\_ATTR\_TCP\_FLAGS}] = \{ .len = \textcolor{keyword}{sizeof}(\_\_be16) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a4dea7a1acfa9eeffb8f09838bb9f9a7d}{OVS\_KEY\_ATTR\_UDP}]   = \{ .len = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }\hyperlink{structovs__key__udp}{ovs\_key\_udp}) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a33b7870d10d17ea1604aa83edf40e452}{OVS\_KEY\_ATTR\_SCTP}]     = \{ .len = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }
      \hyperlink{structovs__key__sctp}{ovs\_key\_sctp}) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a7059323c7b14c529cc9d2ff8d3134de9}{OVS\_KEY\_ATTR\_ICMP}]     = \{ .len = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }
      \hyperlink{structovs__key__icmp}{ovs\_key\_icmp}) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864af4093db51c9d12b98e1b18d7ddc2b5e3}{OVS\_KEY\_ATTR\_ICMPV6}]     = \{ .len = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }
      \hyperlink{structovs__key__icmpv6}{ovs\_key\_icmpv6}) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a78599a1574b0b24244c2911e420a951b}{OVS\_KEY\_ATTR\_ARP}]   = \{ .len = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }\hyperlink{structovs__key__arp}{ovs\_key\_arp}) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a6049f54211f31d444025675813d3881b}{OVS\_KEY\_ATTR\_ND}]     = \{ .len = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }\hyperlink{structovs__key__nd}{ovs\_key\_nd}) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864afa5af2b14a419c06035a864807572a69}{OVS\_KEY\_ATTR\_RECIRC\_ID}] = \{ .len = \textcolor{keyword}{sizeof}(u32) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a8f119543030b5cafc424d37ef817208d}{OVS\_KEY\_ATTR\_DP\_HASH}]   = \{ .len = \textcolor{keyword}{sizeof}(u32) \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864a97fc8cc803ab65e231ad28def7bcbb5f}{OVS\_KEY\_ATTR\_TUNNEL}]     = \{ .len = \hyperlink{linux_2flow__netlink_8c_aa45250c738c1a22be7f5e711887c8547}{OVS\_ATTR\_NESTED},
                     .next = \hyperlink{linux_2flow__netlink_8c_abcfd7a34b15e86938f3646cda1522e07}{ovs\_tunnel\_key\_lens}, \},
    [\hyperlink{openvswitch_8h_a6a279bc7098c9bc819c12355c9e07864ac46f7c8520cb93d091b4247ef8707f7b}{OVS\_KEY\_ATTR\_MPLS}]     = \{ .\hyperlink{structovs__len__tbl_a70f2cb0cf35baf6a1941942a8b70318c}{len} = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }
      \hyperlink{structovs__key__mpls}{ovs\_key\_mpls}) \},
\}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_abcfd7a34b15e86938f3646cda1522e07}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!ovs\+\_\+tunnel\+\_\+key\+\_\+lens@{ovs\+\_\+tunnel\+\_\+key\+\_\+lens}}
\index{ovs\+\_\+tunnel\+\_\+key\+\_\+lens@{ovs\+\_\+tunnel\+\_\+key\+\_\+lens}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{ovs\+\_\+tunnel\+\_\+key\+\_\+lens}]{\setlength{\rightskip}{0pt plus 5cm}const struct {\bf ovs\+\_\+len\+\_\+tbl} ovs\+\_\+tunnel\+\_\+key\+\_\+lens\mbox{[}{\bf O\+V\+S\+\_\+\+T\+U\+N\+N\+E\+L\+\_\+\+K\+E\+Y\+\_\+\+A\+T\+T\+R\+\_\+\+M\+A\+X}+1\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_abcfd7a34b15e86938f3646cda1522e07}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    [\hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427abba6b12276aaae09ecdf61a2189edda5}{OVS\_TUNNEL\_KEY\_ATTR\_ID}]      = \{ .len = \textcolor{keyword}{sizeof}(u64) \},
    [\hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427add76f93836f5e1dcb33419c58aa1afd0}{OVS\_TUNNEL\_KEY\_ATTR\_IPV4\_SRC}]      = \{ .len = \textcolor{keyword}{sizeof}(u32) \},
    [\hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427aa8a1fb062a0a5c1c718096a530c1fee9}{OVS\_TUNNEL\_KEY\_ATTR\_IPV4\_DST}]      = \{ .len = \textcolor{keyword}{sizeof}(u32) \},
    [\hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427ab452549b72cc81cc38c53a0487cded37}{OVS\_TUNNEL\_KEY\_ATTR\_TOS}]        = \{ .len = 1 \},
    [\hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427ace9b9fe26daaf5d99409d1563cc68f5c}{OVS\_TUNNEL\_KEY\_ATTR\_TTL}]        = \{ .len = 1 \},
    [\hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a2b4acde1fe308fb5cdb703d197ccad11}{OVS\_TUNNEL\_KEY\_ATTR\_DONT\_FRAGMENT}] = \{ .len = 0 \},
    [\hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a0b2355fe72f1590f795e2febdcb3cafe}{OVS\_TUNNEL\_KEY\_ATTR\_CSUM}]      = \{ .len = 0 \},
    [\hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a82ec563a3032a39aa9f9694276933101}{OVS\_TUNNEL\_KEY\_ATTR\_TP\_SRC}]      = \{ .len = \textcolor{keyword}{sizeof}(u16) \},
    [\hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a3fa87a8982452cc6e68ddf8e91dfced2}{OVS\_TUNNEL\_KEY\_ATTR\_TP\_DST}]      = \{ .len = \textcolor{keyword}{sizeof}(u16) \},
    [\hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a72ef8de21b6623d09331a68f87038b95}{OVS\_TUNNEL\_KEY\_ATTR\_OAM}]        = \{ .len = 0 \},
    [\hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a3a6f60bb79d6ad889a091b82667009b9}{OVS\_TUNNEL\_KEY\_ATTR\_GENEVE\_OPTS}]   = \{ .len = 
      \hyperlink{linux_2flow__netlink_8c_aa45250c738c1a22be7f5e711887c8547}{OVS\_ATTR\_NESTED} \},
    [\hyperlink{openvswitch_8h_a3ab62ef434a436d109e5dc7fe6a7f427a97447e85c3c3a2f9d648911b727c16ee}{OVS\_TUNNEL\_KEY\_ATTR\_VXLAN\_OPTS}]    = \{ .len = 
      \hyperlink{linux_2flow__netlink_8c_aa45250c738c1a22be7f5e711887c8547}{OVS\_ATTR\_NESTED} \},
\}
\end{DoxyCode}
\hypertarget{linux_2flow__netlink_8c_ac262f3819d334e0cbbdf8198d6d2aed8}{}\index{linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}!vxlan\+\_\+opt\+\_\+policy@{vxlan\+\_\+opt\+\_\+policy}}
\index{vxlan\+\_\+opt\+\_\+policy@{vxlan\+\_\+opt\+\_\+policy}!linux/flow\+\_\+netlink.\+c@{linux/flow\+\_\+netlink.\+c}}
\subsubsection[{vxlan\+\_\+opt\+\_\+policy}]{\setlength{\rightskip}{0pt plus 5cm}const struct nla\+\_\+policy vxlan\+\_\+opt\+\_\+policy\mbox{[}{\bf O\+V\+S\+\_\+\+V\+X\+L\+A\+N\+\_\+\+E\+X\+T\+\_\+\+M\+A\+X}+1\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2flow__netlink_8c_ac262f3819d334e0cbbdf8198d6d2aed8}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    [\hyperlink{openvswitch_8h_a4caf8d8f829279fba122163d961608a4ac0ae9083a880298a86e9d28d46b541c1}{OVS\_VXLAN\_EXT\_GBP}]    = \{ .type = NLA\_U32 \},
\}
\end{DoxyCode}
