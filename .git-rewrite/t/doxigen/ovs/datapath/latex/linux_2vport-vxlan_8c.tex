\hypertarget{linux_2vport-vxlan_8c}{}\section{/home/vladn/git/ovs/datapath/linux/vport-\/vxlan.c File Reference}
\label{linux_2vport-vxlan_8c}\index{/home/vladn/git/ovs/datapath/linux/vport-\/vxlan.\+c@{/home/vladn/git/ovs/datapath/linux/vport-\/vxlan.\+c}}
{\ttfamily \#include $<$linux/version.\+h$>$}\\*
{\ttfamily \#include $<$linux/in.\+h$>$}\\*
{\ttfamily \#include $<$linux/ip.\+h$>$}\\*
{\ttfamily \#include $<$linux/net.\+h$>$}\\*
{\ttfamily \#include $<$linux/rculist.\+h$>$}\\*
{\ttfamily \#include $<$linux/udp.\+h$>$}\\*
{\ttfamily \#include $<$linux/module.\+h$>$}\\*
{\ttfamily \#include $<$net/icmp.\+h$>$}\\*
{\ttfamily \#include $<$net/ip.\+h$>$}\\*
{\ttfamily \#include $<$net/udp.\+h$>$}\\*
{\ttfamily \#include $<$net/ip\+\_\+tunnels.\+h$>$}\\*
{\ttfamily \#include $<$net/rtnetlink.\+h$>$}\\*
{\ttfamily \#include $<$net/route.\+h$>$}\\*
{\ttfamily \#include $<$net/dsfield.\+h$>$}\\*
{\ttfamily \#include $<$net/inet\+\_\+ecn.\+h$>$}\\*
{\ttfamily \#include $<$net/net\+\_\+namespace.\+h$>$}\\*
{\ttfamily \#include $<$net/netns/generic.\+h$>$}\\*
{\ttfamily \#include $<$net/vxlan.\+h$>$}\\*
{\ttfamily \#include \char`\"{}datapath.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}vport.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}vport-\/vxlan.\+h\char`\"{}}\\*
Include dependency graph for vport-\/vxlan.c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{linux_2vport-vxlan_8c__incl}
\end{center}
\end{figure}
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structvxlan__port}{vxlan\+\_\+port}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{linux_2vport-vxlan_8c_a1f8c165bf4196327bc3abff648276d92}{pr\+\_\+fmt}(fmt)~K\+B\+U\+I\+L\+D\+\_\+\+M\+O\+D\+N\+A\+M\+E \char`\"{}\+: \char`\"{} fmt
\end{DoxyCompactItemize}
\subsection*{\+: vport name.}
\label{_amgrp11b33af0c85e2c8a3c03b696f666e431}%
struct \hyperlink{structvxlan__port}{vxlan\+\_\+port} -\/ Keeps track of open U\+D\+P ports \+: \hyperlink{structvxlan__sock}{vxlan\+\_\+sock} created for the port. \begin{DoxyCompactItemize}
\item 
static struct \hyperlink{structvport__ops}{vport\+\_\+ops} \hyperlink{linux_2vport-vxlan_8c_a14100e1b742c7bb52f41541582330814}{ovs\+\_\+vxlan\+\_\+vport\+\_\+ops}
\item 
static const struct nla\+\_\+policy \hyperlink{linux_2vport-vxlan_8c_a8bca1dc2eb9e18c687ef067cae154b8b}{exts\+\_\+policy} \mbox{[}\hyperlink{openvswitch_8h_ac764e78fe2e06d11f39448e337292c7c}{O\+V\+S\+\_\+\+V\+X\+L\+A\+N\+\_\+\+E\+X\+T\+\_\+\+M\+A\+X}+1\mbox{]}
\item 
static struct \hyperlink{structvxlan__port}{vxlan\+\_\+port} $\ast$ \hyperlink{linux_2vport-vxlan_8c_ab19470f9c73474113f37dc3c65265294}{vxlan\+\_\+vport} (const struct \hyperlink{structvport}{vport} $\ast$\hyperlink{structvport}{vport})
\item 
static void \hyperlink{linux_2vport-vxlan_8c_a0b39f553c071625dac0570f97ef7924a}{vxlan\+\_\+rcv} (struct \hyperlink{structvxlan__sock}{vxlan\+\_\+sock} $\ast$vs, struct sk\+\_\+buff $\ast$skb, struct \hyperlink{structvxlan__metadata}{vxlan\+\_\+metadata} $\ast$md)
\item 
static int \hyperlink{linux_2vport-vxlan_8c_a50ef73121a1de8be6425c76ea97fc3da}{vxlan\+\_\+get\+\_\+options} (const struct \hyperlink{structvport}{vport} $\ast$\hyperlink{structvport}{vport}, struct sk\+\_\+buff $\ast$skb)
\item 
static void \hyperlink{linux_2vport-vxlan_8c_aade4bb74066fe5f4ab11820ab7c90485}{vxlan\+\_\+tnl\+\_\+destroy} (struct \hyperlink{structvport}{vport} $\ast$\hyperlink{structvport}{vport})
\item 
static int \hyperlink{linux_2vport-vxlan_8c_a1c323f01bc67db23967f87810a23939b}{vxlan\+\_\+configure\+\_\+exts} (struct \hyperlink{structvport}{vport} $\ast$\hyperlink{structvport}{vport}, struct nlattr $\ast$attr)
\item 
static struct \hyperlink{structvport}{vport} $\ast$ \hyperlink{linux_2vport-vxlan_8c_a15944f1b89ca72bfaf953d278bf09ca7}{vxlan\+\_\+tnl\+\_\+create} (const struct \hyperlink{structvport__parms}{vport\+\_\+parms} $\ast$parms)
\item 
static int \hyperlink{linux_2vport-vxlan_8c_a20eca97b66cc1631237638ba80d3f6f4}{vxlan\+\_\+ext\+\_\+gbp} (struct sk\+\_\+buff $\ast$skb)
\item 
static int \hyperlink{linux_2vport-vxlan_8c_a3f79b05ea9b700c041b3aff7361e707f}{vxlan\+\_\+tnl\+\_\+send} (struct \hyperlink{structvport}{vport} $\ast$\hyperlink{structvport}{vport}, struct sk\+\_\+buff $\ast$skb)
\item 
static int \hyperlink{linux_2vport-vxlan_8c_a24930f1f6ecb4c221d189f13253a5feb}{vxlan\+\_\+get\+\_\+egress\+\_\+tun\+\_\+info} (struct \hyperlink{structvport}{vport} $\ast$\hyperlink{structvport}{vport}, struct sk\+\_\+buff $\ast$skb, struct \hyperlink{structovs__tunnel__info}{ovs\+\_\+tunnel\+\_\+info} $\ast$egress\+\_\+tun\+\_\+info)
\item 
static const char $\ast$ \hyperlink{linux_2vport-vxlan_8c_a8c4bc3ac94b12c027f1c2148fae55d61}{vxlan\+\_\+get\+\_\+name} (const struct \hyperlink{structvport}{vport} $\ast$\hyperlink{structvport}{vport})
\item 
static int \+\_\+\+\_\+init \hyperlink{linux_2vport-vxlan_8c_a1c1c84a2865e1fdf35836751a795916c}{ovs\+\_\+vxlan\+\_\+tnl\+\_\+init} (void)
\item 
static void \+\_\+\+\_\+exit \hyperlink{linux_2vport-vxlan_8c_a93fd41de4d7cb36dccd5e2c57310ef71}{ovs\+\_\+vxlan\+\_\+tnl\+\_\+exit} (void)
\item 
\hyperlink{linux_2vport-vxlan_8c_a32ade2284afa4864170856c68e08907e}{module\+\_\+init} (\hyperlink{vport-vxlan_8c_a1c1c84a2865e1fdf35836751a795916c}{ovs\+\_\+vxlan\+\_\+tnl\+\_\+init})
\item 
\hyperlink{linux_2vport-vxlan_8c_acfe49db4b9b9e976d671d08c1bbf052f}{module\+\_\+exit} (\hyperlink{vport-vxlan_8c_a93fd41de4d7cb36dccd5e2c57310ef71}{ovs\+\_\+vxlan\+\_\+tnl\+\_\+exit})
\item 
\hyperlink{linux_2vport-vxlan_8c_a8c4652622a726ee59702be21c375bcd1}{M\+O\+D\+U\+L\+E\+\_\+\+D\+E\+S\+C\+R\+I\+P\+T\+I\+O\+N} (\char`\"{}O\+V\+S\+: V\+X\+L\+A\+N switching port\char`\"{})
\item 
\hyperlink{linux_2vport-vxlan_8c_ad94b36675e7eb067ea3ce6ff9e244a44}{M\+O\+D\+U\+L\+E\+\_\+\+L\+I\+C\+E\+N\+S\+E} (\char`\"{}G\+P\+L\char`\"{})
\item 
\hyperlink{linux_2vport-vxlan_8c_ad0e081f4770ba9f49ea55358f08183b1}{M\+O\+D\+U\+L\+E\+\_\+\+A\+L\+I\+A\+S} (\char`\"{}vport-\/\hyperlink{flow_8h_ab22aaab04f806700def00f32823fcb9e}{type}-\/4\char`\"{})
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{linux_2vport-vxlan_8c_a1f8c165bf4196327bc3abff648276d92}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!pr\+\_\+fmt@{pr\+\_\+fmt}}
\index{pr\+\_\+fmt@{pr\+\_\+fmt}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{pr\+\_\+fmt}]{\setlength{\rightskip}{0pt plus 5cm}\#define pr\+\_\+fmt(
\begin{DoxyParamCaption}
\item[{}]{fmt}
\end{DoxyParamCaption}
)~K\+B\+U\+I\+L\+D\+\_\+\+M\+O\+D\+N\+A\+M\+E \char`\"{}\+: \char`\"{} fmt}\label{linux_2vport-vxlan_8c_a1f8c165bf4196327bc3abff648276d92}


\subsection{Function Documentation}
\hypertarget{linux_2vport-vxlan_8c_ad0e081f4770ba9f49ea55358f08183b1}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!M\+O\+D\+U\+L\+E\+\_\+\+A\+L\+I\+A\+S@{M\+O\+D\+U\+L\+E\+\_\+\+A\+L\+I\+A\+S}}
\index{M\+O\+D\+U\+L\+E\+\_\+\+A\+L\+I\+A\+S@{M\+O\+D\+U\+L\+E\+\_\+\+A\+L\+I\+A\+S}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{M\+O\+D\+U\+L\+E\+\_\+\+A\+L\+I\+A\+S}]{\setlength{\rightskip}{0pt plus 5cm}M\+O\+D\+U\+L\+E\+\_\+\+A\+L\+I\+A\+S (
\begin{DoxyParamCaption}
\item[{\char`\"{}vport-\/{\bf type}-\/4\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{linux_2vport-vxlan_8c_ad0e081f4770ba9f49ea55358f08183b1}
\hypertarget{linux_2vport-vxlan_8c_a8c4652622a726ee59702be21c375bcd1}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!M\+O\+D\+U\+L\+E\+\_\+\+D\+E\+S\+C\+R\+I\+P\+T\+I\+O\+N@{M\+O\+D\+U\+L\+E\+\_\+\+D\+E\+S\+C\+R\+I\+P\+T\+I\+O\+N}}
\index{M\+O\+D\+U\+L\+E\+\_\+\+D\+E\+S\+C\+R\+I\+P\+T\+I\+O\+N@{M\+O\+D\+U\+L\+E\+\_\+\+D\+E\+S\+C\+R\+I\+P\+T\+I\+O\+N}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{M\+O\+D\+U\+L\+E\+\_\+\+D\+E\+S\+C\+R\+I\+P\+T\+I\+O\+N}]{\setlength{\rightskip}{0pt plus 5cm}M\+O\+D\+U\+L\+E\+\_\+\+D\+E\+S\+C\+R\+I\+P\+T\+I\+O\+N (
\begin{DoxyParamCaption}
\item[{\char`\"{}O\+V\+S\+: V\+X\+L\+A\+N switching port\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{linux_2vport-vxlan_8c_a8c4652622a726ee59702be21c375bcd1}
\hypertarget{linux_2vport-vxlan_8c_acfe49db4b9b9e976d671d08c1bbf052f}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!module\+\_\+exit@{module\+\_\+exit}}
\index{module\+\_\+exit@{module\+\_\+exit}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{module\+\_\+exit}]{\setlength{\rightskip}{0pt plus 5cm}module\+\_\+exit (
\begin{DoxyParamCaption}
\item[{{\bf ovs\+\_\+vxlan\+\_\+tnl\+\_\+exit}}]{}
\end{DoxyParamCaption}
)}\label{linux_2vport-vxlan_8c_acfe49db4b9b9e976d671d08c1bbf052f}
\hypertarget{linux_2vport-vxlan_8c_a32ade2284afa4864170856c68e08907e}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!module\+\_\+init@{module\+\_\+init}}
\index{module\+\_\+init@{module\+\_\+init}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{module\+\_\+init}]{\setlength{\rightskip}{0pt plus 5cm}module\+\_\+init (
\begin{DoxyParamCaption}
\item[{{\bf ovs\+\_\+vxlan\+\_\+tnl\+\_\+init}}]{}
\end{DoxyParamCaption}
)}\label{linux_2vport-vxlan_8c_a32ade2284afa4864170856c68e08907e}
\hypertarget{linux_2vport-vxlan_8c_ad94b36675e7eb067ea3ce6ff9e244a44}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!M\+O\+D\+U\+L\+E\+\_\+\+L\+I\+C\+E\+N\+S\+E@{M\+O\+D\+U\+L\+E\+\_\+\+L\+I\+C\+E\+N\+S\+E}}
\index{M\+O\+D\+U\+L\+E\+\_\+\+L\+I\+C\+E\+N\+S\+E@{M\+O\+D\+U\+L\+E\+\_\+\+L\+I\+C\+E\+N\+S\+E}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{M\+O\+D\+U\+L\+E\+\_\+\+L\+I\+C\+E\+N\+S\+E}]{\setlength{\rightskip}{0pt plus 5cm}M\+O\+D\+U\+L\+E\+\_\+\+L\+I\+C\+E\+N\+S\+E (
\begin{DoxyParamCaption}
\item[{\char`\"{}G\+P\+L\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{linux_2vport-vxlan_8c_ad94b36675e7eb067ea3ce6ff9e244a44}
\hypertarget{linux_2vport-vxlan_8c_a93fd41de4d7cb36dccd5e2c57310ef71}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!ovs\+\_\+vxlan\+\_\+tnl\+\_\+exit@{ovs\+\_\+vxlan\+\_\+tnl\+\_\+exit}}
\index{ovs\+\_\+vxlan\+\_\+tnl\+\_\+exit@{ovs\+\_\+vxlan\+\_\+tnl\+\_\+exit}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{ovs\+\_\+vxlan\+\_\+tnl\+\_\+exit}]{\setlength{\rightskip}{0pt plus 5cm}static void \+\_\+\+\_\+exit ovs\+\_\+vxlan\+\_\+tnl\+\_\+exit (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2vport-vxlan_8c_a93fd41de4d7cb36dccd5e2c57310ef71}

\begin{DoxyCode}
316 \{
317     \hyperlink{linux_2vport_8c_a8659a5c436f2b09d0b6be2c208ee790e}{ovs\_vport\_ops\_unregister}(&\hyperlink{linux_2vport-vxlan_8c_a14100e1b742c7bb52f41541582330814}{ovs\_vxlan\_vport\_ops});
318 \}
\end{DoxyCode}
\hypertarget{linux_2vport-vxlan_8c_a1c1c84a2865e1fdf35836751a795916c}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!ovs\+\_\+vxlan\+\_\+tnl\+\_\+init@{ovs\+\_\+vxlan\+\_\+tnl\+\_\+init}}
\index{ovs\+\_\+vxlan\+\_\+tnl\+\_\+init@{ovs\+\_\+vxlan\+\_\+tnl\+\_\+init}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{ovs\+\_\+vxlan\+\_\+tnl\+\_\+init}]{\setlength{\rightskip}{0pt plus 5cm}static int \+\_\+\+\_\+init ovs\+\_\+vxlan\+\_\+tnl\+\_\+init (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2vport-vxlan_8c_a1c1c84a2865e1fdf35836751a795916c}

\begin{DoxyCode}
311 \{
312     \textcolor{keywordflow}{return} \hyperlink{linux_2vport_8c_a6b6d24642324a66b7bacab2909bea2dc}{ovs\_vport\_ops\_register}(&\hyperlink{linux_2vport-vxlan_8c_a14100e1b742c7bb52f41541582330814}{ovs\_vxlan\_vport\_ops});
313 \}
\end{DoxyCode}
\hypertarget{linux_2vport-vxlan_8c_a1c323f01bc67db23967f87810a23939b}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!vxlan\+\_\+configure\+\_\+exts@{vxlan\+\_\+configure\+\_\+exts}}
\index{vxlan\+\_\+configure\+\_\+exts@{vxlan\+\_\+configure\+\_\+exts}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{vxlan\+\_\+configure\+\_\+exts}]{\setlength{\rightskip}{0pt plus 5cm}static int vxlan\+\_\+configure\+\_\+exts (
\begin{DoxyParamCaption}
\item[{struct {\bf vport} $\ast$}]{vport, }
\item[{struct nlattr $\ast$}]{attr}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2vport-vxlan_8c_a1c323f01bc67db23967f87810a23939b}

\begin{DoxyCode}
132 \{
133     \textcolor{keyword}{struct }nlattr *exts[\hyperlink{openvswitch_8h_ac764e78fe2e06d11f39448e337292c7c}{OVS\_VXLAN\_EXT\_MAX}+1];
134     \textcolor{keyword}{struct }\hyperlink{structvxlan__port}{vxlan\_port} *\hyperlink{structvxlan__port}{vxlan\_port};
135     \textcolor{keywordtype}{int} err;
136 
137     \textcolor{keywordflow}{if} (nla\_len(attr) < \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} nlattr))
138         \textcolor{keywordflow}{return} -EINVAL;
139 
140     err = nla\_parse\_nested(exts, \hyperlink{openvswitch_8h_ac764e78fe2e06d11f39448e337292c7c}{OVS\_VXLAN\_EXT\_MAX}, attr, 
      \hyperlink{linux_2vport-vxlan_8c_a8bca1dc2eb9e18c687ef067cae154b8b}{exts\_policy});
141     \textcolor{keywordflow}{if} (err < 0)
142         \textcolor{keywordflow}{return} err;
143 
144     vxlan\_port = \hyperlink{linux_2vport-vxlan_8c_ab19470f9c73474113f37dc3c65265294}{vxlan\_vport}(vport);
145 
146     \textcolor{keywordflow}{if} (exts[\hyperlink{openvswitch_8h_a4caf8d8f829279fba122163d961608a4ac0ae9083a880298a86e9d28d46b541c1}{OVS\_VXLAN\_EXT\_GBP}])
147         vxlan\_port->\hyperlink{structvxlan__port_a4c4814fa8ff2517ef89920c98c1d66ba}{exts} |= \hyperlink{vxlan_8h_a8331ae965f1a780ef26d2adc7ddb9fec}{VXLAN\_F\_GBP};
148 
149     \textcolor{keywordflow}{return} 0;
150 \}
\end{DoxyCode}
\hypertarget{linux_2vport-vxlan_8c_a20eca97b66cc1631237638ba80d3f6f4}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!vxlan\+\_\+ext\+\_\+gbp@{vxlan\+\_\+ext\+\_\+gbp}}
\index{vxlan\+\_\+ext\+\_\+gbp@{vxlan\+\_\+ext\+\_\+gbp}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{vxlan\+\_\+ext\+\_\+gbp}]{\setlength{\rightskip}{0pt plus 5cm}static int vxlan\+\_\+ext\+\_\+gbp (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2vport-vxlan_8c_a20eca97b66cc1631237638ba80d3f6f4}

\begin{DoxyCode}
208 \{
209     \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__tunnel__info}{ovs\_tunnel\_info} *tun\_info;
210     \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structovs__vxlan__opts}{ovs\_vxlan\_opts} *opts;
211 
212     tun\_info = \hyperlink{datapath_8h_ac337c4d4ddca29916ce8e900038ddd78}{OVS\_CB}(skb)->egress\_tun\_info;
213     opts = tun\_info->\hyperlink{structovs__tunnel__info_ae4fd786894f579a38a5955e7a0e68fd4}{options};
214 
215     \textcolor{keywordflow}{if} (tun\_info->\hyperlink{structovs__tunnel__info_a007f0c7a9938884e6e8663cb4ab20d10}{tunnel}.\hyperlink{structovs__key__ipv4__tunnel_a7459e66ecf90329eb2fa6cf3fc4781db}{tun\_flags} & \hyperlink{ip__tunnels_8h_a50cd9036253f584996011f418422a53f}{TUNNEL\_VXLAN\_OPT} &&
216         tun\_info->\hyperlink{structovs__tunnel__info_ab50d289f61727b922831739affb28b18}{options\_len} >= \textcolor{keyword}{sizeof}(*opts))
217         \textcolor{keywordflow}{return} opts->\hyperlink{structovs__vxlan__opts_a9b035f7870829fa9116ca074ef1ac2b4}{gbp};
218     \textcolor{keywordflow}{else}
219         \textcolor{keywordflow}{return} 0;
220 \}
\end{DoxyCode}
\hypertarget{linux_2vport-vxlan_8c_a24930f1f6ecb4c221d189f13253a5feb}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!vxlan\+\_\+get\+\_\+egress\+\_\+tun\+\_\+info@{vxlan\+\_\+get\+\_\+egress\+\_\+tun\+\_\+info}}
\index{vxlan\+\_\+get\+\_\+egress\+\_\+tun\+\_\+info@{vxlan\+\_\+get\+\_\+egress\+\_\+tun\+\_\+info}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{vxlan\+\_\+get\+\_\+egress\+\_\+tun\+\_\+info}]{\setlength{\rightskip}{0pt plus 5cm}static int vxlan\+\_\+get\+\_\+egress\+\_\+tun\+\_\+info (
\begin{DoxyParamCaption}
\item[{struct {\bf vport} $\ast$}]{vport, }
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct {\bf ovs\+\_\+tunnel\+\_\+info} $\ast$}]{egress\+\_\+tun\+\_\+info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2vport-vxlan_8c_a24930f1f6ecb4c221d189f13253a5feb}

\begin{DoxyCode}
279 \{
280     \textcolor{keyword}{struct }net *net = \hyperlink{datapath_8h_aef2302004ca1f45133eaef00bb3740eb}{ovs\_dp\_get\_net}(vport->\hyperlink{structvport_a49fb6f6bf0ac4337853e9242e88ddc42}{dp});
281     \textcolor{keyword}{struct }\hyperlink{structvxlan__port}{vxlan\_port} *\hyperlink{structvxlan__port}{vxlan\_port} = \hyperlink{linux_2vport-vxlan_8c_ab19470f9c73474113f37dc3c65265294}{vxlan\_vport}(vport);
282     \_\_be16 dst\_port = \hyperlink{compat_8h_a66c1f58d06b91a3e79cf388a80e5096b}{inet\_sport}(vxlan\_port->\hyperlink{structvxlan__port_a28d2b1a2a5beaaf48453d1e0628efb88}{vs}->\hyperlink{structvxlan__sock_a75f35ac3f5f8e0340b2bdc247a84c322}{sock}->sk);
283     \_\_be16 src\_port;
284 
285     src\_port = \hyperlink{net_2udp_8h_afe6572fca30bf3135b12944bcd7e6c39}{udp\_flow\_src\_port}(net, skb, 0, 0, \textcolor{keyword}{true});
286 
287     \textcolor{keywordflow}{return} \hyperlink{linux_2vport_8c_ac5b64ee0badeb969348aae464fdc4c8d}{ovs\_tunnel\_get\_egress\_info}(egress\_tun\_info, net,
288                       \hyperlink{datapath_8h_ac337c4d4ddca29916ce8e900038ddd78}{OVS\_CB}(skb)->egress\_tun\_info,
289                       IPPROTO\_UDP, skb->mark,
290                       src\_port, dst\_port);
291 \}
\end{DoxyCode}
\hypertarget{linux_2vport-vxlan_8c_a8c4bc3ac94b12c027f1c2148fae55d61}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!vxlan\+\_\+get\+\_\+name@{vxlan\+\_\+get\+\_\+name}}
\index{vxlan\+\_\+get\+\_\+name@{vxlan\+\_\+get\+\_\+name}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{vxlan\+\_\+get\+\_\+name}]{\setlength{\rightskip}{0pt plus 5cm}static const char$\ast$ vxlan\+\_\+get\+\_\+name (
\begin{DoxyParamCaption}
\item[{const struct {\bf vport} $\ast$}]{vport}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2vport-vxlan_8c_a8c4bc3ac94b12c027f1c2148fae55d61}

\begin{DoxyCode}
294 \{
295     \textcolor{keyword}{struct }\hyperlink{structvxlan__port}{vxlan\_port} *\hyperlink{structvxlan__port}{vxlan\_port} = \hyperlink{linux_2vport-vxlan_8c_ab19470f9c73474113f37dc3c65265294}{vxlan\_vport}(vport);
296     \textcolor{keywordflow}{return} vxlan\_port->\hyperlink{structvxlan__port_a48b3eb83bbca17229480cf0d7a130272}{name};
297 \}
\end{DoxyCode}
\hypertarget{linux_2vport-vxlan_8c_a50ef73121a1de8be6425c76ea97fc3da}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!vxlan\+\_\+get\+\_\+options@{vxlan\+\_\+get\+\_\+options}}
\index{vxlan\+\_\+get\+\_\+options@{vxlan\+\_\+get\+\_\+options}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{vxlan\+\_\+get\+\_\+options}]{\setlength{\rightskip}{0pt plus 5cm}static int vxlan\+\_\+get\+\_\+options (
\begin{DoxyParamCaption}
\item[{const struct {\bf vport} $\ast$}]{vport, }
\item[{struct sk\+\_\+buff $\ast$}]{skb}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2vport-vxlan_8c_a50ef73121a1de8be6425c76ea97fc3da}

\begin{DoxyCode}
94 \{
95     \textcolor{keyword}{struct }\hyperlink{structvxlan__port}{vxlan\_port} *\hyperlink{structvxlan__port}{vxlan\_port} = \hyperlink{linux_2vport-vxlan_8c_ab19470f9c73474113f37dc3c65265294}{vxlan\_vport}(vport);
96     \_\_be16 dst\_port = \hyperlink{compat_8h_a66c1f58d06b91a3e79cf388a80e5096b}{inet\_sport}(vxlan\_port->\hyperlink{structvxlan__port_a28d2b1a2a5beaaf48453d1e0628efb88}{vs}->\hyperlink{structvxlan__sock_a75f35ac3f5f8e0340b2bdc247a84c322}{sock}->sk);
97 
98     \textcolor{keywordflow}{if} (nla\_put\_u16(skb, \hyperlink{openvswitch_8h_a96a58e29e8dbf2b5bdeb775cba46556eae2bec9320cf2cc32228c9783e1bba39a}{OVS\_TUNNEL\_ATTR\_DST\_PORT}, ntohs(dst\_port)))
99         \textcolor{keywordflow}{return} -EMSGSIZE;
100 
101     \textcolor{keywordflow}{if} (vxlan\_port->\hyperlink{structvxlan__port_a4c4814fa8ff2517ef89920c98c1d66ba}{exts}) \{
102         \textcolor{keyword}{struct }nlattr *exts;
103 
104         exts = nla\_nest\_start(skb, \hyperlink{openvswitch_8h_a96a58e29e8dbf2b5bdeb775cba46556ea310d573fc264521a7d47f37295666999}{OVS\_TUNNEL\_ATTR\_EXTENSION});
105         \textcolor{keywordflow}{if} (!exts)
106             \textcolor{keywordflow}{return} -EMSGSIZE;
107 
108         \textcolor{keywordflow}{if} (vxlan\_port->\hyperlink{structvxlan__port_a4c4814fa8ff2517ef89920c98c1d66ba}{exts} & \hyperlink{vxlan_8h_a8331ae965f1a780ef26d2adc7ddb9fec}{VXLAN\_F\_GBP} &&
109             nla\_put\_flag(skb, \hyperlink{openvswitch_8h_a4caf8d8f829279fba122163d961608a4ac0ae9083a880298a86e9d28d46b541c1}{OVS\_VXLAN\_EXT\_GBP}))
110             \textcolor{keywordflow}{return} -EMSGSIZE;
111 
112         nla\_nest\_end(skb, exts);
113     \}
114 
115     \textcolor{keywordflow}{return} 0;
116 \}
\end{DoxyCode}
\hypertarget{linux_2vport-vxlan_8c_a0b39f553c071625dac0570f97ef7924a}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!vxlan\+\_\+rcv@{vxlan\+\_\+rcv}}
\index{vxlan\+\_\+rcv@{vxlan\+\_\+rcv}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{vxlan\+\_\+rcv}]{\setlength{\rightskip}{0pt plus 5cm}static void vxlan\+\_\+rcv (
\begin{DoxyParamCaption}
\item[{struct {\bf vxlan\+\_\+sock} $\ast$}]{vs, }
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct {\bf vxlan\+\_\+metadata} $\ast$}]{md}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2vport-vxlan_8c_a0b39f553c071625dac0570f97ef7924a}

\begin{DoxyCode}
67 \{
68     \textcolor{keyword}{struct }\hyperlink{structovs__tunnel__info}{ovs\_tunnel\_info} tun\_info;
69     \textcolor{keyword}{struct }\hyperlink{structvxlan__port}{vxlan\_port} *\hyperlink{structvxlan__port}{vxlan\_port};
70     \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport} = vs->\hyperlink{structvxlan__sock_a44942474f147992d768c3a74b44c4d5f}{data};
71     \textcolor{keyword}{struct }iphdr *iph;
72     \textcolor{keyword}{struct }\hyperlink{structovs__vxlan__opts}{ovs\_vxlan\_opts} opts = \{
73         .\hyperlink{structovs__vxlan__opts_a9b035f7870829fa9116ca074ef1ac2b4}{gbp} = md->\hyperlink{structvxlan__metadata_ad71c7ab9d521840720e30ebae8ff2a6a}{gbp},
74     \};
75     \_\_be64 key;
76     \_\_be16 \hyperlink{flow_8h_af4f7a53f6b2df72c34ca881f2714ac91}{flags};
77 
78     flags = \hyperlink{ip__tunnels_8h_a5438f4a0ea8e58438776fffbed3f08a8}{TUNNEL\_KEY} | (\hyperlink{linux_2udp_8h_a7b8908e197538768cf4ff9ec577bd86b}{udp\_hdr}(skb)->check != 0 ? 
      \hyperlink{ip__tunnels_8h_ac8dc03940c0621b1aeddafa9b620022c}{TUNNEL\_CSUM} : 0);
79     vxlan\_port = \hyperlink{linux_2vport-vxlan_8c_ab19470f9c73474113f37dc3c65265294}{vxlan\_vport}(vport);
80     \textcolor{keywordflow}{if} (vxlan\_port->\hyperlink{structvxlan__port_a4c4814fa8ff2517ef89920c98c1d66ba}{exts} & \hyperlink{vxlan_8h_a8331ae965f1a780ef26d2adc7ddb9fec}{VXLAN\_F\_GBP} && md->\hyperlink{structvxlan__metadata_ad71c7ab9d521840720e30ebae8ff2a6a}{gbp})
81         flags |= \hyperlink{ip__tunnels_8h_a50cd9036253f584996011f418422a53f}{TUNNEL\_VXLAN\_OPT};
82 
83     \textcolor{comment}{/* Save outer tunnel values */}
84     iph = \hyperlink{linux_2ip_8h_a06ad68dbeebbe718758ba2d5ebb6335c}{ip\_hdr}(skb);
85     key = cpu\_to\_be64(ntohl(md->\hyperlink{structvxlan__metadata_ac78e68c33d3c91061e3642616135cbc8}{vni}) >> 8);
86     \hyperlink{flow_8h_a852c3ebd7a575ba7133623943f79e5df}{ovs\_flow\_tun\_info\_init}(&tun\_info, iph,
87                    \hyperlink{linux_2udp_8h_a7b8908e197538768cf4ff9ec577bd86b}{udp\_hdr}(skb)->source, \hyperlink{linux_2udp_8h_a7b8908e197538768cf4ff9ec577bd86b}{udp\_hdr}(skb)->dest,
88                    key, flags, &opts, \textcolor{keyword}{sizeof}(opts));
89 
90     \hyperlink{linux_2vport_8c_a45b6883b8ea28eb25965e1f2e1586d46}{ovs\_vport\_receive}(vport, skb, &tun\_info);
91 \}
\end{DoxyCode}
\hypertarget{linux_2vport-vxlan_8c_a15944f1b89ca72bfaf953d278bf09ca7}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!vxlan\+\_\+tnl\+\_\+create@{vxlan\+\_\+tnl\+\_\+create}}
\index{vxlan\+\_\+tnl\+\_\+create@{vxlan\+\_\+tnl\+\_\+create}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{vxlan\+\_\+tnl\+\_\+create}]{\setlength{\rightskip}{0pt plus 5cm}static struct {\bf vport}$\ast$ vxlan\+\_\+tnl\+\_\+create (
\begin{DoxyParamCaption}
\item[{const struct {\bf vport\+\_\+parms} $\ast$}]{parms}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2vport-vxlan_8c_a15944f1b89ca72bfaf953d278bf09ca7}

\begin{DoxyCode}
153 \{
154     \textcolor{keyword}{struct }net *net = \hyperlink{datapath_8h_aef2302004ca1f45133eaef00bb3740eb}{ovs\_dp\_get\_net}(parms->\hyperlink{structvport__parms_a15faa866e3d35a721de77b347017499e}{dp});
155     \textcolor{keyword}{struct }nlattr *options = parms->\hyperlink{structvport__parms_a5c6027e758731e1a16968e77d4e2ca7c}{options};
156     \textcolor{keyword}{struct }\hyperlink{structvxlan__port}{vxlan\_port} *\hyperlink{structvxlan__port}{vxlan\_port};
157     \textcolor{keyword}{struct }\hyperlink{structvxlan__sock}{vxlan\_sock} *vs;
158     \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport};
159     \textcolor{keyword}{struct }nlattr *a;
160     u16 dst\_port;
161     \textcolor{keywordtype}{int} err;
162 
163     \textcolor{keywordflow}{if} (!options) \{
164         err = -EINVAL;
165         \textcolor{keywordflow}{goto} error;
166     \}
167     a = \hyperlink{net_2netlink_8h_a5b73cd8f4a1d3d335642ee1492b7b2c2}{nla\_find\_nested}(options, \hyperlink{openvswitch_8h_a96a58e29e8dbf2b5bdeb775cba46556eae2bec9320cf2cc32228c9783e1bba39a}{OVS\_TUNNEL\_ATTR\_DST\_PORT});
168     \textcolor{keywordflow}{if} (a && nla\_len(a) == \textcolor{keyword}{sizeof}(u16)) \{
169         dst\_port = nla\_get\_u16(a);
170     \} \textcolor{keywordflow}{else} \{
171         \textcolor{comment}{/* Require destination port from userspace. */}
172         err = -EINVAL;
173         \textcolor{keywordflow}{goto} error;
174     \}
175 
176     vport = \hyperlink{linux_2vport_8c_a9198ee06111592d2cf6c3b2bf94561c1}{ovs\_vport\_alloc}(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} vxlan\_port),
177                 &\hyperlink{linux_2vport-vxlan_8c_a14100e1b742c7bb52f41541582330814}{ovs\_vxlan\_vport\_ops}, parms);
178     \textcolor{keywordflow}{if} (IS\_ERR(vport))
179         \textcolor{keywordflow}{return} vport;
180 
181     vxlan\_port = \hyperlink{linux_2vport-vxlan_8c_ab19470f9c73474113f37dc3c65265294}{vxlan\_vport}(vport);
182     strncpy(vxlan\_port->\hyperlink{structvxlan__port_a48b3eb83bbca17229480cf0d7a130272}{name}, parms->\hyperlink{structvport__parms_a4f27e2a7b7dc0493c095cdaabe225b38}{name}, IFNAMSIZ);
183 
184     a = \hyperlink{net_2netlink_8h_a5b73cd8f4a1d3d335642ee1492b7b2c2}{nla\_find\_nested}(options, \hyperlink{openvswitch_8h_a96a58e29e8dbf2b5bdeb775cba46556ea310d573fc264521a7d47f37295666999}{OVS\_TUNNEL\_ATTR\_EXTENSION});
185     \textcolor{keywordflow}{if} (a) \{
186         err = \hyperlink{linux_2vport-vxlan_8c_a1c323f01bc67db23967f87810a23939b}{vxlan\_configure\_exts}(vport, a);
187         \textcolor{keywordflow}{if} (err) \{
188             \hyperlink{linux_2vport_8c_a17e57e95b47bad0bcf00e2e2805e2170}{ovs\_vport\_free}(vport);
189             \textcolor{keywordflow}{goto} error;
190         \}
191     \}
192 
193     vs = \hyperlink{vxlan_8h_a9ed9b80801b3c6e86f19168856645c59}{vxlan\_sock\_add}(net, htons(dst\_port), \hyperlink{linux_2vport-vxlan_8c_a0b39f553c071625dac0570f97ef7924a}{vxlan\_rcv}, vport, \textcolor{keyword}{true},
194                 vxlan\_port->\hyperlink{structvxlan__port_a4c4814fa8ff2517ef89920c98c1d66ba}{exts});
195     \textcolor{keywordflow}{if} (IS\_ERR(vs)) \{
196         \hyperlink{linux_2vport_8c_a17e57e95b47bad0bcf00e2e2805e2170}{ovs\_vport\_free}(vport);
197         \textcolor{keywordflow}{return} (\textcolor{keywordtype}{void} *)vs;
198     \}
199     vxlan\_port->\hyperlink{structvxlan__port_a28d2b1a2a5beaaf48453d1e0628efb88}{vs} = vs;
200 
201     \textcolor{keywordflow}{return} vport;
202 
203 error:
204     \textcolor{keywordflow}{return} ERR\_PTR(err);
205 \}
\end{DoxyCode}
\hypertarget{linux_2vport-vxlan_8c_aade4bb74066fe5f4ab11820ab7c90485}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!vxlan\+\_\+tnl\+\_\+destroy@{vxlan\+\_\+tnl\+\_\+destroy}}
\index{vxlan\+\_\+tnl\+\_\+destroy@{vxlan\+\_\+tnl\+\_\+destroy}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{vxlan\+\_\+tnl\+\_\+destroy}]{\setlength{\rightskip}{0pt plus 5cm}static void vxlan\+\_\+tnl\+\_\+destroy (
\begin{DoxyParamCaption}
\item[{struct {\bf vport} $\ast$}]{vport}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2vport-vxlan_8c_aade4bb74066fe5f4ab11820ab7c90485}

\begin{DoxyCode}
119 \{
120     \textcolor{keyword}{struct }\hyperlink{structvxlan__port}{vxlan\_port} *\hyperlink{structvxlan__port}{vxlan\_port} = \hyperlink{linux_2vport-vxlan_8c_ab19470f9c73474113f37dc3c65265294}{vxlan\_vport}(vport);
121 
122     \hyperlink{vxlan_8h_a9ca03180bef52de7bcac7fc144938a13}{vxlan\_sock\_release}(vxlan\_port->\hyperlink{structvxlan__port_a28d2b1a2a5beaaf48453d1e0628efb88}{vs});
123 
124     \hyperlink{linux_2vport_8c_a91949289f78c0f0c2433ef5f20495e66}{ovs\_vport\_deferred\_free}(vport);
125 \}
\end{DoxyCode}
\hypertarget{linux_2vport-vxlan_8c_a3f79b05ea9b700c041b3aff7361e707f}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!vxlan\+\_\+tnl\+\_\+send@{vxlan\+\_\+tnl\+\_\+send}}
\index{vxlan\+\_\+tnl\+\_\+send@{vxlan\+\_\+tnl\+\_\+send}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{vxlan\+\_\+tnl\+\_\+send}]{\setlength{\rightskip}{0pt plus 5cm}static int vxlan\+\_\+tnl\+\_\+send (
\begin{DoxyParamCaption}
\item[{struct {\bf vport} $\ast$}]{vport, }
\item[{struct sk\+\_\+buff $\ast$}]{skb}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2vport-vxlan_8c_a3f79b05ea9b700c041b3aff7361e707f}

\begin{DoxyCode}
223 \{
224     \textcolor{keyword}{struct }\hyperlink{structovs__key__ipv4__tunnel}{ovs\_key\_ipv4\_tunnel} *\hyperlink{flow_8h_a904e9497acde49a1992636f77597c5c7}{tun\_key};
225     \textcolor{keyword}{struct }net *net = \hyperlink{datapath_8h_aef2302004ca1f45133eaef00bb3740eb}{ovs\_dp\_get\_net}(vport->\hyperlink{structvport_a49fb6f6bf0ac4337853e9242e88ddc42}{dp});
226     \textcolor{keyword}{struct }\hyperlink{structvxlan__port}{vxlan\_port} *\hyperlink{structvxlan__port}{vxlan\_port} = \hyperlink{linux_2vport-vxlan_8c_ab19470f9c73474113f37dc3c65265294}{vxlan\_vport}(vport);
227     \_\_be16 dst\_port = \hyperlink{compat_8h_a66c1f58d06b91a3e79cf388a80e5096b}{inet\_sport}(vxlan\_port->\hyperlink{structvxlan__port_a28d2b1a2a5beaaf48453d1e0628efb88}{vs}->\hyperlink{structvxlan__sock_a75f35ac3f5f8e0340b2bdc247a84c322}{sock}->sk);
228     \textcolor{keyword}{struct }\hyperlink{structvxlan__metadata}{vxlan\_metadata} md = \{0\};
229     \textcolor{keyword}{struct }rtable *rt;
230     \_\_be16 src\_port;
231     \_\_be32 saddr;
232     \_\_be16 df;
233     \textcolor{keywordtype}{int} err;
234     u32 vxflags;
235 
236     \textcolor{keywordflow}{if} (unlikely(!\hyperlink{datapath_8h_ac337c4d4ddca29916ce8e900038ddd78}{OVS\_CB}(skb)->egress\_tun\_info)) \{
237         err = -EINVAL;
238         \textcolor{keywordflow}{goto} error;
239     \}
240 
241     tun\_key = &\hyperlink{datapath_8h_ac337c4d4ddca29916ce8e900038ddd78}{OVS\_CB}(skb)->egress\_tun\_info->tunnel;
242 
243     \textcolor{comment}{/* Route lookup */}
244     saddr = tun\_key->\hyperlink{structovs__key__ipv4__tunnel_a1e5a978f104d61e9694e914a109734a7}{ipv4\_src};
245     rt = \hyperlink{compat_8h_a9fd71ce2d13a3dcc4f7d51469ba86d79}{find\_route}(\hyperlink{datapath_8h_aef2302004ca1f45133eaef00bb3740eb}{ovs\_dp\_get\_net}(vport->\hyperlink{structvport_a49fb6f6bf0ac4337853e9242e88ddc42}{dp}),
246             &saddr, tun\_key->\hyperlink{structovs__key__ipv4__tunnel_ae443d381a97f53bbc4139fe36c0aae30}{ipv4\_dst},
247             IPPROTO\_UDP, tun\_key->\hyperlink{structovs__key__ipv4__tunnel_a69594eaf9d7dfc2824b264484e02498e}{ipv4\_tos},
248             skb->mark);
249     \textcolor{keywordflow}{if} (IS\_ERR(rt)) \{
250         err = PTR\_ERR(rt);
251         \textcolor{keywordflow}{goto} error;
252     \}
253 
254     df = tun\_key->\hyperlink{structovs__key__ipv4__tunnel_a7459e66ecf90329eb2fa6cf3fc4781db}{tun\_flags} & \hyperlink{ip__tunnels_8h_a3b33c8fadb48f2281d5852e2a0d8eeff}{TUNNEL\_DONT\_FRAGMENT} ? htons(IP\_DF) : 0;
255     skb->ignore\_df = 1;
256 
257     src\_port = \hyperlink{net_2udp_8h_afe6572fca30bf3135b12944bcd7e6c39}{udp\_flow\_src\_port}(net, skb, 0, 0, \textcolor{keyword}{true});
258     md.\hyperlink{structvxlan__metadata_ac78e68c33d3c91061e3642616135cbc8}{vni} = htonl(be64\_to\_cpu(tun\_key->\hyperlink{structovs__key__ipv4__tunnel_ae36132bc05ca6257b572edddffcb867a}{tun\_id}) << 8);
259     md.\hyperlink{structvxlan__metadata_ad71c7ab9d521840720e30ebae8ff2a6a}{gbp} = \hyperlink{linux_2vport-vxlan_8c_a20eca97b66cc1631237638ba80d3f6f4}{vxlan\_ext\_gbp}(skb);
260     vxflags = vxlan\_port->\hyperlink{structvxlan__port_a4c4814fa8ff2517ef89920c98c1d66ba}{exts} |
261               (tun\_key->\hyperlink{structovs__key__ipv4__tunnel_a7459e66ecf90329eb2fa6cf3fc4781db}{tun\_flags} & \hyperlink{ip__tunnels_8h_ac8dc03940c0621b1aeddafa9b620022c}{TUNNEL\_CSUM} ? 
      \hyperlink{vxlan_8h_a1b3d960bf01a2faa7302f79170aca48e}{VXLAN\_F\_UDP\_CSUM} : 0);
262 
263     err = \hyperlink{vxlan_8h_a18881f641d198e10bc5367b31f844107}{vxlan\_xmit\_skb}(vxlan\_port->\hyperlink{structvxlan__port_a28d2b1a2a5beaaf48453d1e0628efb88}{vs}, rt, skb,
264                  saddr, tun\_key->\hyperlink{structovs__key__ipv4__tunnel_ae443d381a97f53bbc4139fe36c0aae30}{ipv4\_dst},
265                  tun\_key->\hyperlink{structovs__key__ipv4__tunnel_a69594eaf9d7dfc2824b264484e02498e}{ipv4\_tos},
266                  tun\_key->\hyperlink{structovs__key__ipv4__tunnel_a24de7472a8c22903fce96b73dab68a40}{ipv4\_ttl}, df,
267                  src\_port, dst\_port,
268                  &md, \textcolor{keyword}{false}, vxflags);
269     \textcolor{keywordflow}{if} (err < 0)
270         ip\_rt\_put(rt);
271     \textcolor{keywordflow}{return} err;
272 error:
273     kfree\_skb(skb);
274     \textcolor{keywordflow}{return} err;
275 \}
\end{DoxyCode}
\hypertarget{linux_2vport-vxlan_8c_ab19470f9c73474113f37dc3c65265294}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!vxlan\+\_\+vport@{vxlan\+\_\+vport}}
\index{vxlan\+\_\+vport@{vxlan\+\_\+vport}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{vxlan\+\_\+vport}]{\setlength{\rightskip}{0pt plus 5cm}static struct {\bf vxlan\+\_\+port}$\ast$ vxlan\+\_\+vport (
\begin{DoxyParamCaption}
\item[{const struct {\bf vport} $\ast$}]{vport}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2vport-vxlan_8c_ab19470f9c73474113f37dc3c65265294}

\begin{DoxyCode}
61 \{
62     \textcolor{keywordflow}{return} \hyperlink{vport_8h_ad18aa811f80cfd4c3895d96f7f3f4acd}{vport\_priv}(vport);
63 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{linux_2vport-vxlan_8c_a8bca1dc2eb9e18c687ef067cae154b8b}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!exts\+\_\+policy@{exts\+\_\+policy}}
\index{exts\+\_\+policy@{exts\+\_\+policy}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{exts\+\_\+policy}]{\setlength{\rightskip}{0pt plus 5cm}const struct nla\+\_\+policy exts\+\_\+policy\mbox{[}{\bf O\+V\+S\+\_\+\+V\+X\+L\+A\+N\+\_\+\+E\+X\+T\+\_\+\+M\+A\+X}+1\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2vport-vxlan_8c_a8bca1dc2eb9e18c687ef067cae154b8b}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    [\hyperlink{openvswitch_8h_a4caf8d8f829279fba122163d961608a4ac0ae9083a880298a86e9d28d46b541c1}{OVS\_VXLAN\_EXT\_GBP}]    = \{ .type = NLA\_FLAG, \},
\}
\end{DoxyCode}
\hypertarget{linux_2vport-vxlan_8c_a14100e1b742c7bb52f41541582330814}{}\index{linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}!ovs\+\_\+vxlan\+\_\+vport\+\_\+ops@{ovs\+\_\+vxlan\+\_\+vport\+\_\+ops}}
\index{ovs\+\_\+vxlan\+\_\+vport\+\_\+ops@{ovs\+\_\+vxlan\+\_\+vport\+\_\+ops}!linux/vport-\/vxlan.\+c@{linux/vport-\/vxlan.\+c}}
\subsubsection[{ovs\+\_\+vxlan\+\_\+vport\+\_\+ops}]{\setlength{\rightskip}{0pt plus 5cm}static struct {\bf vport\+\_\+ops} ovs\+\_\+vxlan\+\_\+vport\+\_\+ops\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2vport-vxlan_8c_a14100e1b742c7bb52f41541582330814}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    .type           = \hyperlink{openvswitch_8h_a9a1b861aa99bd83177a2b10b34745b0aabd94b320598ca17b189318d8e27ac1b0}{OVS\_VPORT\_TYPE\_VXLAN},
    .create         = \hyperlink{linux_2vport-vxlan_8c_a15944f1b89ca72bfaf953d278bf09ca7}{vxlan\_tnl\_create},
    .destroy        = \hyperlink{linux_2vport-vxlan_8c_aade4bb74066fe5f4ab11820ab7c90485}{vxlan\_tnl\_destroy},
    .get\_name       = \hyperlink{linux_2vport-vxlan_8c_a8c4bc3ac94b12c027f1c2148fae55d61}{vxlan\_get\_name},
    .get\_options        = \hyperlink{linux_2vport-vxlan_8c_a50ef73121a1de8be6425c76ea97fc3da}{vxlan\_get\_options},
    .send           = \hyperlink{linux_2vport-vxlan_8c_a3f79b05ea9b700c041b3aff7361e707f}{vxlan\_tnl\_send},
    .get\_egress\_tun\_info    = \hyperlink{linux_2vport-vxlan_8c_a24930f1f6ecb4c221d189f13253a5feb}{vxlan\_get\_egress\_tun\_info},
    .owner          = THIS\_MODULE,
\}
\end{DoxyCode}
