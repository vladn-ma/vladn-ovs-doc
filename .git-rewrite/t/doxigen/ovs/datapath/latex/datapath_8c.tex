\hypertarget{datapath_8c}{}\section{/home/vladn/git/ovs/datapath/datapath.c File Reference}
\label{datapath_8c}\index{/home/vladn/git/ovs/datapath/datapath.\+c@{/home/vladn/git/ovs/datapath/datapath.\+c}}
{\ttfamily \#include $<$linux/init.\+h$>$}\\*
{\ttfamily \#include $<$linux/module.\+h$>$}\\*
{\ttfamily \#include $<$linux/if\+\_\+arp.\+h$>$}\\*
{\ttfamily \#include $<$linux/if\+\_\+vlan.\+h$>$}\\*
{\ttfamily \#include $<$linux/in.\+h$>$}\\*
{\ttfamily \#include $<$linux/ip.\+h$>$}\\*
{\ttfamily \#include $<$linux/jhash.\+h$>$}\\*
{\ttfamily \#include $<$linux/delay.\+h$>$}\\*
{\ttfamily \#include $<$linux/time.\+h$>$}\\*
{\ttfamily \#include $<$linux/etherdevice.\+h$>$}\\*
{\ttfamily \#include $<$linux/genetlink.\+h$>$}\\*
{\ttfamily \#include $<$linux/kernel.\+h$>$}\\*
{\ttfamily \#include $<$linux/kthread.\+h$>$}\\*
{\ttfamily \#include $<$linux/mutex.\+h$>$}\\*
{\ttfamily \#include $<$linux/percpu.\+h$>$}\\*
{\ttfamily \#include $<$linux/rcupdate.\+h$>$}\\*
{\ttfamily \#include $<$linux/tcp.\+h$>$}\\*
{\ttfamily \#include $<$linux/udp.\+h$>$}\\*
{\ttfamily \#include $<$linux/version.\+h$>$}\\*
{\ttfamily \#include $<$linux/ethtool.\+h$>$}\\*
{\ttfamily \#include $<$linux/wait.\+h$>$}\\*
{\ttfamily \#include $<$asm/div64.\+h$>$}\\*
{\ttfamily \#include $<$linux/highmem.\+h$>$}\\*
{\ttfamily \#include $<$linux/netfilter\+\_\+bridge.\+h$>$}\\*
{\ttfamily \#include $<$linux/netfilter\+\_\+ipv4.\+h$>$}\\*
{\ttfamily \#include $<$linux/inetdevice.\+h$>$}\\*
{\ttfamily \#include $<$linux/list.\+h$>$}\\*
{\ttfamily \#include $<$linux/openvswitch.\+h$>$}\\*
{\ttfamily \#include $<$linux/rculist.\+h$>$}\\*
{\ttfamily \#include $<$linux/dmi.\+h$>$}\\*
{\ttfamily \#include $<$net/genetlink.\+h$>$}\\*
{\ttfamily \#include $<$net/net\+\_\+namespace.\+h$>$}\\*
{\ttfamily \#include $<$net/netns/generic.\+h$>$}\\*
{\ttfamily \#include \char`\"{}datapath.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}flow.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}flow\+\_\+table.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}flow\+\_\+netlink.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}vlan.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}vport-\/internal\+\_\+dev.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}vport-\/netdev.\+h\char`\"{}}\\*
Include dependency graph for datapath.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{datapath_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{datapath_8c_a1f8c165bf4196327bc3abff648276d92}{pr\+\_\+fmt}(fmt)~K\+B\+U\+I\+L\+D\+\_\+\+M\+O\+D\+N\+A\+M\+E \char`\"{}\+: \char`\"{} fmt
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{datapath_8c_abf00303edb3bc87ac06f165737f618ec}{E\+X\+P\+O\+R\+T\+\_\+\+S\+Y\+M\+B\+O\+L\+\_\+\+G\+P\+L} (\hyperlink{datapath_8h_ace140298dc2b59b3d77d59c0a210de29}{ovs\+\_\+net\+\_\+id})
\item 
static \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} \hyperlink{datapath_8c_aba3b63f0e73c9ea6ecb8b7aa5d913724}{ovs\+\_\+must\+\_\+notify} (struct \hyperlink{genetlink_8h_aba961c2c372b7122ad0c8ae5e7af2f3b}{genl\+\_\+family} $\ast$family, struct genl\+\_\+info $\ast$info, unsigned int group)
\item 
static void \hyperlink{datapath_8c_a67f527ad1164ff0d67fe854584ced567}{ovs\+\_\+notify} (struct \hyperlink{genetlink_8h_aba961c2c372b7122ad0c8ae5e7af2f3b}{genl\+\_\+family} $\ast$family, struct genl\+\_\+multicast\+\_\+group $\ast$grp, struct sk\+\_\+buff $\ast$skb, struct genl\+\_\+info $\ast$info)
\item 
static \hyperlink{datapath_8c_aa489fc945a5cabc6b1efbf3b886ee600}{D\+E\+F\+I\+N\+E\+\_\+\+M\+U\+T\+E\+X} (ovs\+\_\+mutex)
\item 
void \hyperlink{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}{ovs\+\_\+lock} (void)
\item 
void \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\+\_\+unlock} (void)
\item 
static int \hyperlink{datapath_8c_a2c10ba8a23a8cb2f14b7f7684e5ebb5d}{queue\+\_\+gso\+\_\+packets} (struct \hyperlink{structdatapath}{datapath} $\ast$dp, struct sk\+\_\+buff $\ast$, const struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$, const struct \hyperlink{structdp__upcall__info}{dp\+\_\+upcall\+\_\+info} $\ast$)
\item 
static int \hyperlink{datapath_8c_a549c591fae56562523f243abbe4a1e3e}{queue\+\_\+userspace\+\_\+packet} (struct \hyperlink{structdatapath}{datapath} $\ast$dp, struct sk\+\_\+buff $\ast$, const struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$, const struct \hyperlink{structdp__upcall__info}{dp\+\_\+upcall\+\_\+info} $\ast$)
\item 
static struct \hyperlink{structdatapath}{datapath} $\ast$ \hyperlink{datapath_8c_ab3f598cca9ed98120cc11daa11690da8}{get\+\_\+dp\+\_\+rcu} (struct net $\ast$net, int dp\+\_\+ifindex)
\item 
static struct \hyperlink{structdatapath}{datapath} $\ast$ \hyperlink{datapath_8c_a1107d4fd386aa6551511140b5405e1d3}{get\+\_\+dp} (struct net $\ast$net, int dp\+\_\+ifindex)
\item 
const char $\ast$ \hyperlink{datapath_8c_a6a23196916bb5de4994f901bdf1aba2d}{ovs\+\_\+dp\+\_\+name} (const struct \hyperlink{structdatapath}{datapath} $\ast$dp)
\item 
static int \hyperlink{datapath_8c_a2c4c60ba176a755749744f7b01aa6edd}{get\+\_\+dpifindex} (const struct \hyperlink{structdatapath}{datapath} $\ast$dp)
\item 
static void \hyperlink{datapath_8c_a5f329d1e5ef78eb6e9b4aa63c2d97e91}{destroy\+\_\+dp\+\_\+rcu} (struct rcu\+\_\+head $\ast$rcu)
\item 
static struct hlist\+\_\+head $\ast$ \hyperlink{datapath_8c_af291a723340e4e1bd38b4b14e7f4377a}{vport\+\_\+hash\+\_\+bucket} (const struct \hyperlink{structdatapath}{datapath} $\ast$dp, u16 port\+\_\+no)
\item 
struct \hyperlink{structvport}{vport} $\ast$ \hyperlink{datapath_8c_a0a9ec01692e1fdcb15a9a294d3789af0}{ovs\+\_\+lookup\+\_\+vport} (const struct \hyperlink{structdatapath}{datapath} $\ast$dp, u16 port\+\_\+no)
\item 
static struct \hyperlink{structvport}{vport} $\ast$ \hyperlink{datapath_8c_afac95a3e755fe3b0906ccc72d052cbe1}{new\+\_\+vport} (const struct \hyperlink{structvport__parms}{vport\+\_\+parms} $\ast$parms)
\item 
void \hyperlink{datapath_8c_a560b5f5f97a839287201f7486c53447e}{ovs\+\_\+dp\+\_\+detach\+\_\+port} (struct \hyperlink{structvport}{vport} $\ast$p)
\item 
void \hyperlink{datapath_8c_aa52cbaf8a4e68129287bfc8ddcde0711}{ovs\+\_\+dp\+\_\+process\+\_\+packet} (struct sk\+\_\+buff $\ast$skb, struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$key)
\item 
int \hyperlink{datapath_8c_a229b5c7d0158ebc24a90f44de0df0040}{ovs\+\_\+dp\+\_\+upcall} (struct \hyperlink{structdatapath}{datapath} $\ast$dp, struct sk\+\_\+buff $\ast$skb, const struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$key, const struct \hyperlink{structdp__upcall__info}{dp\+\_\+upcall\+\_\+info} $\ast$upcall\+\_\+info)
\item 
static size\+\_\+t \hyperlink{datapath_8c_a845617ce8ad4e18b0c54961d796a0aeb}{upcall\+\_\+msg\+\_\+size} (const struct \hyperlink{structdp__upcall__info}{dp\+\_\+upcall\+\_\+info} $\ast$upcall\+\_\+info, unsigned int hdrlen)
\item 
static int \hyperlink{datapath_8c_a20b16b839bd3116f7dbad5719b02c115}{ovs\+\_\+packet\+\_\+cmd\+\_\+execute} (struct sk\+\_\+buff $\ast$skb, struct genl\+\_\+info $\ast$info)
\item 
static void \hyperlink{datapath_8c_a689a2b3c19c9cdebecfb266acf5ba221}{get\+\_\+dp\+\_\+stats} (const struct \hyperlink{structdatapath}{datapath} $\ast$dp, struct \hyperlink{structovs__dp__stats}{ovs\+\_\+dp\+\_\+stats} $\ast$stats, struct \hyperlink{structovs__dp__megaflow__stats}{ovs\+\_\+dp\+\_\+megaflow\+\_\+stats} $\ast$mega\+\_\+stats)
\item 
static \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} \hyperlink{datapath_8c_a4d912d3ed7dba8789b726280b6dea3a4}{should\+\_\+fill\+\_\+key} (const struct \hyperlink{structsw__flow__id}{sw\+\_\+flow\+\_\+id} $\ast$sfid, uint32\+\_\+t ufid\+\_\+flags)
\item 
static \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} \hyperlink{datapath_8c_acef91dffd31fb70fa6c94e11ad08805b}{should\+\_\+fill\+\_\+mask} (uint32\+\_\+t ufid\+\_\+flags)
\item 
static \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} \hyperlink{datapath_8c_a05dcb72a9103046c5721d03a1592291f}{should\+\_\+fill\+\_\+actions} (uint32\+\_\+t ufid\+\_\+flags)
\item 
static size\+\_\+t \hyperlink{datapath_8c_a5f17e0449c315970d82161c131e70dbd}{ovs\+\_\+flow\+\_\+cmd\+\_\+msg\+\_\+size} (const struct \hyperlink{structsw__flow__actions}{sw\+\_\+flow\+\_\+actions} $\ast$acts, const struct \hyperlink{structsw__flow__id}{sw\+\_\+flow\+\_\+id} $\ast$sfid, uint32\+\_\+t ufid\+\_\+flags)
\item 
static int \hyperlink{datapath_8c_a832dcdda5999f2e7fadd72b2ad2373f3}{ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+stats} (const struct \hyperlink{structsw__flow}{sw\+\_\+flow} $\ast$flow, struct sk\+\_\+buff $\ast$skb)
\item 
static int \hyperlink{datapath_8c_ad6ce625c1cb24262cddbabe479987986}{ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+actions} (const struct \hyperlink{structsw__flow}{sw\+\_\+flow} $\ast$flow, struct sk\+\_\+buff $\ast$skb, int skb\+\_\+orig\+\_\+len)
\item 
static int \hyperlink{datapath_8c_a7b415415fa0d84bab45258cd3080f2c7}{ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+info} (const struct \hyperlink{structsw__flow}{sw\+\_\+flow} $\ast$flow, int dp\+\_\+ifindex, struct sk\+\_\+buff $\ast$skb, u32 portid, u32 seq, u32 \hyperlink{flow_8h_af4f7a53f6b2df72c34ca881f2714ac91}{flags}, u8 cmd, u32 ufid\+\_\+flags)
\item 
static struct sk\+\_\+buff $\ast$ \hyperlink{datapath_8c_ac6daf72fcac45a9bd571dec78216e197}{ovs\+\_\+flow\+\_\+cmd\+\_\+alloc\+\_\+info} (const struct \hyperlink{structsw__flow__actions}{sw\+\_\+flow\+\_\+actions} $\ast$acts, const struct \hyperlink{structsw__flow__id}{sw\+\_\+flow\+\_\+id} $\ast$sfid, struct genl\+\_\+info $\ast$info, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} always, uint32\+\_\+t ufid\+\_\+flags)
\item 
static struct sk\+\_\+buff $\ast$ \hyperlink{datapath_8c_afbfb35c0b3684e82dce573f04491ad1e}{ovs\+\_\+flow\+\_\+cmd\+\_\+build\+\_\+info} (const struct \hyperlink{structsw__flow}{sw\+\_\+flow} $\ast$flow, int dp\+\_\+ifindex, struct genl\+\_\+info $\ast$info, u8 cmd, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} always, u32 ufid\+\_\+flags)
\item 
static int \hyperlink{datapath_8c_ac8895cf604439184dad96f70e335afe2}{ovs\+\_\+flow\+\_\+cmd\+\_\+new} (struct sk\+\_\+buff $\ast$skb, struct genl\+\_\+info $\ast$info)
\item 
static struct \hyperlink{structsw__flow__actions}{sw\+\_\+flow\+\_\+actions} $\ast$ \hyperlink{datapath_8c_aac07273dc62dc714973b44be41f9bf7f}{get\+\_\+flow\+\_\+actions} (const struct nlattr $\ast$a, const struct \hyperlink{structsw__flow__key}{sw\+\_\+flow\+\_\+key} $\ast$key, const struct \hyperlink{structsw__flow__mask}{sw\+\_\+flow\+\_\+mask} $\ast$mask, \hyperlink{types_8h_afaa87723b8417d40fcf45b7330261ef9}{bool} log)
\item 
static int \hyperlink{datapath_8c_a4c6c2d9354cb73a6300a9b3c9cd2a114}{ovs\+\_\+flow\+\_\+cmd\+\_\+set} (struct sk\+\_\+buff $\ast$skb, struct genl\+\_\+info $\ast$info)
\item 
static int \hyperlink{datapath_8c_a747a4726ec84c751acb3048a515cef86}{ovs\+\_\+flow\+\_\+cmd\+\_\+get} (struct sk\+\_\+buff $\ast$skb, struct genl\+\_\+info $\ast$info)
\item 
static int \hyperlink{datapath_8c_aa05c62aa6531c0e0312126a21a8d99a5}{ovs\+\_\+flow\+\_\+cmd\+\_\+del} (struct sk\+\_\+buff $\ast$skb, struct genl\+\_\+info $\ast$info)
\item 
static int \hyperlink{datapath_8c_a4759993b01f8bc67711ecacacdf43976}{ovs\+\_\+flow\+\_\+cmd\+\_\+dump} (struct sk\+\_\+buff $\ast$skb, struct netlink\+\_\+callback $\ast$cb)
\item 
static size\+\_\+t \hyperlink{datapath_8c_aab015cdb7b4e0d2fa66da1b72963df67}{ovs\+\_\+dp\+\_\+cmd\+\_\+msg\+\_\+size} (void)
\item 
static int \hyperlink{datapath_8c_a0c18d2b438aba3739c2a36e172cfe3ea}{ovs\+\_\+dp\+\_\+cmd\+\_\+fill\+\_\+info} (struct \hyperlink{structdatapath}{datapath} $\ast$dp, struct sk\+\_\+buff $\ast$skb, u32 portid, u32 seq, u32 \hyperlink{flow_8h_af4f7a53f6b2df72c34ca881f2714ac91}{flags}, u8 cmd)
\item 
static struct sk\+\_\+buff $\ast$ \hyperlink{datapath_8c_ad01db8513d30c057f1ea10532ebc8b1e}{ovs\+\_\+dp\+\_\+cmd\+\_\+alloc\+\_\+info} (struct genl\+\_\+info $\ast$info)
\item 
static struct \hyperlink{structdatapath}{datapath} $\ast$ \hyperlink{datapath_8c_a774dc1bd6a39e68ebac48e55688a8574}{lookup\+\_\+datapath} (struct net $\ast$net, const struct \hyperlink{structovs__header}{ovs\+\_\+header} $\ast$\hyperlink{structovs__header}{ovs\+\_\+header}, struct nlattr $\ast$a\mbox{[}\hyperlink{openvswitch_8h_a928e759af5a47791e5b3070bf596fd5d}{O\+V\+S\+\_\+\+D\+P\+\_\+\+A\+T\+T\+R\+\_\+\+M\+A\+X}+1\mbox{]})
\item 
static void \hyperlink{datapath_8c_aba7a59d6ae252953be557d7478f7332f}{ovs\+\_\+dp\+\_\+reset\+\_\+user\+\_\+features} (struct sk\+\_\+buff $\ast$skb, struct genl\+\_\+info $\ast$info)
\item 
static void \hyperlink{datapath_8c_a2c763b1da99cce1a426140794eaf8f03}{ovs\+\_\+dp\+\_\+change} (struct \hyperlink{structdatapath}{datapath} $\ast$dp, struct nlattr $\ast$a\mbox{[}$\,$\mbox{]})
\item 
static int \hyperlink{datapath_8c_a8d012b2863686706ab9d1282a82d6625}{ovs\+\_\+dp\+\_\+cmd\+\_\+new} (struct sk\+\_\+buff $\ast$skb, struct genl\+\_\+info $\ast$info)
\item 
static void \hyperlink{datapath_8c_a6c66e1332f2a95e9510e37745d77bad1}{\+\_\+\+\_\+dp\+\_\+destroy} (struct \hyperlink{structdatapath}{datapath} $\ast$dp)
\item 
static int \hyperlink{datapath_8c_a580bc462589253144c5027fa18fbfb17}{ovs\+\_\+dp\+\_\+cmd\+\_\+del} (struct sk\+\_\+buff $\ast$skb, struct genl\+\_\+info $\ast$info)
\item 
static int \hyperlink{datapath_8c_aa59555f8c6107137945c90e92fd42b4c}{ovs\+\_\+dp\+\_\+cmd\+\_\+set} (struct sk\+\_\+buff $\ast$skb, struct genl\+\_\+info $\ast$info)
\item 
static int \hyperlink{datapath_8c_ab253bc3f01b9d70955d3d3dcfc236b9f}{ovs\+\_\+dp\+\_\+cmd\+\_\+get} (struct sk\+\_\+buff $\ast$skb, struct genl\+\_\+info $\ast$info)
\item 
static int \hyperlink{datapath_8c_a64056132bb398b3e7c92291cc6905537}{ovs\+\_\+dp\+\_\+cmd\+\_\+dump} (struct sk\+\_\+buff $\ast$skb, struct netlink\+\_\+callback $\ast$cb)
\item 
static int \hyperlink{datapath_8c_a4272403de9a985cea17181e99b7a7edc}{ovs\+\_\+vport\+\_\+cmd\+\_\+fill\+\_\+info} (struct \hyperlink{structvport}{vport} $\ast$\hyperlink{structvport}{vport}, struct sk\+\_\+buff $\ast$skb, u32 portid, u32 seq, u32 \hyperlink{flow_8h_af4f7a53f6b2df72c34ca881f2714ac91}{flags}, u8 cmd)
\item 
static struct sk\+\_\+buff $\ast$ \hyperlink{datapath_8c_a45645849b972492fa9f01eeaf668bf78}{ovs\+\_\+vport\+\_\+cmd\+\_\+alloc\+\_\+info} (void)
\item 
struct sk\+\_\+buff $\ast$ \hyperlink{datapath_8c_adf50e47c9c548390402b1da1608235c9}{ovs\+\_\+vport\+\_\+cmd\+\_\+build\+\_\+info} (struct \hyperlink{structvport}{vport} $\ast$\hyperlink{structvport}{vport}, u32 portid, u32 seq, u8 cmd)
\item 
static struct \hyperlink{structvport}{vport} $\ast$ \hyperlink{datapath_8c_a95b019fd3980803dcc1bb5aca920f58b}{lookup\+\_\+vport} (struct net $\ast$net, const struct \hyperlink{structovs__header}{ovs\+\_\+header} $\ast$\hyperlink{structovs__header}{ovs\+\_\+header}, struct nlattr $\ast$a\mbox{[}\hyperlink{openvswitch_8h_a789cf40a0af09c574467d47ca6a2eb7b}{O\+V\+S\+\_\+\+V\+P\+O\+R\+T\+\_\+\+A\+T\+T\+R\+\_\+\+M\+A\+X}+1\mbox{]})
\item 
static int \hyperlink{datapath_8c_a0b878975d12b240c20c6b5389b5b12b6}{ovs\+\_\+vport\+\_\+cmd\+\_\+new} (struct sk\+\_\+buff $\ast$skb, struct genl\+\_\+info $\ast$info)
\item 
static int \hyperlink{datapath_8c_a89f1e2fa808021479860862b3e7556e5}{ovs\+\_\+vport\+\_\+cmd\+\_\+set} (struct sk\+\_\+buff $\ast$skb, struct genl\+\_\+info $\ast$info)
\item 
static int \hyperlink{datapath_8c_afc2316a8fe3074ed07e853d552fb4704}{ovs\+\_\+vport\+\_\+cmd\+\_\+del} (struct sk\+\_\+buff $\ast$skb, struct genl\+\_\+info $\ast$info)
\item 
static int \hyperlink{datapath_8c_ad818149bb2b46cab6eeb5b7ba6a14afe}{ovs\+\_\+vport\+\_\+cmd\+\_\+get} (struct sk\+\_\+buff $\ast$skb, struct genl\+\_\+info $\ast$info)
\item 
static int \hyperlink{datapath_8c_ac61e52592bc18541660c182e9aebbcaf}{ovs\+\_\+vport\+\_\+cmd\+\_\+dump} (struct sk\+\_\+buff $\ast$skb, struct netlink\+\_\+callback $\ast$cb)
\item 
static void \hyperlink{datapath_8c_a02412b752de54c0add0ca994b0e74079}{dp\+\_\+unregister\+\_\+genl} (int n\+\_\+families)
\item 
static int \hyperlink{datapath_8c_a8a589935468eb018de07b30900a56ddb}{dp\+\_\+register\+\_\+genl} (void)
\item 
static int \+\_\+\+\_\+net\+\_\+init \hyperlink{datapath_8c_af390458a6069bd6b50c9a0d46517159a}{ovs\+\_\+init\+\_\+net} (struct net $\ast$net)
\item 
static void \+\_\+\+\_\+net\+\_\+exit \hyperlink{datapath_8c_a97bf5ddc3763f5f1b5691cc262bd206a}{list\+\_\+vports\+\_\+from\+\_\+net} (struct net $\ast$net, struct net $\ast$dnet, struct list\+\_\+head $\ast$head)
\item 
static void \+\_\+\+\_\+net\+\_\+exit \hyperlink{datapath_8c_aead9307565d6ab903dd5db639c7299e4}{ovs\+\_\+exit\+\_\+net} (struct net $\ast$dnet)
\item 
\hyperlink{datapath_8c_a537406a5b4c729d36ebe1d833ce74eda}{D\+E\+F\+I\+N\+E\+\_\+\+C\+O\+M\+P\+A\+T\+\_\+\+P\+N\+E\+T\+\_\+\+R\+E\+G\+\_\+\+F\+U\+N\+C} (device)
\item 
static int \+\_\+\+\_\+init \hyperlink{datapath_8c_a85a2562435726aa1e9d254c86c6e597e}{dp\+\_\+init} (void)
\item 
static void \hyperlink{datapath_8c_a64b62ac82dbfc2107fa6b38a2c9e3612}{dp\+\_\+cleanup} (void)
\item 
\hyperlink{datapath_8c_a61981f8b771cdb3f88315f3da5f4fe18}{module\+\_\+init} (\hyperlink{linux_2datapath_8c_a85a2562435726aa1e9d254c86c6e597e}{dp\+\_\+init})
\item 
\hyperlink{datapath_8c_afefe140861ac8adc338b486bf95f710f}{module\+\_\+exit} (\hyperlink{linux_2datapath_8c_a64b62ac82dbfc2107fa6b38a2c9e3612}{dp\+\_\+cleanup})
\item 
\hyperlink{datapath_8c_a375185aea6f89fbd06af3e43f39d2975}{M\+O\+D\+U\+L\+E\+\_\+\+D\+E\+S\+C\+R\+I\+P\+T\+I\+O\+N} (\char`\"{}Open v\+Switch switching \hyperlink{structdatapath}{datapath}\char`\"{})
\item 
\hyperlink{datapath_8c_ad94b36675e7eb067ea3ce6ff9e244a44}{M\+O\+D\+U\+L\+E\+\_\+\+L\+I\+C\+E\+N\+S\+E} (\char`\"{}G\+P\+L\char`\"{})
\item 
\hyperlink{datapath_8c_ada33d5db5abb99d420d4b6d82ea237c4}{M\+O\+D\+U\+L\+E\+\_\+\+V\+E\+R\+S\+I\+O\+N} (V\+E\+R\+S\+I\+O\+N)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{datapath_8h_ace140298dc2b59b3d77d59c0a210de29}{ovs\+\_\+net\+\_\+id} \hyperlink{datapath_8c_a50bac238082a6952a4dadad6299cc4b3}{\+\_\+\+\_\+read\+\_\+mostly}
\item 
static struct \hyperlink{genetlink_8h_aba961c2c372b7122ad0c8ae5e7af2f3b}{genl\+\_\+family} \hyperlink{datapath_8c_a709033900c84449b9f83cb62cecb1627}{dp\+\_\+packet\+\_\+genl\+\_\+family}
\item 
static struct \hyperlink{genetlink_8h_aba961c2c372b7122ad0c8ae5e7af2f3b}{genl\+\_\+family} \hyperlink{datapath_8c_af07853d514acd11f9f0d23494b6a2f9e}{dp\+\_\+flow\+\_\+genl\+\_\+family}
\item 
static struct \hyperlink{genetlink_8h_aba961c2c372b7122ad0c8ae5e7af2f3b}{genl\+\_\+family} \hyperlink{datapath_8c_a00b4c28b2a15cad709af53b6484fc45c}{dp\+\_\+datapath\+\_\+genl\+\_\+family}
\item 
static const struct nla\+\_\+policy \hyperlink{datapath_8c_aad79544f457c7a323273d328dafff886}{flow\+\_\+policy} \mbox{[}$\,$\mbox{]}
\item 
static struct genl\+\_\+multicast\+\_\+group \hyperlink{datapath_8c_ae43fcc307ac0fa091a736d4687c7f884}{ovs\+\_\+dp\+\_\+flow\+\_\+multicast\+\_\+group}
\item 
static struct genl\+\_\+multicast\+\_\+group \hyperlink{datapath_8c_afa5d1f090aee506896ff5ef56b4053e1}{ovs\+\_\+dp\+\_\+datapath\+\_\+multicast\+\_\+group}
\item 
struct genl\+\_\+multicast\+\_\+group \hyperlink{datapath_8c_a9dd8d4307b50fdee582eb4013d89eb7b}{ovs\+\_\+dp\+\_\+vport\+\_\+multicast\+\_\+group}
\item 
static const struct nla\+\_\+policy \hyperlink{datapath_8c_aaef8775f67f989a9ff396e2aa6f6f3e2}{packet\+\_\+policy} \mbox{[}\hyperlink{openvswitch_8h_a9c91f74efc7f0264839c153979485eec}{O\+V\+S\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+A\+T\+T\+R\+\_\+\+M\+A\+X}+1\mbox{]}
\item 
static struct genl\+\_\+ops \hyperlink{datapath_8c_a75ed1b368ac93a17ed4d04c82b892be9}{dp\+\_\+packet\+\_\+genl\+\_\+ops} \mbox{[}$\,$\mbox{]}
\item 
static struct genl\+\_\+ops \hyperlink{datapath_8c_a42bdb3978421f4f0b3a1be828226b271}{dp\+\_\+flow\+\_\+genl\+\_\+ops} \mbox{[}$\,$\mbox{]}
\item 
static const struct nla\+\_\+policy \hyperlink{datapath_8c_a34f2da191c04c403e206dacb0c3d2a6f}{datapath\+\_\+policy} \mbox{[}\hyperlink{openvswitch_8h_a928e759af5a47791e5b3070bf596fd5d}{O\+V\+S\+\_\+\+D\+P\+\_\+\+A\+T\+T\+R\+\_\+\+M\+A\+X}+1\mbox{]}
\item 
static struct genl\+\_\+ops \hyperlink{datapath_8c_a29acb4bb9ad0b3d7af71e628bf516372}{dp\+\_\+datapath\+\_\+genl\+\_\+ops} \mbox{[}$\,$\mbox{]}
\item 
static const struct nla\+\_\+policy \hyperlink{datapath_8c_af3f5c0f1eb12c1eb1a2494f265dda98a}{vport\+\_\+policy} \mbox{[}\hyperlink{openvswitch_8h_a789cf40a0af09c574467d47ca6a2eb7b}{O\+V\+S\+\_\+\+V\+P\+O\+R\+T\+\_\+\+A\+T\+T\+R\+\_\+\+M\+A\+X}+1\mbox{]}
\item 
static struct genl\+\_\+ops \hyperlink{datapath_8c_a5a28211e3b7e9a5cf7ccf8e81b8bfa8e}{dp\+\_\+vport\+\_\+genl\+\_\+ops} \mbox{[}$\,$\mbox{]}
\item 
struct \hyperlink{genetlink_8h_aba961c2c372b7122ad0c8ae5e7af2f3b}{genl\+\_\+family} \hyperlink{datapath_8c_a69bf55f33e234bc4b78e6eeee1d603fd}{dp\+\_\+vport\+\_\+genl\+\_\+family}
\item 
static struct \hyperlink{genetlink_8h_aba961c2c372b7122ad0c8ae5e7af2f3b}{genl\+\_\+family} $\ast$ \hyperlink{datapath_8c_ae945344e649c305788038f5bc09bc817}{dp\+\_\+genl\+\_\+families} \mbox{[}$\,$\mbox{]}
\item 
static struct pernet\+\_\+operations \hyperlink{datapath_8c_a3a9f5b1a35fcb90938194f22dc2d0f14}{ovs\+\_\+net\+\_\+ops}
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{datapath_8c_a1f8c165bf4196327bc3abff648276d92}{}\index{datapath.\+c@{datapath.\+c}!pr\+\_\+fmt@{pr\+\_\+fmt}}
\index{pr\+\_\+fmt@{pr\+\_\+fmt}!datapath.\+c@{datapath.\+c}}
\subsubsection[{pr\+\_\+fmt}]{\setlength{\rightskip}{0pt plus 5cm}\#define pr\+\_\+fmt(
\begin{DoxyParamCaption}
\item[{}]{fmt}
\end{DoxyParamCaption}
)~K\+B\+U\+I\+L\+D\+\_\+\+M\+O\+D\+N\+A\+M\+E \char`\"{}\+: \char`\"{} fmt}\label{datapath_8c_a1f8c165bf4196327bc3abff648276d92}


\subsection{Function Documentation}
\hypertarget{datapath_8c_a6c66e1332f2a95e9510e37745d77bad1}{}\index{datapath.\+c@{datapath.\+c}!\+\_\+\+\_\+dp\+\_\+destroy@{\+\_\+\+\_\+dp\+\_\+destroy}}
\index{\+\_\+\+\_\+dp\+\_\+destroy@{\+\_\+\+\_\+dp\+\_\+destroy}!datapath.\+c@{datapath.\+c}}
\subsubsection[{\+\_\+\+\_\+dp\+\_\+destroy}]{\setlength{\rightskip}{0pt plus 5cm}static void \+\_\+\+\_\+dp\+\_\+destroy (
\begin{DoxyParamCaption}
\item[{struct {\bf datapath} $\ast$}]{dp}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a6c66e1332f2a95e9510e37745d77bad1}

\begin{DoxyCode}
1614 \{
1615     \textcolor{keywordtype}{int} i;
1616 
1617     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{datapath_8h_ac1bf9805d62227b8f76f130087e18018}{DP\_VPORT\_HASH\_BUCKETS}; i++) \{
1618         \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport};
1619         \textcolor{keyword}{struct }hlist\_node *n;
1620 
1621         \hyperlink{list_8h_ae2f7dd7dbbe2f13fa51aca9fcb31a03f}{hlist\_for\_each\_entry\_safe}(vport, n, &dp->\hyperlink{structdatapath_abb0de528545b312de283b571cb6c4ede}{ports}[i], dp\_hash\_node)
1622             if (vport->port\_no != \hyperlink{openvswitch_8h_aff2f13b95c27262c520f26831e647598}{OVSP\_LOCAL})
1623                 \hyperlink{datapath_8c_a560b5f5f97a839287201f7486c53447e}{ovs\_dp\_detach\_port}(vport);
1624     \}
1625 
1626     list\_del\_rcu(&dp->list\_node);
1627 
1628     \textcolor{comment}{/* OVSP\_LOCAL is datapath internal port. We need to make sure that}
1629 \textcolor{comment}{     * all ports in datapath are destroyed first before freeing datapath.}
1630 \textcolor{comment}{     */}
1631     \hyperlink{datapath_8c_a560b5f5f97a839287201f7486c53447e}{ovs\_dp\_detach\_port}(\hyperlink{datapath_8h_a422576bd4b943e9df313ba73f6c624e1}{ovs\_vport\_ovsl}(dp, 
      \hyperlink{openvswitch_8h_aff2f13b95c27262c520f26831e647598}{OVSP\_LOCAL}));
1632 
1633     \textcolor{comment}{/* RCU destroy the flow table */}
1634     call\_rcu(&dp->rcu, \hyperlink{datapath_8c_a5f329d1e5ef78eb6e9b4aa63c2d97e91}{destroy\_dp\_rcu});
1635 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a537406a5b4c729d36ebe1d833ce74eda}{}\index{datapath.\+c@{datapath.\+c}!D\+E\+F\+I\+N\+E\+\_\+\+C\+O\+M\+P\+A\+T\+\_\+\+P\+N\+E\+T\+\_\+\+R\+E\+G\+\_\+\+F\+U\+N\+C@{D\+E\+F\+I\+N\+E\+\_\+\+C\+O\+M\+P\+A\+T\+\_\+\+P\+N\+E\+T\+\_\+\+R\+E\+G\+\_\+\+F\+U\+N\+C}}
\index{D\+E\+F\+I\+N\+E\+\_\+\+C\+O\+M\+P\+A\+T\+\_\+\+P\+N\+E\+T\+\_\+\+R\+E\+G\+\_\+\+F\+U\+N\+C@{D\+E\+F\+I\+N\+E\+\_\+\+C\+O\+M\+P\+A\+T\+\_\+\+P\+N\+E\+T\+\_\+\+R\+E\+G\+\_\+\+F\+U\+N\+C}!datapath.\+c@{datapath.\+c}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+\+C\+O\+M\+P\+A\+T\+\_\+\+P\+N\+E\+T\+\_\+\+R\+E\+G\+\_\+\+F\+U\+N\+C}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+\+C\+O\+M\+P\+A\+T\+\_\+\+P\+N\+E\+T\+\_\+\+R\+E\+G\+\_\+\+F\+U\+N\+C (
\begin{DoxyParamCaption}
\item[{device}]{}
\end{DoxyParamCaption}
)}\label{datapath_8c_a537406a5b4c729d36ebe1d833ce74eda}
\hypertarget{datapath_8c_aa489fc945a5cabc6b1efbf3b886ee600}{}\index{datapath.\+c@{datapath.\+c}!D\+E\+F\+I\+N\+E\+\_\+\+M\+U\+T\+E\+X@{D\+E\+F\+I\+N\+E\+\_\+\+M\+U\+T\+E\+X}}
\index{D\+E\+F\+I\+N\+E\+\_\+\+M\+U\+T\+E\+X@{D\+E\+F\+I\+N\+E\+\_\+\+M\+U\+T\+E\+X}!datapath.\+c@{datapath.\+c}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+\+M\+U\+T\+E\+X}]{\setlength{\rightskip}{0pt plus 5cm}static D\+E\+F\+I\+N\+E\+\_\+\+M\+U\+T\+E\+X (
\begin{DoxyParamCaption}
\item[{ovs\+\_\+mutex}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_aa489fc945a5cabc6b1efbf3b886ee600}
D\+O\+C\+: Locking\+:

All writes e.\+g. Writes to device state (add/remove datapath, port, set operations on vports, etc.), Writes to other state (flow table modifications, set miscellaneous datapath parameters, etc.) are protected by ovs\+\_\+lock.

Reads are protected by R\+C\+U.

There are a few special cases (mostly stats) that have their own synchronization but they nest under all of above and don\textquotesingle{}t interact with each other.

The R\+T\+N\+L lock nests inside ovs\+\_\+mutex. \hypertarget{datapath_8c_a5f329d1e5ef78eb6e9b4aa63c2d97e91}{}\index{datapath.\+c@{datapath.\+c}!destroy\+\_\+dp\+\_\+rcu@{destroy\+\_\+dp\+\_\+rcu}}
\index{destroy\+\_\+dp\+\_\+rcu@{destroy\+\_\+dp\+\_\+rcu}!datapath.\+c@{datapath.\+c}}
\subsubsection[{destroy\+\_\+dp\+\_\+rcu}]{\setlength{\rightskip}{0pt plus 5cm}static void destroy\+\_\+dp\+\_\+rcu (
\begin{DoxyParamCaption}
\item[{struct rcu\+\_\+head $\ast$}]{rcu}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a5f329d1e5ef78eb6e9b4aa63c2d97e91}

\begin{DoxyCode}
203 \{
204     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp = container\_of(\hyperlink{structdatapath_af487ac38fa868c398dd248f1956b7a35}{rcu}, \textcolor{keyword}{struct} \hyperlink{structdatapath}{datapath}, 
      \hyperlink{structdatapath_af487ac38fa868c398dd248f1956b7a35}{rcu});
205 
206     \hyperlink{flow__table_8c_ad37dcfdb56d17589ed79b5c4dd38bc76}{ovs\_flow\_tbl\_destroy}(&dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table});
207     free\_percpu(dp->\hyperlink{structdatapath_a26ff295c711206c8177cdc89150c6a4a}{stats\_percpu});
208     release\_net(\hyperlink{datapath_8h_aef2302004ca1f45133eaef00bb3740eb}{ovs\_dp\_get\_net}(dp));
209     kfree(dp->\hyperlink{structdatapath_abb0de528545b312de283b571cb6c4ede}{ports});
210     kfree(dp);
211 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a64b62ac82dbfc2107fa6b38a2c9e3612}{}\index{datapath.\+c@{datapath.\+c}!dp\+\_\+cleanup@{dp\+\_\+cleanup}}
\index{dp\+\_\+cleanup@{dp\+\_\+cleanup}!datapath.\+c@{datapath.\+c}}
\subsubsection[{dp\+\_\+cleanup}]{\setlength{\rightskip}{0pt plus 5cm}static void dp\+\_\+cleanup (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a64b62ac82dbfc2107fa6b38a2c9e3612}

\begin{DoxyCode}
2344 \{
2345     \hyperlink{datapath_8c_a02412b752de54c0add0ca994b0e74079}{dp\_unregister\_genl}(ARRAY\_SIZE(\hyperlink{datapath_8c_ae945344e649c305788038f5bc09bc817}{dp\_genl\_families}));
2346     \hyperlink{linux_2vport-netdev_8c_ada5333ba6a30c7b472582687565e316c}{ovs\_netdev\_exit}();
2347     unregister\_netdevice\_notifier(&\hyperlink{datapath_8h_ab34ba4d6c1125efcec9480356f3393e6}{ovs\_dp\_device\_notifier});
2348     unregister\_pernet\_device(&\hyperlink{datapath_8c_a3a9f5b1a35fcb90938194f22dc2d0f14}{ovs\_net\_ops});
2349     rcu\_barrier();
2350     \hyperlink{linux_2vport_8c_a32e04c9d5d25cb3b7e23a297dc65fc6a}{ovs\_vport\_exit}();
2351     \hyperlink{flow__table_8c_a96cce30f7a9c3231d5b5afaf967378eb}{ovs\_flow\_exit}();
2352     \hyperlink{linux_2vport-internal__dev_8c_a4e61a8459847af3c4f5773e09552cf98}{ovs\_internal\_dev\_rtnl\_link\_unregister}();
2353     \hyperlink{actions_8c_a7dfd1f218e0966ef342251a185866f4d}{action\_fifos\_exit}();
2354 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a85a2562435726aa1e9d254c86c6e597e}{}\index{datapath.\+c@{datapath.\+c}!dp\+\_\+init@{dp\+\_\+init}}
\index{dp\+\_\+init@{dp\+\_\+init}!datapath.\+c@{datapath.\+c}}
\subsubsection[{dp\+\_\+init}]{\setlength{\rightskip}{0pt plus 5cm}static int \+\_\+\+\_\+init dp\+\_\+init (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a85a2562435726aa1e9d254c86c6e597e}

\begin{DoxyCode}
2284 \{
2285     \textcolor{keywordtype}{int} err;
2286 
2287     BUILD\_BUG\_ON(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structovs__skb__cb}{ovs\_skb\_cb}) > FIELD\_SIZEOF(\textcolor{keyword}{struct} sk\_buff, cb));
2288 
2289     pr\_info(\textcolor{stringliteral}{"Open vSwitch switching datapath %s\(\backslash\)n"}, VERSION);
2290 
2291     err = \hyperlink{actions_8c_a3006f0376c2aecb6525126ad0e9bae25}{action\_fifos\_init}();
2292     \textcolor{keywordflow}{if} (err)
2293         \textcolor{keywordflow}{goto} error;
2294 
2295     err = \hyperlink{linux_2vport-internal__dev_8c_ac6d8a2dd3cdef9e9ba9efdd4e0656f7c}{ovs\_internal\_dev\_rtnl\_link\_register}();
2296     \textcolor{keywordflow}{if} (err)
2297         \textcolor{keywordflow}{goto} error\_action\_fifos\_exit;
2298 
2299     err = \hyperlink{flow__table_8c_a07492868e65ba495c86d49df9cf1bc50}{ovs\_flow\_init}();
2300     \textcolor{keywordflow}{if} (err)
2301         \textcolor{keywordflow}{goto} error\_unreg\_rtnl\_link;
2302 
2303     err = \hyperlink{linux_2vport_8c_aacc501a60108d387b8fd7535c2e6168f}{ovs\_vport\_init}();
2304     \textcolor{keywordflow}{if} (err)
2305         \textcolor{keywordflow}{goto} error\_flow\_exit;
2306 
2307     err = register\_pernet\_device(&\hyperlink{datapath_8c_a3a9f5b1a35fcb90938194f22dc2d0f14}{ovs\_net\_ops});
2308     \textcolor{keywordflow}{if} (err)
2309         \textcolor{keywordflow}{goto} error\_vport\_exit;
2310 
2311     err = register\_netdevice\_notifier(&\hyperlink{datapath_8h_ab34ba4d6c1125efcec9480356f3393e6}{ovs\_dp\_device\_notifier});
2312     \textcolor{keywordflow}{if} (err)
2313         \textcolor{keywordflow}{goto} error\_netns\_exit;
2314 
2315     err = \hyperlink{linux_2vport-netdev_8c_a70dd93833f5d471ed3951dd80f54a914}{ovs\_netdev\_init}();
2316     \textcolor{keywordflow}{if} (err)
2317         \textcolor{keywordflow}{goto} error\_unreg\_notifier;
2318 
2319     err = \hyperlink{datapath_8c_a8a589935468eb018de07b30900a56ddb}{dp\_register\_genl}();
2320     \textcolor{keywordflow}{if} (err < 0)
2321         \textcolor{keywordflow}{goto} error\_unreg\_netdev;
2322 
2323     \textcolor{keywordflow}{return} 0;
2324 
2325 error\_unreg\_netdev:
2326     \hyperlink{linux_2vport-netdev_8c_ada5333ba6a30c7b472582687565e316c}{ovs\_netdev\_exit}();
2327 error\_unreg\_notifier:
2328     unregister\_netdevice\_notifier(&\hyperlink{datapath_8h_ab34ba4d6c1125efcec9480356f3393e6}{ovs\_dp\_device\_notifier});
2329 error\_netns\_exit:
2330     unregister\_pernet\_device(&\hyperlink{datapath_8c_a3a9f5b1a35fcb90938194f22dc2d0f14}{ovs\_net\_ops});
2331 error\_vport\_exit:
2332     \hyperlink{linux_2vport_8c_a32e04c9d5d25cb3b7e23a297dc65fc6a}{ovs\_vport\_exit}();
2333 error\_flow\_exit:
2334     \hyperlink{flow__table_8c_a96cce30f7a9c3231d5b5afaf967378eb}{ovs\_flow\_exit}();
2335 error\_unreg\_rtnl\_link:
2336     \hyperlink{linux_2vport-internal__dev_8c_a4e61a8459847af3c4f5773e09552cf98}{ovs\_internal\_dev\_rtnl\_link\_unregister}();
2337 error\_action\_fifos\_exit:
2338     \hyperlink{actions_8c_a7dfd1f218e0966ef342251a185866f4d}{action\_fifos\_exit}();
2339 error:
2340     \textcolor{keywordflow}{return} err;
2341 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a8a589935468eb018de07b30900a56ddb}{}\index{datapath.\+c@{datapath.\+c}!dp\+\_\+register\+\_\+genl@{dp\+\_\+register\+\_\+genl}}
\index{dp\+\_\+register\+\_\+genl@{dp\+\_\+register\+\_\+genl}!datapath.\+c@{datapath.\+c}}
\subsubsection[{dp\+\_\+register\+\_\+genl}]{\setlength{\rightskip}{0pt plus 5cm}static int dp\+\_\+register\+\_\+genl (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a8a589935468eb018de07b30900a56ddb}

\begin{DoxyCode}
2193 \{
2194     \textcolor{keywordtype}{int} err;
2195     \textcolor{keywordtype}{int} i;
2196 
2197     \textcolor{keywordflow}{for} (i = 0; i < ARRAY\_SIZE(\hyperlink{datapath_8c_ae945344e649c305788038f5bc09bc817}{dp\_genl\_families}); i++) \{
2198 
2199         err = \hyperlink{genetlink_8h_ae1e50e3e047b37c08412138d4f224179}{genl\_register\_family}(\hyperlink{datapath_8c_ae945344e649c305788038f5bc09bc817}{dp\_genl\_families}[i]);
2200         \textcolor{keywordflow}{if} (err)
2201             \textcolor{keywordflow}{goto} error;
2202     \}
2203 
2204     \textcolor{keywordflow}{return} 0;
2205 
2206 error:
2207     \hyperlink{datapath_8c_a02412b752de54c0add0ca994b0e74079}{dp\_unregister\_genl}(i);
2208     \textcolor{keywordflow}{return} err;
2209 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a02412b752de54c0add0ca994b0e74079}{}\index{datapath.\+c@{datapath.\+c}!dp\+\_\+unregister\+\_\+genl@{dp\+\_\+unregister\+\_\+genl}}
\index{dp\+\_\+unregister\+\_\+genl@{dp\+\_\+unregister\+\_\+genl}!datapath.\+c@{datapath.\+c}}
\subsubsection[{dp\+\_\+unregister\+\_\+genl}]{\setlength{\rightskip}{0pt plus 5cm}static void dp\+\_\+unregister\+\_\+genl (
\begin{DoxyParamCaption}
\item[{int}]{n\+\_\+families}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a02412b752de54c0add0ca994b0e74079}

\begin{DoxyCode}
2185 \{
2186     \textcolor{keywordtype}{int} i;
2187 
2188     \textcolor{keywordflow}{for} (i = 0; i < n\_families; i++)
2189         \hyperlink{genetlink_8h_a838538f5265ecd4c9726bdf30cfa02c2}{genl\_unregister\_family}(\hyperlink{datapath_8c_ae945344e649c305788038f5bc09bc817}{dp\_genl\_families}[i]);
2190 \}
\end{DoxyCode}
\hypertarget{datapath_8c_abf00303edb3bc87ac06f165737f618ec}{}\index{datapath.\+c@{datapath.\+c}!E\+X\+P\+O\+R\+T\+\_\+\+S\+Y\+M\+B\+O\+L\+\_\+\+G\+P\+L@{E\+X\+P\+O\+R\+T\+\_\+\+S\+Y\+M\+B\+O\+L\+\_\+\+G\+P\+L}}
\index{E\+X\+P\+O\+R\+T\+\_\+\+S\+Y\+M\+B\+O\+L\+\_\+\+G\+P\+L@{E\+X\+P\+O\+R\+T\+\_\+\+S\+Y\+M\+B\+O\+L\+\_\+\+G\+P\+L}!datapath.\+c@{datapath.\+c}}
\subsubsection[{E\+X\+P\+O\+R\+T\+\_\+\+S\+Y\+M\+B\+O\+L\+\_\+\+G\+P\+L}]{\setlength{\rightskip}{0pt plus 5cm}E\+X\+P\+O\+R\+T\+\_\+\+S\+Y\+M\+B\+O\+L\+\_\+\+G\+P\+L (
\begin{DoxyParamCaption}
\item[{{\bf ovs\+\_\+net\+\_\+id}}]{}
\end{DoxyParamCaption}
)}\label{datapath_8c_abf00303edb3bc87ac06f165737f618ec}
\hypertarget{datapath_8c_a1107d4fd386aa6551511140b5405e1d3}{}\index{datapath.\+c@{datapath.\+c}!get\+\_\+dp@{get\+\_\+dp}}
\index{get\+\_\+dp@{get\+\_\+dp}!datapath.\+c@{datapath.\+c}}
\subsubsection[{get\+\_\+dp}]{\setlength{\rightskip}{0pt plus 5cm}static struct {\bf datapath}$\ast$ get\+\_\+dp (
\begin{DoxyParamCaption}
\item[{struct net $\ast$}]{net, }
\item[{int}]{dp\+\_\+ifindex}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a1107d4fd386aa6551511140b5405e1d3}

\begin{DoxyCode}
166 \{
167     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
168 
169     WARN\_ON\_ONCE(!\hyperlink{rcupdate_8h_ab77c80b5efea34ea99ec24a4f532eb9b}{rcu\_read\_lock\_held}() && !
      \hyperlink{datapath_8h_a54d3f44a7dda58b44208095ce4b2c0ee}{lockdep\_ovsl\_is\_held}());
170     rcu\_read\_lock();
171     dp = \hyperlink{datapath_8c_ab3f598cca9ed98120cc11daa11690da8}{get\_dp\_rcu}(net, dp\_ifindex);
172     rcu\_read\_unlock();
173 
174     \textcolor{keywordflow}{return} dp;
175 \}
\end{DoxyCode}
\hypertarget{datapath_8c_ab3f598cca9ed98120cc11daa11690da8}{}\index{datapath.\+c@{datapath.\+c}!get\+\_\+dp\+\_\+rcu@{get\+\_\+dp\+\_\+rcu}}
\index{get\+\_\+dp\+\_\+rcu@{get\+\_\+dp\+\_\+rcu}!datapath.\+c@{datapath.\+c}}
\subsubsection[{get\+\_\+dp\+\_\+rcu}]{\setlength{\rightskip}{0pt plus 5cm}static struct {\bf datapath}$\ast$ get\+\_\+dp\+\_\+rcu (
\begin{DoxyParamCaption}
\item[{struct net $\ast$}]{net, }
\item[{int}]{dp\+\_\+ifindex}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_ab3f598cca9ed98120cc11daa11690da8}

\begin{DoxyCode}
150 \{
151     \textcolor{keyword}{struct }net\_device *dev = \hyperlink{netdevice_8h_aae9e99af63bfc2280ca46e232e32b6b8}{dev\_get\_by\_index\_rcu}(net, dp\_ifindex);
152 
153     \textcolor{keywordflow}{if} (dev) \{
154         \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport} = \hyperlink{linux_2vport-internal__dev_8c_abdb7a75d6c79176507a41a200c69e77b}{ovs\_internal\_dev\_get\_vport}(dev);
155         \textcolor{keywordflow}{if} (vport)
156             \textcolor{keywordflow}{return} vport->\hyperlink{structvport_a49fb6f6bf0ac4337853e9242e88ddc42}{dp};
157     \}
158 
159     \textcolor{keywordflow}{return} NULL;
160 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a689a2b3c19c9cdebecfb266acf5ba221}{}\index{datapath.\+c@{datapath.\+c}!get\+\_\+dp\+\_\+stats@{get\+\_\+dp\+\_\+stats}}
\index{get\+\_\+dp\+\_\+stats@{get\+\_\+dp\+\_\+stats}!datapath.\+c@{datapath.\+c}}
\subsubsection[{get\+\_\+dp\+\_\+stats}]{\setlength{\rightskip}{0pt plus 5cm}static void get\+\_\+dp\+\_\+stats (
\begin{DoxyParamCaption}
\item[{const struct {\bf datapath} $\ast$}]{dp, }
\item[{struct {\bf ovs\+\_\+dp\+\_\+stats} $\ast$}]{stats, }
\item[{struct {\bf ovs\+\_\+dp\+\_\+megaflow\+\_\+stats} $\ast$}]{mega\+\_\+stats}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a689a2b3c19c9cdebecfb266acf5ba221}

\begin{DoxyCode}
661 \{
662     \textcolor{keywordtype}{int} i;
663 
664     memset(mega\_stats, 0, \textcolor{keyword}{sizeof}(*mega\_stats));
665 
666     stats->\hyperlink{structovs__dp__stats_af6bf9e903d781d713f0f5d10b2d8550f}{n\_flows} = \hyperlink{flow__table_8c_a8f1f39fd4e1ecafd99321016698a709a}{ovs\_flow\_tbl\_count}(&dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table});
667     mega\_stats->\hyperlink{structovs__dp__megaflow__stats_a7984504a5c12cc5a0767c6a34c4c9c96}{n\_masks} = \hyperlink{flow__table_8c_ab6e18d16217cddd0af756b76b72e6ce6}{ovs\_flow\_tbl\_num\_masks}(&dp->
      \hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table});
668 
669     stats->\hyperlink{structovs__dp__stats_a0c6b8d1358632341b5e949570c5dca68}{n\_hit} = stats->\hyperlink{structovs__dp__stats_a8f1b9687593ebb43ca54c1c9904999a6}{n\_missed} = stats->\hyperlink{structovs__dp__stats_a83a104dedcf4ee3cc2a940e4043e89b2}{n\_lost} = 0;
670 
671     \hyperlink{cpumask_8h_ad15c4fe55a8b712e3bf1049320f3c3cb}{for\_each\_possible\_cpu}(i) \{
672         \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structdp__stats__percpu}{dp\_stats\_percpu} *percpu\_stats;
673         \textcolor{keyword}{struct }\hyperlink{structdp__stats__percpu}{dp\_stats\_percpu} local\_stats;
674         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} start;
675 
676         percpu\_stats = per\_cpu\_ptr(dp->\hyperlink{structdatapath_a26ff295c711206c8177cdc89150c6a4a}{stats\_percpu}, i);
677 
678         \textcolor{keywordflow}{do} \{
679             start = \hyperlink{u64__stats__sync_8h_addfaebb71638dbc159aaee907e45fe84}{u64\_stats\_fetch\_begin\_irq}(&percpu\_stats->
      \hyperlink{structdp__stats__percpu_ad67971f59f6db5432848db23d185dc2f}{syncp});
680             local\_stats = *percpu\_stats;
681         \} \textcolor{keywordflow}{while} (\hyperlink{u64__stats__sync_8h_a663ca602e197bee607ec46f743c839e1}{u64\_stats\_fetch\_retry\_irq}(&percpu\_stats->
      \hyperlink{structdp__stats__percpu_ad67971f59f6db5432848db23d185dc2f}{syncp}, start));
682 
683         stats->\hyperlink{structovs__dp__stats_a0c6b8d1358632341b5e949570c5dca68}{n\_hit} += local\_stats.n\_hit;
684         stats->\hyperlink{structovs__dp__stats_a8f1b9687593ebb43ca54c1c9904999a6}{n\_missed} += local\_stats.n\_missed;
685         stats->\hyperlink{structovs__dp__stats_a83a104dedcf4ee3cc2a940e4043e89b2}{n\_lost} += local\_stats.n\_lost;
686         mega\_stats->\hyperlink{structovs__dp__megaflow__stats_a28566425278d53e7a93e693d54e1e65c}{n\_mask\_hit} += local\_stats.n\_mask\_hit;
687     \}
688 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a2c4c60ba176a755749744f7b01aa6edd}{}\index{datapath.\+c@{datapath.\+c}!get\+\_\+dpifindex@{get\+\_\+dpifindex}}
\index{get\+\_\+dpifindex@{get\+\_\+dpifindex}!datapath.\+c@{datapath.\+c}}
\subsubsection[{get\+\_\+dpifindex}]{\setlength{\rightskip}{0pt plus 5cm}static int get\+\_\+dpifindex (
\begin{DoxyParamCaption}
\item[{const struct {\bf datapath} $\ast$}]{dp}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a2c4c60ba176a755749744f7b01aa6edd}

\begin{DoxyCode}
185 \{
186     \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *local;
187     \textcolor{keywordtype}{int} ifindex;
188 
189     rcu\_read\_lock();
190 
191     local = \hyperlink{datapath_8h_ac6f3c37a7850774112c03c6e88d89dc0}{ovs\_vport\_rcu}(dp, \hyperlink{openvswitch_8h_aff2f13b95c27262c520f26831e647598}{OVSP\_LOCAL});
192     \textcolor{keywordflow}{if} (local)
193         ifindex = \hyperlink{vport-netdev_8h_a2cb441c6cf067ce3c79cb43836e9fc55}{netdev\_vport\_priv}(local)->\hyperlink{structnetdev__vport_acf4ee248f7385e2f987fd2736f824ca9}{dev}->ifindex;
194     \textcolor{keywordflow}{else}
195         ifindex = 0;
196 
197     rcu\_read\_unlock();
198 
199     \textcolor{keywordflow}{return} ifindex;
200 \}
\end{DoxyCode}
\hypertarget{datapath_8c_aac07273dc62dc714973b44be41f9bf7f}{}\index{datapath.\+c@{datapath.\+c}!get\+\_\+flow\+\_\+actions@{get\+\_\+flow\+\_\+actions}}
\index{get\+\_\+flow\+\_\+actions@{get\+\_\+flow\+\_\+actions}!datapath.\+c@{datapath.\+c}}
\subsubsection[{get\+\_\+flow\+\_\+actions}]{\setlength{\rightskip}{0pt plus 5cm}static struct {\bf sw\+\_\+flow\+\_\+actions}$\ast$ get\+\_\+flow\+\_\+actions (
\begin{DoxyParamCaption}
\item[{const struct nlattr $\ast$}]{a, }
\item[{const struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{key, }
\item[{const struct {\bf sw\+\_\+flow\+\_\+mask} $\ast$}]{mask, }
\item[{{\bf bool}}]{log}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_aac07273dc62dc714973b44be41f9bf7f}

\begin{DoxyCode}
1056 \{
1057     \textcolor{keyword}{struct }\hyperlink{structsw__flow__actions}{sw\_flow\_actions} *acts;
1058     \textcolor{keyword}{struct }\hyperlink{structsw__flow__key}{sw\_flow\_key} masked\_key;
1059     \textcolor{keywordtype}{int} error;
1060 
1061     \hyperlink{flow__table_8c_a40f76cbd2e168abb1b9744562e24be3b}{ovs\_flow\_mask\_key}(&masked\_key, key, mask);
1062     error = \hyperlink{flow__netlink_8c_a10dc93f8c379eae7a557d54d9b387dd6}{ovs\_nla\_copy\_actions}(a, &masked\_key, &acts, log);
1063     \textcolor{keywordflow}{if} (error) \{
1064         \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log,
1065               \textcolor{stringliteral}{"Actions may not be safe on all matching packets"});
1066         \textcolor{keywordflow}{return} ERR\_PTR(error);
1067     \}
1068 
1069     \textcolor{keywordflow}{return} acts;
1070 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a97bf5ddc3763f5f1b5691cc262bd206a}{}\index{datapath.\+c@{datapath.\+c}!list\+\_\+vports\+\_\+from\+\_\+net@{list\+\_\+vports\+\_\+from\+\_\+net}}
\index{list\+\_\+vports\+\_\+from\+\_\+net@{list\+\_\+vports\+\_\+from\+\_\+net}!datapath.\+c@{datapath.\+c}}
\subsubsection[{list\+\_\+vports\+\_\+from\+\_\+net}]{\setlength{\rightskip}{0pt plus 5cm}static void \+\_\+\+\_\+net\+\_\+exit list\+\_\+vports\+\_\+from\+\_\+net (
\begin{DoxyParamCaption}
\item[{struct net $\ast$}]{net, }
\item[{struct net $\ast$}]{dnet, }
\item[{struct list\+\_\+head $\ast$}]{head}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a97bf5ddc3763f5f1b5691cc262bd206a}

\begin{DoxyCode}
2222 \{
2223     \textcolor{keyword}{struct }\hyperlink{structovs__net}{ovs\_net} *\hyperlink{structovs__net}{ovs\_net} = net\_generic(net, \hyperlink{datapath_8h_ace140298dc2b59b3d77d59c0a210de29}{ovs\_net\_id});
2224     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
2225 
2226     list\_for\_each\_entry(dp, &ovs\_net->\hyperlink{structovs__net_a0490101f7ea82f5c290a92d447bd8f9d}{dps}, \hyperlink{structdatapath_ac5f44be07025a2addb5c393fba822000}{list\_node}) \{
2227         \textcolor{keywordtype}{int} i;
2228 
2229         \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{datapath_8h_ac1bf9805d62227b8f76f130087e18018}{DP\_VPORT\_HASH\_BUCKETS}; i++) \{
2230             \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport};
2231 
2232             \hyperlink{list_8h_a3782c1eea66f5cacadce6e0175e4650a}{hlist\_for\_each\_entry}(vport, &dp->\hyperlink{structdatapath_abb0de528545b312de283b571cb6c4ede}{ports}[i], 
      \hyperlink{structvport_a27d2c94e2edd5de172e0b866cdd70fea}{dp\_hash\_node}) \{
2233                 \textcolor{keyword}{struct }\hyperlink{structnetdev__vport}{netdev\_vport} *\hyperlink{structnetdev__vport}{netdev\_vport};
2234 
2235                 \textcolor{keywordflow}{if} (vport->\hyperlink{structvport_a5af933fc664c1194ac3bbc337da35586}{ops}->\hyperlink{structvport__ops_a7dd0d3776e78a2885063d3afd5e78148}{type} != \hyperlink{openvswitch_8h_a9a1b861aa99bd83177a2b10b34745b0aa99034286803fd0adf04dde0fa7e69f00}{OVS\_VPORT\_TYPE\_INTERNAL})
2236                     \textcolor{keywordflow}{continue};
2237 
2238                 netdev\_vport = \hyperlink{vport-netdev_8h_a2cb441c6cf067ce3c79cb43836e9fc55}{netdev\_vport\_priv}(vport);
2239                 \textcolor{keywordflow}{if} (dev\_net(netdev\_vport->\hyperlink{structnetdev__vport_acf4ee248f7385e2f987fd2736f824ca9}{dev}) == dnet)
2240                     list\_add(&vport->\hyperlink{structvport_ae41f659d10b0f1c27324e9406d5c2ef1}{detach\_list}, head);
2241             \}
2242         \}
2243     \}
2244 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a774dc1bd6a39e68ebac48e55688a8574}{}\index{datapath.\+c@{datapath.\+c}!lookup\+\_\+datapath@{lookup\+\_\+datapath}}
\index{lookup\+\_\+datapath@{lookup\+\_\+datapath}!datapath.\+c@{datapath.\+c}}
\subsubsection[{lookup\+\_\+datapath}]{\setlength{\rightskip}{0pt plus 5cm}static struct {\bf datapath}$\ast$ lookup\+\_\+datapath (
\begin{DoxyParamCaption}
\item[{struct net $\ast$}]{net, }
\item[{const struct {\bf ovs\+\_\+header} $\ast$}]{ovs\+\_\+header, }
\item[{struct nlattr $\ast$}]{a\mbox{[}\+O\+V\+S\+\_\+\+D\+P\+\_\+\+A\+T\+T\+R\+\_\+\+M\+A\+X+1\mbox{]}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a774dc1bd6a39e68ebac48e55688a8574}

\begin{DoxyCode}
1475 \{
1476     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
1477 
1478     \textcolor{keywordflow}{if} (!a[\hyperlink{openvswitch_8h_a6ebc7cf092971c117649bbb97f9b9ae7a4a2ac3c4a891b957f1788c0c9ebb736d}{OVS\_DP\_ATTR\_NAME}])
1479         dp = \hyperlink{datapath_8c_a1107d4fd386aa6551511140b5405e1d3}{get\_dp}(net, ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex});
1480     \textcolor{keywordflow}{else} \{
1481         \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport};
1482 
1483         vport = \hyperlink{linux_2vport_8c_a6982e9b904201400a516a90502cdb70d}{ovs\_vport\_locate}(net, nla\_data(a[OVS\_DP\_ATTR\_NAME]));
1484         dp = vport && vport->\hyperlink{structvport_aae00fc5d12b47f02cbfd4f67ae114b58}{port\_no} == \hyperlink{openvswitch_8h_aff2f13b95c27262c520f26831e647598}{OVSP\_LOCAL} ? vport->\hyperlink{structvport_a49fb6f6bf0ac4337853e9242e88ddc42}{dp} : NULL;
1485     \}
1486     \textcolor{keywordflow}{return} dp ? dp : ERR\_PTR(-ENODEV);
1487 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a95b019fd3980803dcc1bb5aca920f58b}{}\index{datapath.\+c@{datapath.\+c}!lookup\+\_\+vport@{lookup\+\_\+vport}}
\index{lookup\+\_\+vport@{lookup\+\_\+vport}!datapath.\+c@{datapath.\+c}}
\subsubsection[{lookup\+\_\+vport}]{\setlength{\rightskip}{0pt plus 5cm}static struct {\bf vport}$\ast$ lookup\+\_\+vport (
\begin{DoxyParamCaption}
\item[{struct net $\ast$}]{net, }
\item[{const struct {\bf ovs\+\_\+header} $\ast$}]{ovs\+\_\+header, }
\item[{struct nlattr $\ast$}]{a\mbox{[}\+O\+V\+S\+\_\+\+V\+P\+O\+R\+T\+\_\+\+A\+T\+T\+R\+\_\+\+M\+A\+X+1\mbox{]}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a95b019fd3980803dcc1bb5aca920f58b}

\begin{DoxyCode}
1866 \{
1867     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
1868     \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport};
1869 
1870     \textcolor{keywordflow}{if} (a[\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464daef39b12d8a0cb39f2248d82f435bec3c}{OVS\_VPORT\_ATTR\_NAME}]) \{
1871         vport = \hyperlink{linux_2vport_8c_a6982e9b904201400a516a90502cdb70d}{ovs\_vport\_locate}(net, nla\_data(a[OVS\_VPORT\_ATTR\_NAME]));
1872         \textcolor{keywordflow}{if} (!vport)
1873             \textcolor{keywordflow}{return} ERR\_PTR(-ENODEV);
1874         \textcolor{keywordflow}{if} (ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex} &&
1875             ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex} != \hyperlink{datapath_8c_a2c4c60ba176a755749744f7b01aa6edd}{get\_dpifindex}(vport->
      \hyperlink{structvport_a49fb6f6bf0ac4337853e9242e88ddc42}{dp}))
1876             \textcolor{keywordflow}{return} ERR\_PTR(-ENODEV);
1877         \textcolor{keywordflow}{return} vport;
1878     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (a[\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464da08e4cd652a0f6cd6eeeaac1db3bdf503}{OVS\_VPORT\_ATTR\_PORT\_NO}]) \{
1879         u32 \hyperlink{structvport_aae00fc5d12b47f02cbfd4f67ae114b58}{port\_no} = nla\_get\_u32(a[OVS\_VPORT\_ATTR\_PORT\_NO]);
1880 
1881         \textcolor{keywordflow}{if} (port\_no >= \hyperlink{datapath_8h_a73b117dd1ebe456eecfb7688047a03f1}{DP\_MAX\_PORTS})
1882             \textcolor{keywordflow}{return} ERR\_PTR(-EFBIG);
1883 
1884         dp = \hyperlink{datapath_8c_a1107d4fd386aa6551511140b5405e1d3}{get\_dp}(net, ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex});
1885         \textcolor{keywordflow}{if} (!dp)
1886             \textcolor{keywordflow}{return} ERR\_PTR(-ENODEV);
1887 
1888         vport = \hyperlink{datapath_8h_a33d8540a1f2484576cfa52366828fcfc}{ovs\_vport\_ovsl\_rcu}(dp, port\_no);
1889         \textcolor{keywordflow}{if} (!vport)
1890             \textcolor{keywordflow}{return} ERR\_PTR(-ENODEV);
1891         \textcolor{keywordflow}{return} vport;
1892     \} \textcolor{keywordflow}{else}
1893         \textcolor{keywordflow}{return} ERR\_PTR(-EINVAL);
1894 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a375185aea6f89fbd06af3e43f39d2975}{}\index{datapath.\+c@{datapath.\+c}!M\+O\+D\+U\+L\+E\+\_\+\+D\+E\+S\+C\+R\+I\+P\+T\+I\+O\+N@{M\+O\+D\+U\+L\+E\+\_\+\+D\+E\+S\+C\+R\+I\+P\+T\+I\+O\+N}}
\index{M\+O\+D\+U\+L\+E\+\_\+\+D\+E\+S\+C\+R\+I\+P\+T\+I\+O\+N@{M\+O\+D\+U\+L\+E\+\_\+\+D\+E\+S\+C\+R\+I\+P\+T\+I\+O\+N}!datapath.\+c@{datapath.\+c}}
\subsubsection[{M\+O\+D\+U\+L\+E\+\_\+\+D\+E\+S\+C\+R\+I\+P\+T\+I\+O\+N}]{\setlength{\rightskip}{0pt plus 5cm}M\+O\+D\+U\+L\+E\+\_\+\+D\+E\+S\+C\+R\+I\+P\+T\+I\+O\+N (
\begin{DoxyParamCaption}
\item[{\char`\"{}Open v\+Switch switching {\bf datapath}\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{datapath_8c_a375185aea6f89fbd06af3e43f39d2975}
\hypertarget{datapath_8c_afefe140861ac8adc338b486bf95f710f}{}\index{datapath.\+c@{datapath.\+c}!module\+\_\+exit@{module\+\_\+exit}}
\index{module\+\_\+exit@{module\+\_\+exit}!datapath.\+c@{datapath.\+c}}
\subsubsection[{module\+\_\+exit}]{\setlength{\rightskip}{0pt plus 5cm}module\+\_\+exit (
\begin{DoxyParamCaption}
\item[{{\bf dp\+\_\+cleanup}}]{}
\end{DoxyParamCaption}
)}\label{datapath_8c_afefe140861ac8adc338b486bf95f710f}
\hypertarget{datapath_8c_a61981f8b771cdb3f88315f3da5f4fe18}{}\index{datapath.\+c@{datapath.\+c}!module\+\_\+init@{module\+\_\+init}}
\index{module\+\_\+init@{module\+\_\+init}!datapath.\+c@{datapath.\+c}}
\subsubsection[{module\+\_\+init}]{\setlength{\rightskip}{0pt plus 5cm}module\+\_\+init (
\begin{DoxyParamCaption}
\item[{{\bf dp\+\_\+init}}]{}
\end{DoxyParamCaption}
)}\label{datapath_8c_a61981f8b771cdb3f88315f3da5f4fe18}
\hypertarget{datapath_8c_ad94b36675e7eb067ea3ce6ff9e244a44}{}\index{datapath.\+c@{datapath.\+c}!M\+O\+D\+U\+L\+E\+\_\+\+L\+I\+C\+E\+N\+S\+E@{M\+O\+D\+U\+L\+E\+\_\+\+L\+I\+C\+E\+N\+S\+E}}
\index{M\+O\+D\+U\+L\+E\+\_\+\+L\+I\+C\+E\+N\+S\+E@{M\+O\+D\+U\+L\+E\+\_\+\+L\+I\+C\+E\+N\+S\+E}!datapath.\+c@{datapath.\+c}}
\subsubsection[{M\+O\+D\+U\+L\+E\+\_\+\+L\+I\+C\+E\+N\+S\+E}]{\setlength{\rightskip}{0pt plus 5cm}M\+O\+D\+U\+L\+E\+\_\+\+L\+I\+C\+E\+N\+S\+E (
\begin{DoxyParamCaption}
\item[{\char`\"{}G\+P\+L\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{datapath_8c_ad94b36675e7eb067ea3ce6ff9e244a44}
\hypertarget{datapath_8c_ada33d5db5abb99d420d4b6d82ea237c4}{}\index{datapath.\+c@{datapath.\+c}!M\+O\+D\+U\+L\+E\+\_\+\+V\+E\+R\+S\+I\+O\+N@{M\+O\+D\+U\+L\+E\+\_\+\+V\+E\+R\+S\+I\+O\+N}}
\index{M\+O\+D\+U\+L\+E\+\_\+\+V\+E\+R\+S\+I\+O\+N@{M\+O\+D\+U\+L\+E\+\_\+\+V\+E\+R\+S\+I\+O\+N}!datapath.\+c@{datapath.\+c}}
\subsubsection[{M\+O\+D\+U\+L\+E\+\_\+\+V\+E\+R\+S\+I\+O\+N}]{\setlength{\rightskip}{0pt plus 5cm}M\+O\+D\+U\+L\+E\+\_\+\+V\+E\+R\+S\+I\+O\+N (
\begin{DoxyParamCaption}
\item[{V\+E\+R\+S\+I\+O\+N}]{}
\end{DoxyParamCaption}
)}\label{datapath_8c_ada33d5db5abb99d420d4b6d82ea237c4}
\hypertarget{datapath_8c_afac95a3e755fe3b0906ccc72d052cbe1}{}\index{datapath.\+c@{datapath.\+c}!new\+\_\+vport@{new\+\_\+vport}}
\index{new\+\_\+vport@{new\+\_\+vport}!datapath.\+c@{datapath.\+c}}
\subsubsection[{new\+\_\+vport}]{\setlength{\rightskip}{0pt plus 5cm}static struct {\bf vport}$\ast$ new\+\_\+vport (
\begin{DoxyParamCaption}
\item[{const struct {\bf vport\+\_\+parms} $\ast$}]{parms}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_afac95a3e755fe3b0906ccc72d052cbe1}

\begin{DoxyCode}
235 \{
236     \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport};
237 
238     vport = \hyperlink{linux_2vport_8c_ae922e6de985b3cb78f3d8f470a2e6ff9}{ovs\_vport\_add}(parms);
239     \textcolor{keywordflow}{if} (!IS\_ERR(vport)) \{
240         \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp = parms->\hyperlink{structvport__parms_a15faa866e3d35a721de77b347017499e}{dp};
241         \textcolor{keyword}{struct }hlist\_head *head = \hyperlink{datapath_8c_af291a723340e4e1bd38b4b14e7f4377a}{vport\_hash\_bucket}(dp, vport->
      \hyperlink{structvport_aae00fc5d12b47f02cbfd4f67ae114b58}{port\_no});
242 
243         hlist\_add\_head\_rcu(&vport->\hyperlink{structvport_a27d2c94e2edd5de172e0b866cdd70fea}{dp\_hash\_node}, head);
244     \}
245     \textcolor{keywordflow}{return} vport;
246 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a2c763b1da99cce1a426140794eaf8f03}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+change@{ovs\+\_\+dp\+\_\+change}}
\index{ovs\+\_\+dp\+\_\+change@{ovs\+\_\+dp\+\_\+change}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+change}]{\setlength{\rightskip}{0pt plus 5cm}static void ovs\+\_\+dp\+\_\+change (
\begin{DoxyParamCaption}
\item[{struct {\bf datapath} $\ast$}]{dp, }
\item[{struct nlattr $\ast$}]{a\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a2c763b1da99cce1a426140794eaf8f03}

\begin{DoxyCode}
1502 \{
1503     \textcolor{keywordflow}{if} (a[\hyperlink{openvswitch_8h_a6ebc7cf092971c117649bbb97f9b9ae7a40ebfa9b92707b878c6d32c889537b32}{OVS\_DP\_ATTR\_USER\_FEATURES}])
1504         dp->\hyperlink{structdatapath_a92ce3b704c20f18b3a696f98b6f7d266}{user\_features} = nla\_get\_u32(a[OVS\_DP\_ATTR\_USER\_FEATURES]);
1505 \}
\end{DoxyCode}
\hypertarget{datapath_8c_ad01db8513d30c057f1ea10532ebc8b1e}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+cmd\+\_\+alloc\+\_\+info@{ovs\+\_\+dp\+\_\+cmd\+\_\+alloc\+\_\+info}}
\index{ovs\+\_\+dp\+\_\+cmd\+\_\+alloc\+\_\+info@{ovs\+\_\+dp\+\_\+cmd\+\_\+alloc\+\_\+info}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+cmd\+\_\+alloc\+\_\+info}]{\setlength{\rightskip}{0pt plus 5cm}static struct sk\+\_\+buff$\ast$ ovs\+\_\+dp\+\_\+cmd\+\_\+alloc\+\_\+info (
\begin{DoxyParamCaption}
\item[{struct genl\+\_\+info $\ast$}]{info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_ad01db8513d30c057f1ea10532ebc8b1e}

\begin{DoxyCode}
1467 \{
1468     \textcolor{keywordflow}{return} \hyperlink{genetlink_8h_a004898a56e34b42638510826a4757ab5}{genlmsg\_new\_unicast}(\hyperlink{datapath_8c_aab015cdb7b4e0d2fa66da1b72963df67}{ovs\_dp\_cmd\_msg\_size}(), info, 
      GFP\_KERNEL);
1469 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a580bc462589253144c5027fa18fbfb17}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+cmd\+\_\+del@{ovs\+\_\+dp\+\_\+cmd\+\_\+del}}
\index{ovs\+\_\+dp\+\_\+cmd\+\_\+del@{ovs\+\_\+dp\+\_\+cmd\+\_\+del}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+cmd\+\_\+del}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+dp\+\_\+cmd\+\_\+del (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct genl\+\_\+info $\ast$}]{info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a580bc462589253144c5027fa18fbfb17}

\begin{DoxyCode}
1638 \{
1639     \textcolor{keyword}{struct }sk\_buff *reply;
1640     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
1641     \textcolor{keywordtype}{int} err;
1642 
1643     reply = \hyperlink{datapath_8c_ad01db8513d30c057f1ea10532ebc8b1e}{ovs\_dp\_cmd\_alloc\_info}(info);
1644     \textcolor{keywordflow}{if} (!reply)
1645         \textcolor{keywordflow}{return} -ENOMEM;
1646 
1647     \hyperlink{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}{ovs\_lock}();
1648     dp = \hyperlink{datapath_8c_a774dc1bd6a39e68ebac48e55688a8574}{lookup\_datapath}(sock\_net(skb->sk), info->userhdr, info->attrs);
1649     err = PTR\_ERR(dp);
1650     \textcolor{keywordflow}{if} (IS\_ERR(dp))
1651         \textcolor{keywordflow}{goto} err\_unlock\_free;
1652 
1653     err = \hyperlink{datapath_8c_a0c18d2b438aba3739c2a36e172cfe3ea}{ovs\_dp\_cmd\_fill\_info}(dp, reply, info->snd\_portid,
1654                    info->snd\_seq, 0, \hyperlink{openvswitch_8h_aa8ba551904bd37a482265422ae718fbda185ce13c521cefbceee31b2f7c8bc3dc}{OVS\_DP\_CMD\_DEL});
1655     BUG\_ON(err < 0);
1656 
1657     \hyperlink{datapath_8c_a6c66e1332f2a95e9510e37745d77bad1}{\_\_dp\_destroy}(dp);
1658     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1659 
1660     \hyperlink{datapath_8c_a67f527ad1164ff0d67fe854584ced567}{ovs\_notify}(&\hyperlink{datapath_8c_a00b4c28b2a15cad709af53b6484fc45c}{dp\_datapath\_genl\_family}, &
      \hyperlink{datapath_8c_afa5d1f090aee506896ff5ef56b4053e1}{ovs\_dp\_datapath\_multicast\_group}, reply, info);
1661     \textcolor{keywordflow}{return} 0;
1662 
1663 err\_unlock\_free:
1664     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1665     kfree\_skb(reply);
1666     \textcolor{keywordflow}{return} err;
1667 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a64056132bb398b3e7c92291cc6905537}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+cmd\+\_\+dump@{ovs\+\_\+dp\+\_\+cmd\+\_\+dump}}
\index{ovs\+\_\+dp\+\_\+cmd\+\_\+dump@{ovs\+\_\+dp\+\_\+cmd\+\_\+dump}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+cmd\+\_\+dump}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+dp\+\_\+cmd\+\_\+dump (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct netlink\+\_\+callback $\ast$}]{cb}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a64056132bb398b3e7c92291cc6905537}

\begin{DoxyCode}
1732 \{
1733     \textcolor{keyword}{struct }\hyperlink{structovs__net}{ovs\_net} *\hyperlink{structovs__net}{ovs\_net} = net\_generic(sock\_net(skb->sk), 
      \hyperlink{datapath_8h_ace140298dc2b59b3d77d59c0a210de29}{ovs\_net\_id});
1734     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
1735     \textcolor{keywordtype}{int} skip = cb->args[0];
1736     \textcolor{keywordtype}{int} i = 0;
1737 
1738     \hyperlink{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}{ovs\_lock}();
1739     list\_for\_each\_entry(dp, &ovs\_net->\hyperlink{structovs__net_a0490101f7ea82f5c290a92d447bd8f9d}{dps}, \hyperlink{structdatapath_ac5f44be07025a2addb5c393fba822000}{list\_node}) \{
1740         \textcolor{keywordflow}{if} (i >= skip &&
1741             \hyperlink{datapath_8c_a0c18d2b438aba3739c2a36e172cfe3ea}{ovs\_dp\_cmd\_fill\_info}(dp, skb, NETLINK\_CB(cb->skb).portid,
1742                      cb->nlh->nlmsg\_seq, NLM\_F\_MULTI,
1743                      \hyperlink{openvswitch_8h_aa8ba551904bd37a482265422ae718fbdabde26912980136dc563e8918e2d90334}{OVS\_DP\_CMD\_NEW}) < 0)
1744             \textcolor{keywordflow}{break};
1745         i++;
1746     \}
1747     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1748 
1749     cb->args[0] = i;
1750 
1751     \textcolor{keywordflow}{return} skb->len;
1752 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a0c18d2b438aba3739c2a36e172cfe3ea}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+cmd\+\_\+fill\+\_\+info@{ovs\+\_\+dp\+\_\+cmd\+\_\+fill\+\_\+info}}
\index{ovs\+\_\+dp\+\_\+cmd\+\_\+fill\+\_\+info@{ovs\+\_\+dp\+\_\+cmd\+\_\+fill\+\_\+info}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+cmd\+\_\+fill\+\_\+info}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+dp\+\_\+cmd\+\_\+fill\+\_\+info (
\begin{DoxyParamCaption}
\item[{struct {\bf datapath} $\ast$}]{dp, }
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{u32}]{portid, }
\item[{u32}]{seq, }
\item[{u32}]{flags, }
\item[{u8}]{cmd}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a0c18d2b438aba3739c2a36e172cfe3ea}

\begin{DoxyCode}
1427 \{
1428     \textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header} *\hyperlink{structovs__header}{ovs\_header};
1429     \textcolor{keyword}{struct }\hyperlink{structovs__dp__stats}{ovs\_dp\_stats} dp\_stats;
1430     \textcolor{keyword}{struct }\hyperlink{structovs__dp__megaflow__stats}{ovs\_dp\_megaflow\_stats} dp\_megaflow\_stats;
1431     \textcolor{keywordtype}{int} err;
1432 
1433     ovs\_header = \hyperlink{genetlink_8h_a306fd8e0093b286af42dfce236aeb096}{genlmsg\_put}(skb, portid, seq, &
      \hyperlink{datapath_8c_a00b4c28b2a15cad709af53b6484fc45c}{dp\_datapath\_genl\_family},
1434                    \hyperlink{flow_8h_af4f7a53f6b2df72c34ca881f2714ac91}{flags}, cmd);
1435     \textcolor{keywordflow}{if} (!ovs\_header)
1436         \textcolor{keywordflow}{goto} error;
1437 
1438     ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex} = \hyperlink{datapath_8c_a2c4c60ba176a755749744f7b01aa6edd}{get\_dpifindex}(dp);
1439 
1440     err = nla\_put\_string(skb, \hyperlink{openvswitch_8h_a6ebc7cf092971c117649bbb97f9b9ae7a4a2ac3c4a891b957f1788c0c9ebb736d}{OVS\_DP\_ATTR\_NAME}, \hyperlink{datapath_8c_a6a23196916bb5de4994f901bdf1aba2d}{ovs\_dp\_name}(dp));
1441     \textcolor{keywordflow}{if} (err)
1442         \textcolor{keywordflow}{goto} nla\_put\_failure;
1443 
1444     \hyperlink{datapath_8c_a689a2b3c19c9cdebecfb266acf5ba221}{get\_dp\_stats}(dp, &dp\_stats, &dp\_megaflow\_stats);
1445     \textcolor{keywordflow}{if} (nla\_put(skb, \hyperlink{openvswitch_8h_a6ebc7cf092971c117649bbb97f9b9ae7a87d0c639500ec7bf5f901ef8ea8a3e88}{OVS\_DP\_ATTR\_STATS}, \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} 
      \hyperlink{structovs__dp__stats}{ovs\_dp\_stats}),
1446             &dp\_stats))
1447         \textcolor{keywordflow}{goto} nla\_put\_failure;
1448 
1449     \textcolor{keywordflow}{if} (nla\_put(skb, \hyperlink{openvswitch_8h_a6ebc7cf092971c117649bbb97f9b9ae7a910e55b5d883ea8b793b89473e48d667}{OVS\_DP\_ATTR\_MEGAFLOW\_STATS},
1450             \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structovs__dp__megaflow__stats}{ovs\_dp\_megaflow\_stats}),
1451             &dp\_megaflow\_stats))
1452         \textcolor{keywordflow}{goto} nla\_put\_failure;
1453 
1454     \textcolor{keywordflow}{if} (nla\_put\_u32(skb, \hyperlink{openvswitch_8h_a6ebc7cf092971c117649bbb97f9b9ae7a40ebfa9b92707b878c6d32c889537b32}{OVS\_DP\_ATTR\_USER\_FEATURES}, dp->
      \hyperlink{structdatapath_a92ce3b704c20f18b3a696f98b6f7d266}{user\_features}))
1455         \textcolor{keywordflow}{goto} nla\_put\_failure;
1456 
1457     genlmsg\_end(skb, ovs\_header);
1458     \textcolor{keywordflow}{return} 0;
1459 
1460 nla\_put\_failure:
1461     genlmsg\_cancel(skb, ovs\_header);
1462 error:
1463     \textcolor{keywordflow}{return} -EMSGSIZE;
1464 \}
\end{DoxyCode}
\hypertarget{datapath_8c_ab253bc3f01b9d70955d3d3dcfc236b9f}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+cmd\+\_\+get@{ovs\+\_\+dp\+\_\+cmd\+\_\+get}}
\index{ovs\+\_\+dp\+\_\+cmd\+\_\+get@{ovs\+\_\+dp\+\_\+cmd\+\_\+get}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+cmd\+\_\+get}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+dp\+\_\+cmd\+\_\+get (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct genl\+\_\+info $\ast$}]{info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_ab253bc3f01b9d70955d3d3dcfc236b9f}

\begin{DoxyCode}
1703 \{
1704     \textcolor{keyword}{struct }sk\_buff *reply;
1705     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
1706     \textcolor{keywordtype}{int} err;
1707 
1708     reply = \hyperlink{datapath_8c_ad01db8513d30c057f1ea10532ebc8b1e}{ovs\_dp\_cmd\_alloc\_info}(info);
1709     \textcolor{keywordflow}{if} (!reply)
1710         \textcolor{keywordflow}{return} -ENOMEM;
1711 
1712     \hyperlink{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}{ovs\_lock}();
1713     dp = \hyperlink{datapath_8c_a774dc1bd6a39e68ebac48e55688a8574}{lookup\_datapath}(sock\_net(skb->sk), info->userhdr, info->attrs);
1714     \textcolor{keywordflow}{if} (IS\_ERR(dp)) \{
1715         err = PTR\_ERR(dp);
1716         \textcolor{keywordflow}{goto} err\_unlock\_free;
1717     \}
1718     err = \hyperlink{datapath_8c_a0c18d2b438aba3739c2a36e172cfe3ea}{ovs\_dp\_cmd\_fill\_info}(dp, reply, info->snd\_portid,
1719                    info->snd\_seq, 0, \hyperlink{openvswitch_8h_aa8ba551904bd37a482265422ae718fbdabde26912980136dc563e8918e2d90334}{OVS\_DP\_CMD\_NEW});
1720     BUG\_ON(err < 0);
1721     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1722 
1723     \textcolor{keywordflow}{return} genlmsg\_reply(reply, info);
1724 
1725 err\_unlock\_free:
1726     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1727     kfree\_skb(reply);
1728     \textcolor{keywordflow}{return} err;
1729 \}
\end{DoxyCode}
\hypertarget{datapath_8c_aab015cdb7b4e0d2fa66da1b72963df67}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+cmd\+\_\+msg\+\_\+size@{ovs\+\_\+dp\+\_\+cmd\+\_\+msg\+\_\+size}}
\index{ovs\+\_\+dp\+\_\+cmd\+\_\+msg\+\_\+size@{ovs\+\_\+dp\+\_\+cmd\+\_\+msg\+\_\+size}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+cmd\+\_\+msg\+\_\+size}]{\setlength{\rightskip}{0pt plus 5cm}static size\+\_\+t ovs\+\_\+dp\+\_\+cmd\+\_\+msg\+\_\+size (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_aab015cdb7b4e0d2fa66da1b72963df67}

\begin{DoxyCode}
1413 \{
1414     \textcolor{keywordtype}{size\_t} msgsize = NLMSG\_ALIGN(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structovs__header}{ovs\_header}));
1415 
1416     msgsize += nla\_total\_size(IFNAMSIZ);
1417     msgsize += nla\_total\_size(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structovs__dp__stats}{ovs\_dp\_stats}));
1418     msgsize += nla\_total\_size(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structovs__dp__megaflow__stats}{ovs\_dp\_megaflow\_stats}));
1419     msgsize += nla\_total\_size(\textcolor{keyword}{sizeof}(u32)); \textcolor{comment}{/* OVS\_DP\_ATTR\_USER\_FEATURES */}
1420 
1421     \textcolor{keywordflow}{return} msgsize;
1422 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a8d012b2863686706ab9d1282a82d6625}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+cmd\+\_\+new@{ovs\+\_\+dp\+\_\+cmd\+\_\+new}}
\index{ovs\+\_\+dp\+\_\+cmd\+\_\+new@{ovs\+\_\+dp\+\_\+cmd\+\_\+new}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+cmd\+\_\+new}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+dp\+\_\+cmd\+\_\+new (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct genl\+\_\+info $\ast$}]{info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a8d012b2863686706ab9d1282a82d6625}

\begin{DoxyCode}
1508 \{
1509     \textcolor{keyword}{struct }nlattr **a = info->attrs;
1510     \textcolor{keyword}{struct }\hyperlink{structvport__parms}{vport\_parms} parms;
1511     \textcolor{keyword}{struct }sk\_buff *reply;
1512     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
1513     \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport};
1514     \textcolor{keyword}{struct }\hyperlink{structovs__net}{ovs\_net} *\hyperlink{structovs__net}{ovs\_net};
1515     \textcolor{keywordtype}{int} err, i;
1516 
1517     err = -EINVAL;
1518     \textcolor{keywordflow}{if} (!a[\hyperlink{openvswitch_8h_a6ebc7cf092971c117649bbb97f9b9ae7a4a2ac3c4a891b957f1788c0c9ebb736d}{OVS\_DP\_ATTR\_NAME}] || !a[\hyperlink{openvswitch_8h_a6ebc7cf092971c117649bbb97f9b9ae7a1f5b964b750d20b64d4f9c68fd39908a}{OVS\_DP\_ATTR\_UPCALL\_PID}])
1519         \textcolor{keywordflow}{goto} err;
1520 
1521     reply = \hyperlink{datapath_8c_ad01db8513d30c057f1ea10532ebc8b1e}{ovs\_dp\_cmd\_alloc\_info}(info);
1522     \textcolor{keywordflow}{if} (!reply)
1523         \textcolor{keywordflow}{return} -ENOMEM;
1524 
1525     err = -ENOMEM;
1526     dp = kzalloc(\textcolor{keyword}{sizeof}(*dp), GFP\_KERNEL);
1527     \textcolor{keywordflow}{if} (dp == NULL)
1528         \textcolor{keywordflow}{goto} err\_free\_reply;
1529 
1530     \hyperlink{datapath_8h_af2973d12bb9f33d8e86d2fcad4dc7319}{ovs\_dp\_set\_net}(dp, hold\_net(sock\_net(skb->sk)));
1531 
1532     \textcolor{comment}{/* Allocate table. */}
1533     err = \hyperlink{flow__table_8c_a0df1c5a76810e541b43248c402d764ff}{ovs\_flow\_tbl\_init}(&dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table});
1534     \textcolor{keywordflow}{if} (err)
1535         \textcolor{keywordflow}{goto} err\_free\_dp;
1536 
1537     dp->\hyperlink{structdatapath_a26ff295c711206c8177cdc89150c6a4a}{stats\_percpu} = \hyperlink{netdevice_8h_ac860eb13284bc990b8da39516ec6d4b4}{netdev\_alloc\_pcpu\_stats}(\textcolor{keyword}{struct} 
      \hyperlink{structdp__stats__percpu}{dp\_stats\_percpu});
1538     \textcolor{keywordflow}{if} (!dp->\hyperlink{structdatapath_a26ff295c711206c8177cdc89150c6a4a}{stats\_percpu}) \{
1539         err = -ENOMEM;
1540         \textcolor{keywordflow}{goto} err\_destroy\_table;
1541     \}
1542 
1543     dp->\hyperlink{structdatapath_abb0de528545b312de283b571cb6c4ede}{ports} = kmalloc(\hyperlink{datapath_8h_ac1bf9805d62227b8f76f130087e18018}{DP\_VPORT\_HASH\_BUCKETS} * \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} hlist\_head),
1544                 GFP\_KERNEL);
1545     \textcolor{keywordflow}{if} (!dp->\hyperlink{structdatapath_abb0de528545b312de283b571cb6c4ede}{ports}) \{
1546         err = -ENOMEM;
1547         \textcolor{keywordflow}{goto} err\_destroy\_percpu;
1548     \}
1549 
1550     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{datapath_8h_ac1bf9805d62227b8f76f130087e18018}{DP\_VPORT\_HASH\_BUCKETS}; i++)
1551         INIT\_HLIST\_HEAD(&dp->\hyperlink{structdatapath_abb0de528545b312de283b571cb6c4ede}{ports}[i]);
1552 
1553     \textcolor{comment}{/* Set up our datapath device. */}
1554     parms.name = nla\_data(a[\hyperlink{openvswitch_8h_a6ebc7cf092971c117649bbb97f9b9ae7a4a2ac3c4a891b957f1788c0c9ebb736d}{OVS\_DP\_ATTR\_NAME}]);
1555     parms.type = \hyperlink{openvswitch_8h_a9a1b861aa99bd83177a2b10b34745b0aa99034286803fd0adf04dde0fa7e69f00}{OVS\_VPORT\_TYPE\_INTERNAL};
1556     parms.options = NULL;
1557     parms.dp = dp;
1558     parms.port\_no = \hyperlink{openvswitch_8h_aff2f13b95c27262c520f26831e647598}{OVSP\_LOCAL};
1559     parms.upcall\_portids = a[\hyperlink{openvswitch_8h_a6ebc7cf092971c117649bbb97f9b9ae7a1f5b964b750d20b64d4f9c68fd39908a}{OVS\_DP\_ATTR\_UPCALL\_PID}];
1560 
1561     \hyperlink{datapath_8c_a2c763b1da99cce1a426140794eaf8f03}{ovs\_dp\_change}(dp, a);
1562 
1563     \textcolor{comment}{/* So far only local changes have been made, now need the lock. */}
1564     \hyperlink{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}{ovs\_lock}();
1565 
1566     vport = \hyperlink{datapath_8c_afac95a3e755fe3b0906ccc72d052cbe1}{new\_vport}(&parms);
1567     \textcolor{keywordflow}{if} (IS\_ERR(vport)) \{
1568         err = PTR\_ERR(vport);
1569         \textcolor{keywordflow}{if} (err == -EBUSY)
1570             err = -EEXIST;
1571 
1572         \textcolor{keywordflow}{if} (err == -EEXIST) \{
1573             \textcolor{comment}{/* An outdated user space instance that does not understand}
1574 \textcolor{comment}{             * the concept of user\_features has attempted to create a new}
1575 \textcolor{comment}{             * datapath and is likely to reuse it. Drop all user features.}
1576 \textcolor{comment}{             */}
1577             \textcolor{keywordflow}{if} (info->genlhdr->version < \hyperlink{openvswitch_8h_a354833a50dbfe8e654f3c6f8c3686874}{OVS\_DP\_VER\_FEATURES})
1578                 \hyperlink{datapath_8c_aba7a59d6ae252953be557d7478f7332f}{ovs\_dp\_reset\_user\_features}(skb, info);
1579         \}
1580 
1581         \textcolor{keywordflow}{goto} err\_destroy\_ports\_array;
1582     \}
1583 
1584     err = \hyperlink{datapath_8c_a0c18d2b438aba3739c2a36e172cfe3ea}{ovs\_dp\_cmd\_fill\_info}(dp, reply, info->snd\_portid,
1585                    info->snd\_seq, 0, \hyperlink{openvswitch_8h_aa8ba551904bd37a482265422ae718fbdabde26912980136dc563e8918e2d90334}{OVS\_DP\_CMD\_NEW});
1586     BUG\_ON(err < 0);
1587 
1588     ovs\_net = net\_generic(\hyperlink{datapath_8h_aef2302004ca1f45133eaef00bb3740eb}{ovs\_dp\_get\_net}(dp), \hyperlink{datapath_8h_ace140298dc2b59b3d77d59c0a210de29}{ovs\_net\_id});
1589     list\_add\_tail\_rcu(&dp->\hyperlink{structdatapath_ac5f44be07025a2addb5c393fba822000}{list\_node}, &ovs\_net->\hyperlink{structovs__net_a0490101f7ea82f5c290a92d447bd8f9d}{dps});
1590 
1591     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1592 
1593     \hyperlink{datapath_8c_a67f527ad1164ff0d67fe854584ced567}{ovs\_notify}(&\hyperlink{datapath_8c_a00b4c28b2a15cad709af53b6484fc45c}{dp\_datapath\_genl\_family}, &
      \hyperlink{datapath_8c_afa5d1f090aee506896ff5ef56b4053e1}{ovs\_dp\_datapath\_multicast\_group}, reply, info);
1594     \textcolor{keywordflow}{return} 0;
1595 
1596 err\_destroy\_ports\_array:
1597     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1598     kfree(dp->\hyperlink{structdatapath_abb0de528545b312de283b571cb6c4ede}{ports});
1599 err\_destroy\_percpu:
1600     free\_percpu(dp->\hyperlink{structdatapath_a26ff295c711206c8177cdc89150c6a4a}{stats\_percpu});
1601 err\_destroy\_table:
1602     \hyperlink{flow__table_8c_ad37dcfdb56d17589ed79b5c4dd38bc76}{ovs\_flow\_tbl\_destroy}(&dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table});
1603 err\_free\_dp:
1604     release\_net(\hyperlink{datapath_8h_aef2302004ca1f45133eaef00bb3740eb}{ovs\_dp\_get\_net}(dp));
1605     kfree(dp);
1606 err\_free\_reply:
1607     kfree\_skb(reply);
1608 err:
1609     \textcolor{keywordflow}{return} err;
1610 \}
\end{DoxyCode}
\hypertarget{datapath_8c_aa59555f8c6107137945c90e92fd42b4c}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+cmd\+\_\+set@{ovs\+\_\+dp\+\_\+cmd\+\_\+set}}
\index{ovs\+\_\+dp\+\_\+cmd\+\_\+set@{ovs\+\_\+dp\+\_\+cmd\+\_\+set}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+cmd\+\_\+set}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+dp\+\_\+cmd\+\_\+set (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct genl\+\_\+info $\ast$}]{info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_aa59555f8c6107137945c90e92fd42b4c}

\begin{DoxyCode}
1670 \{
1671     \textcolor{keyword}{struct }sk\_buff *reply;
1672     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
1673     \textcolor{keywordtype}{int} err;
1674 
1675     reply = \hyperlink{datapath_8c_ad01db8513d30c057f1ea10532ebc8b1e}{ovs\_dp\_cmd\_alloc\_info}(info);
1676     \textcolor{keywordflow}{if} (!reply)
1677         \textcolor{keywordflow}{return} -ENOMEM;
1678 
1679     \hyperlink{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}{ovs\_lock}();
1680     dp = \hyperlink{datapath_8c_a774dc1bd6a39e68ebac48e55688a8574}{lookup\_datapath}(sock\_net(skb->sk), info->userhdr, info->attrs);
1681     err = PTR\_ERR(dp);
1682     \textcolor{keywordflow}{if} (IS\_ERR(dp))
1683         \textcolor{keywordflow}{goto} err\_unlock\_free;
1684 
1685     \hyperlink{datapath_8c_a2c763b1da99cce1a426140794eaf8f03}{ovs\_dp\_change}(dp, info->attrs);
1686 
1687     err = \hyperlink{datapath_8c_a0c18d2b438aba3739c2a36e172cfe3ea}{ovs\_dp\_cmd\_fill\_info}(dp, reply, info->snd\_portid,
1688                    info->snd\_seq, 0, \hyperlink{openvswitch_8h_aa8ba551904bd37a482265422ae718fbdabde26912980136dc563e8918e2d90334}{OVS\_DP\_CMD\_NEW});
1689     BUG\_ON(err < 0);
1690 
1691     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1692 
1693     \hyperlink{datapath_8c_a67f527ad1164ff0d67fe854584ced567}{ovs\_notify}(&\hyperlink{datapath_8c_a00b4c28b2a15cad709af53b6484fc45c}{dp\_datapath\_genl\_family}, &
      \hyperlink{datapath_8c_afa5d1f090aee506896ff5ef56b4053e1}{ovs\_dp\_datapath\_multicast\_group}, reply, info);
1694     \textcolor{keywordflow}{return} 0;
1695 
1696 err\_unlock\_free:
1697     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1698     kfree\_skb(reply);
1699     \textcolor{keywordflow}{return} err;
1700 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a560b5f5f97a839287201f7486c53447e}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+detach\+\_\+port@{ovs\+\_\+dp\+\_\+detach\+\_\+port}}
\index{ovs\+\_\+dp\+\_\+detach\+\_\+port@{ovs\+\_\+dp\+\_\+detach\+\_\+port}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+detach\+\_\+port}]{\setlength{\rightskip}{0pt plus 5cm}void ovs\+\_\+dp\+\_\+detach\+\_\+port (
\begin{DoxyParamCaption}
\item[{struct {\bf vport} $\ast$}]{p}
\end{DoxyParamCaption}
)}\label{datapath_8c_a560b5f5f97a839287201f7486c53447e}

\begin{DoxyCode}
249 \{
250     \hyperlink{datapath_8h_af8d476fa8191790e6f57cad0623f192c}{ASSERT\_OVSL}();
251 
252     \textcolor{comment}{/* First drop references to device. */}
253     hlist\_del\_rcu(&p->\hyperlink{structvport_a27d2c94e2edd5de172e0b866cdd70fea}{dp\_hash\_node});
254 
255     \textcolor{comment}{/* Then destroy it. */}
256     \hyperlink{linux_2vport_8c_ad7676013c642bc044ead47b79eb94075}{ovs\_vport\_del}(p);
257 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a6a23196916bb5de4994f901bdf1aba2d}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+name@{ovs\+\_\+dp\+\_\+name}}
\index{ovs\+\_\+dp\+\_\+name@{ovs\+\_\+dp\+\_\+name}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+name}]{\setlength{\rightskip}{0pt plus 5cm}const char$\ast$ ovs\+\_\+dp\+\_\+name (
\begin{DoxyParamCaption}
\item[{const struct {\bf datapath} $\ast$}]{dp}
\end{DoxyParamCaption}
)}\label{datapath_8c_a6a23196916bb5de4994f901bdf1aba2d}

\begin{DoxyCode}
179 \{
180     \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport} = \hyperlink{datapath_8h_a33d8540a1f2484576cfa52366828fcfc}{ovs\_vport\_ovsl\_rcu}(dp, 
      \hyperlink{openvswitch_8h_aff2f13b95c27262c520f26831e647598}{OVSP\_LOCAL});
181     \textcolor{keywordflow}{return} vport->\hyperlink{structvport_a5af933fc664c1194ac3bbc337da35586}{ops}->\hyperlink{structvport__ops_abe0c3315271724bf05338487e0ced13c}{get\_name}(vport);
182 \}
\end{DoxyCode}
\hypertarget{datapath_8c_aa52cbaf8a4e68129287bfc8ddcde0711}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+process\+\_\+packet@{ovs\+\_\+dp\+\_\+process\+\_\+packet}}
\index{ovs\+\_\+dp\+\_\+process\+\_\+packet@{ovs\+\_\+dp\+\_\+process\+\_\+packet}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+process\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}void ovs\+\_\+dp\+\_\+process\+\_\+packet (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{key}
\end{DoxyParamCaption}
)}\label{datapath_8c_aa52cbaf8a4e68129287bfc8ddcde0711}

\begin{DoxyCode}
261 \{
262     \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *p = \hyperlink{datapath_8h_ac337c4d4ddca29916ce8e900038ddd78}{OVS\_CB}(skb)->input\_vport;
263     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp = p->\hyperlink{structvport_a49fb6f6bf0ac4337853e9242e88ddc42}{dp};
264     \textcolor{keyword}{struct }\hyperlink{structsw__flow}{sw\_flow} *flow;
265     \textcolor{keyword}{struct }\hyperlink{structsw__flow__actions}{sw\_flow\_actions} *sf\_acts;
266     \textcolor{keyword}{struct }\hyperlink{structdp__stats__percpu}{dp\_stats\_percpu} *stats;
267     u64 *stats\_counter;
268     u32 \hyperlink{structdp__stats__percpu_acbf57615b1fb66464f9e67efb32bd038}{n\_mask\_hit};
269 
270     stats = \hyperlink{percpu_8h_a1cd55f287dff5c4a79fc11dd38d47c12}{this\_cpu\_ptr}(dp->\hyperlink{structdatapath_a26ff295c711206c8177cdc89150c6a4a}{stats\_percpu});
271 
272     \textcolor{comment}{/* Look up flow. */}
273     flow = \hyperlink{flow__table_8c_ac1ff64b403e23c6e8226b0024969556b}{ovs\_flow\_tbl\_lookup\_stats}(&dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table}, key, 
      \hyperlink{skbuff_8h_acb236314b209f764af9aae7fbbb04311}{skb\_get\_hash}(skb),
274                      &n\_mask\_hit);
275     \textcolor{keywordflow}{if} (unlikely(!flow)) \{
276         \textcolor{keyword}{struct }\hyperlink{structdp__upcall__info}{dp\_upcall\_info} upcall;
277         \textcolor{keywordtype}{int} error;
278 
279         memset(&upcall, 0, \textcolor{keyword}{sizeof}(upcall));
280         upcall.cmd = \hyperlink{openvswitch_8h_a162a763c571debd951c9d2727b0f9bc3ae41f30829d03ed04928e74f82b349f0a}{OVS\_PACKET\_CMD\_MISS};
281         upcall.portid = \hyperlink{linux_2vport_8c_aeee9e742f0a0fbb3bda943eea9e63e56}{ovs\_vport\_find\_upcall\_portid}(p, skb);
282         error = \hyperlink{datapath_8c_a229b5c7d0158ebc24a90f44de0df0040}{ovs\_dp\_upcall}(dp, skb, key, &upcall);
283         \textcolor{keywordflow}{if} (unlikely(error))
284             kfree\_skb(skb);
285         \textcolor{keywordflow}{else}
286             \hyperlink{skbuff_8h_adc460a9e6dccf5557d55bbce8c7adb6a}{consume\_skb}(skb);
287         stats\_counter = &stats->\hyperlink{structdp__stats__percpu_ab919c22c9548a3dcd42632fb84634e26}{n\_missed};
288         \textcolor{keywordflow}{goto} out;
289     \}
290 
291     \hyperlink{flow_8c_ad20885fb9e6da56eb9cb58d139281916}{ovs\_flow\_stats\_update}(flow, key->\hyperlink{structsw__flow__key_a9c1944a39db1bf91141048df6d85ce8b}{tp}.\hyperlink{structsw__flow__key_a910f5e4408d113dbc9211190b44e0880}{flags}, skb);
292     sf\_acts = rcu\_dereference(flow->\hyperlink{structsw__flow_aa845bdaabc25d81dcf8b1a7519b35408}{sf\_acts});
293     \hyperlink{actions_8c_a5b34c1980d155574d657a21cac3bcc37}{ovs\_execute\_actions}(dp, skb, sf\_acts, key);
294 
295     stats\_counter = &stats->\hyperlink{structdp__stats__percpu_add53281b86504a50626cce7fac173d5b}{n\_hit};
296 
297 out:
298     \textcolor{comment}{/* Update datapath statistics. */}
299     \hyperlink{u64__stats__sync_8h_a79de6de9a2c8c4e1c98d78e5689b74f7}{u64\_stats\_update\_begin}(&stats->\hyperlink{structdp__stats__percpu_ad67971f59f6db5432848db23d185dc2f}{syncp});
300     (*stats\_counter)++;
301     stats->\hyperlink{structdp__stats__percpu_acbf57615b1fb66464f9e67efb32bd038}{n\_mask\_hit} += n\_mask\_hit;
302     \hyperlink{u64__stats__sync_8h_a4005b558b0a34d25298936e8d899e980}{u64\_stats\_update\_end}(&stats->\hyperlink{structdp__stats__percpu_ad67971f59f6db5432848db23d185dc2f}{syncp});
303 \}
\end{DoxyCode}
\hypertarget{datapath_8c_aba7a59d6ae252953be557d7478f7332f}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+reset\+\_\+user\+\_\+features@{ovs\+\_\+dp\+\_\+reset\+\_\+user\+\_\+features}}
\index{ovs\+\_\+dp\+\_\+reset\+\_\+user\+\_\+features@{ovs\+\_\+dp\+\_\+reset\+\_\+user\+\_\+features}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+reset\+\_\+user\+\_\+features}]{\setlength{\rightskip}{0pt plus 5cm}static void ovs\+\_\+dp\+\_\+reset\+\_\+user\+\_\+features (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct genl\+\_\+info $\ast$}]{info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_aba7a59d6ae252953be557d7478f7332f}

\begin{DoxyCode}
1490 \{
1491     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
1492 
1493     dp = \hyperlink{datapath_8c_a774dc1bd6a39e68ebac48e55688a8574}{lookup\_datapath}(sock\_net(skb->sk), info->userhdr, info->attrs);
1494     \textcolor{keywordflow}{if} (IS\_ERR(dp))
1495         \textcolor{keywordflow}{return};
1496 
1497     WARN(dp->\hyperlink{structdatapath_a92ce3b704c20f18b3a696f98b6f7d266}{user\_features}, \textcolor{stringliteral}{"Dropping previously announced user features\(\backslash\)n"});
1498     dp->\hyperlink{structdatapath_a92ce3b704c20f18b3a696f98b6f7d266}{user\_features} = 0;
1499 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a229b5c7d0158ebc24a90f44de0df0040}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+upcall@{ovs\+\_\+dp\+\_\+upcall}}
\index{ovs\+\_\+dp\+\_\+upcall@{ovs\+\_\+dp\+\_\+upcall}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+upcall}]{\setlength{\rightskip}{0pt plus 5cm}int ovs\+\_\+dp\+\_\+upcall (
\begin{DoxyParamCaption}
\item[{struct {\bf datapath} $\ast$}]{dp, }
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{const struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{key, }
\item[{const struct {\bf dp\+\_\+upcall\+\_\+info} $\ast$}]{upcall\+\_\+info}
\end{DoxyParamCaption}
)}\label{datapath_8c_a229b5c7d0158ebc24a90f44de0df0040}

\begin{DoxyCode}
308 \{
309     \textcolor{keyword}{struct }\hyperlink{structdp__stats__percpu}{dp\_stats\_percpu} *stats;
310     \textcolor{keywordtype}{int} err;
311 
312     \textcolor{keywordflow}{if} (upcall\_info->\hyperlink{structdp__upcall__info_a4300576f43ab3d9293453d9c664de818}{portid} == 0) \{
313         err = -ENOTCONN;
314         \textcolor{keywordflow}{goto} err;
315     \}
316 
317     \textcolor{keywordflow}{if} (!skb\_is\_gso(skb))
318         err = \hyperlink{datapath_8c_a549c591fae56562523f243abbe4a1e3e}{queue\_userspace\_packet}(dp, skb, key, upcall\_info);
319     \textcolor{keywordflow}{else}
320         err = \hyperlink{datapath_8c_a2c10ba8a23a8cb2f14b7f7684e5ebb5d}{queue\_gso\_packets}(dp, skb, key, upcall\_info);
321     \textcolor{keywordflow}{if} (err)
322         \textcolor{keywordflow}{goto} err;
323 
324     \textcolor{keywordflow}{return} 0;
325 
326 err:
327     stats = \hyperlink{percpu_8h_a1cd55f287dff5c4a79fc11dd38d47c12}{this\_cpu\_ptr}(dp->\hyperlink{structdatapath_a26ff295c711206c8177cdc89150c6a4a}{stats\_percpu});
328 
329     \hyperlink{u64__stats__sync_8h_a79de6de9a2c8c4e1c98d78e5689b74f7}{u64\_stats\_update\_begin}(&stats->\hyperlink{structdp__stats__percpu_ad67971f59f6db5432848db23d185dc2f}{syncp});
330     stats->\hyperlink{structdp__stats__percpu_abecbd535feefeb9ff1721ca6e517c310}{n\_lost}++;
331     \hyperlink{u64__stats__sync_8h_a4005b558b0a34d25298936e8d899e980}{u64\_stats\_update\_end}(&stats->\hyperlink{structdp__stats__percpu_ad67971f59f6db5432848db23d185dc2f}{syncp});
332 
333     \textcolor{keywordflow}{return} err;
334 \}
\end{DoxyCode}
\hypertarget{datapath_8c_aead9307565d6ab903dd5db639c7299e4}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+exit\+\_\+net@{ovs\+\_\+exit\+\_\+net}}
\index{ovs\+\_\+exit\+\_\+net@{ovs\+\_\+exit\+\_\+net}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+exit\+\_\+net}]{\setlength{\rightskip}{0pt plus 5cm}static void \+\_\+\+\_\+net\+\_\+exit ovs\+\_\+exit\+\_\+net (
\begin{DoxyParamCaption}
\item[{struct net $\ast$}]{dnet}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_aead9307565d6ab903dd5db639c7299e4}

\begin{DoxyCode}
2247 \{
2248     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp, *dp\_next;
2249     \textcolor{keyword}{struct }\hyperlink{structovs__net}{ovs\_net} *\hyperlink{structovs__net}{ovs\_net} = net\_generic(dnet, \hyperlink{datapath_8h_ace140298dc2b59b3d77d59c0a210de29}{ovs\_net\_id});
2250     \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport}, *vport\_next;
2251     \textcolor{keyword}{struct }net *net;
2252     \hyperlink{linux_2vport-geneve_8c_aa66e082c97d7820eb9eb166e6cf4b996}{LIST\_HEAD}(head);
2253 
2254     \hyperlink{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}{ovs\_lock}();
2255     list\_for\_each\_entry\_safe(dp, dp\_next, &ovs\_net->\hyperlink{structovs__net_a0490101f7ea82f5c290a92d447bd8f9d}{dps}, list\_node)
2256         \hyperlink{datapath_8c_a6c66e1332f2a95e9510e37745d77bad1}{\_\_dp\_destroy}(dp);
2257 
2258     rtnl\_lock();
2259     for\_each\_net(net)
2260         \hyperlink{datapath_8c_a97bf5ddc3763f5f1b5691cc262bd206a}{list\_vports\_from\_net}(net, dnet, &head);
2261     rtnl\_unlock();
2262 
2263     \textcolor{comment}{/* Detach all vports from given namespace. */}
2264     list\_for\_each\_entry\_safe(vport, vport\_next, &head, detach\_list) \{
2265         list\_del(&vport->detach\_list);
2266         \hyperlink{datapath_8c_a560b5f5f97a839287201f7486c53447e}{ovs\_dp\_detach\_port}(vport);
2267     \}
2268 
2269     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
2270 
2271     cancel\_work\_sync(&ovs\_net->\hyperlink{structovs__net_ac8cdb834420a37531f032e526ac61901}{dp\_notify\_work});
2272 \}
\end{DoxyCode}
\hypertarget{datapath_8c_ac6daf72fcac45a9bd571dec78216e197}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+flow\+\_\+cmd\+\_\+alloc\+\_\+info@{ovs\+\_\+flow\+\_\+cmd\+\_\+alloc\+\_\+info}}
\index{ovs\+\_\+flow\+\_\+cmd\+\_\+alloc\+\_\+info@{ovs\+\_\+flow\+\_\+cmd\+\_\+alloc\+\_\+info}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+flow\+\_\+cmd\+\_\+alloc\+\_\+info}]{\setlength{\rightskip}{0pt plus 5cm}static struct sk\+\_\+buff$\ast$ ovs\+\_\+flow\+\_\+cmd\+\_\+alloc\+\_\+info (
\begin{DoxyParamCaption}
\item[{const struct {\bf sw\+\_\+flow\+\_\+actions} $\ast$}]{acts, }
\item[{const struct {\bf sw\+\_\+flow\+\_\+id} $\ast$}]{sfid, }
\item[{struct genl\+\_\+info $\ast$}]{info, }
\item[{{\bf bool}}]{always, }
\item[{uint32\+\_\+t}]{ufid\+\_\+flags}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_ac6daf72fcac45a9bd571dec78216e197}

\begin{DoxyCode}
855 \{
856     \textcolor{keyword}{struct }sk\_buff *skb;
857     \textcolor{keywordtype}{size\_t} len;
858 
859     \textcolor{keywordflow}{if} (!always && !\hyperlink{datapath_8c_aba3b63f0e73c9ea6ecb8b7aa5d913724}{ovs\_must\_notify}(&\hyperlink{datapath_8c_af07853d514acd11f9f0d23494b6a2f9e}{dp\_flow\_genl\_family}, info,
860                     \hyperlink{compat_8h_ab49ad0e0c1bb8cda8015902526ae189c}{GROUP\_ID}(&\hyperlink{datapath_8c_ae43fcc307ac0fa091a736d4687c7f884}{ovs\_dp\_flow\_multicast\_group})))
861         \textcolor{keywordflow}{return} NULL;
862 
863     len = \hyperlink{datapath_8c_a5f17e0449c315970d82161c131e70dbd}{ovs\_flow\_cmd\_msg\_size}(acts, sfid, ufid\_flags);
864     skb = \hyperlink{genetlink_8h_a004898a56e34b42638510826a4757ab5}{genlmsg\_new\_unicast}(len, info, GFP\_KERNEL);
865     \textcolor{keywordflow}{if} (!skb)
866         \textcolor{keywordflow}{return} ERR\_PTR(-ENOMEM);
867 
868     \textcolor{keywordflow}{return} skb;
869 \}
\end{DoxyCode}
\hypertarget{datapath_8c_afbfb35c0b3684e82dce573f04491ad1e}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+flow\+\_\+cmd\+\_\+build\+\_\+info@{ovs\+\_\+flow\+\_\+cmd\+\_\+build\+\_\+info}}
\index{ovs\+\_\+flow\+\_\+cmd\+\_\+build\+\_\+info@{ovs\+\_\+flow\+\_\+cmd\+\_\+build\+\_\+info}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+flow\+\_\+cmd\+\_\+build\+\_\+info}]{\setlength{\rightskip}{0pt plus 5cm}static struct sk\+\_\+buff$\ast$ ovs\+\_\+flow\+\_\+cmd\+\_\+build\+\_\+info (
\begin{DoxyParamCaption}
\item[{const struct {\bf sw\+\_\+flow} $\ast$}]{flow, }
\item[{int}]{dp\+\_\+ifindex, }
\item[{struct genl\+\_\+info $\ast$}]{info, }
\item[{u8}]{cmd, }
\item[{{\bf bool}}]{always, }
\item[{u32}]{ufid\+\_\+flags}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_afbfb35c0b3684e82dce573f04491ad1e}

\begin{DoxyCode}
876 \{
877     \textcolor{keyword}{struct }sk\_buff *skb;
878     \textcolor{keywordtype}{int} retval;
879 
880     skb = \hyperlink{datapath_8c_ac6daf72fcac45a9bd571dec78216e197}{ovs\_flow\_cmd\_alloc\_info}(\hyperlink{datapath_8h_a06ef69170d345fd3996a467dcacf3ff3}{ovsl\_dereference}(flow->
      \hyperlink{structsw__flow_aa845bdaabc25d81dcf8b1a7519b35408}{sf\_acts}),
881                       &flow->\hyperlink{structsw__flow_a6e6645eec909d54871675be30000c0b9}{id}, info, always, ufid\_flags);
882     \textcolor{keywordflow}{if} (\hyperlink{err_8h_a22778380bb4d25b99295990c3aaa1417}{IS\_ERR\_OR\_NULL}(skb))
883         \textcolor{keywordflow}{return} skb;
884 
885     retval = \hyperlink{datapath_8c_a7b415415fa0d84bab45258cd3080f2c7}{ovs\_flow\_cmd\_fill\_info}(flow, dp\_ifindex, skb,
886                     info->snd\_portid, info->snd\_seq, 0,
887                     cmd, ufid\_flags);
888     BUG\_ON(retval < 0);
889     \textcolor{keywordflow}{return} skb;
890 \}
\end{DoxyCode}
\hypertarget{datapath_8c_aa05c62aa6531c0e0312126a21a8d99a5}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+flow\+\_\+cmd\+\_\+del@{ovs\+\_\+flow\+\_\+cmd\+\_\+del}}
\index{ovs\+\_\+flow\+\_\+cmd\+\_\+del@{ovs\+\_\+flow\+\_\+cmd\+\_\+del}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+flow\+\_\+cmd\+\_\+del}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+flow\+\_\+cmd\+\_\+del (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct genl\+\_\+info $\ast$}]{info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_aa05c62aa6531c0e0312126a21a8d99a5}

\begin{DoxyCode}
1243 \{
1244     \textcolor{keyword}{struct }nlattr **a = info->attrs;
1245     \textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header} *\hyperlink{structovs__header}{ovs\_header} = info->userhdr;
1246     \textcolor{keyword}{struct }\hyperlink{structsw__flow__key}{sw\_flow\_key} key;
1247     \textcolor{keyword}{struct }sk\_buff *reply;
1248     \textcolor{keyword}{struct }\hyperlink{structsw__flow}{sw\_flow} *flow = NULL;
1249     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
1250     \textcolor{keyword}{struct }\hyperlink{structsw__flow__match}{sw\_flow\_match} match;
1251     \textcolor{keyword}{struct }\hyperlink{structsw__flow__id}{sw\_flow\_id} \hyperlink{structsw__flow__id_a22ce2b1fed980149931fbccb05750f3e}{ufid};
1252     u32 ufid\_flags = \hyperlink{flow__netlink_8c_a415cb727697a02d62b8ff40795337d40}{ovs\_nla\_get\_ufid\_flags}(a[
      \hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a151813739a9f8d3ecc0c08503b9b0042}{OVS\_FLOW\_ATTR\_UFID\_FLAGS}]);
1253     \textcolor{keywordtype}{int} err;
1254     \textcolor{keywordtype}{bool} log = !a[\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a667851b468a6c195d627220177b2a973}{OVS\_FLOW\_ATTR\_PROBE}];
1255     \textcolor{keywordtype}{bool} ufid\_present;
1256 
1257     ufid\_present = \hyperlink{flow__netlink_8c_a81e0cfe1c434ecde4ad684c8b8586877}{ovs\_nla\_get\_ufid}(&\hyperlink{structsw__flow__id_a22ce2b1fed980149931fbccb05750f3e}{ufid}, a[
      \hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a0d2822e9d4b6fa37c54dd8b693c2b465}{OVS\_FLOW\_ATTR\_UFID}], log);
1258     \textcolor{keywordflow}{if} (a[\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a0d310e7624962a1b4c5212459995a5c9}{OVS\_FLOW\_ATTR\_KEY}]) \{
1259         \hyperlink{flow__netlink_8c_a1a09e9d38844c59332975789573e994c}{ovs\_match\_init}(&match, &key, NULL);
1260         err = \hyperlink{flow__netlink_8c_a074547b2bcb32890a72ae873700391d5}{ovs\_nla\_get\_match}(&match, a[OVS\_FLOW\_ATTR\_KEY], NULL,
1261                     log);
1262         \textcolor{keywordflow}{if} (unlikely(err))
1263             \textcolor{keywordflow}{return} err;
1264     \}
1265 
1266     \hyperlink{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}{ovs\_lock}();
1267     dp = \hyperlink{datapath_8c_a1107d4fd386aa6551511140b5405e1d3}{get\_dp}(sock\_net(skb->sk), ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex});
1268     \textcolor{keywordflow}{if} (unlikely(!dp)) \{
1269         err = -ENODEV;
1270         \textcolor{keywordflow}{goto} unlock;
1271     \}
1272 
1273     \textcolor{keywordflow}{if} (unlikely(!a[OVS\_FLOW\_ATTR\_KEY] && !ufid\_present)) \{
1274         err = \hyperlink{flow__table_8c_a7e424f978318e8c007b3de68854e8dc2}{ovs\_flow\_tbl\_flush}(&dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table});
1275         \textcolor{keywordflow}{goto} unlock;
1276     \}
1277 
1278     \textcolor{keywordflow}{if} (ufid\_present)
1279         flow = \hyperlink{flow__table_8c_a522dbf2a9a0518ff57eb58c09b69448c}{ovs\_flow\_tbl\_lookup\_ufid}(&dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table}, &
      \hyperlink{structsw__flow__id_a22ce2b1fed980149931fbccb05750f3e}{ufid});
1280     \textcolor{keywordflow}{else}
1281         flow = \hyperlink{flow__table_8c_ad54c8ee8b511e42f2296bcf5ff8d0fd3}{ovs\_flow\_tbl\_lookup\_exact}(&dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table}, &match);
1282     \textcolor{keywordflow}{if} (unlikely(!flow)) \{
1283         err = -ENOENT;
1284         \textcolor{keywordflow}{goto} unlock;
1285     \}
1286 
1287     \hyperlink{flow__table_8c_aa75b8bc2551f9c1a8d65b942a10df89a}{ovs\_flow\_tbl\_remove}(&dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table}, flow);
1288     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1289 
1290     reply = \hyperlink{datapath_8c_ac6daf72fcac45a9bd571dec78216e197}{ovs\_flow\_cmd\_alloc\_info}(\hyperlink{rcupdate_8h_a9e866c0e8ba667e053cb8f59af572157}{rcu\_dereference\_raw}(flow->
      \hyperlink{structsw__flow_aa845bdaabc25d81dcf8b1a7519b35408}{sf\_acts}),
1291                     &flow->\hyperlink{structsw__flow_a6e6645eec909d54871675be30000c0b9}{id}, info, \textcolor{keyword}{false}, ufid\_flags);
1292 
1293     \textcolor{keywordflow}{if} (likely(reply)) \{
1294         \textcolor{keywordflow}{if} (likely(!IS\_ERR(reply))) \{
1295             rcu\_read\_lock();    \textcolor{comment}{/*To keep RCU checker happy. */}
1296             err = \hyperlink{datapath_8c_a7b415415fa0d84bab45258cd3080f2c7}{ovs\_flow\_cmd\_fill\_info}(flow, ovs\_header->
      \hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex},
1297                              reply, info->snd\_portid,
1298                              info->snd\_seq, 0,
1299                              \hyperlink{openvswitch_8h_ab057316614ced2632c206f5b09fb6406a7bc985bd1b36d9c15028c5b66f650273}{OVS\_FLOW\_CMD\_DEL},
1300                              ufid\_flags);
1301             rcu\_read\_unlock();
1302             BUG\_ON(err < 0);
1303             \hyperlink{datapath_8c_a67f527ad1164ff0d67fe854584ced567}{ovs\_notify}(&\hyperlink{datapath_8c_af07853d514acd11f9f0d23494b6a2f9e}{dp\_flow\_genl\_family}, &
      \hyperlink{datapath_8c_ae43fcc307ac0fa091a736d4687c7f884}{ovs\_dp\_flow\_multicast\_group}, reply, info);
1304         \} \textcolor{keywordflow}{else} \{
1305             \hyperlink{genetlink_8h_a4261ddbadfb4439b57bd106a5ab0a043}{genl\_set\_err}(&\hyperlink{datapath_8c_af07853d514acd11f9f0d23494b6a2f9e}{dp\_flow\_genl\_family}, sock\_net(skb->sk), 0,
1306                      \hyperlink{compat_8h_ab49ad0e0c1bb8cda8015902526ae189c}{GROUP\_ID}(&\hyperlink{datapath_8c_ae43fcc307ac0fa091a736d4687c7f884}{ovs\_dp\_flow\_multicast\_group}), PTR\_ERR(
      reply));
1307 
1308         \}
1309     \}
1310 
1311     \hyperlink{flow__table_8c_a8133cf46e955b2ae38a0bb8afc0a454f}{ovs\_flow\_free}(flow, \textcolor{keyword}{true});
1312     \textcolor{keywordflow}{return} 0;
1313 unlock:
1314     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1315     \textcolor{keywordflow}{return} err;
1316 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a4759993b01f8bc67711ecacacdf43976}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+flow\+\_\+cmd\+\_\+dump@{ovs\+\_\+flow\+\_\+cmd\+\_\+dump}}
\index{ovs\+\_\+flow\+\_\+cmd\+\_\+dump@{ovs\+\_\+flow\+\_\+cmd\+\_\+dump}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+flow\+\_\+cmd\+\_\+dump}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+flow\+\_\+cmd\+\_\+dump (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct netlink\+\_\+callback $\ast$}]{cb}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a4759993b01f8bc67711ecacacdf43976}

\begin{DoxyCode}
1319 \{
1320     \textcolor{keyword}{struct }nlattr *a[\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554afec191eae0752c40acd2d040b2d1edaa}{\_\_OVS\_FLOW\_ATTR\_MAX}];
1321     \textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header} *\hyperlink{structovs__header}{ovs\_header} = genlmsg\_data(nlmsg\_data(cb->nlh));
1322     \textcolor{keyword}{struct }\hyperlink{structtable__instance}{table\_instance} *ti;
1323     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
1324     u32 ufid\_flags;
1325     \textcolor{keywordtype}{int} err;
1326 
1327     err = \hyperlink{genetlink_8h_a1abecce1ec06195cd98ee3d569328bec}{genlmsg\_parse}(cb->nlh, &\hyperlink{datapath_8c_af07853d514acd11f9f0d23494b6a2f9e}{dp\_flow\_genl\_family}, a,
1328                 \hyperlink{openvswitch_8h_a05c07757006c2efd4a1a43593f896acf}{OVS\_FLOW\_ATTR\_MAX}, \hyperlink{datapath_8c_aad79544f457c7a323273d328dafff886}{flow\_policy});
1329     \textcolor{keywordflow}{if} (err)
1330         \textcolor{keywordflow}{return} err;
1331     ufid\_flags = \hyperlink{flow__netlink_8c_a415cb727697a02d62b8ff40795337d40}{ovs\_nla\_get\_ufid\_flags}(a[
      \hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a151813739a9f8d3ecc0c08503b9b0042}{OVS\_FLOW\_ATTR\_UFID\_FLAGS}]);
1332 
1333     rcu\_read\_lock();
1334     dp = \hyperlink{datapath_8c_ab3f598cca9ed98120cc11daa11690da8}{get\_dp\_rcu}(sock\_net(skb->sk), ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex});
1335     \textcolor{keywordflow}{if} (!dp) \{
1336         rcu\_read\_unlock();
1337         \textcolor{keywordflow}{return} -ENODEV;
1338     \}
1339 
1340     ti = rcu\_dereference(dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table}.\hyperlink{structflow__table_a49d708e68608d510f6d25a16a14fd565}{ti});
1341     \textcolor{keywordflow}{for} (;;) \{
1342         \textcolor{keyword}{struct }\hyperlink{structsw__flow}{sw\_flow} *flow;
1343         u32 bucket, obj;
1344 
1345         bucket = cb->args[0];
1346         obj = cb->args[1];
1347         flow = \hyperlink{flow__table_8c_ab25c7aae52c39216ebb03d10a6cba0d8}{ovs\_flow\_tbl\_dump\_next}(ti, &bucket, &obj);
1348         \textcolor{keywordflow}{if} (!flow)
1349             \textcolor{keywordflow}{break};
1350 
1351         \textcolor{keywordflow}{if} (\hyperlink{datapath_8c_a7b415415fa0d84bab45258cd3080f2c7}{ovs\_flow\_cmd\_fill\_info}(flow, ovs\_header->
      \hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex}, skb,
1352                        NETLINK\_CB(cb->skb).portid,
1353                        cb->nlh->nlmsg\_seq, NLM\_F\_MULTI,
1354                        \hyperlink{openvswitch_8h_ab057316614ced2632c206f5b09fb6406ac86b2408dee1e6128057215035e2515e}{OVS\_FLOW\_CMD\_NEW}, ufid\_flags) < 0)
1355             \textcolor{keywordflow}{break};
1356 
1357         cb->args[0] = bucket;
1358         cb->args[1] = obj;
1359     \}
1360     rcu\_read\_unlock();
1361     \textcolor{keywordflow}{return} skb->len;
1362 \}
\end{DoxyCode}
\hypertarget{datapath_8c_ad6ce625c1cb24262cddbabe479987986}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+actions@{ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+actions}}
\index{ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+actions@{ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+actions}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+actions}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+actions (
\begin{DoxyParamCaption}
\item[{const struct {\bf sw\+\_\+flow} $\ast$}]{flow, }
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{int}]{skb\+\_\+orig\+\_\+len}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_ad6ce625c1cb24262cddbabe479987986}

\begin{DoxyCode}
762 \{
763     \textcolor{keyword}{struct }nlattr *start;
764     \textcolor{keywordtype}{int} err;
765 
766     \textcolor{comment}{/* If OVS\_FLOW\_ATTR\_ACTIONS doesn't fit, skip dumping the actions if}
767 \textcolor{comment}{     * this is the first flow to be dumped into 'skb'.  This is unusual for}
768 \textcolor{comment}{     * Netlink but individual action lists can be longer than}
769 \textcolor{comment}{     * NLMSG\_GOODSIZE and thus entirely undumpable if we didn't do this.}
770 \textcolor{comment}{     * The userspace caller can always fetch the actions separately if it}
771 \textcolor{comment}{     * really wants them.  (Most userspace callers in fact don't care.)}
772 \textcolor{comment}{     *}
773 \textcolor{comment}{     * This can only fail for dump operations because the skb is always}
774 \textcolor{comment}{     * properly sized for single flows.}
775 \textcolor{comment}{     */}
776     start = nla\_nest\_start(skb, \hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554ae28f57a4b243f965ad67a6e96ad09aea}{OVS\_FLOW\_ATTR\_ACTIONS});
777     \textcolor{keywordflow}{if} (start) \{
778         \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structsw__flow__actions}{sw\_flow\_actions} *sf\_acts;
779 
780         sf\_acts = \hyperlink{datapath_8h_a5f2a2c1026f970f0052e77f5ebba33d1}{rcu\_dereference\_ovsl}(flow->\hyperlink{structsw__flow_aa845bdaabc25d81dcf8b1a7519b35408}{sf\_acts});
781         err = \hyperlink{flow__netlink_8c_a923304ee69be1cfa52197b0f73c29e49}{ovs\_nla\_put\_actions}(sf\_acts->\hyperlink{structsw__flow__actions_ae091e053b6fbc25174a28e97282cbe36}{actions},
782                       sf\_acts->\hyperlink{structsw__flow__actions_ad18c83862d211746fc0542eabff148a5}{actions\_len}, skb);
783 
784         \textcolor{keywordflow}{if} (!err)
785             nla\_nest\_end(skb, start);
786         \textcolor{keywordflow}{else} \{
787             \textcolor{keywordflow}{if} (skb\_orig\_len)
788                 \textcolor{keywordflow}{return} err;
789 
790             nla\_nest\_cancel(skb, start);
791         \}
792     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (skb\_orig\_len) \{
793         \textcolor{keywordflow}{return} -EMSGSIZE;
794     \}
795 
796     \textcolor{keywordflow}{return} 0;
797 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a7b415415fa0d84bab45258cd3080f2c7}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+info@{ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+info}}
\index{ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+info@{ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+info}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+info}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+info (
\begin{DoxyParamCaption}
\item[{const struct {\bf sw\+\_\+flow} $\ast$}]{flow, }
\item[{int}]{dp\+\_\+ifindex, }
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{u32}]{portid, }
\item[{u32}]{seq, }
\item[{u32}]{flags, }
\item[{u8}]{cmd, }
\item[{u32}]{ufid\+\_\+flags}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a7b415415fa0d84bab45258cd3080f2c7}

\begin{DoxyCode}
803 \{
804     \textcolor{keyword}{const} \textcolor{keywordtype}{int} skb\_orig\_len = skb->len;
805     \textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header} *\hyperlink{structovs__header}{ovs\_header};
806     \textcolor{keywordtype}{int} err;
807 
808     ovs\_header = \hyperlink{genetlink_8h_a306fd8e0093b286af42dfce236aeb096}{genlmsg\_put}(skb, portid, seq, &\hyperlink{datapath_8c_af07853d514acd11f9f0d23494b6a2f9e}{dp\_flow\_genl\_family},
809                  \hyperlink{flow_8h_af4f7a53f6b2df72c34ca881f2714ac91}{flags}, cmd);
810     \textcolor{keywordflow}{if} (!ovs\_header)
811         \textcolor{keywordflow}{return} -EMSGSIZE;
812 
813     ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex} = \hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex};
814 
815     err = \hyperlink{flow__netlink_8c_a636f7d3cbe8656ceda87373110a4abc4}{ovs\_nla\_put\_identifier}(flow, skb);
816     \textcolor{keywordflow}{if} (err)
817         \textcolor{keywordflow}{goto} error;
818 
819     \textcolor{keywordflow}{if} (\hyperlink{datapath_8c_a4d912d3ed7dba8789b726280b6dea3a4}{should\_fill\_key}(&flow->\hyperlink{structsw__flow_a6e6645eec909d54871675be30000c0b9}{id}, ufid\_flags)) \{
820         err = \hyperlink{flow__netlink_8c_a2f6c3ab02b8e5d6296278dc9214500eb}{ovs\_nla\_put\_masked\_key}(flow, skb);
821         \textcolor{keywordflow}{if} (err)
822             \textcolor{keywordflow}{goto} error;
823     \}
824 
825     \textcolor{keywordflow}{if} (\hyperlink{datapath_8c_acef91dffd31fb70fa6c94e11ad08805b}{should\_fill\_mask}(ufid\_flags)) \{
826         err = \hyperlink{flow__netlink_8c_af5ab12e938f8564945464a9e110eace3}{ovs\_nla\_put\_mask}(flow, skb);
827         \textcolor{keywordflow}{if} (err)
828             \textcolor{keywordflow}{goto} error;
829     \}
830 
831     err = \hyperlink{datapath_8c_a832dcdda5999f2e7fadd72b2ad2373f3}{ovs\_flow\_cmd\_fill\_stats}(flow, skb);
832     \textcolor{keywordflow}{if} (err)
833         \textcolor{keywordflow}{goto} error;
834 
835     \textcolor{keywordflow}{if} (\hyperlink{datapath_8c_a05dcb72a9103046c5721d03a1592291f}{should\_fill\_actions}(ufid\_flags)) \{
836         err = \hyperlink{datapath_8c_ad6ce625c1cb24262cddbabe479987986}{ovs\_flow\_cmd\_fill\_actions}(flow, skb, skb\_orig\_len);
837         \textcolor{keywordflow}{if} (err)
838             \textcolor{keywordflow}{goto} error;
839     \}
840 
841     genlmsg\_end(skb, ovs\_header);
842     \textcolor{keywordflow}{return} 0;
843 
844 error:
845     genlmsg\_cancel(skb, ovs\_header);
846     \textcolor{keywordflow}{return} err;
847 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a832dcdda5999f2e7fadd72b2ad2373f3}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+stats@{ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+stats}}
\index{ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+stats@{ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+stats}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+stats}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+flow\+\_\+cmd\+\_\+fill\+\_\+stats (
\begin{DoxyParamCaption}
\item[{const struct {\bf sw\+\_\+flow} $\ast$}]{flow, }
\item[{struct sk\+\_\+buff $\ast$}]{skb}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a832dcdda5999f2e7fadd72b2ad2373f3}

\begin{DoxyCode}
737 \{
738     \textcolor{keyword}{struct }\hyperlink{structovs__flow__stats}{ovs\_flow\_stats} stats;
739     \_\_be16 tcp\_flags;
740     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} used;
741 
742     \hyperlink{flow_8c_a03636247cfc74747632c000eec0919db}{ovs\_flow\_stats\_get}(flow, &stats, &used, &tcp\_flags);
743 
744     \textcolor{keywordflow}{if} (used &&
745         nla\_put\_u64(skb, \hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554abff0dc46f1e37c1afd60db41ee16ce53}{OVS\_FLOW\_ATTR\_USED}, 
      \hyperlink{flow_8c_adfdcc779325fc169a793acda2e32a46b}{ovs\_flow\_used\_time}(used)))
746         \textcolor{keywordflow}{return} -EMSGSIZE;
747 
748     \textcolor{keywordflow}{if} (stats.n\_packets &&
749         nla\_put(skb, \hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554aad261b1394b027a2d23a043bf4169103}{OVS\_FLOW\_ATTR\_STATS}, \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} 
      \hyperlink{structovs__flow__stats}{ovs\_flow\_stats}), &stats))
750         \textcolor{keywordflow}{return} -EMSGSIZE;
751 
752     \textcolor{keywordflow}{if} ((u8)ntohs(tcp\_flags) &&
753          nla\_put\_u8(skb, \hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a41629096476c3022be85319b116f2839}{OVS\_FLOW\_ATTR\_TCP\_FLAGS}, (u8)ntohs(tcp\_flags)))
754         \textcolor{keywordflow}{return} -EMSGSIZE;
755 
756     \textcolor{keywordflow}{return} 0;
757 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a747a4726ec84c751acb3048a515cef86}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+flow\+\_\+cmd\+\_\+get@{ovs\+\_\+flow\+\_\+cmd\+\_\+get}}
\index{ovs\+\_\+flow\+\_\+cmd\+\_\+get@{ovs\+\_\+flow\+\_\+cmd\+\_\+get}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+flow\+\_\+cmd\+\_\+get}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+flow\+\_\+cmd\+\_\+get (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct genl\+\_\+info $\ast$}]{info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a747a4726ec84c751acb3048a515cef86}

\begin{DoxyCode}
1185 \{
1186     \textcolor{keyword}{struct }nlattr **a = info->attrs;
1187     \textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header} *\hyperlink{structovs__header}{ovs\_header} = info->userhdr;
1188     \textcolor{keyword}{struct }\hyperlink{structsw__flow__key}{sw\_flow\_key} key;
1189     \textcolor{keyword}{struct }sk\_buff *reply;
1190     \textcolor{keyword}{struct }\hyperlink{structsw__flow}{sw\_flow} *flow;
1191     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
1192     \textcolor{keyword}{struct }\hyperlink{structsw__flow__match}{sw\_flow\_match} match;
1193     \textcolor{keyword}{struct }\hyperlink{structsw__flow__id}{sw\_flow\_id} \hyperlink{structsw__flow__id_a22ce2b1fed980149931fbccb05750f3e}{ufid};
1194     u32 ufid\_flags = \hyperlink{flow__netlink_8c_a415cb727697a02d62b8ff40795337d40}{ovs\_nla\_get\_ufid\_flags}(a[
      \hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a151813739a9f8d3ecc0c08503b9b0042}{OVS\_FLOW\_ATTR\_UFID\_FLAGS}]);
1195     \textcolor{keywordtype}{int} err = 0;
1196     \textcolor{keywordtype}{bool} log = !a[\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a667851b468a6c195d627220177b2a973}{OVS\_FLOW\_ATTR\_PROBE}];
1197     \textcolor{keywordtype}{bool} ufid\_present;
1198 
1199     ufid\_present = \hyperlink{flow__netlink_8c_a81e0cfe1c434ecde4ad684c8b8586877}{ovs\_nla\_get\_ufid}(&\hyperlink{structsw__flow__id_a22ce2b1fed980149931fbccb05750f3e}{ufid}, a[
      \hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a0d2822e9d4b6fa37c54dd8b693c2b465}{OVS\_FLOW\_ATTR\_UFID}], log);
1200     \textcolor{keywordflow}{if} (a[\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a0d310e7624962a1b4c5212459995a5c9}{OVS\_FLOW\_ATTR\_KEY}]) \{
1201         \hyperlink{flow__netlink_8c_a1a09e9d38844c59332975789573e994c}{ovs\_match\_init}(&match, &key, NULL);
1202         err = \hyperlink{flow__netlink_8c_a074547b2bcb32890a72ae873700391d5}{ovs\_nla\_get\_match}(&match, a[OVS\_FLOW\_ATTR\_KEY], NULL,
1203                     log);
1204     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!ufid\_present) \{
1205         \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log,
1206               \textcolor{stringliteral}{"Flow get message rejected, Key attribute missing."});
1207         err = -EINVAL;
1208     \}
1209     \textcolor{keywordflow}{if} (err)
1210         \textcolor{keywordflow}{return} err;
1211 
1212     \hyperlink{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}{ovs\_lock}();
1213     dp = \hyperlink{datapath_8c_a1107d4fd386aa6551511140b5405e1d3}{get\_dp}(sock\_net(skb->sk), ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex});
1214     \textcolor{keywordflow}{if} (!dp) \{
1215         err = -ENODEV;
1216         \textcolor{keywordflow}{goto} unlock;
1217     \}
1218 
1219     \textcolor{keywordflow}{if} (ufid\_present)
1220         flow = \hyperlink{flow__table_8c_a522dbf2a9a0518ff57eb58c09b69448c}{ovs\_flow\_tbl\_lookup\_ufid}(&dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table}, &
      \hyperlink{structsw__flow__id_a22ce2b1fed980149931fbccb05750f3e}{ufid});
1221     \textcolor{keywordflow}{else}
1222         flow = \hyperlink{flow__table_8c_ad54c8ee8b511e42f2296bcf5ff8d0fd3}{ovs\_flow\_tbl\_lookup\_exact}(&dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table}, &match);
1223     \textcolor{keywordflow}{if} (!flow) \{
1224         err = -ENOENT;
1225         \textcolor{keywordflow}{goto} unlock;
1226     \}
1227 
1228     reply = \hyperlink{datapath_8c_afbfb35c0b3684e82dce573f04491ad1e}{ovs\_flow\_cmd\_build\_info}(flow, ovs\_header->
      \hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex}, info,
1229                     \hyperlink{openvswitch_8h_ab057316614ced2632c206f5b09fb6406ac86b2408dee1e6128057215035e2515e}{OVS\_FLOW\_CMD\_NEW}, \textcolor{keyword}{true}, ufid\_flags);
1230     \textcolor{keywordflow}{if} (IS\_ERR(reply)) \{
1231         err = PTR\_ERR(reply);
1232         \textcolor{keywordflow}{goto} unlock;
1233     \}
1234 
1235     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1236     \textcolor{keywordflow}{return} genlmsg\_reply(reply, info);
1237 unlock:
1238     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1239     \textcolor{keywordflow}{return} err;
1240 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a5f17e0449c315970d82161c131e70dbd}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+flow\+\_\+cmd\+\_\+msg\+\_\+size@{ovs\+\_\+flow\+\_\+cmd\+\_\+msg\+\_\+size}}
\index{ovs\+\_\+flow\+\_\+cmd\+\_\+msg\+\_\+size@{ovs\+\_\+flow\+\_\+cmd\+\_\+msg\+\_\+size}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+flow\+\_\+cmd\+\_\+msg\+\_\+size}]{\setlength{\rightskip}{0pt plus 5cm}static size\+\_\+t ovs\+\_\+flow\+\_\+cmd\+\_\+msg\+\_\+size (
\begin{DoxyParamCaption}
\item[{const struct {\bf sw\+\_\+flow\+\_\+actions} $\ast$}]{acts, }
\item[{const struct {\bf sw\+\_\+flow\+\_\+id} $\ast$}]{sfid, }
\item[{uint32\+\_\+t}]{ufid\+\_\+flags}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a5f17e0449c315970d82161c131e70dbd}

\begin{DoxyCode}
709 \{
710     \textcolor{keywordtype}{size\_t} len = NLMSG\_ALIGN(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structovs__header}{ovs\_header}));
711 
712     \textcolor{comment}{/* OVS\_FLOW\_ATTR\_UFID */}
713     \textcolor{keywordflow}{if} (sfid && \hyperlink{flow_8h_a995966854ceb0b5a72ff027c12ccf426}{ovs\_identifier\_is\_ufid}(sfid))
714         len += nla\_total\_size(sfid->\hyperlink{structsw__flow__id_a7cfead96fedf295e55d6a17857adfbf5}{ufid\_len});
715 
716     \textcolor{comment}{/* OVS\_FLOW\_ATTR\_KEY */}
717     \textcolor{keywordflow}{if} (!sfid || \hyperlink{datapath_8c_a4d912d3ed7dba8789b726280b6dea3a4}{should\_fill\_key}(sfid, ufid\_flags))
718         len += nla\_total\_size(\hyperlink{flow__netlink_8c_a4ea1ec7f3650fd324fc1538c97e795d0}{ovs\_key\_attr\_size}());
719 
720     \textcolor{comment}{/* OVS\_FLOW\_ATTR\_MASK */}
721     \textcolor{keywordflow}{if} (\hyperlink{datapath_8c_acef91dffd31fb70fa6c94e11ad08805b}{should\_fill\_mask}(ufid\_flags))
722         len += nla\_total\_size(\hyperlink{flow__netlink_8c_a4ea1ec7f3650fd324fc1538c97e795d0}{ovs\_key\_attr\_size}());
723 
724     \textcolor{comment}{/* OVS\_FLOW\_ATTR\_ACTIONS */}
725     \textcolor{keywordflow}{if} (\hyperlink{datapath_8c_a05dcb72a9103046c5721d03a1592291f}{should\_fill\_actions}(ufid\_flags))
726         len += nla\_total\_size(acts->\hyperlink{structsw__flow__actions_ad18c83862d211746fc0542eabff148a5}{actions\_len});
727 
728     \textcolor{keywordflow}{return} len
729         + nla\_total\_size(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structovs__flow__stats}{ovs\_flow\_stats})) \textcolor{comment}{/* OVS\_FLOW\_ATTR\_STATS */}
730         + nla\_total\_size(1) \textcolor{comment}{/* OVS\_FLOW\_ATTR\_TCP\_FLAGS */}
731         + nla\_total\_size(8); \textcolor{comment}{/* OVS\_FLOW\_ATTR\_USED */}
732 \}
\end{DoxyCode}
\hypertarget{datapath_8c_ac8895cf604439184dad96f70e335afe2}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+flow\+\_\+cmd\+\_\+new@{ovs\+\_\+flow\+\_\+cmd\+\_\+new}}
\index{ovs\+\_\+flow\+\_\+cmd\+\_\+new@{ovs\+\_\+flow\+\_\+cmd\+\_\+new}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+flow\+\_\+cmd\+\_\+new}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+flow\+\_\+cmd\+\_\+new (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct genl\+\_\+info $\ast$}]{info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_ac8895cf604439184dad96f70e335afe2}

\begin{DoxyCode}
893 \{
894     \textcolor{keyword}{struct }nlattr **a = info->attrs;
895     \textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header} *\hyperlink{structovs__header}{ovs\_header} = info->userhdr;
896     \textcolor{keyword}{struct }\hyperlink{structsw__flow}{sw\_flow} *flow = NULL, *new\_flow;
897     \textcolor{keyword}{struct }\hyperlink{structsw__flow__mask}{sw\_flow\_mask} mask;
898     \textcolor{keyword}{struct }sk\_buff *reply;
899     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
900     \textcolor{keyword}{struct }\hyperlink{structsw__flow__key}{sw\_flow\_key} key;
901     \textcolor{keyword}{struct }\hyperlink{structsw__flow__actions}{sw\_flow\_actions} *acts;
902     \textcolor{keyword}{struct }\hyperlink{structsw__flow__match}{sw\_flow\_match} match;
903     u32 ufid\_flags = \hyperlink{flow__netlink_8c_a415cb727697a02d62b8ff40795337d40}{ovs\_nla\_get\_ufid\_flags}(a[
      \hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a151813739a9f8d3ecc0c08503b9b0042}{OVS\_FLOW\_ATTR\_UFID\_FLAGS}]);
904     \textcolor{keywordtype}{int} error;
905     \textcolor{keywordtype}{bool} log = !a[\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a667851b468a6c195d627220177b2a973}{OVS\_FLOW\_ATTR\_PROBE}];
906 
907     \textcolor{comment}{/* Must have key and actions. */}
908     error = -EINVAL;
909     \textcolor{keywordflow}{if} (!a[\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a0d310e7624962a1b4c5212459995a5c9}{OVS\_FLOW\_ATTR\_KEY}]) \{
910         \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Flow key attr not present in new flow."});
911         \textcolor{keywordflow}{goto} error;
912     \}
913     \textcolor{keywordflow}{if} (!a[\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554ae28f57a4b243f965ad67a6e96ad09aea}{OVS\_FLOW\_ATTR\_ACTIONS}]) \{
914         \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Flow actions attr not present in new flow."});
915         \textcolor{keywordflow}{goto} error;
916     \}
917 
918     \textcolor{comment}{/* Most of the time we need to allocate a new flow, do it before}
919 \textcolor{comment}{     * locking.}
920 \textcolor{comment}{     */}
921     new\_flow = \hyperlink{flow__table_8c_acce701c647d8e59486574fba1be3e10c}{ovs\_flow\_alloc}();
922     \textcolor{keywordflow}{if} (IS\_ERR(new\_flow)) \{
923         error = PTR\_ERR(new\_flow);
924         \textcolor{keywordflow}{goto} error;
925     \}
926 
927     \textcolor{comment}{/* Extract key. */}
928     \hyperlink{flow__netlink_8c_a1a09e9d38844c59332975789573e994c}{ovs\_match\_init}(&match, &\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}, &\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask});
929     error = \hyperlink{flow__netlink_8c_a074547b2bcb32890a72ae873700391d5}{ovs\_nla\_get\_match}(&match, a[OVS\_FLOW\_ATTR\_KEY],
930                   a[\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a355a203b089e115abb28ea003dc5822c}{OVS\_FLOW\_ATTR\_MASK}], log);
931     \textcolor{keywordflow}{if} (error)
932         \textcolor{keywordflow}{goto} err\_kfree\_flow;
933 
934     \hyperlink{flow__table_8c_a40f76cbd2e168abb1b9744562e24be3b}{ovs\_flow\_mask\_key}(&new\_flow->key, &\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}, &\hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask});
935 
936     \textcolor{comment}{/* Extract flow identifier. */}
937     error = \hyperlink{flow__netlink_8c_aa416ab3b06ce40eee0be66306129c8d5}{ovs\_nla\_get\_identifier}(&new\_flow->id, a[
      \hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a0d2822e9d4b6fa37c54dd8b693c2b465}{OVS\_FLOW\_ATTR\_UFID}],
938                        &\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key}, log);
939     \textcolor{keywordflow}{if} (error)
940         \textcolor{keywordflow}{goto} err\_kfree\_flow;
941 
942     \textcolor{comment}{/* Validate actions. */}
943     error = \hyperlink{flow__netlink_8c_a10dc93f8c379eae7a557d54d9b387dd6}{ovs\_nla\_copy\_actions}(a[OVS\_FLOW\_ATTR\_ACTIONS], &new\_flow->key,
944                      &acts, log);
945     \textcolor{keywordflow}{if} (error) \{
946         \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Flow actions may not be safe on all matching packets."});
947         \textcolor{keywordflow}{goto} err\_kfree\_flow;
948     \}
949 
950     reply = \hyperlink{datapath_8c_ac6daf72fcac45a9bd571dec78216e197}{ovs\_flow\_cmd\_alloc\_info}(acts, &new\_flow->id, info, \textcolor{keyword}{false},
951                     ufid\_flags);
952     \textcolor{keywordflow}{if} (IS\_ERR(reply)) \{
953         error = PTR\_ERR(reply);
954         \textcolor{keywordflow}{goto} err\_kfree\_acts;
955     \}
956 
957     \hyperlink{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}{ovs\_lock}();
958     dp = \hyperlink{datapath_8c_a1107d4fd386aa6551511140b5405e1d3}{get\_dp}(sock\_net(skb->sk), ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex});
959     \textcolor{keywordflow}{if} (unlikely(!dp)) \{
960         error = -ENODEV;
961         \textcolor{keywordflow}{goto} err\_unlock\_ovs;
962     \}
963 
964     \textcolor{comment}{/* Check if this is a duplicate flow */}
965     \textcolor{keywordflow}{if} (\hyperlink{flow_8h_a995966854ceb0b5a72ff027c12ccf426}{ovs\_identifier\_is\_ufid}(&new\_flow->id))
966         flow = \hyperlink{flow__table_8c_a522dbf2a9a0518ff57eb58c09b69448c}{ovs\_flow\_tbl\_lookup\_ufid}(&dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table}, &new\_flow->id);
967     \textcolor{keywordflow}{if} (!flow)
968         flow = \hyperlink{flow__table_8c_a0d208a262dd7b040266e554a447fa099}{ovs\_flow\_tbl\_lookup}(&dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table}, &\hyperlink{structsw__flow__match_a4030aac38105b63798ea11f43f506372}{key});
969     \textcolor{keywordflow}{if} (likely(!flow)) \{
970         rcu\_assign\_pointer(new\_flow->sf\_acts, acts);
971 
972         \textcolor{comment}{/* Put flow in bucket. */}
973         error = \hyperlink{flow__table_8c_a72ec4f72961a64b1c006978a32554a4c}{ovs\_flow\_tbl\_insert}(&dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table}, new\_flow, &
      \hyperlink{structsw__flow__match_a4536aff731528d6def7d386435c203d1}{mask});
974         \textcolor{keywordflow}{if} (unlikely(error)) \{
975             acts = NULL;
976             \textcolor{keywordflow}{goto} err\_unlock\_ovs;
977         \}
978 
979         \textcolor{keywordflow}{if} (unlikely(reply)) \{
980             error = \hyperlink{datapath_8c_a7b415415fa0d84bab45258cd3080f2c7}{ovs\_flow\_cmd\_fill\_info}(new\_flow,
981                                ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex},
982                                reply, info->snd\_portid,
983                                info->snd\_seq, 0,
984                                \hyperlink{openvswitch_8h_ab057316614ced2632c206f5b09fb6406ac86b2408dee1e6128057215035e2515e}{OVS\_FLOW\_CMD\_NEW},
985                                ufid\_flags);
986             BUG\_ON(error < 0);
987         \}
988         \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
989     \} \textcolor{keywordflow}{else} \{
990         \textcolor{keyword}{struct }\hyperlink{structsw__flow__actions}{sw\_flow\_actions} *old\_acts;
991 
992         \textcolor{comment}{/* Bail out if we're not allowed to modify an existing flow.}
993 \textcolor{comment}{         * We accept NLM\_F\_CREATE in place of the intended NLM\_F\_EXCL}
994 \textcolor{comment}{         * because Generic Netlink treats the latter as a dump}
995 \textcolor{comment}{         * request.  We also accept NLM\_F\_EXCL in case that bug ever}
996 \textcolor{comment}{         * gets fixed.}
997 \textcolor{comment}{         */}
998         \textcolor{keywordflow}{if} (unlikely(info->nlhdr->nlmsg\_flags & (NLM\_F\_CREATE
999                              | NLM\_F\_EXCL))) \{
1000             error = -EEXIST;
1001             \textcolor{keywordflow}{goto} err\_unlock\_ovs;
1002         \}
1003         \textcolor{comment}{/* The flow identifier has to be the same for flow updates.}
1004 \textcolor{comment}{         * Look for any overlapping flow.}
1005 \textcolor{comment}{         */}
1006         \textcolor{keywordflow}{if} (unlikely(!\hyperlink{flow__table_8c_aa91629aca9fd74e235332c7a015d9528}{ovs\_flow\_cmp}(flow, &match))) \{
1007             \textcolor{keywordflow}{if} (\hyperlink{flow_8h_a3bfeaa297d8807b969a14f1cde78d21b}{ovs\_identifier\_is\_key}(&flow->\hyperlink{structsw__flow_a6e6645eec909d54871675be30000c0b9}{id}))
1008                 flow = \hyperlink{flow__table_8c_ad54c8ee8b511e42f2296bcf5ff8d0fd3}{ovs\_flow\_tbl\_lookup\_exact}(&dp->
      \hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table},
1009                                  &match);
1010             \textcolor{keywordflow}{else} \textcolor{comment}{/* UFID matches but key is different */}
1011                 flow = NULL;
1012             \textcolor{keywordflow}{if} (!flow) \{
1013                 error = -ENOENT;
1014                 \textcolor{keywordflow}{goto} err\_unlock\_ovs;
1015             \}
1016         \}
1017         \textcolor{comment}{/* Update actions. */}
1018         old\_acts = \hyperlink{datapath_8h_a06ef69170d345fd3996a467dcacf3ff3}{ovsl\_dereference}(flow->\hyperlink{structsw__flow_aa845bdaabc25d81dcf8b1a7519b35408}{sf\_acts});
1019         rcu\_assign\_pointer(flow->\hyperlink{structsw__flow_aa845bdaabc25d81dcf8b1a7519b35408}{sf\_acts}, acts);
1020 
1021         \textcolor{keywordflow}{if} (unlikely(reply)) \{
1022             error = \hyperlink{datapath_8c_a7b415415fa0d84bab45258cd3080f2c7}{ovs\_flow\_cmd\_fill\_info}(flow,
1023                                ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex},
1024                                reply, info->snd\_portid,
1025                                info->snd\_seq, 0,
1026                                \hyperlink{openvswitch_8h_ab057316614ced2632c206f5b09fb6406ac86b2408dee1e6128057215035e2515e}{OVS\_FLOW\_CMD\_NEW},
1027                                ufid\_flags);
1028             BUG\_ON(error < 0);
1029         \}
1030         \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1031 
1032         \hyperlink{flow__netlink_8c_a5e773c3bb49bbeb0c0a4eb356c779a22}{ovs\_nla\_free\_flow\_actions}(old\_acts);
1033         \hyperlink{flow__table_8c_a8133cf46e955b2ae38a0bb8afc0a454f}{ovs\_flow\_free}(new\_flow, \textcolor{keyword}{false});
1034     \}
1035 
1036     \textcolor{keywordflow}{if} (reply)
1037         \hyperlink{datapath_8c_a67f527ad1164ff0d67fe854584ced567}{ovs\_notify}(&\hyperlink{datapath_8c_af07853d514acd11f9f0d23494b6a2f9e}{dp\_flow\_genl\_family}, &
      \hyperlink{datapath_8c_ae43fcc307ac0fa091a736d4687c7f884}{ovs\_dp\_flow\_multicast\_group}, reply, info);
1038     \textcolor{keywordflow}{return} 0;
1039 
1040 err\_unlock\_ovs:
1041     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1042     kfree\_skb(reply);
1043 err\_kfree\_acts:
1044     kfree(acts);
1045 err\_kfree\_flow:
1046     \hyperlink{flow__table_8c_a8133cf46e955b2ae38a0bb8afc0a454f}{ovs\_flow\_free}(new\_flow, \textcolor{keyword}{false});
1047 error:
1048     \textcolor{keywordflow}{return} error;
1049 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a4c6c2d9354cb73a6300a9b3c9cd2a114}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+flow\+\_\+cmd\+\_\+set@{ovs\+\_\+flow\+\_\+cmd\+\_\+set}}
\index{ovs\+\_\+flow\+\_\+cmd\+\_\+set@{ovs\+\_\+flow\+\_\+cmd\+\_\+set}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+flow\+\_\+cmd\+\_\+set}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+flow\+\_\+cmd\+\_\+set (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct genl\+\_\+info $\ast$}]{info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a4c6c2d9354cb73a6300a9b3c9cd2a114}

\begin{DoxyCode}
1073 \{
1074     \textcolor{keyword}{struct }nlattr **a = info->attrs;
1075     \textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header} *\hyperlink{structovs__header}{ovs\_header} = info->userhdr;
1076     \textcolor{keyword}{struct }\hyperlink{structsw__flow__key}{sw\_flow\_key} key;
1077     \textcolor{keyword}{struct }\hyperlink{structsw__flow}{sw\_flow} *flow;
1078     \textcolor{keyword}{struct }\hyperlink{structsw__flow__mask}{sw\_flow\_mask} mask;
1079     \textcolor{keyword}{struct }sk\_buff *reply = NULL;
1080     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
1081     \textcolor{keyword}{struct }\hyperlink{structsw__flow__actions}{sw\_flow\_actions} *old\_acts = NULL, *acts = NULL;
1082     \textcolor{keyword}{struct }\hyperlink{structsw__flow__match}{sw\_flow\_match} match;
1083     \textcolor{keyword}{struct }\hyperlink{structsw__flow__id}{sw\_flow\_id} sfid;
1084     u32 ufid\_flags = \hyperlink{flow__netlink_8c_a415cb727697a02d62b8ff40795337d40}{ovs\_nla\_get\_ufid\_flags}(a[
      \hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a151813739a9f8d3ecc0c08503b9b0042}{OVS\_FLOW\_ATTR\_UFID\_FLAGS}]);
1085     \textcolor{keywordtype}{int} error;
1086     \textcolor{keywordtype}{bool} log = !a[\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a667851b468a6c195d627220177b2a973}{OVS\_FLOW\_ATTR\_PROBE}];
1087     \textcolor{keywordtype}{bool} ufid\_present;
1088 
1089     \textcolor{comment}{/* Extract key. */}
1090     error = -EINVAL;
1091     \textcolor{keywordflow}{if} (!a[\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a0d310e7624962a1b4c5212459995a5c9}{OVS\_FLOW\_ATTR\_KEY}]) \{
1092         \hyperlink{datapath_8h_a54648b7a2c9b192074cd95eb945433f0}{OVS\_NLERR}(log, \textcolor{stringliteral}{"Flow key attribute not present in set flow."});
1093         \textcolor{keywordflow}{goto} error;
1094     \}
1095 
1096     ufid\_present = \hyperlink{flow__netlink_8c_a81e0cfe1c434ecde4ad684c8b8586877}{ovs\_nla\_get\_ufid}(&sfid, a[\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a0d2822e9d4b6fa37c54dd8b693c2b465}{OVS\_FLOW\_ATTR\_UFID}], log);
1097     \hyperlink{flow__netlink_8c_a1a09e9d38844c59332975789573e994c}{ovs\_match\_init}(&match, &key, &mask);
1098     error = \hyperlink{flow__netlink_8c_a074547b2bcb32890a72ae873700391d5}{ovs\_nla\_get\_match}(&match, a[OVS\_FLOW\_ATTR\_KEY],
1099                   a[\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a355a203b089e115abb28ea003dc5822c}{OVS\_FLOW\_ATTR\_MASK}], log);
1100     \textcolor{keywordflow}{if} (error)
1101         \textcolor{keywordflow}{goto} error;
1102 
1103     \textcolor{comment}{/* Validate actions. */}
1104     \textcolor{keywordflow}{if} (a[\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554ae28f57a4b243f965ad67a6e96ad09aea}{OVS\_FLOW\_ATTR\_ACTIONS}]) \{
1105         acts = \hyperlink{datapath_8c_aac07273dc62dc714973b44be41f9bf7f}{get\_flow\_actions}(a[OVS\_FLOW\_ATTR\_ACTIONS], &key, &mask,
1106                     log);
1107         \textcolor{keywordflow}{if} (IS\_ERR(acts)) \{
1108             error = PTR\_ERR(acts);
1109             \textcolor{keywordflow}{goto} error;
1110         \}
1111 
1112         \textcolor{comment}{/* Can allocate before locking if have acts. */}
1113         reply = \hyperlink{datapath_8c_ac6daf72fcac45a9bd571dec78216e197}{ovs\_flow\_cmd\_alloc\_info}(acts, &sfid, info, \textcolor{keyword}{false},
1114                         ufid\_flags);
1115         \textcolor{keywordflow}{if} (IS\_ERR(reply)) \{
1116             error = PTR\_ERR(reply);
1117             \textcolor{keywordflow}{goto} err\_kfree\_acts;
1118         \}
1119     \}
1120 
1121     \hyperlink{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}{ovs\_lock}();
1122     dp = \hyperlink{datapath_8c_a1107d4fd386aa6551511140b5405e1d3}{get\_dp}(sock\_net(skb->sk), ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex});
1123     \textcolor{keywordflow}{if} (unlikely(!dp)) \{
1124         error = -ENODEV;
1125         \textcolor{keywordflow}{goto} err\_unlock\_ovs;
1126     \}
1127     \textcolor{comment}{/* Check that the flow exists. */}
1128     \textcolor{keywordflow}{if} (ufid\_present)
1129         flow = \hyperlink{flow__table_8c_a522dbf2a9a0518ff57eb58c09b69448c}{ovs\_flow\_tbl\_lookup\_ufid}(&dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table}, &sfid);
1130     \textcolor{keywordflow}{else}
1131         flow = \hyperlink{flow__table_8c_ad54c8ee8b511e42f2296bcf5ff8d0fd3}{ovs\_flow\_tbl\_lookup\_exact}(&dp->\hyperlink{structdatapath_ac6d67fe586c19484391acbcfa267259d}{table}, &match);
1132     \textcolor{keywordflow}{if} (unlikely(!flow)) \{
1133         error = -ENOENT;
1134         \textcolor{keywordflow}{goto} err\_unlock\_ovs;
1135     \}
1136 
1137     \textcolor{comment}{/* Update actions, if present. */}
1138     \textcolor{keywordflow}{if} (likely(acts)) \{
1139         old\_acts = \hyperlink{datapath_8h_a06ef69170d345fd3996a467dcacf3ff3}{ovsl\_dereference}(flow->\hyperlink{structsw__flow_aa845bdaabc25d81dcf8b1a7519b35408}{sf\_acts});
1140         rcu\_assign\_pointer(flow->\hyperlink{structsw__flow_aa845bdaabc25d81dcf8b1a7519b35408}{sf\_acts}, acts);
1141 
1142         \textcolor{keywordflow}{if} (unlikely(reply)) \{
1143             error = \hyperlink{datapath_8c_a7b415415fa0d84bab45258cd3080f2c7}{ovs\_flow\_cmd\_fill\_info}(flow,
1144                                ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex},
1145                                reply, info->snd\_portid,
1146                                info->snd\_seq, 0,
1147                                \hyperlink{openvswitch_8h_ab057316614ced2632c206f5b09fb6406ac86b2408dee1e6128057215035e2515e}{OVS\_FLOW\_CMD\_NEW},
1148                                ufid\_flags);
1149             BUG\_ON(error < 0);
1150         \}
1151     \} \textcolor{keywordflow}{else} \{
1152         \textcolor{comment}{/* Could not alloc without acts before locking. */}
1153         reply = \hyperlink{datapath_8c_afbfb35c0b3684e82dce573f04491ad1e}{ovs\_flow\_cmd\_build\_info}(flow, ovs\_header->
      \hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex},
1154                         info, \hyperlink{openvswitch_8h_ab057316614ced2632c206f5b09fb6406ac86b2408dee1e6128057215035e2515e}{OVS\_FLOW\_CMD\_NEW}, \textcolor{keyword}{false},
1155                         ufid\_flags);
1156 
1157         \textcolor{keywordflow}{if} (unlikely(IS\_ERR(reply))) \{
1158             error = PTR\_ERR(reply);
1159             \textcolor{keywordflow}{goto} err\_unlock\_ovs;
1160         \}
1161     \}
1162 
1163     \textcolor{comment}{/* Clear stats. */}
1164     \textcolor{keywordflow}{if} (a[\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a4f9d4c0277a9ba32b021a411a37259c6}{OVS\_FLOW\_ATTR\_CLEAR}])
1165         \hyperlink{flow_8c_a8dfa7ecd72ff9237664d0c402ff3f543}{ovs\_flow\_stats\_clear}(flow);
1166     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1167 
1168     \textcolor{keywordflow}{if} (reply)
1169         \hyperlink{datapath_8c_a67f527ad1164ff0d67fe854584ced567}{ovs\_notify}(&\hyperlink{datapath_8c_af07853d514acd11f9f0d23494b6a2f9e}{dp\_flow\_genl\_family}, &
      \hyperlink{datapath_8c_ae43fcc307ac0fa091a736d4687c7f884}{ovs\_dp\_flow\_multicast\_group}, reply, info);
1170     \textcolor{keywordflow}{if} (old\_acts)
1171         \hyperlink{flow__netlink_8c_a5e773c3bb49bbeb0c0a4eb356c779a22}{ovs\_nla\_free\_flow\_actions}(old\_acts);
1172 
1173     \textcolor{keywordflow}{return} 0;
1174 
1175 err\_unlock\_ovs:
1176     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1177     kfree\_skb(reply);
1178 err\_kfree\_acts:
1179     kfree(acts);
1180 error:
1181     \textcolor{keywordflow}{return} error;
1182 \}
\end{DoxyCode}
\hypertarget{datapath_8c_af390458a6069bd6b50c9a0d46517159a}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+init\+\_\+net@{ovs\+\_\+init\+\_\+net}}
\index{ovs\+\_\+init\+\_\+net@{ovs\+\_\+init\+\_\+net}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+init\+\_\+net}]{\setlength{\rightskip}{0pt plus 5cm}static int \+\_\+\+\_\+net\+\_\+init ovs\+\_\+init\+\_\+net (
\begin{DoxyParamCaption}
\item[{struct net $\ast$}]{net}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_af390458a6069bd6b50c9a0d46517159a}

\begin{DoxyCode}
2212 \{
2213     \textcolor{keyword}{struct }\hyperlink{structovs__net}{ovs\_net} *\hyperlink{structovs__net}{ovs\_net} = net\_generic(net, \hyperlink{datapath_8h_ace140298dc2b59b3d77d59c0a210de29}{ovs\_net\_id});
2214 
2215     INIT\_LIST\_HEAD(&ovs\_net->\hyperlink{structovs__net_a0490101f7ea82f5c290a92d447bd8f9d}{dps});
2216     INIT\_WORK(&ovs\_net->\hyperlink{structovs__net_ac8cdb834420a37531f032e526ac61901}{dp\_notify\_work}, \hyperlink{datapath_8h_a5d5624a3bb21c222e3a6f18f56ff20b2}{ovs\_dp\_notify\_wq});
2217     \textcolor{keywordflow}{return} 0;
2218 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+lock@{ovs\+\_\+lock}}
\index{ovs\+\_\+lock@{ovs\+\_\+lock}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+lock}]{\setlength{\rightskip}{0pt plus 5cm}void ovs\+\_\+lock (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\label{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}

\begin{DoxyCode}
121 \{
122     mutex\_lock(&ovs\_mutex);
123 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a0a9ec01692e1fdcb15a9a294d3789af0}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+lookup\+\_\+vport@{ovs\+\_\+lookup\+\_\+vport}}
\index{ovs\+\_\+lookup\+\_\+vport@{ovs\+\_\+lookup\+\_\+vport}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+lookup\+\_\+vport}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf vport}$\ast$ ovs\+\_\+lookup\+\_\+vport (
\begin{DoxyParamCaption}
\item[{const struct {\bf datapath} $\ast$}]{dp, }
\item[{u16}]{port\+\_\+no}
\end{DoxyParamCaption}
)}\label{datapath_8c_a0a9ec01692e1fdcb15a9a294d3789af0}

\begin{DoxyCode}
221 \{
222     \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport};
223     \textcolor{keyword}{struct }hlist\_head *head;
224 
225     head = \hyperlink{datapath_8c_af291a723340e4e1bd38b4b14e7f4377a}{vport\_hash\_bucket}(dp, port\_no);
226     \hyperlink{rculist_8h_a482ed6bca0b607f6455d5386f3b1ed75}{hlist\_for\_each\_entry\_rcu}(vport, head, dp\_hash\_node) \{
227         \textcolor{keywordflow}{if} (vport->\hyperlink{structvport_aae00fc5d12b47f02cbfd4f67ae114b58}{port\_no} == port\_no)
228             \textcolor{keywordflow}{return} vport;
229     \}
230     \textcolor{keywordflow}{return} NULL;
231 \}
\end{DoxyCode}
\hypertarget{datapath_8c_aba3b63f0e73c9ea6ecb8b7aa5d913724}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+must\+\_\+notify@{ovs\+\_\+must\+\_\+notify}}
\index{ovs\+\_\+must\+\_\+notify@{ovs\+\_\+must\+\_\+notify}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+must\+\_\+notify}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf bool} ovs\+\_\+must\+\_\+notify (
\begin{DoxyParamCaption}
\item[{struct {\bf genl\+\_\+family} $\ast$}]{family, }
\item[{struct genl\+\_\+info $\ast$}]{info, }
\item[{unsigned int}]{group}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_aba3b63f0e73c9ea6ecb8b7aa5d913724}

\begin{DoxyCode}
89 \{
90     \textcolor{keywordflow}{return} info->nlhdr->nlmsg\_flags & NLM\_F\_ECHO ||
91            \hyperlink{genetlink_8h_aa54145e7af183e7c5fb8fb3fd3c74465}{genl\_has\_listeners}(family, genl\_info\_net(info), group);
92 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a67f527ad1164ff0d67fe854584ced567}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+notify@{ovs\+\_\+notify}}
\index{ovs\+\_\+notify@{ovs\+\_\+notify}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+notify}]{\setlength{\rightskip}{0pt plus 5cm}static void ovs\+\_\+notify (
\begin{DoxyParamCaption}
\item[{struct {\bf genl\+\_\+family} $\ast$}]{family, }
\item[{struct genl\+\_\+multicast\+\_\+group $\ast$}]{grp, }
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct genl\+\_\+info $\ast$}]{info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a67f527ad1164ff0d67fe854584ced567}

\begin{DoxyCode}
96 \{
97     \hyperlink{genetlink_8h_a3e365d35277825cfe05ad9d319085842}{genl\_notify}(family, skb, genl\_info\_net(info),
98             info->snd\_portid, \hyperlink{compat_8h_ab49ad0e0c1bb8cda8015902526ae189c}{GROUP\_ID}(grp), info->nlhdr, GFP\_KERNEL);
99 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a20b16b839bd3116f7dbad5719b02c115}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+packet\+\_\+cmd\+\_\+execute@{ovs\+\_\+packet\+\_\+cmd\+\_\+execute}}
\index{ovs\+\_\+packet\+\_\+cmd\+\_\+execute@{ovs\+\_\+packet\+\_\+cmd\+\_\+execute}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+packet\+\_\+cmd\+\_\+execute}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+packet\+\_\+cmd\+\_\+execute (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct genl\+\_\+info $\ast$}]{info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a20b16b839bd3116f7dbad5719b02c115}

\begin{DoxyCode}
537 \{
538     \textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header} *\hyperlink{structovs__header}{ovs\_header} = info->userhdr;
539     \textcolor{keyword}{struct }nlattr **a = info->attrs;
540     \textcolor{keyword}{struct }\hyperlink{structsw__flow__actions}{sw\_flow\_actions} *acts;
541     \textcolor{keyword}{struct }sk\_buff *packet;
542     \textcolor{keyword}{struct }\hyperlink{structsw__flow}{sw\_flow} *flow;
543     \textcolor{keyword}{struct }\hyperlink{structsw__flow__actions}{sw\_flow\_actions} *sf\_acts;
544     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
545     \textcolor{keyword}{struct }ethhdr *\hyperlink{flow_8h_a1679a3c93391059deba58179f52c86a6}{eth};
546     \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *input\_vport;
547     \textcolor{keywordtype}{int} len;
548     \textcolor{keywordtype}{int} err;
549     \textcolor{keywordtype}{bool} log = !a[\hyperlink{openvswitch_8h_a34899be8f30456f4c7c2747eaf3eb78ba704db48bfb2df7e31805ee5c5909172e}{OVS\_PACKET\_ATTR\_PROBE}];
550 
551     err = -EINVAL;
552     \textcolor{keywordflow}{if} (!a[\hyperlink{openvswitch_8h_a34899be8f30456f4c7c2747eaf3eb78bac19f59ebb0be0e7a3d6e145369562977}{OVS\_PACKET\_ATTR\_PACKET}] || !a[
      \hyperlink{openvswitch_8h_a34899be8f30456f4c7c2747eaf3eb78ba24d5d8704ff3c8ad939a01ea2f29acf7}{OVS\_PACKET\_ATTR\_KEY}] ||
553         !a[\hyperlink{openvswitch_8h_a34899be8f30456f4c7c2747eaf3eb78ba92b7b96f0518290779bfd078f1456d85}{OVS\_PACKET\_ATTR\_ACTIONS}])
554         \textcolor{keywordflow}{goto} err;
555 
556     len = nla\_len(a[\hyperlink{openvswitch_8h_a34899be8f30456f4c7c2747eaf3eb78bac19f59ebb0be0e7a3d6e145369562977}{OVS\_PACKET\_ATTR\_PACKET}]);
557     packet = \_\_dev\_alloc\_skb(NET\_IP\_ALIGN + len, GFP\_KERNEL);
558     err = -ENOMEM;
559     \textcolor{keywordflow}{if} (!packet)
560         \textcolor{keywordflow}{goto} err;
561     skb\_reserve(packet, NET\_IP\_ALIGN);
562 
563     nla\_memcpy(\_\_skb\_put(packet, len), a[\hyperlink{openvswitch_8h_a34899be8f30456f4c7c2747eaf3eb78bac19f59ebb0be0e7a3d6e145369562977}{OVS\_PACKET\_ATTR\_PACKET}], len);
564 
565     \hyperlink{skbuff_8h_aaf81c26756757ac1e1d7e6933f61bdaf}{skb\_reset\_mac\_header}(packet);
566     eth = eth\_hdr(packet);
567 
568     \textcolor{comment}{/* Normally, setting the skb 'protocol' field would be handled by a}
569 \textcolor{comment}{     * call to eth\_type\_trans(), but it assumes there's a sending}
570 \textcolor{comment}{     * device, which we may not have.}
571 \textcolor{comment}{     */}
572     \textcolor{keywordflow}{if} (eth\_proto\_is\_802\_3(eth->h\_proto))
573         packet->protocol = eth->h\_proto;
574     \textcolor{keywordflow}{else}
575         packet->protocol = htons(ETH\_P\_802\_2);
576 
577     \textcolor{comment}{/* Build an sw\_flow for sending this packet. */}
578     flow = \hyperlink{flow__table_8c_acce701c647d8e59486574fba1be3e10c}{ovs\_flow\_alloc}();
579     err = PTR\_ERR(flow);
580     \textcolor{keywordflow}{if} (IS\_ERR(flow))
581         \textcolor{keywordflow}{goto} err\_kfree\_skb;
582 
583     err = \hyperlink{flow_8c_a5e042238993a5a8a8a8b3472cb274ead}{ovs\_flow\_key\_extract\_userspace}(a[
      \hyperlink{openvswitch_8h_a34899be8f30456f4c7c2747eaf3eb78ba24d5d8704ff3c8ad939a01ea2f29acf7}{OVS\_PACKET\_ATTR\_KEY}], packet,
584                          &flow->\hyperlink{structsw__flow_a14b83cbd65275bda4e97ae35500d26d8}{key}, log);
585     \textcolor{keywordflow}{if} (err)
586         \textcolor{keywordflow}{goto} err\_flow\_free;
587 
588     err = \hyperlink{flow__netlink_8c_a10dc93f8c379eae7a557d54d9b387dd6}{ovs\_nla\_copy\_actions}(a[OVS\_PACKET\_ATTR\_ACTIONS],
589                    &flow->\hyperlink{structsw__flow_a14b83cbd65275bda4e97ae35500d26d8}{key}, &acts, log);
590     \textcolor{keywordflow}{if} (err)
591         \textcolor{keywordflow}{goto} err\_flow\_free;
592 
593     rcu\_assign\_pointer(flow->\hyperlink{structsw__flow_aa845bdaabc25d81dcf8b1a7519b35408}{sf\_acts}, acts);
594     \hyperlink{datapath_8h_ac337c4d4ddca29916ce8e900038ddd78}{OVS\_CB}(packet)->egress\_tun\_info = NULL;
595     packet->priority = flow->\hyperlink{structsw__flow_a14b83cbd65275bda4e97ae35500d26d8}{key}.\hyperlink{structsw__flow__key_a57cbddb75a8d4fd859300bd34d98e84a}{phy}.\hyperlink{structsw__flow__key_a9dd898913d9faaec1ec970029e7fbb71}{priority};
596     packet->mark = flow->\hyperlink{structsw__flow_a14b83cbd65275bda4e97ae35500d26d8}{key}.\hyperlink{structsw__flow__key_a57cbddb75a8d4fd859300bd34d98e84a}{phy}.\hyperlink{structsw__flow__key_ae02571657f29397dcc45de8528f4ed05}{skb\_mark};
597 
598     rcu\_read\_lock();
599     dp = \hyperlink{datapath_8c_ab3f598cca9ed98120cc11daa11690da8}{get\_dp\_rcu}(sock\_net(skb->sk), ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex});
600     err = -ENODEV;
601     \textcolor{keywordflow}{if} (!dp)
602         \textcolor{keywordflow}{goto} err\_unlock;
603 
604     input\_vport = \hyperlink{datapath_8h_ac6f3c37a7850774112c03c6e88d89dc0}{ovs\_vport\_rcu}(dp, flow->\hyperlink{structsw__flow_a14b83cbd65275bda4e97ae35500d26d8}{key}.\hyperlink{structsw__flow__key_a57cbddb75a8d4fd859300bd34d98e84a}{phy}.\hyperlink{structsw__flow__key_a5848de18caa80d36d9bc60cc686a2c6e}{in\_port});
605     \textcolor{keywordflow}{if} (!input\_vport)
606         input\_vport = \hyperlink{datapath_8h_ac6f3c37a7850774112c03c6e88d89dc0}{ovs\_vport\_rcu}(dp, \hyperlink{openvswitch_8h_aff2f13b95c27262c520f26831e647598}{OVSP\_LOCAL});
607 
608     \textcolor{keywordflow}{if} (!input\_vport)
609         \textcolor{keywordflow}{goto} err\_unlock;
610 
611     \hyperlink{datapath_8h_ac337c4d4ddca29916ce8e900038ddd78}{OVS\_CB}(packet)->input\_vport = input\_vport;
612     sf\_acts = rcu\_dereference(flow->\hyperlink{structsw__flow_aa845bdaabc25d81dcf8b1a7519b35408}{sf\_acts});
613 
614     local\_bh\_disable();
615     err = \hyperlink{actions_8c_a5b34c1980d155574d657a21cac3bcc37}{ovs\_execute\_actions}(dp, packet, sf\_acts, &flow->\hyperlink{structsw__flow_a14b83cbd65275bda4e97ae35500d26d8}{key});
616     local\_bh\_enable();
617     rcu\_read\_unlock();
618 
619     \hyperlink{flow__table_8c_a8133cf46e955b2ae38a0bb8afc0a454f}{ovs\_flow\_free}(flow, \textcolor{keyword}{false});
620     \textcolor{keywordflow}{return} err;
621 
622 err\_unlock:
623     rcu\_read\_unlock();
624 err\_flow\_free:
625     \hyperlink{flow__table_8c_a8133cf46e955b2ae38a0bb8afc0a454f}{ovs\_flow\_free}(flow, \textcolor{keyword}{false});
626 err\_kfree\_skb:
627     kfree\_skb(packet);
628 err:
629     \textcolor{keywordflow}{return} err;
630 \}
\end{DoxyCode}
\hypertarget{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+unlock@{ovs\+\_\+unlock}}
\index{ovs\+\_\+unlock@{ovs\+\_\+unlock}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+unlock}]{\setlength{\rightskip}{0pt plus 5cm}void ovs\+\_\+unlock (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\label{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}

\begin{DoxyCode}
126 \{
127     mutex\_unlock(&ovs\_mutex);
128 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a45645849b972492fa9f01eeaf668bf78}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+vport\+\_\+cmd\+\_\+alloc\+\_\+info@{ovs\+\_\+vport\+\_\+cmd\+\_\+alloc\+\_\+info}}
\index{ovs\+\_\+vport\+\_\+cmd\+\_\+alloc\+\_\+info@{ovs\+\_\+vport\+\_\+cmd\+\_\+alloc\+\_\+info}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+vport\+\_\+cmd\+\_\+alloc\+\_\+info}]{\setlength{\rightskip}{0pt plus 5cm}static struct sk\+\_\+buff$\ast$ ovs\+\_\+vport\+\_\+cmd\+\_\+alloc\+\_\+info (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a45645849b972492fa9f01eeaf668bf78}

\begin{DoxyCode}
1841 \{
1842     \textcolor{keywordflow}{return} nlmsg\_new(\hyperlink{linux_2netlink_8h_a5098e3f66b13a5c9ad78eeffe65e6868}{NLMSG\_DEFAULT\_SIZE}, GFP\_KERNEL);
1843 \}
\end{DoxyCode}
\hypertarget{datapath_8c_adf50e47c9c548390402b1da1608235c9}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+vport\+\_\+cmd\+\_\+build\+\_\+info@{ovs\+\_\+vport\+\_\+cmd\+\_\+build\+\_\+info}}
\index{ovs\+\_\+vport\+\_\+cmd\+\_\+build\+\_\+info@{ovs\+\_\+vport\+\_\+cmd\+\_\+build\+\_\+info}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+vport\+\_\+cmd\+\_\+build\+\_\+info}]{\setlength{\rightskip}{0pt plus 5cm}struct sk\+\_\+buff$\ast$ ovs\+\_\+vport\+\_\+cmd\+\_\+build\+\_\+info (
\begin{DoxyParamCaption}
\item[{struct {\bf vport} $\ast$}]{vport, }
\item[{u32}]{portid, }
\item[{u32}]{seq, }
\item[{u8}]{cmd}
\end{DoxyParamCaption}
)}\label{datapath_8c_adf50e47c9c548390402b1da1608235c9}

\begin{DoxyCode}
1848 \{
1849     \textcolor{keyword}{struct }sk\_buff *skb;
1850     \textcolor{keywordtype}{int} retval;
1851 
1852     skb = nlmsg\_new(\hyperlink{linux_2netlink_8h_a5098e3f66b13a5c9ad78eeffe65e6868}{NLMSG\_DEFAULT\_SIZE}, GFP\_ATOMIC);
1853     \textcolor{keywordflow}{if} (!skb)
1854         \textcolor{keywordflow}{return} ERR\_PTR(-ENOMEM);
1855 
1856     retval = \hyperlink{datapath_8c_a4272403de9a985cea17181e99b7a7edc}{ovs\_vport\_cmd\_fill\_info}(vport, skb, portid, seq, 0, cmd);
1857     BUG\_ON(retval < 0);
1858 
1859     \textcolor{keywordflow}{return} skb;
1860 \}
\end{DoxyCode}
\hypertarget{datapath_8c_afc2316a8fe3074ed07e853d552fb4704}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+vport\+\_\+cmd\+\_\+del@{ovs\+\_\+vport\+\_\+cmd\+\_\+del}}
\index{ovs\+\_\+vport\+\_\+cmd\+\_\+del@{ovs\+\_\+vport\+\_\+cmd\+\_\+del}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+vport\+\_\+cmd\+\_\+del}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+vport\+\_\+cmd\+\_\+del (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct genl\+\_\+info $\ast$}]{info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_afc2316a8fe3074ed07e853d552fb4704}

\begin{DoxyCode}
2025 \{
2026     \textcolor{keyword}{struct }nlattr **a = info->attrs;
2027     \textcolor{keyword}{struct }sk\_buff *reply;
2028     \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport};
2029     \textcolor{keywordtype}{int} err;
2030 
2031     reply = \hyperlink{datapath_8c_a45645849b972492fa9f01eeaf668bf78}{ovs\_vport\_cmd\_alloc\_info}();
2032     \textcolor{keywordflow}{if} (!reply)
2033         \textcolor{keywordflow}{return} -ENOMEM;
2034 
2035     \hyperlink{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}{ovs\_lock}();
2036     vport = \hyperlink{datapath_8c_a95b019fd3980803dcc1bb5aca920f58b}{lookup\_vport}(sock\_net(skb->sk), info->userhdr, a);
2037     err = PTR\_ERR(vport);
2038     \textcolor{keywordflow}{if} (IS\_ERR(vport))
2039         \textcolor{keywordflow}{goto} exit\_unlock\_free;
2040 
2041     \textcolor{keywordflow}{if} (vport->\hyperlink{structvport_aae00fc5d12b47f02cbfd4f67ae114b58}{port\_no} == \hyperlink{openvswitch_8h_aff2f13b95c27262c520f26831e647598}{OVSP\_LOCAL}) \{
2042         err = -EINVAL;
2043         \textcolor{keywordflow}{goto} exit\_unlock\_free;
2044     \}
2045 
2046     err = \hyperlink{datapath_8c_a4272403de9a985cea17181e99b7a7edc}{ovs\_vport\_cmd\_fill\_info}(vport, reply, info->snd\_portid,
2047                       info->snd\_seq, 0, \hyperlink{openvswitch_8h_ae012c39e873d42b086636b19a242c354a067967d6cc0d7b7283ad6d77cba6936f}{OVS\_VPORT\_CMD\_DEL});
2048     BUG\_ON(err < 0);
2049     \hyperlink{datapath_8c_a560b5f5f97a839287201f7486c53447e}{ovs\_dp\_detach\_port}(vport);
2050     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
2051 
2052     \hyperlink{datapath_8c_a67f527ad1164ff0d67fe854584ced567}{ovs\_notify}(&\hyperlink{datapath_8c_a69bf55f33e234bc4b78e6eeee1d603fd}{dp\_vport\_genl\_family}, &
      \hyperlink{datapath_8c_a9dd8d4307b50fdee582eb4013d89eb7b}{ovs\_dp\_vport\_multicast\_group}, reply, info);
2053     \textcolor{keywordflow}{return} 0;
2054 
2055 exit\_unlock\_free:
2056     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
2057     kfree\_skb(reply);
2058     \textcolor{keywordflow}{return} err;
2059 \}
\end{DoxyCode}
\hypertarget{datapath_8c_ac61e52592bc18541660c182e9aebbcaf}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+vport\+\_\+cmd\+\_\+dump@{ovs\+\_\+vport\+\_\+cmd\+\_\+dump}}
\index{ovs\+\_\+vport\+\_\+cmd\+\_\+dump@{ovs\+\_\+vport\+\_\+cmd\+\_\+dump}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+vport\+\_\+cmd\+\_\+dump}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+vport\+\_\+cmd\+\_\+dump (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct netlink\+\_\+callback $\ast$}]{cb}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_ac61e52592bc18541660c182e9aebbcaf}

\begin{DoxyCode}
2092 \{
2093     \textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header} *\hyperlink{structovs__header}{ovs\_header} = genlmsg\_data(nlmsg\_data(cb->nlh));
2094     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
2095     \textcolor{keywordtype}{int} bucket = cb->args[0], skip = cb->args[1];
2096     \textcolor{keywordtype}{int} i, j = 0;
2097 
2098     rcu\_read\_lock();
2099     dp = \hyperlink{datapath_8c_ab3f598cca9ed98120cc11daa11690da8}{get\_dp\_rcu}(sock\_net(skb->sk), ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex});
2100     \textcolor{keywordflow}{if} (!dp) \{
2101         rcu\_read\_unlock();
2102         \textcolor{keywordflow}{return} -ENODEV;
2103     \}
2104     \textcolor{keywordflow}{for} (i = bucket; i < \hyperlink{datapath_8h_ac1bf9805d62227b8f76f130087e18018}{DP\_VPORT\_HASH\_BUCKETS}; i++) \{
2105         \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport};
2106 
2107         j = 0;
2108         \hyperlink{rculist_8h_a482ed6bca0b607f6455d5386f3b1ed75}{hlist\_for\_each\_entry\_rcu}(vport, &dp->\hyperlink{structdatapath_abb0de528545b312de283b571cb6c4ede}{ports}[i], 
      \hyperlink{structvport_a27d2c94e2edd5de172e0b866cdd70fea}{dp\_hash\_node}) \{
2109             \textcolor{keywordflow}{if} (j >= skip &&
2110                 \hyperlink{datapath_8c_a4272403de9a985cea17181e99b7a7edc}{ovs\_vport\_cmd\_fill\_info}(vport, skb,
2111                             NETLINK\_CB(cb->skb).portid,
2112                             cb->nlh->nlmsg\_seq,
2113                             NLM\_F\_MULTI,
2114                             \hyperlink{openvswitch_8h_ae012c39e873d42b086636b19a242c354af6255867587891980ef6577446362d45}{OVS\_VPORT\_CMD\_NEW}) < 0)
2115                 \textcolor{keywordflow}{goto} out;
2116 
2117             j++;
2118         \}
2119         skip = 0;
2120     \}
2121 out:
2122     rcu\_read\_unlock();
2123 
2124     cb->args[0] = i;
2125     cb->args[1] = j;
2126 
2127     \textcolor{keywordflow}{return} skb->len;
2128 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a4272403de9a985cea17181e99b7a7edc}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+vport\+\_\+cmd\+\_\+fill\+\_\+info@{ovs\+\_\+vport\+\_\+cmd\+\_\+fill\+\_\+info}}
\index{ovs\+\_\+vport\+\_\+cmd\+\_\+fill\+\_\+info@{ovs\+\_\+vport\+\_\+cmd\+\_\+fill\+\_\+info}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+vport\+\_\+cmd\+\_\+fill\+\_\+info}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+vport\+\_\+cmd\+\_\+fill\+\_\+info (
\begin{DoxyParamCaption}
\item[{struct {\bf vport} $\ast$}]{vport, }
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{u32}]{portid, }
\item[{u32}]{seq, }
\item[{u32}]{flags, }
\item[{u8}]{cmd}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a4272403de9a985cea17181e99b7a7edc}

\begin{DoxyCode}
1801 \{
1802     \textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header} *\hyperlink{structovs__header}{ovs\_header};
1803     \textcolor{keyword}{struct }\hyperlink{structovs__vport__stats}{ovs\_vport\_stats} vport\_stats;
1804     \textcolor{keywordtype}{int} err;
1805 
1806     ovs\_header = \hyperlink{genetlink_8h_a306fd8e0093b286af42dfce236aeb096}{genlmsg\_put}(skb, portid, seq, &\hyperlink{datapath_8c_a69bf55f33e234bc4b78e6eeee1d603fd}{dp\_vport\_genl\_family},
1807                  \hyperlink{flow_8h_af4f7a53f6b2df72c34ca881f2714ac91}{flags}, cmd);
1808     \textcolor{keywordflow}{if} (!ovs\_header)
1809         \textcolor{keywordflow}{return} -EMSGSIZE;
1810 
1811     ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex} = \hyperlink{datapath_8c_a2c4c60ba176a755749744f7b01aa6edd}{get\_dpifindex}(vport->\hyperlink{structvport_a49fb6f6bf0ac4337853e9242e88ddc42}{dp});
1812 
1813     \textcolor{keywordflow}{if} (nla\_put\_u32(skb, \hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464da08e4cd652a0f6cd6eeeaac1db3bdf503}{OVS\_VPORT\_ATTR\_PORT\_NO}, vport->
      \hyperlink{structvport_aae00fc5d12b47f02cbfd4f67ae114b58}{port\_no}) ||
1814         nla\_put\_u32(skb, \hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464da84ada86f1005907daaf7dc8eb0c0a637}{OVS\_VPORT\_ATTR\_TYPE}, vport->\hyperlink{structvport_a5af933fc664c1194ac3bbc337da35586}{ops}->
      \hyperlink{structvport__ops_a7dd0d3776e78a2885063d3afd5e78148}{type}) ||
1815         nla\_put\_string(skb, \hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464daef39b12d8a0cb39f2248d82f435bec3c}{OVS\_VPORT\_ATTR\_NAME}, vport->\hyperlink{structvport_a5af933fc664c1194ac3bbc337da35586}{ops}->
      \hyperlink{structvport__ops_abe0c3315271724bf05338487e0ced13c}{get\_name}(vport)))
1816         \textcolor{keywordflow}{goto} nla\_put\_failure;
1817 
1818     \hyperlink{linux_2vport_8c_a7753bcf5f4263f9f8d9d4ff42e64d86a}{ovs\_vport\_get\_stats}(vport, &vport\_stats);
1819     \textcolor{keywordflow}{if} (nla\_put(skb, \hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464dadab030c40c3510bf42f3e33d3986fbaa}{OVS\_VPORT\_ATTR\_STATS}, \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} 
      \hyperlink{structovs__vport__stats}{ovs\_vport\_stats}),
1820             &vport\_stats))
1821         \textcolor{keywordflow}{goto} nla\_put\_failure;
1822 
1823     \textcolor{keywordflow}{if} (\hyperlink{linux_2vport_8c_a44407fddea47b25021a73cfc6f36c7ad}{ovs\_vport\_get\_upcall\_portids}(vport, skb))
1824         \textcolor{keywordflow}{goto} nla\_put\_failure;
1825 
1826     err = \hyperlink{linux_2vport_8c_a7224829872e717ebe354d80bf9860db2}{ovs\_vport\_get\_options}(vport, skb);
1827     \textcolor{keywordflow}{if} (err == -EMSGSIZE)
1828         \textcolor{keywordflow}{goto} error;
1829 
1830     genlmsg\_end(skb, ovs\_header);
1831     \textcolor{keywordflow}{return} 0;
1832 
1833 nla\_put\_failure:
1834     err = -EMSGSIZE;
1835 error:
1836     genlmsg\_cancel(skb, ovs\_header);
1837     \textcolor{keywordflow}{return} err;
1838 \}
\end{DoxyCode}
\hypertarget{datapath_8c_ad818149bb2b46cab6eeb5b7ba6a14afe}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+vport\+\_\+cmd\+\_\+get@{ovs\+\_\+vport\+\_\+cmd\+\_\+get}}
\index{ovs\+\_\+vport\+\_\+cmd\+\_\+get@{ovs\+\_\+vport\+\_\+cmd\+\_\+get}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+vport\+\_\+cmd\+\_\+get}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+vport\+\_\+cmd\+\_\+get (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct genl\+\_\+info $\ast$}]{info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_ad818149bb2b46cab6eeb5b7ba6a14afe}

\begin{DoxyCode}
2062 \{
2063     \textcolor{keyword}{struct }nlattr **a = info->attrs;
2064     \textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header} *\hyperlink{structovs__header}{ovs\_header} = info->userhdr;
2065     \textcolor{keyword}{struct }sk\_buff *reply;
2066     \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport};
2067     \textcolor{keywordtype}{int} err;
2068 
2069     reply = \hyperlink{datapath_8c_a45645849b972492fa9f01eeaf668bf78}{ovs\_vport\_cmd\_alloc\_info}();
2070     \textcolor{keywordflow}{if} (!reply)
2071         \textcolor{keywordflow}{return} -ENOMEM;
2072 
2073     rcu\_read\_lock();
2074     vport = \hyperlink{datapath_8c_a95b019fd3980803dcc1bb5aca920f58b}{lookup\_vport}(sock\_net(skb->sk), ovs\_header, a);
2075     err = PTR\_ERR(vport);
2076     \textcolor{keywordflow}{if} (IS\_ERR(vport))
2077         \textcolor{keywordflow}{goto} exit\_unlock\_free;
2078     err = \hyperlink{datapath_8c_a4272403de9a985cea17181e99b7a7edc}{ovs\_vport\_cmd\_fill\_info}(vport, reply, info->snd\_portid,
2079                       info->snd\_seq, 0, \hyperlink{openvswitch_8h_ae012c39e873d42b086636b19a242c354af6255867587891980ef6577446362d45}{OVS\_VPORT\_CMD\_NEW});
2080     BUG\_ON(err < 0);
2081     rcu\_read\_unlock();
2082 
2083     \textcolor{keywordflow}{return} genlmsg\_reply(reply, info);
2084 
2085 exit\_unlock\_free:
2086     rcu\_read\_unlock();
2087     kfree\_skb(reply);
2088     \textcolor{keywordflow}{return} err;
2089 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a0b878975d12b240c20c6b5389b5b12b6}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+vport\+\_\+cmd\+\_\+new@{ovs\+\_\+vport\+\_\+cmd\+\_\+new}}
\index{ovs\+\_\+vport\+\_\+cmd\+\_\+new@{ovs\+\_\+vport\+\_\+cmd\+\_\+new}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+vport\+\_\+cmd\+\_\+new}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+vport\+\_\+cmd\+\_\+new (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct genl\+\_\+info $\ast$}]{info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a0b878975d12b240c20c6b5389b5b12b6}

\begin{DoxyCode}
1897 \{
1898     \textcolor{keyword}{struct }nlattr **a = info->attrs;
1899     \textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header} *\hyperlink{structovs__header}{ovs\_header} = info->userhdr;
1900     \textcolor{keyword}{struct }\hyperlink{structvport__parms}{vport\_parms} parms;
1901     \textcolor{keyword}{struct }sk\_buff *reply;
1902     \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport};
1903     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
1904     u32 port\_no;
1905     \textcolor{keywordtype}{int} err;
1906 
1907     \textcolor{keywordflow}{if} (!a[\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464daef39b12d8a0cb39f2248d82f435bec3c}{OVS\_VPORT\_ATTR\_NAME}] || !a[\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464da84ada86f1005907daaf7dc8eb0c0a637}{OVS\_VPORT\_ATTR\_TYPE}] ||
1908         !a[\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464da3afa40888197949fd69c2f5f6076fcc2}{OVS\_VPORT\_ATTR\_UPCALL\_PID}])
1909         \textcolor{keywordflow}{return} -EINVAL;
1910 
1911     port\_no = a[\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464da08e4cd652a0f6cd6eeeaac1db3bdf503}{OVS\_VPORT\_ATTR\_PORT\_NO}]
1912         ? nla\_get\_u32(a[\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464da08e4cd652a0f6cd6eeeaac1db3bdf503}{OVS\_VPORT\_ATTR\_PORT\_NO}]) : 0;
1913     \textcolor{keywordflow}{if} (port\_no >= \hyperlink{datapath_8h_a73b117dd1ebe456eecfb7688047a03f1}{DP\_MAX\_PORTS})
1914         \textcolor{keywordflow}{return} -EFBIG;
1915 
1916     reply = \hyperlink{datapath_8c_a45645849b972492fa9f01eeaf668bf78}{ovs\_vport\_cmd\_alloc\_info}();
1917     \textcolor{keywordflow}{if} (!reply)
1918         \textcolor{keywordflow}{return} -ENOMEM;
1919 
1920     \hyperlink{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}{ovs\_lock}();
1921 restart:
1922     dp = \hyperlink{datapath_8c_a1107d4fd386aa6551511140b5405e1d3}{get\_dp}(sock\_net(skb->sk), ovs\_header->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex});
1923     err = -ENODEV;
1924     \textcolor{keywordflow}{if} (!dp)
1925         \textcolor{keywordflow}{goto} exit\_unlock\_free;
1926 
1927     \textcolor{keywordflow}{if} (port\_no) \{
1928         vport = \hyperlink{datapath_8h_a422576bd4b943e9df313ba73f6c624e1}{ovs\_vport\_ovsl}(dp, port\_no);
1929         err = -EBUSY;
1930         \textcolor{keywordflow}{if} (vport)
1931             \textcolor{keywordflow}{goto} exit\_unlock\_free;
1932     \} \textcolor{keywordflow}{else} \{
1933         \textcolor{keywordflow}{for} (port\_no = 1; ; port\_no++) \{
1934             \textcolor{keywordflow}{if} (port\_no >= \hyperlink{datapath_8h_a73b117dd1ebe456eecfb7688047a03f1}{DP\_MAX\_PORTS}) \{
1935                 err = -EFBIG;
1936                 \textcolor{keywordflow}{goto} exit\_unlock\_free;
1937             \}
1938             vport = \hyperlink{datapath_8h_a422576bd4b943e9df313ba73f6c624e1}{ovs\_vport\_ovsl}(dp, port\_no);
1939             \textcolor{keywordflow}{if} (!vport)
1940                 \textcolor{keywordflow}{break};
1941         \}
1942     \}
1943 
1944     parms.name = nla\_data(a[\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464daef39b12d8a0cb39f2248d82f435bec3c}{OVS\_VPORT\_ATTR\_NAME}]);
1945     parms.type = nla\_get\_u32(a[\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464da84ada86f1005907daaf7dc8eb0c0a637}{OVS\_VPORT\_ATTR\_TYPE}]);
1946     parms.options = a[\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464dac0bc104dd1ef77ac2f0a0f9d6f087239}{OVS\_VPORT\_ATTR\_OPTIONS}];
1947     parms.dp = dp;
1948     parms.port\_no = port\_no;
1949     parms.upcall\_portids = a[\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464da3afa40888197949fd69c2f5f6076fcc2}{OVS\_VPORT\_ATTR\_UPCALL\_PID}];
1950 
1951     vport = \hyperlink{datapath_8c_afac95a3e755fe3b0906ccc72d052cbe1}{new\_vport}(&parms);
1952     err = PTR\_ERR(vport);
1953     \textcolor{keywordflow}{if} (IS\_ERR(vport)) \{
1954         \textcolor{keywordflow}{if} (err == -EAGAIN)
1955             \textcolor{keywordflow}{goto} restart;
1956         \textcolor{keywordflow}{goto} exit\_unlock\_free;
1957     \}
1958 
1959     err = \hyperlink{datapath_8c_a4272403de9a985cea17181e99b7a7edc}{ovs\_vport\_cmd\_fill\_info}(vport, reply, info->snd\_portid,
1960                       info->snd\_seq, 0, \hyperlink{openvswitch_8h_ae012c39e873d42b086636b19a242c354af6255867587891980ef6577446362d45}{OVS\_VPORT\_CMD\_NEW});
1961     BUG\_ON(err < 0);
1962     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1963 
1964     \hyperlink{datapath_8c_a67f527ad1164ff0d67fe854584ced567}{ovs\_notify}(&\hyperlink{datapath_8c_a69bf55f33e234bc4b78e6eeee1d603fd}{dp\_vport\_genl\_family}, &
      \hyperlink{datapath_8c_a9dd8d4307b50fdee582eb4013d89eb7b}{ovs\_dp\_vport\_multicast\_group}, reply, info);
1965     \textcolor{keywordflow}{return} 0;
1966 
1967 exit\_unlock\_free:
1968     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
1969     kfree\_skb(reply);
1970     \textcolor{keywordflow}{return} err;
1971 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a89f1e2fa808021479860862b3e7556e5}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+vport\+\_\+cmd\+\_\+set@{ovs\+\_\+vport\+\_\+cmd\+\_\+set}}
\index{ovs\+\_\+vport\+\_\+cmd\+\_\+set@{ovs\+\_\+vport\+\_\+cmd\+\_\+set}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+vport\+\_\+cmd\+\_\+set}]{\setlength{\rightskip}{0pt plus 5cm}static int ovs\+\_\+vport\+\_\+cmd\+\_\+set (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct genl\+\_\+info $\ast$}]{info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a89f1e2fa808021479860862b3e7556e5}

\begin{DoxyCode}
1974 \{
1975     \textcolor{keyword}{struct }nlattr **a = info->attrs;
1976     \textcolor{keyword}{struct }sk\_buff *reply;
1977     \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport};
1978     \textcolor{keywordtype}{int} err;
1979 
1980     reply = \hyperlink{datapath_8c_a45645849b972492fa9f01eeaf668bf78}{ovs\_vport\_cmd\_alloc\_info}();
1981     \textcolor{keywordflow}{if} (!reply)
1982         \textcolor{keywordflow}{return} -ENOMEM;
1983 
1984     \hyperlink{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}{ovs\_lock}();
1985     vport = \hyperlink{datapath_8c_a95b019fd3980803dcc1bb5aca920f58b}{lookup\_vport}(sock\_net(skb->sk), info->userhdr, a);
1986     err = PTR\_ERR(vport);
1987     \textcolor{keywordflow}{if} (IS\_ERR(vport))
1988         \textcolor{keywordflow}{goto} exit\_unlock\_free;
1989 
1990     \textcolor{keywordflow}{if} (a[\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464da84ada86f1005907daaf7dc8eb0c0a637}{OVS\_VPORT\_ATTR\_TYPE}] &&
1991         nla\_get\_u32(a[\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464da84ada86f1005907daaf7dc8eb0c0a637}{OVS\_VPORT\_ATTR\_TYPE}]) != vport->\hyperlink{structvport_a5af933fc664c1194ac3bbc337da35586}{ops}->
      \hyperlink{structvport__ops_a7dd0d3776e78a2885063d3afd5e78148}{type}) \{
1992         err = -EINVAL;
1993         \textcolor{keywordflow}{goto} exit\_unlock\_free;
1994     \}
1995 
1996     \textcolor{keywordflow}{if} (a[\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464dac0bc104dd1ef77ac2f0a0f9d6f087239}{OVS\_VPORT\_ATTR\_OPTIONS}]) \{
1997         err = \hyperlink{linux_2vport_8c_acfdffde36364d009c64778f1ef6c863b}{ovs\_vport\_set\_options}(vport, a[OVS\_VPORT\_ATTR\_OPTIONS]);
1998         \textcolor{keywordflow}{if} (err)
1999             \textcolor{keywordflow}{goto} exit\_unlock\_free;
2000     \}
2001 
2002     \textcolor{keywordflow}{if} (a[\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464da3afa40888197949fd69c2f5f6076fcc2}{OVS\_VPORT\_ATTR\_UPCALL\_PID}]) \{
2003         \textcolor{keyword}{struct }nlattr *ids = a[\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464da3afa40888197949fd69c2f5f6076fcc2}{OVS\_VPORT\_ATTR\_UPCALL\_PID}];
2004 
2005         err = \hyperlink{linux_2vport_8c_a8d6c13e6f31531135adf06eb8004a20a}{ovs\_vport\_set\_upcall\_portids}(vport, ids);
2006         \textcolor{keywordflow}{if} (err)
2007             \textcolor{keywordflow}{goto} exit\_unlock\_free;
2008     \}
2009 
2010     err = \hyperlink{datapath_8c_a4272403de9a985cea17181e99b7a7edc}{ovs\_vport\_cmd\_fill\_info}(vport, reply, info->snd\_portid,
2011                       info->snd\_seq, 0, \hyperlink{openvswitch_8h_ae012c39e873d42b086636b19a242c354af6255867587891980ef6577446362d45}{OVS\_VPORT\_CMD\_NEW});
2012     BUG\_ON(err < 0);
2013     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
2014 
2015     \hyperlink{datapath_8c_a67f527ad1164ff0d67fe854584ced567}{ovs\_notify}(&\hyperlink{datapath_8c_a69bf55f33e234bc4b78e6eeee1d603fd}{dp\_vport\_genl\_family}, &
      \hyperlink{datapath_8c_a9dd8d4307b50fdee582eb4013d89eb7b}{ovs\_dp\_vport\_multicast\_group}, reply, info);
2016     \textcolor{keywordflow}{return} 0;
2017 
2018 exit\_unlock\_free:
2019     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
2020     kfree\_skb(reply);
2021     \textcolor{keywordflow}{return} err;
2022 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a2c10ba8a23a8cb2f14b7f7684e5ebb5d}{}\index{datapath.\+c@{datapath.\+c}!queue\+\_\+gso\+\_\+packets@{queue\+\_\+gso\+\_\+packets}}
\index{queue\+\_\+gso\+\_\+packets@{queue\+\_\+gso\+\_\+packets}!datapath.\+c@{datapath.\+c}}
\subsubsection[{queue\+\_\+gso\+\_\+packets}]{\setlength{\rightskip}{0pt plus 5cm}static int queue\+\_\+gso\+\_\+packets (
\begin{DoxyParamCaption}
\item[{struct {\bf datapath} $\ast$}]{dp, }
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{const struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{key, }
\item[{const struct {\bf dp\+\_\+upcall\+\_\+info} $\ast$}]{upcall\+\_\+info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a2c10ba8a23a8cb2f14b7f7684e5ebb5d}

\begin{DoxyCode}
339 \{
340     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} gso\_type = skb\_shinfo(skb)->gso\_type;
341     \textcolor{keyword}{struct }\hyperlink{structsw__flow__key}{sw\_flow\_key} later\_key;
342     \textcolor{keyword}{struct }sk\_buff *segs, *nskb;
343     \textcolor{keyword}{struct }\hyperlink{structovs__skb__cb}{ovs\_skb\_cb} ovs\_cb;
344     \textcolor{keywordtype}{int} err;
345 
346     ovs\_cb = *\hyperlink{datapath_8h_ac337c4d4ddca29916ce8e900038ddd78}{OVS\_CB}(skb);
347     segs = \_\_skb\_gso\_segment(skb, NETIF\_F\_SG, \textcolor{keyword}{false});
348     *\hyperlink{datapath_8h_ac337c4d4ddca29916ce8e900038ddd78}{OVS\_CB}(skb) = ovs\_cb;
349     \textcolor{keywordflow}{if} (IS\_ERR(segs))
350         \textcolor{keywordflow}{return} PTR\_ERR(segs);
351     \textcolor{keywordflow}{if} (segs == NULL)
352         \textcolor{keywordflow}{return} -EINVAL;
353 
354     \textcolor{keywordflow}{if} (gso\_type & SKB\_GSO\_UDP) \{
355         \textcolor{comment}{/* The initial flow key extracted by ovs\_flow\_key\_extract()}
356 \textcolor{comment}{         * in this case is for a first fragment, so we need to}
357 \textcolor{comment}{         * properly mark later fragments.}
358 \textcolor{comment}{         */}
359         later\_key = *key;
360         later\_key.\hyperlink{structsw__flow__key_ae8d48c419eaff6a9fda97c7446bdec0e}{ip}.frag = \hyperlink{openvswitch_8h_ad843f713a855bfcacd0adfe3e98eb447a1d1c9f89ced33419ec870391d8954c10}{OVS\_FRAG\_TYPE\_LATER};
361     \}
362 
363     \textcolor{comment}{/* Queue all of the segments. */}
364     skb = segs;
365     \textcolor{keywordflow}{do} \{
366         *\hyperlink{datapath_8h_ac337c4d4ddca29916ce8e900038ddd78}{OVS\_CB}(skb) = ovs\_cb;
367         \textcolor{keywordflow}{if} (gso\_type & SKB\_GSO\_UDP && skb != segs)
368             key = &later\_key;
369 
370         err = \hyperlink{datapath_8c_a549c591fae56562523f243abbe4a1e3e}{queue\_userspace\_packet}(dp, skb, key, upcall\_info);
371         \textcolor{keywordflow}{if} (err)
372             \textcolor{keywordflow}{break};
373 
374     \} \textcolor{keywordflow}{while} ((skb = skb->next));
375 
376     \textcolor{comment}{/* Free all of the segments. */}
377     skb = segs;
378     \textcolor{keywordflow}{do} \{
379         nskb = skb->next;
380         \textcolor{keywordflow}{if} (err)
381             kfree\_skb(skb);
382         \textcolor{keywordflow}{else}
383             \hyperlink{skbuff_8h_adc460a9e6dccf5557d55bbce8c7adb6a}{consume\_skb}(skb);
384     \} \textcolor{keywordflow}{while} ((skb = nskb));
385     \textcolor{keywordflow}{return} err;
386 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a549c591fae56562523f243abbe4a1e3e}{}\index{datapath.\+c@{datapath.\+c}!queue\+\_\+userspace\+\_\+packet@{queue\+\_\+userspace\+\_\+packet}}
\index{queue\+\_\+userspace\+\_\+packet@{queue\+\_\+userspace\+\_\+packet}!datapath.\+c@{datapath.\+c}}
\subsubsection[{queue\+\_\+userspace\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}static int queue\+\_\+userspace\+\_\+packet (
\begin{DoxyParamCaption}
\item[{struct {\bf datapath} $\ast$}]{dp, }
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{const struct {\bf sw\+\_\+flow\+\_\+key} $\ast$}]{key, }
\item[{const struct {\bf dp\+\_\+upcall\+\_\+info} $\ast$}]{upcall\+\_\+info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a549c591fae56562523f243abbe4a1e3e}

\begin{DoxyCode}
413 \{
414     \textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header} *upcall;
415     \textcolor{keyword}{struct }sk\_buff *nskb = NULL;
416     \textcolor{keyword}{struct }sk\_buff *user\_skb = NULL; \textcolor{comment}{/* to be queued to userspace */}
417     \textcolor{keyword}{struct }nlattr *nla;
418     \textcolor{keyword}{struct }genl\_info info = \{
419 \textcolor{preprocessor}{#ifdef HAVE\_GENLMSG\_NEW\_UNICAST}
420         .dst\_sk = \hyperlink{datapath_8h_aef2302004ca1f45133eaef00bb3740eb}{ovs\_dp\_get\_net}(dp)->genl\_sock,
421 \textcolor{preprocessor}{#endif}
422         .snd\_portid = upcall\_info->\hyperlink{structdp__upcall__info_a4300576f43ab3d9293453d9c664de818}{portid},
423     \};
424     \textcolor{keywordtype}{size\_t} len;
425     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} hlen;
426     \textcolor{keywordtype}{int} err, dp\_ifindex;
427 
428     dp\_ifindex = \hyperlink{datapath_8c_a2c4c60ba176a755749744f7b01aa6edd}{get\_dpifindex}(dp);
429     \textcolor{keywordflow}{if} (!dp\_ifindex)
430         \textcolor{keywordflow}{return} -ENODEV;
431 
432     \textcolor{keywordflow}{if} (\hyperlink{if__vlan_8h_a0bdf3e26944669a4265c7e717e846215}{skb\_vlan\_tag\_present}(skb)) \{
433         nskb = skb\_clone(skb, GFP\_ATOMIC);
434         \textcolor{keywordflow}{if} (!nskb)
435             \textcolor{keywordflow}{return} -ENOMEM;
436 
437         nskb = \hyperlink{if__vlan_8h_a458e4fe2d77c1973bb14ed81f76cf562}{vlan\_insert\_tag\_set\_proto}(nskb, nskb->vlan\_proto, 
      \hyperlink{if__vlan_8h_a0fa23322859cba87d3f5e4526aafd80f}{skb\_vlan\_tag\_get}(nskb));
438         \textcolor{keywordflow}{if} (!nskb)
439             \textcolor{keywordflow}{return} -ENOMEM;
440 
441         \hyperlink{vlan_8h_ad5de1acaa10b947f662a8200417dd6c4}{vlan\_set\_tci}(nskb, 0);
442 
443         skb = nskb;
444     \}
445 
446     \textcolor{keywordflow}{if} (nla\_attr\_size(skb->len) > \hyperlink{kernel_8h_a689b119da994dece91d44b5aeac643ed}{USHRT\_MAX}) \{
447         err = -EFBIG;
448         \textcolor{keywordflow}{goto} out;
449     \}
450 
451     \textcolor{comment}{/* Complete checksum if needed */}
452     \textcolor{keywordflow}{if} (skb->ip\_summed == \hyperlink{skbuff_8h_a627906a22e9d4cb31c7674b86eb25ef3}{CHECKSUM\_PARTIAL} &&
453         (err = skb\_checksum\_help(skb)))
454         \textcolor{keywordflow}{goto} out;
455 
456     \textcolor{comment}{/* Older versions of OVS user space enforce alignment of the last}
457 \textcolor{comment}{     * Netlink attribute to NLA\_ALIGNTO which would require extensive}
458 \textcolor{comment}{     * padding logic. Only perform zerocopy if padding is not required.}
459 \textcolor{comment}{     */}
460     \textcolor{keywordflow}{if} (dp->\hyperlink{structdatapath_a92ce3b704c20f18b3a696f98b6f7d266}{user\_features} & \hyperlink{openvswitch_8h_ae7c6d2c749b74b35349391206c8ab289}{OVS\_DP\_F\_UNALIGNED})
461         hlen = skb\_zerocopy\_headlen(skb);
462     \textcolor{keywordflow}{else}
463         hlen = skb->len;
464 
465     len = \hyperlink{datapath_8c_a845617ce8ad4e18b0c54961d796a0aeb}{upcall\_msg\_size}(upcall\_info, hlen);
466     user\_skb = \hyperlink{genetlink_8h_a004898a56e34b42638510826a4757ab5}{genlmsg\_new\_unicast}(len, &info, GFP\_ATOMIC);
467     \textcolor{keywordflow}{if} (!user\_skb) \{
468         err = -ENOMEM;
469         \textcolor{keywordflow}{goto} out;
470     \}
471 
472     upcall = \hyperlink{genetlink_8h_a306fd8e0093b286af42dfce236aeb096}{genlmsg\_put}(user\_skb, 0, 0, &\hyperlink{datapath_8c_a709033900c84449b9f83cb62cecb1627}{dp\_packet\_genl\_family},
473                  0, upcall\_info->\hyperlink{structdp__upcall__info_afdbbbb0aef83ab4652e15715db247d22}{cmd});
474     upcall->\hyperlink{structovs__header_a8ff8d9e5f29285dff5404cc8fa23b452}{dp\_ifindex} = dp\_ifindex;
475 
476     err = \hyperlink{flow__netlink_8c_a845412e2f8f2bcb48df005e857474fcb}{ovs\_nla\_put\_key}(key, key, \hyperlink{openvswitch_8h_a34899be8f30456f4c7c2747eaf3eb78ba24d5d8704ff3c8ad939a01ea2f29acf7}{OVS\_PACKET\_ATTR\_KEY}, \textcolor{keyword}{false}, user\_skb)
      ;
477     BUG\_ON(err);
478 
479     \textcolor{keywordflow}{if} (upcall\_info->\hyperlink{structdp__upcall__info_a78d8f8bd4a0418b043a3a2401e516d5a}{userdata})
480         \_\_nla\_put(user\_skb, \hyperlink{openvswitch_8h_a34899be8f30456f4c7c2747eaf3eb78ba100abd429da107a1405dacf7a9bfa6f0}{OVS\_PACKET\_ATTR\_USERDATA},
481               nla\_len(upcall\_info->\hyperlink{structdp__upcall__info_a78d8f8bd4a0418b043a3a2401e516d5a}{userdata}),
482               nla\_data(upcall\_info->\hyperlink{structdp__upcall__info_a78d8f8bd4a0418b043a3a2401e516d5a}{userdata}));
483 
484     \textcolor{keywordflow}{if} (upcall\_info->\hyperlink{structdp__upcall__info_a74a70c7b1f24487fd51d0f0c5aa1c11e}{egress\_tun\_info}) \{
485         nla = nla\_nest\_start(user\_skb, \hyperlink{openvswitch_8h_a34899be8f30456f4c7c2747eaf3eb78ba286dae32c610cf3e3d0e767ef003b1ff}{OVS\_PACKET\_ATTR\_EGRESS\_TUN\_KEY});
486         err = \hyperlink{flow__netlink_8c_a8a7309f6247775b5682061576c039e22}{ovs\_nla\_put\_egress\_tunnel\_key}(user\_skb,
487                             upcall\_info->\hyperlink{structdp__upcall__info_a74a70c7b1f24487fd51d0f0c5aa1c11e}{egress\_tun\_info});
488         BUG\_ON(err);
489         nla\_nest\_end(user\_skb, nla);
490     \}
491 
492     \textcolor{keywordflow}{if} (upcall\_info->\hyperlink{structdp__upcall__info_ad5ccfb55799f138fa7d01461e2035d1f}{actions\_len}) \{
493         nla = nla\_nest\_start(user\_skb, \hyperlink{openvswitch_8h_a34899be8f30456f4c7c2747eaf3eb78ba92b7b96f0518290779bfd078f1456d85}{OVS\_PACKET\_ATTR\_ACTIONS});
494         err = \hyperlink{flow__netlink_8c_a923304ee69be1cfa52197b0f73c29e49}{ovs\_nla\_put\_actions}(upcall\_info->\hyperlink{structdp__upcall__info_a0e948e89cb162118d95c37d8c2a6c5c3}{actions},
495                       upcall\_info->\hyperlink{structdp__upcall__info_ad5ccfb55799f138fa7d01461e2035d1f}{actions\_len},
496                       user\_skb);
497         \textcolor{keywordflow}{if} (!err)
498             nla\_nest\_end(user\_skb, nla);
499         \textcolor{keywordflow}{else}
500             nla\_nest\_cancel(user\_skb, nla);
501     \}
502 
503     \textcolor{comment}{/* Only reserve room for attribute header, packet data is added}
504 \textcolor{comment}{     * in skb\_zerocopy()}
505 \textcolor{comment}{     */}
506     \textcolor{keywordflow}{if} (!(nla = nla\_reserve(user\_skb, \hyperlink{openvswitch_8h_a34899be8f30456f4c7c2747eaf3eb78bac19f59ebb0be0e7a3d6e145369562977}{OVS\_PACKET\_ATTR\_PACKET}, 0))) \{
507         err = -ENOBUFS;
508         \textcolor{keywordflow}{goto} out;
509     \}
510     nla->nla\_len = nla\_attr\_size(skb->len);
511 
512     err = \hyperlink{skbuff_8h_a3b5615a68dce0b4c498e3363bf48ee52}{skb\_zerocopy}(user\_skb, skb, skb->len, hlen);
513     \textcolor{keywordflow}{if} (err)
514         \textcolor{keywordflow}{goto} out;
515 
516     \textcolor{comment}{/* Pad OVS\_PACKET\_ATTR\_PACKET if linear copy was performed */}
517     \textcolor{keywordflow}{if} (!(dp->\hyperlink{structdatapath_a92ce3b704c20f18b3a696f98b6f7d266}{user\_features} & \hyperlink{openvswitch_8h_ae7c6d2c749b74b35349391206c8ab289}{OVS\_DP\_F\_UNALIGNED})) \{
518         \textcolor{keywordtype}{size\_t} plen = NLA\_ALIGN(user\_skb->len) - user\_skb->len;
519 
520         \textcolor{keywordflow}{if} (plen > 0)
521             memset(skb\_put(user\_skb, plen), 0, plen);
522     \}
523 
524     ((\textcolor{keyword}{struct }nlmsghdr *) user\_skb->data)->nlmsg\_len = user\_skb->len;
525 
526     err = genlmsg\_unicast(\hyperlink{datapath_8h_aef2302004ca1f45133eaef00bb3740eb}{ovs\_dp\_get\_net}(dp), user\_skb, upcall\_info->
      \hyperlink{structdp__upcall__info_a4300576f43ab3d9293453d9c664de818}{portid});
527     user\_skb = NULL;
528 out:
529     \textcolor{keywordflow}{if} (err)
530         skb\_tx\_error(skb);
531     kfree\_skb(user\_skb);
532     kfree\_skb(nskb);
533     \textcolor{keywordflow}{return} err;
534 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a05dcb72a9103046c5721d03a1592291f}{}\index{datapath.\+c@{datapath.\+c}!should\+\_\+fill\+\_\+actions@{should\+\_\+fill\+\_\+actions}}
\index{should\+\_\+fill\+\_\+actions@{should\+\_\+fill\+\_\+actions}!datapath.\+c@{datapath.\+c}}
\subsubsection[{should\+\_\+fill\+\_\+actions}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf bool} should\+\_\+fill\+\_\+actions (
\begin{DoxyParamCaption}
\item[{uint32\+\_\+t}]{ufid\+\_\+flags}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a05dcb72a9103046c5721d03a1592291f}

\begin{DoxyCode}
702 \{
703     \textcolor{keywordflow}{return} !(ufid\_flags & \hyperlink{openvswitch_8h_a1a832ceb1ae1b3bc6b5912f8baceb465}{OVS\_UFID\_F\_OMIT\_ACTIONS});
704 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a4d912d3ed7dba8789b726280b6dea3a4}{}\index{datapath.\+c@{datapath.\+c}!should\+\_\+fill\+\_\+key@{should\+\_\+fill\+\_\+key}}
\index{should\+\_\+fill\+\_\+key@{should\+\_\+fill\+\_\+key}!datapath.\+c@{datapath.\+c}}
\subsubsection[{should\+\_\+fill\+\_\+key}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf bool} should\+\_\+fill\+\_\+key (
\begin{DoxyParamCaption}
\item[{const struct {\bf sw\+\_\+flow\+\_\+id} $\ast$}]{sfid, }
\item[{uint32\+\_\+t}]{ufid\+\_\+flags}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a4d912d3ed7dba8789b726280b6dea3a4}

\begin{DoxyCode}
691 \{
692     \textcolor{keywordflow}{return} \hyperlink{flow_8h_a995966854ceb0b5a72ff027c12ccf426}{ovs\_identifier\_is\_ufid}(sfid) &&
693            !(ufid\_flags & \hyperlink{openvswitch_8h_a1a9a22d936cb386b43f6f48cf0ff5e03}{OVS\_UFID\_F\_OMIT\_KEY});
694 \}
\end{DoxyCode}
\hypertarget{datapath_8c_acef91dffd31fb70fa6c94e11ad08805b}{}\index{datapath.\+c@{datapath.\+c}!should\+\_\+fill\+\_\+mask@{should\+\_\+fill\+\_\+mask}}
\index{should\+\_\+fill\+\_\+mask@{should\+\_\+fill\+\_\+mask}!datapath.\+c@{datapath.\+c}}
\subsubsection[{should\+\_\+fill\+\_\+mask}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf bool} should\+\_\+fill\+\_\+mask (
\begin{DoxyParamCaption}
\item[{uint32\+\_\+t}]{ufid\+\_\+flags}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_acef91dffd31fb70fa6c94e11ad08805b}

\begin{DoxyCode}
697 \{
698     \textcolor{keywordflow}{return} !(ufid\_flags & \hyperlink{openvswitch_8h_a30c9df26b82f250e2d5077a93bf0f9fe}{OVS\_UFID\_F\_OMIT\_MASK});
699 \}
\end{DoxyCode}
\hypertarget{datapath_8c_a845617ce8ad4e18b0c54961d796a0aeb}{}\index{datapath.\+c@{datapath.\+c}!upcall\+\_\+msg\+\_\+size@{upcall\+\_\+msg\+\_\+size}}
\index{upcall\+\_\+msg\+\_\+size@{upcall\+\_\+msg\+\_\+size}!datapath.\+c@{datapath.\+c}}
\subsubsection[{upcall\+\_\+msg\+\_\+size}]{\setlength{\rightskip}{0pt plus 5cm}static size\+\_\+t upcall\+\_\+msg\+\_\+size (
\begin{DoxyParamCaption}
\item[{const struct {\bf dp\+\_\+upcall\+\_\+info} $\ast$}]{upcall\+\_\+info, }
\item[{unsigned int}]{hdrlen}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a845617ce8ad4e18b0c54961d796a0aeb}

\begin{DoxyCode}
390 \{
391     \textcolor{keywordtype}{size\_t} size = NLMSG\_ALIGN(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structovs__header}{ovs\_header}))
392         + nla\_total\_size(hdrlen) \textcolor{comment}{/* OVS\_PACKET\_ATTR\_PACKET */}
393         + nla\_total\_size(\hyperlink{flow__netlink_8c_a4ea1ec7f3650fd324fc1538c97e795d0}{ovs\_key\_attr\_size}()); \textcolor{comment}{/* OVS\_PACKET\_ATTR\_KEY */}
394 
395     \textcolor{comment}{/* OVS\_PACKET\_ATTR\_USERDATA */}
396     \textcolor{keywordflow}{if} (upcall\_info->\hyperlink{structdp__upcall__info_a78d8f8bd4a0418b043a3a2401e516d5a}{userdata})
397         size += NLA\_ALIGN(upcall\_info->\hyperlink{structdp__upcall__info_a78d8f8bd4a0418b043a3a2401e516d5a}{userdata}->nla\_len);
398 
399     \textcolor{comment}{/* OVS\_PACKET\_ATTR\_EGRESS\_TUN\_KEY */}
400     \textcolor{keywordflow}{if} (upcall\_info->\hyperlink{structdp__upcall__info_a74a70c7b1f24487fd51d0f0c5aa1c11e}{egress\_tun\_info})
401         size += nla\_total\_size(\hyperlink{flow__netlink_8c_ac920825ffe4fa75e7ca3c5e76ad4ec2a}{ovs\_tun\_key\_attr\_size}());
402 
403     \textcolor{comment}{/* OVS\_PACKET\_ATTR\_ACTIONS */}
404     \textcolor{keywordflow}{if} (upcall\_info->\hyperlink{structdp__upcall__info_ad5ccfb55799f138fa7d01461e2035d1f}{actions\_len})
405         size += nla\_total\_size(upcall\_info->\hyperlink{structdp__upcall__info_ad5ccfb55799f138fa7d01461e2035d1f}{actions\_len});
406 
407     \textcolor{keywordflow}{return} size;
408 \}
\end{DoxyCode}
\hypertarget{datapath_8c_af291a723340e4e1bd38b4b14e7f4377a}{}\index{datapath.\+c@{datapath.\+c}!vport\+\_\+hash\+\_\+bucket@{vport\+\_\+hash\+\_\+bucket}}
\index{vport\+\_\+hash\+\_\+bucket@{vport\+\_\+hash\+\_\+bucket}!datapath.\+c@{datapath.\+c}}
\subsubsection[{vport\+\_\+hash\+\_\+bucket}]{\setlength{\rightskip}{0pt plus 5cm}static struct hlist\+\_\+head$\ast$ vport\+\_\+hash\+\_\+bucket (
\begin{DoxyParamCaption}
\item[{const struct {\bf datapath} $\ast$}]{dp, }
\item[{u16}]{port\+\_\+no}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_af291a723340e4e1bd38b4b14e7f4377a}

\begin{DoxyCode}
215 \{
216     \textcolor{keywordflow}{return} &dp->\hyperlink{structdatapath_abb0de528545b312de283b571cb6c4ede}{ports}[port\_no & (\hyperlink{datapath_8h_ac1bf9805d62227b8f76f130087e18018}{DP\_VPORT\_HASH\_BUCKETS} - 1)];
217 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{datapath_8c_a50bac238082a6952a4dadad6299cc4b3}{}\index{datapath.\+c@{datapath.\+c}!\+\_\+\+\_\+read\+\_\+mostly@{\+\_\+\+\_\+read\+\_\+mostly}}
\index{\+\_\+\+\_\+read\+\_\+mostly@{\+\_\+\+\_\+read\+\_\+mostly}!datapath.\+c@{datapath.\+c}}
\subsubsection[{\+\_\+\+\_\+read\+\_\+mostly}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf ovs\+\_\+net\+\_\+id} \+\_\+\+\_\+read\+\_\+mostly}\label{datapath_8c_a50bac238082a6952a4dadad6299cc4b3}
\hypertarget{datapath_8c_a34f2da191c04c403e206dacb0c3d2a6f}{}\index{datapath.\+c@{datapath.\+c}!datapath\+\_\+policy@{datapath\+\_\+policy}}
\index{datapath\+\_\+policy@{datapath\+\_\+policy}!datapath.\+c@{datapath.\+c}}
\subsubsection[{datapath\+\_\+policy}]{\setlength{\rightskip}{0pt plus 5cm}const struct nla\+\_\+policy datapath\+\_\+policy\mbox{[}{\bf O\+V\+S\+\_\+\+D\+P\+\_\+\+A\+T\+T\+R\+\_\+\+M\+A\+X}+1\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a34f2da191c04c403e206dacb0c3d2a6f}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    [\hyperlink{openvswitch_8h_a6ebc7cf092971c117649bbb97f9b9ae7a4a2ac3c4a891b957f1788c0c9ebb736d}{OVS\_DP\_ATTR\_NAME}] = \{ .type = NLA\_NUL\_STRING, .len = IFNAMSIZ - 1 \},
    [\hyperlink{openvswitch_8h_a6ebc7cf092971c117649bbb97f9b9ae7a1f5b964b750d20b64d4f9c68fd39908a}{OVS\_DP\_ATTR\_UPCALL\_PID}] = \{ .type = NLA\_U32 \},
    [\hyperlink{openvswitch_8h_a6ebc7cf092971c117649bbb97f9b9ae7a40ebfa9b92707b878c6d32c889537b32}{OVS\_DP\_ATTR\_USER\_FEATURES}] = \{ .type = NLA\_U32 \},
\}
\end{DoxyCode}
\hypertarget{datapath_8c_a00b4c28b2a15cad709af53b6484fc45c}{}\index{datapath.\+c@{datapath.\+c}!dp\+\_\+datapath\+\_\+genl\+\_\+family@{dp\+\_\+datapath\+\_\+genl\+\_\+family}}
\index{dp\+\_\+datapath\+\_\+genl\+\_\+family@{dp\+\_\+datapath\+\_\+genl\+\_\+family}!datapath.\+c@{datapath.\+c}}
\subsubsection[{dp\+\_\+datapath\+\_\+genl\+\_\+family}]{\setlength{\rightskip}{0pt plus 5cm}static struct {\bf genl\+\_\+family} dp\+\_\+datapath\+\_\+genl\+\_\+family\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a00b4c28b2a15cad709af53b6484fc45c}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    .id = GENL\_ID\_GENERATE,
    .hdrsize = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header}),
    .name = \hyperlink{openvswitch_8h_ad706f128e1ab7961c76157fe6a5fa7b0}{OVS\_DATAPATH\_FAMILY},
    .version = \hyperlink{openvswitch_8h_ab28a9426105dc9255e16385d7e6e38d1}{OVS\_DATAPATH\_VERSION},
    .maxattr = \hyperlink{openvswitch_8h_a928e759af5a47791e5b3070bf596fd5d}{OVS\_DP\_ATTR\_MAX},
    .netnsok = \textcolor{keyword}{true},
    .parallel\_ops = \textcolor{keyword}{true},
    .ops = \hyperlink{datapath_8c_a29acb4bb9ad0b3d7af71e628bf516372}{dp\_datapath\_genl\_ops},
    .n\_ops = ARRAY\_SIZE(\hyperlink{datapath_8c_a29acb4bb9ad0b3d7af71e628bf516372}{dp\_datapath\_genl\_ops}),
    .mcgrps = &\hyperlink{datapath_8c_afa5d1f090aee506896ff5ef56b4053e1}{ovs\_dp\_datapath\_multicast\_group},
    .n\_mcgrps = 1,
\}
\end{DoxyCode}
\hypertarget{datapath_8c_a29acb4bb9ad0b3d7af71e628bf516372}{}\index{datapath.\+c@{datapath.\+c}!dp\+\_\+datapath\+\_\+genl\+\_\+ops@{dp\+\_\+datapath\+\_\+genl\+\_\+ops}}
\index{dp\+\_\+datapath\+\_\+genl\+\_\+ops@{dp\+\_\+datapath\+\_\+genl\+\_\+ops}!datapath.\+c@{datapath.\+c}}
\subsubsection[{dp\+\_\+datapath\+\_\+genl\+\_\+ops}]{\setlength{\rightskip}{0pt plus 5cm}struct genl\+\_\+ops dp\+\_\+datapath\+\_\+genl\+\_\+ops\mbox{[}$\,$\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a29acb4bb9ad0b3d7af71e628bf516372}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    \{ .cmd = \hyperlink{openvswitch_8h_aa8ba551904bd37a482265422ae718fbdabde26912980136dc563e8918e2d90334}{OVS\_DP\_CMD\_NEW},
      .flags = GENL\_ADMIN\_PERM, 
      .policy = \hyperlink{datapath_8c_a34f2da191c04c403e206dacb0c3d2a6f}{datapath\_policy},
      .doit = \hyperlink{datapath_8c_a8d012b2863686706ab9d1282a82d6625}{ovs\_dp\_cmd\_new}
    \},
    \{ .cmd = \hyperlink{openvswitch_8h_aa8ba551904bd37a482265422ae718fbda185ce13c521cefbceee31b2f7c8bc3dc}{OVS\_DP\_CMD\_DEL},
      .flags = GENL\_ADMIN\_PERM, 
      .policy = \hyperlink{datapath_8c_a34f2da191c04c403e206dacb0c3d2a6f}{datapath\_policy},
      .doit = \hyperlink{datapath_8c_a580bc462589253144c5027fa18fbfb17}{ovs\_dp\_cmd\_del}
    \},
    \{ .cmd = \hyperlink{openvswitch_8h_aa8ba551904bd37a482265422ae718fbda1fcf92e01e60c2820a8799f4457a8171}{OVS\_DP\_CMD\_GET},
      .flags = 0,           
      .policy = \hyperlink{datapath_8c_a34f2da191c04c403e206dacb0c3d2a6f}{datapath\_policy},
      .doit = \hyperlink{datapath_8c_ab253bc3f01b9d70955d3d3dcfc236b9f}{ovs\_dp\_cmd\_get},
      .dumpit = \hyperlink{datapath_8c_a64056132bb398b3e7c92291cc6905537}{ovs\_dp\_cmd\_dump}
    \},
    \{ .cmd = \hyperlink{openvswitch_8h_aa8ba551904bd37a482265422ae718fbda4f5de6647e59f92ae8220596700b8fb2}{OVS\_DP\_CMD\_SET},
      .flags = GENL\_ADMIN\_PERM, 
      .policy = \hyperlink{datapath_8c_a34f2da191c04c403e206dacb0c3d2a6f}{datapath\_policy},
      .doit = \hyperlink{datapath_8c_aa59555f8c6107137945c90e92fd42b4c}{ovs\_dp\_cmd\_set},
    \},
\}
\end{DoxyCode}
\hypertarget{datapath_8c_af07853d514acd11f9f0d23494b6a2f9e}{}\index{datapath.\+c@{datapath.\+c}!dp\+\_\+flow\+\_\+genl\+\_\+family@{dp\+\_\+flow\+\_\+genl\+\_\+family}}
\index{dp\+\_\+flow\+\_\+genl\+\_\+family@{dp\+\_\+flow\+\_\+genl\+\_\+family}!datapath.\+c@{datapath.\+c}}
\subsubsection[{dp\+\_\+flow\+\_\+genl\+\_\+family}]{\setlength{\rightskip}{0pt plus 5cm}static struct {\bf genl\+\_\+family} dp\+\_\+flow\+\_\+genl\+\_\+family\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_af07853d514acd11f9f0d23494b6a2f9e}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    .id = GENL\_ID\_GENERATE,
    .hdrsize = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header}),
    .name = \hyperlink{openvswitch_8h_a2c1f0278554b621518c6f178cfcceb7b}{OVS\_FLOW\_FAMILY},
    .version = \hyperlink{openvswitch_8h_a4a9075a73bedec1723097192a6ce15b7}{OVS\_FLOW\_VERSION},
    .maxattr = \hyperlink{openvswitch_8h_a05c07757006c2efd4a1a43593f896acf}{OVS\_FLOW\_ATTR\_MAX},
    .netnsok = \textcolor{keyword}{true},
    .parallel\_ops = \textcolor{keyword}{true},
    .ops = \hyperlink{datapath_8c_a42bdb3978421f4f0b3a1be828226b271}{dp\_flow\_genl\_ops},
    .n\_ops = ARRAY\_SIZE(\hyperlink{datapath_8c_a42bdb3978421f4f0b3a1be828226b271}{dp\_flow\_genl\_ops}),
    .mcgrps = &\hyperlink{datapath_8c_ae43fcc307ac0fa091a736d4687c7f884}{ovs\_dp\_flow\_multicast\_group},
    .n\_mcgrps = 1,
\}
\end{DoxyCode}
\hypertarget{datapath_8c_a42bdb3978421f4f0b3a1be828226b271}{}\index{datapath.\+c@{datapath.\+c}!dp\+\_\+flow\+\_\+genl\+\_\+ops@{dp\+\_\+flow\+\_\+genl\+\_\+ops}}
\index{dp\+\_\+flow\+\_\+genl\+\_\+ops@{dp\+\_\+flow\+\_\+genl\+\_\+ops}!datapath.\+c@{datapath.\+c}}
\subsubsection[{dp\+\_\+flow\+\_\+genl\+\_\+ops}]{\setlength{\rightskip}{0pt plus 5cm}struct genl\+\_\+ops dp\+\_\+flow\+\_\+genl\+\_\+ops\mbox{[}$\,$\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a42bdb3978421f4f0b3a1be828226b271}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    \{ .cmd = \hyperlink{openvswitch_8h_ab057316614ced2632c206f5b09fb6406ac86b2408dee1e6128057215035e2515e}{OVS\_FLOW\_CMD\_NEW},
      .flags = GENL\_ADMIN\_PERM, 
      .policy = \hyperlink{datapath_8c_aad79544f457c7a323273d328dafff886}{flow\_policy},
      .doit = \hyperlink{datapath_8c_ac8895cf604439184dad96f70e335afe2}{ovs\_flow\_cmd\_new}
    \},
    \{ .cmd = \hyperlink{openvswitch_8h_ab057316614ced2632c206f5b09fb6406a7bc985bd1b36d9c15028c5b66f650273}{OVS\_FLOW\_CMD\_DEL},
      .flags = GENL\_ADMIN\_PERM, 
      .policy = \hyperlink{datapath_8c_aad79544f457c7a323273d328dafff886}{flow\_policy},
      .doit = \hyperlink{datapath_8c_aa05c62aa6531c0e0312126a21a8d99a5}{ovs\_flow\_cmd\_del}
    \},
    \{ .cmd = \hyperlink{openvswitch_8h_ab057316614ced2632c206f5b09fb6406ad06e12cfb34bd0de68552a1fe1d85cc4}{OVS\_FLOW\_CMD\_GET},
      .flags = 0,           
      .policy = \hyperlink{datapath_8c_aad79544f457c7a323273d328dafff886}{flow\_policy},
      .doit = \hyperlink{datapath_8c_a747a4726ec84c751acb3048a515cef86}{ovs\_flow\_cmd\_get},
      .dumpit = \hyperlink{datapath_8c_a4759993b01f8bc67711ecacacdf43976}{ovs\_flow\_cmd\_dump}
    \},
    \{ .cmd = \hyperlink{openvswitch_8h_ab057316614ced2632c206f5b09fb6406ac0cc55d79341974845a29394ccb1943a}{OVS\_FLOW\_CMD\_SET},
      .flags = GENL\_ADMIN\_PERM, 
      .policy = \hyperlink{datapath_8c_aad79544f457c7a323273d328dafff886}{flow\_policy},
      .doit = \hyperlink{datapath_8c_a4c6c2d9354cb73a6300a9b3c9cd2a114}{ovs\_flow\_cmd\_set},
    \},
\}
\end{DoxyCode}
\hypertarget{datapath_8c_ae945344e649c305788038f5bc09bc817}{}\index{datapath.\+c@{datapath.\+c}!dp\+\_\+genl\+\_\+families@{dp\+\_\+genl\+\_\+families}}
\index{dp\+\_\+genl\+\_\+families@{dp\+\_\+genl\+\_\+families}!datapath.\+c@{datapath.\+c}}
\subsubsection[{dp\+\_\+genl\+\_\+families}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf genl\+\_\+family}$\ast$ dp\+\_\+genl\+\_\+families\mbox{[}$\,$\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_ae945344e649c305788038f5bc09bc817}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    &\hyperlink{datapath_8c_a00b4c28b2a15cad709af53b6484fc45c}{dp\_datapath\_genl\_family},
    &\hyperlink{datapath_8c_a69bf55f33e234bc4b78e6eeee1d603fd}{dp\_vport\_genl\_family},
    &\hyperlink{datapath_8c_af07853d514acd11f9f0d23494b6a2f9e}{dp\_flow\_genl\_family},
    &\hyperlink{datapath_8c_a709033900c84449b9f83cb62cecb1627}{dp\_packet\_genl\_family},
\}
\end{DoxyCode}
\hypertarget{datapath_8c_a709033900c84449b9f83cb62cecb1627}{}\index{datapath.\+c@{datapath.\+c}!dp\+\_\+packet\+\_\+genl\+\_\+family@{dp\+\_\+packet\+\_\+genl\+\_\+family}}
\index{dp\+\_\+packet\+\_\+genl\+\_\+family@{dp\+\_\+packet\+\_\+genl\+\_\+family}!datapath.\+c@{datapath.\+c}}
\subsubsection[{dp\+\_\+packet\+\_\+genl\+\_\+family}]{\setlength{\rightskip}{0pt plus 5cm}static struct {\bf genl\+\_\+family} dp\+\_\+packet\+\_\+genl\+\_\+family\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a709033900c84449b9f83cb62cecb1627}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    .id = GENL\_ID\_GENERATE,
    .hdrsize = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header}),
    .name = \hyperlink{openvswitch_8h_a56c212fea20a48caa7a76f34d5f9817b}{OVS\_PACKET\_FAMILY},
    .version = \hyperlink{openvswitch_8h_a19725a05aa9fdeb9d9672273e502f12e}{OVS\_PACKET\_VERSION},
    .maxattr = \hyperlink{openvswitch_8h_a9c91f74efc7f0264839c153979485eec}{OVS\_PACKET\_ATTR\_MAX},
    .netnsok = \textcolor{keyword}{true},
    .parallel\_ops = \textcolor{keyword}{true},
    .ops = \hyperlink{datapath_8c_a75ed1b368ac93a17ed4d04c82b892be9}{dp\_packet\_genl\_ops},
    .n\_ops = ARRAY\_SIZE(\hyperlink{datapath_8c_a75ed1b368ac93a17ed4d04c82b892be9}{dp\_packet\_genl\_ops}),
\}
\end{DoxyCode}
\hypertarget{datapath_8c_a75ed1b368ac93a17ed4d04c82b892be9}{}\index{datapath.\+c@{datapath.\+c}!dp\+\_\+packet\+\_\+genl\+\_\+ops@{dp\+\_\+packet\+\_\+genl\+\_\+ops}}
\index{dp\+\_\+packet\+\_\+genl\+\_\+ops@{dp\+\_\+packet\+\_\+genl\+\_\+ops}!datapath.\+c@{datapath.\+c}}
\subsubsection[{dp\+\_\+packet\+\_\+genl\+\_\+ops}]{\setlength{\rightskip}{0pt plus 5cm}struct genl\+\_\+ops dp\+\_\+packet\+\_\+genl\+\_\+ops\mbox{[}$\,$\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a75ed1b368ac93a17ed4d04c82b892be9}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    \{ .cmd = \hyperlink{openvswitch_8h_a162a763c571debd951c9d2727b0f9bc3ac4964483b5e4005e4c9c745b28735e75}{OVS\_PACKET\_CMD\_EXECUTE},
      .flags = GENL\_ADMIN\_PERM, 
      .policy = \hyperlink{datapath_8c_aaef8775f67f989a9ff396e2aa6f6f3e2}{packet\_policy},
      .doit = \hyperlink{datapath_8c_a20b16b839bd3116f7dbad5719b02c115}{ovs\_packet\_cmd\_execute}
    \}
\}
\end{DoxyCode}
\hypertarget{datapath_8c_a69bf55f33e234bc4b78e6eeee1d603fd}{}\index{datapath.\+c@{datapath.\+c}!dp\+\_\+vport\+\_\+genl\+\_\+family@{dp\+\_\+vport\+\_\+genl\+\_\+family}}
\index{dp\+\_\+vport\+\_\+genl\+\_\+family@{dp\+\_\+vport\+\_\+genl\+\_\+family}!datapath.\+c@{datapath.\+c}}
\subsubsection[{dp\+\_\+vport\+\_\+genl\+\_\+family}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf genl\+\_\+family} dp\+\_\+vport\+\_\+genl\+\_\+family}\label{datapath_8c_a69bf55f33e234bc4b78e6eeee1d603fd}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    .id = GENL\_ID\_GENERATE,
    .hdrsize = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }\hyperlink{structovs__header}{ovs\_header}),
    .name = \hyperlink{openvswitch_8h_a3b479ce8afc5c926a2f00ff2bd6ae955}{OVS\_VPORT\_FAMILY},
    .version = \hyperlink{openvswitch_8h_a75bc4af06158c9dc5e72b47c72661260}{OVS\_VPORT\_VERSION},
    .maxattr = \hyperlink{openvswitch_8h_a789cf40a0af09c574467d47ca6a2eb7b}{OVS\_VPORT\_ATTR\_MAX},
    .netnsok = \textcolor{keyword}{true},
    .parallel\_ops = \textcolor{keyword}{true},
    .ops = \hyperlink{datapath_8c_a5a28211e3b7e9a5cf7ccf8e81b8bfa8e}{dp\_vport\_genl\_ops},
    .n\_ops = ARRAY\_SIZE(\hyperlink{datapath_8c_a5a28211e3b7e9a5cf7ccf8e81b8bfa8e}{dp\_vport\_genl\_ops}),
    .mcgrps = &\hyperlink{datapath_8c_a9dd8d4307b50fdee582eb4013d89eb7b}{ovs\_dp\_vport\_multicast\_group},
    .n\_mcgrps = 1,
\}
\end{DoxyCode}
\hypertarget{datapath_8c_a5a28211e3b7e9a5cf7ccf8e81b8bfa8e}{}\index{datapath.\+c@{datapath.\+c}!dp\+\_\+vport\+\_\+genl\+\_\+ops@{dp\+\_\+vport\+\_\+genl\+\_\+ops}}
\index{dp\+\_\+vport\+\_\+genl\+\_\+ops@{dp\+\_\+vport\+\_\+genl\+\_\+ops}!datapath.\+c@{datapath.\+c}}
\subsubsection[{dp\+\_\+vport\+\_\+genl\+\_\+ops}]{\setlength{\rightskip}{0pt plus 5cm}struct genl\+\_\+ops dp\+\_\+vport\+\_\+genl\+\_\+ops\mbox{[}$\,$\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a5a28211e3b7e9a5cf7ccf8e81b8bfa8e}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    \{ .cmd = \hyperlink{openvswitch_8h_ae012c39e873d42b086636b19a242c354af6255867587891980ef6577446362d45}{OVS\_VPORT\_CMD\_NEW},
      .flags = GENL\_ADMIN\_PERM, 
      .policy = \hyperlink{datapath_8c_af3f5c0f1eb12c1eb1a2494f265dda98a}{vport\_policy},
      .doit = \hyperlink{datapath_8c_a0b878975d12b240c20c6b5389b5b12b6}{ovs\_vport\_cmd\_new}
    \},
    \{ .cmd = \hyperlink{openvswitch_8h_ae012c39e873d42b086636b19a242c354a067967d6cc0d7b7283ad6d77cba6936f}{OVS\_VPORT\_CMD\_DEL},
      .flags = GENL\_ADMIN\_PERM, 
      .policy = \hyperlink{datapath_8c_af3f5c0f1eb12c1eb1a2494f265dda98a}{vport\_policy},
      .doit = \hyperlink{datapath_8c_afc2316a8fe3074ed07e853d552fb4704}{ovs\_vport\_cmd\_del}
    \},
    \{ .cmd = \hyperlink{openvswitch_8h_ae012c39e873d42b086636b19a242c354a05c323e17334722a02cc910e29d3d338}{OVS\_VPORT\_CMD\_GET},
      .flags = 0,           
      .policy = \hyperlink{datapath_8c_af3f5c0f1eb12c1eb1a2494f265dda98a}{vport\_policy},
      .doit = \hyperlink{datapath_8c_ad818149bb2b46cab6eeb5b7ba6a14afe}{ovs\_vport\_cmd\_get},
      .dumpit = \hyperlink{datapath_8c_ac61e52592bc18541660c182e9aebbcaf}{ovs\_vport\_cmd\_dump}
    \},
    \{ .cmd = \hyperlink{openvswitch_8h_ae012c39e873d42b086636b19a242c354a96ee5280006d8c13e60f0c97fceb346e}{OVS\_VPORT\_CMD\_SET},
      .flags = GENL\_ADMIN\_PERM, 
      .policy = \hyperlink{datapath_8c_af3f5c0f1eb12c1eb1a2494f265dda98a}{vport\_policy},
      .doit = \hyperlink{datapath_8c_a89f1e2fa808021479860862b3e7556e5}{ovs\_vport\_cmd\_set},
    \},
\}
\end{DoxyCode}
\hypertarget{datapath_8c_aad79544f457c7a323273d328dafff886}{}\index{datapath.\+c@{datapath.\+c}!flow\+\_\+policy@{flow\+\_\+policy}}
\index{flow\+\_\+policy@{flow\+\_\+policy}!datapath.\+c@{datapath.\+c}}
\subsubsection[{flow\+\_\+policy}]{\setlength{\rightskip}{0pt plus 5cm}static const struct nla\+\_\+policy flow\+\_\+policy\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_aad79544f457c7a323273d328dafff886}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    [\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a0d310e7624962a1b4c5212459995a5c9}{OVS\_FLOW\_ATTR\_KEY}] = \{ .type = NLA\_NESTED \},
    [\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a355a203b089e115abb28ea003dc5822c}{OVS\_FLOW\_ATTR\_MASK}] = \{ .type = NLA\_NESTED \},
    [\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554ae28f57a4b243f965ad67a6e96ad09aea}{OVS\_FLOW\_ATTR\_ACTIONS}] = \{ .type = NLA\_NESTED \},
    [\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a4f9d4c0277a9ba32b021a411a37259c6}{OVS\_FLOW\_ATTR\_CLEAR}] = \{ .type = NLA\_FLAG \},
    [\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a667851b468a6c195d627220177b2a973}{OVS\_FLOW\_ATTR\_PROBE}] = \{ .type = NLA\_FLAG \},
    [\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a0d2822e9d4b6fa37c54dd8b693c2b465}{OVS\_FLOW\_ATTR\_UFID}] = \{ .type = NLA\_UNSPEC, .len = 1 \},
    [\hyperlink{openvswitch_8h_a57b731cb45ac4bf32234fbf071e9c554a151813739a9f8d3ecc0c08503b9b0042}{OVS\_FLOW\_ATTR\_UFID\_FLAGS}] = \{ .type = NLA\_U32 \},
\}
\end{DoxyCode}
\hypertarget{datapath_8c_afa5d1f090aee506896ff5ef56b4053e1}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+datapath\+\_\+multicast\+\_\+group@{ovs\+\_\+dp\+\_\+datapath\+\_\+multicast\+\_\+group}}
\index{ovs\+\_\+dp\+\_\+datapath\+\_\+multicast\+\_\+group@{ovs\+\_\+dp\+\_\+datapath\+\_\+multicast\+\_\+group}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+datapath\+\_\+multicast\+\_\+group}]{\setlength{\rightskip}{0pt plus 5cm}struct genl\+\_\+multicast\+\_\+group ovs\+\_\+dp\+\_\+datapath\+\_\+multicast\+\_\+group\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_afa5d1f090aee506896ff5ef56b4053e1}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    .name = \hyperlink{openvswitch_8h_a3673c0ac440db8bd6d238d2ff4683de5}{OVS\_DATAPATH\_MCGROUP}
\}
\end{DoxyCode}
\hypertarget{datapath_8c_ae43fcc307ac0fa091a736d4687c7f884}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+flow\+\_\+multicast\+\_\+group@{ovs\+\_\+dp\+\_\+flow\+\_\+multicast\+\_\+group}}
\index{ovs\+\_\+dp\+\_\+flow\+\_\+multicast\+\_\+group@{ovs\+\_\+dp\+\_\+flow\+\_\+multicast\+\_\+group}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+flow\+\_\+multicast\+\_\+group}]{\setlength{\rightskip}{0pt plus 5cm}struct genl\+\_\+multicast\+\_\+group ovs\+\_\+dp\+\_\+flow\+\_\+multicast\+\_\+group\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_ae43fcc307ac0fa091a736d4687c7f884}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    .name = \hyperlink{openvswitch_8h_a61e7be54e39b43e0d78c4ceafba15e1f}{OVS\_FLOW\_MCGROUP}
\}
\end{DoxyCode}
\hypertarget{datapath_8c_a9dd8d4307b50fdee582eb4013d89eb7b}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+dp\+\_\+vport\+\_\+multicast\+\_\+group@{ovs\+\_\+dp\+\_\+vport\+\_\+multicast\+\_\+group}}
\index{ovs\+\_\+dp\+\_\+vport\+\_\+multicast\+\_\+group@{ovs\+\_\+dp\+\_\+vport\+\_\+multicast\+\_\+group}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+vport\+\_\+multicast\+\_\+group}]{\setlength{\rightskip}{0pt plus 5cm}struct genl\+\_\+multicast\+\_\+group ovs\+\_\+dp\+\_\+vport\+\_\+multicast\+\_\+group}\label{datapath_8c_a9dd8d4307b50fdee582eb4013d89eb7b}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    .name = \hyperlink{openvswitch_8h_a0b8c92c5b5790b096b7c1d3b7f7c82d6}{OVS\_VPORT\_MCGROUP}
\}
\end{DoxyCode}
\hypertarget{datapath_8c_a3a9f5b1a35fcb90938194f22dc2d0f14}{}\index{datapath.\+c@{datapath.\+c}!ovs\+\_\+net\+\_\+ops@{ovs\+\_\+net\+\_\+ops}}
\index{ovs\+\_\+net\+\_\+ops@{ovs\+\_\+net\+\_\+ops}!datapath.\+c@{datapath.\+c}}
\subsubsection[{ovs\+\_\+net\+\_\+ops}]{\setlength{\rightskip}{0pt plus 5cm}struct pernet\+\_\+operations ovs\+\_\+net\+\_\+ops\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_a3a9f5b1a35fcb90938194f22dc2d0f14}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    .init = \hyperlink{datapath_8c_af390458a6069bd6b50c9a0d46517159a}{ovs\_init\_net},
    .exit = \hyperlink{datapath_8c_aead9307565d6ab903dd5db639c7299e4}{ovs\_exit\_net},
    .id   = &\hyperlink{datapath_8h_ace140298dc2b59b3d77d59c0a210de29}{ovs\_net\_id},
    .size = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }\hyperlink{structovs__net}{ovs\_net}),
\}
\end{DoxyCode}
\hypertarget{datapath_8c_aaef8775f67f989a9ff396e2aa6f6f3e2}{}\index{datapath.\+c@{datapath.\+c}!packet\+\_\+policy@{packet\+\_\+policy}}
\index{packet\+\_\+policy@{packet\+\_\+policy}!datapath.\+c@{datapath.\+c}}
\subsubsection[{packet\+\_\+policy}]{\setlength{\rightskip}{0pt plus 5cm}const struct nla\+\_\+policy packet\+\_\+policy\mbox{[}{\bf O\+V\+S\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+A\+T\+T\+R\+\_\+\+M\+A\+X}+1\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_aaef8775f67f989a9ff396e2aa6f6f3e2}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    [\hyperlink{openvswitch_8h_a34899be8f30456f4c7c2747eaf3eb78bac19f59ebb0be0e7a3d6e145369562977}{OVS\_PACKET\_ATTR\_PACKET}] = \{ .len = ETH\_HLEN \},
    [\hyperlink{openvswitch_8h_a34899be8f30456f4c7c2747eaf3eb78ba24d5d8704ff3c8ad939a01ea2f29acf7}{OVS\_PACKET\_ATTR\_KEY}] = \{ .type = NLA\_NESTED \},
    [\hyperlink{openvswitch_8h_a34899be8f30456f4c7c2747eaf3eb78ba92b7b96f0518290779bfd078f1456d85}{OVS\_PACKET\_ATTR\_ACTIONS}] = \{ .type = NLA\_NESTED \},
    [\hyperlink{openvswitch_8h_a34899be8f30456f4c7c2747eaf3eb78ba704db48bfb2df7e31805ee5c5909172e}{OVS\_PACKET\_ATTR\_PROBE}] = \{ .type = NLA\_FLAG \},
\}
\end{DoxyCode}
\hypertarget{datapath_8c_af3f5c0f1eb12c1eb1a2494f265dda98a}{}\index{datapath.\+c@{datapath.\+c}!vport\+\_\+policy@{vport\+\_\+policy}}
\index{vport\+\_\+policy@{vport\+\_\+policy}!datapath.\+c@{datapath.\+c}}
\subsubsection[{vport\+\_\+policy}]{\setlength{\rightskip}{0pt plus 5cm}const struct nla\+\_\+policy vport\+\_\+policy\mbox{[}{\bf O\+V\+S\+\_\+\+V\+P\+O\+R\+T\+\_\+\+A\+T\+T\+R\+\_\+\+M\+A\+X}+1\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}\label{datapath_8c_af3f5c0f1eb12c1eb1a2494f265dda98a}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    [\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464daef39b12d8a0cb39f2248d82f435bec3c}{OVS\_VPORT\_ATTR\_NAME}] = \{ .type = NLA\_NUL\_STRING, .len = IFNAMSIZ - 1 \},
    [\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464dadab030c40c3510bf42f3e33d3986fbaa}{OVS\_VPORT\_ATTR\_STATS}] = \{ .len = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }
      \hyperlink{structovs__vport__stats}{ovs\_vport\_stats}) \},
    [\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464da08e4cd652a0f6cd6eeeaac1db3bdf503}{OVS\_VPORT\_ATTR\_PORT\_NO}] = \{ .type = NLA\_U32 \},
    [\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464da84ada86f1005907daaf7dc8eb0c0a637}{OVS\_VPORT\_ATTR\_TYPE}] = \{ .type = NLA\_U32 \},
    [\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464da3afa40888197949fd69c2f5f6076fcc2}{OVS\_VPORT\_ATTR\_UPCALL\_PID}] = \{ .type = NLA\_U32 \},
    [\hyperlink{openvswitch_8h_aae19f7a3f207d3adc0b9a30b79c6464dac0bc104dd1ef77ac2f0a0f9d6f087239}{OVS\_VPORT\_ATTR\_OPTIONS}] = \{ .type = NLA\_NESTED \},
\}
\end{DoxyCode}
