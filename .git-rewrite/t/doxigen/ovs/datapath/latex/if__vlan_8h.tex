\hypertarget{if__vlan_8h}{}\section{/home/vladn/git/ovs/datapath/linux/compat/include/linux/if\+\_\+vlan.h File Reference}
\label{if__vlan_8h}\index{/home/vladn/git/ovs/datapath/linux/compat/include/linux/if\+\_\+vlan.\+h@{/home/vladn/git/ovs/datapath/linux/compat/include/linux/if\+\_\+vlan.\+h}}
{\ttfamily \#include $<$linux/skbuff.\+h$>$}\\*
{\ttfamily \#include $<$linux/version.\+h$>$}\\*
Include dependency graph for if\+\_\+vlan.\+h\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{if__vlan_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{if__vlan_8h__dep__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{if__vlan_8h_a458e4fe2d77c1973bb14ed81f76cf562}{vlan\+\_\+insert\+\_\+tag\+\_\+set\+\_\+proto}(skb,  \hyperlink{flow_8h_af1698a0033f39eb7a745097761b717d2}{proto},  vlan\+\_\+tci)~\hyperlink{if__vlan_8h_aff31d238f4246372f129a175bd6459c2}{rpl\+\_\+vlan\+\_\+insert\+\_\+tag\+\_\+set\+\_\+proto}(skb, vlan\+\_\+tci)
\item 
\#define \hyperlink{if__vlan_8h_ac63a1655fd12f2bb65b488a8dd28108e}{V\+L\+A\+N\+\_\+\+P\+R\+I\+O\+\_\+\+M\+A\+S\+K}~0xe000 /$\ast$ Priority Code Point $\ast$/
\item 
\#define \hyperlink{if__vlan_8h_add0a34bea2b4ba4d85d43401cc8d9c4f}{V\+L\+A\+N\+\_\+\+P\+R\+I\+O\+\_\+\+S\+H\+I\+F\+T}~13
\item 
\#define \hyperlink{if__vlan_8h_ae8ea7341ee9684778a44fe4e0004d098}{V\+L\+A\+N\+\_\+\+C\+F\+I\+\_\+\+M\+A\+S\+K}~0x1000 /$\ast$ Canonical Format Indicator $\ast$/
\item 
\#define \hyperlink{if__vlan_8h_ac8bf15be3fd1a3a63a2452fa05a83217}{V\+L\+A\+N\+\_\+\+T\+A\+G\+\_\+\+P\+R\+E\+S\+E\+N\+T}~\hyperlink{if__vlan_8h_ae8ea7341ee9684778a44fe4e0004d098}{V\+L\+A\+N\+\_\+\+C\+F\+I\+\_\+\+M\+A\+S\+K}
\item 
\#define \hyperlink{if__vlan_8h_aec003868f531858e684c2ff8edc3ef72}{\+\_\+\+\_\+vlan\+\_\+insert\+\_\+tag}(skb,  \hyperlink{flow_8h_af1698a0033f39eb7a745097761b717d2}{proto},  \hyperlink{flow_8h_a4528fe4db43b403cd959b50285d71b0c}{tci})~\hyperlink{if__vlan_8h_a0ccb375fc6a6728ddc2175f9cc23e3af}{rpl\+\_\+vlan\+\_\+insert\+\_\+tag}(skb, \hyperlink{flow_8h_a4528fe4db43b403cd959b50285d71b0c}{tci})
\item 
\#define \hyperlink{if__vlan_8h_a0bdf3e26944669a4265c7e717e846215}{skb\+\_\+vlan\+\_\+tag\+\_\+present}(skb)~vlan\+\_\+tx\+\_\+tag\+\_\+present(skb)
\item 
\#define \hyperlink{if__vlan_8h_a0fa23322859cba87d3f5e4526aafd80f}{skb\+\_\+vlan\+\_\+tag\+\_\+get}(skb)~vlan\+\_\+tx\+\_\+tag\+\_\+get(skb)
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static struct sk\+\_\+buff $\ast$ \hyperlink{if__vlan_8h_aff31d238f4246372f129a175bd6459c2}{rpl\+\_\+vlan\+\_\+insert\+\_\+tag\+\_\+set\+\_\+proto} (struct sk\+\_\+buff $\ast$skb, u16 vlan\+\_\+tci)
\item 
static void \hyperlink{if__vlan_8h_a5c4cef422095e8594dac7c32fe582d65}{vlan\+\_\+set\+\_\+encap\+\_\+proto} (struct sk\+\_\+buff $\ast$skb, struct vlan\+\_\+hdr $\ast$vhdr)
\item 
static int \hyperlink{if__vlan_8h_a0ccb375fc6a6728ddc2175f9cc23e3af}{rpl\+\_\+vlan\+\_\+insert\+\_\+tag} (struct sk\+\_\+buff $\ast$skb, u16 vlan\+\_\+tci)
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{if__vlan_8h_aec003868f531858e684c2ff8edc3ef72}{}\index{if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}!\+\_\+\+\_\+vlan\+\_\+insert\+\_\+tag@{\+\_\+\+\_\+vlan\+\_\+insert\+\_\+tag}}
\index{\+\_\+\+\_\+vlan\+\_\+insert\+\_\+tag@{\+\_\+\+\_\+vlan\+\_\+insert\+\_\+tag}!if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}}
\subsubsection[{\+\_\+\+\_\+vlan\+\_\+insert\+\_\+tag}]{\setlength{\rightskip}{0pt plus 5cm}\#define \+\_\+\+\_\+vlan\+\_\+insert\+\_\+tag(
\begin{DoxyParamCaption}
\item[{}]{skb, }
\item[{}]{{\bf proto}, }
\item[{}]{{\bf tci}}
\end{DoxyParamCaption}
)~{\bf rpl\+\_\+vlan\+\_\+insert\+\_\+tag}(skb, {\bf tci})}\label{if__vlan_8h_aec003868f531858e684c2ff8edc3ef72}
\hypertarget{if__vlan_8h_a0fa23322859cba87d3f5e4526aafd80f}{}\index{if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}!skb\+\_\+vlan\+\_\+tag\+\_\+get@{skb\+\_\+vlan\+\_\+tag\+\_\+get}}
\index{skb\+\_\+vlan\+\_\+tag\+\_\+get@{skb\+\_\+vlan\+\_\+tag\+\_\+get}!if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}}
\subsubsection[{skb\+\_\+vlan\+\_\+tag\+\_\+get}]{\setlength{\rightskip}{0pt plus 5cm}\#define skb\+\_\+vlan\+\_\+tag\+\_\+get(
\begin{DoxyParamCaption}
\item[{}]{skb}
\end{DoxyParamCaption}
)~vlan\+\_\+tx\+\_\+tag\+\_\+get(skb)}\label{if__vlan_8h_a0fa23322859cba87d3f5e4526aafd80f}
\hypertarget{if__vlan_8h_a0bdf3e26944669a4265c7e717e846215}{}\index{if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}!skb\+\_\+vlan\+\_\+tag\+\_\+present@{skb\+\_\+vlan\+\_\+tag\+\_\+present}}
\index{skb\+\_\+vlan\+\_\+tag\+\_\+present@{skb\+\_\+vlan\+\_\+tag\+\_\+present}!if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}}
\subsubsection[{skb\+\_\+vlan\+\_\+tag\+\_\+present}]{\setlength{\rightskip}{0pt plus 5cm}\#define skb\+\_\+vlan\+\_\+tag\+\_\+present(
\begin{DoxyParamCaption}
\item[{}]{skb}
\end{DoxyParamCaption}
)~vlan\+\_\+tx\+\_\+tag\+\_\+present(skb)}\label{if__vlan_8h_a0bdf3e26944669a4265c7e717e846215}
\hypertarget{if__vlan_8h_ae8ea7341ee9684778a44fe4e0004d098}{}\index{if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}!V\+L\+A\+N\+\_\+\+C\+F\+I\+\_\+\+M\+A\+S\+K@{V\+L\+A\+N\+\_\+\+C\+F\+I\+\_\+\+M\+A\+S\+K}}
\index{V\+L\+A\+N\+\_\+\+C\+F\+I\+\_\+\+M\+A\+S\+K@{V\+L\+A\+N\+\_\+\+C\+F\+I\+\_\+\+M\+A\+S\+K}!if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}}
\subsubsection[{V\+L\+A\+N\+\_\+\+C\+F\+I\+\_\+\+M\+A\+S\+K}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\+L\+A\+N\+\_\+\+C\+F\+I\+\_\+\+M\+A\+S\+K~0x1000 /$\ast$ Canonical Format Indicator $\ast$/}\label{if__vlan_8h_ae8ea7341ee9684778a44fe4e0004d098}
\hypertarget{if__vlan_8h_a458e4fe2d77c1973bb14ed81f76cf562}{}\index{if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}!vlan\+\_\+insert\+\_\+tag\+\_\+set\+\_\+proto@{vlan\+\_\+insert\+\_\+tag\+\_\+set\+\_\+proto}}
\index{vlan\+\_\+insert\+\_\+tag\+\_\+set\+\_\+proto@{vlan\+\_\+insert\+\_\+tag\+\_\+set\+\_\+proto}!if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}}
\subsubsection[{vlan\+\_\+insert\+\_\+tag\+\_\+set\+\_\+proto}]{\setlength{\rightskip}{0pt plus 5cm}\#define vlan\+\_\+insert\+\_\+tag\+\_\+set\+\_\+proto(
\begin{DoxyParamCaption}
\item[{}]{skb, }
\item[{}]{{\bf proto}, }
\item[{}]{vlan\+\_\+tci}
\end{DoxyParamCaption}
)~{\bf rpl\+\_\+vlan\+\_\+insert\+\_\+tag\+\_\+set\+\_\+proto}(skb, vlan\+\_\+tci)}\label{if__vlan_8h_a458e4fe2d77c1973bb14ed81f76cf562}
\hypertarget{if__vlan_8h_ac63a1655fd12f2bb65b488a8dd28108e}{}\index{if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}!V\+L\+A\+N\+\_\+\+P\+R\+I\+O\+\_\+\+M\+A\+S\+K@{V\+L\+A\+N\+\_\+\+P\+R\+I\+O\+\_\+\+M\+A\+S\+K}}
\index{V\+L\+A\+N\+\_\+\+P\+R\+I\+O\+\_\+\+M\+A\+S\+K@{V\+L\+A\+N\+\_\+\+P\+R\+I\+O\+\_\+\+M\+A\+S\+K}!if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}}
\subsubsection[{V\+L\+A\+N\+\_\+\+P\+R\+I\+O\+\_\+\+M\+A\+S\+K}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\+L\+A\+N\+\_\+\+P\+R\+I\+O\+\_\+\+M\+A\+S\+K~0xe000 /$\ast$ Priority Code Point $\ast$/}\label{if__vlan_8h_ac63a1655fd12f2bb65b488a8dd28108e}
\hypertarget{if__vlan_8h_add0a34bea2b4ba4d85d43401cc8d9c4f}{}\index{if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}!V\+L\+A\+N\+\_\+\+P\+R\+I\+O\+\_\+\+S\+H\+I\+F\+T@{V\+L\+A\+N\+\_\+\+P\+R\+I\+O\+\_\+\+S\+H\+I\+F\+T}}
\index{V\+L\+A\+N\+\_\+\+P\+R\+I\+O\+\_\+\+S\+H\+I\+F\+T@{V\+L\+A\+N\+\_\+\+P\+R\+I\+O\+\_\+\+S\+H\+I\+F\+T}!if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}}
\subsubsection[{V\+L\+A\+N\+\_\+\+P\+R\+I\+O\+\_\+\+S\+H\+I\+F\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\+L\+A\+N\+\_\+\+P\+R\+I\+O\+\_\+\+S\+H\+I\+F\+T~13}\label{if__vlan_8h_add0a34bea2b4ba4d85d43401cc8d9c4f}
\hypertarget{if__vlan_8h_ac8bf15be3fd1a3a63a2452fa05a83217}{}\index{if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}!V\+L\+A\+N\+\_\+\+T\+A\+G\+\_\+\+P\+R\+E\+S\+E\+N\+T@{V\+L\+A\+N\+\_\+\+T\+A\+G\+\_\+\+P\+R\+E\+S\+E\+N\+T}}
\index{V\+L\+A\+N\+\_\+\+T\+A\+G\+\_\+\+P\+R\+E\+S\+E\+N\+T@{V\+L\+A\+N\+\_\+\+T\+A\+G\+\_\+\+P\+R\+E\+S\+E\+N\+T}!if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}}
\subsubsection[{V\+L\+A\+N\+\_\+\+T\+A\+G\+\_\+\+P\+R\+E\+S\+E\+N\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\+L\+A\+N\+\_\+\+T\+A\+G\+\_\+\+P\+R\+E\+S\+E\+N\+T~{\bf V\+L\+A\+N\+\_\+\+C\+F\+I\+\_\+\+M\+A\+S\+K}}\label{if__vlan_8h_ac8bf15be3fd1a3a63a2452fa05a83217}


\subsection{Function Documentation}
\hypertarget{if__vlan_8h_a0ccb375fc6a6728ddc2175f9cc23e3af}{}\index{if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}!rpl\+\_\+vlan\+\_\+insert\+\_\+tag@{rpl\+\_\+vlan\+\_\+insert\+\_\+tag}}
\index{rpl\+\_\+vlan\+\_\+insert\+\_\+tag@{rpl\+\_\+vlan\+\_\+insert\+\_\+tag}!if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}}
\subsubsection[{rpl\+\_\+vlan\+\_\+insert\+\_\+tag}]{\setlength{\rightskip}{0pt plus 5cm}static int rpl\+\_\+vlan\+\_\+insert\+\_\+tag (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{u16}]{vlan\+\_\+tci}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}\label{if__vlan_8h_a0ccb375fc6a6728ddc2175f9cc23e3af}

\begin{DoxyCode}
152 \{
153     \textcolor{keyword}{struct }vlan\_ethhdr *veth;
154 
155     \textcolor{keywordflow}{if} (\hyperlink{skbuff_8h_af94d3f18640790df84539d4c0575a880}{skb\_cow\_head}(skb, VLAN\_HLEN) < 0)
156         \textcolor{keywordflow}{return} -ENOMEM;
157 
158     veth = (\textcolor{keyword}{struct }vlan\_ethhdr *)skb\_push(skb, VLAN\_HLEN);
159 
160     \textcolor{comment}{/* Move the mac addresses to the beginning of the new header. */}
161     memmove(skb->data, skb->data + VLAN\_HLEN, 2 * ETH\_ALEN);
162     skb->mac\_header -= VLAN\_HLEN;
163 
164     \textcolor{comment}{/* first, the ethernet type */}
165     veth->h\_vlan\_proto = htons(ETH\_P\_8021Q);
166 
167     \textcolor{comment}{/* now, the TCI */}
168     veth->h\_vlan\_TCI = htons(vlan\_tci);
169 
170     \textcolor{keywordflow}{return} 0;
171 \}
\end{DoxyCode}
\hypertarget{if__vlan_8h_aff31d238f4246372f129a175bd6459c2}{}\index{if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}!rpl\+\_\+vlan\+\_\+insert\+\_\+tag\+\_\+set\+\_\+proto@{rpl\+\_\+vlan\+\_\+insert\+\_\+tag\+\_\+set\+\_\+proto}}
\index{rpl\+\_\+vlan\+\_\+insert\+\_\+tag\+\_\+set\+\_\+proto@{rpl\+\_\+vlan\+\_\+insert\+\_\+tag\+\_\+set\+\_\+proto}!if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}}
\subsubsection[{rpl\+\_\+vlan\+\_\+insert\+\_\+tag\+\_\+set\+\_\+proto}]{\setlength{\rightskip}{0pt plus 5cm}static struct sk\+\_\+buff$\ast$ rpl\+\_\+vlan\+\_\+insert\+\_\+tag\+\_\+set\+\_\+proto (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{u16}]{vlan\+\_\+tci}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{if__vlan_8h_aff31d238f4246372f129a175bd6459c2}

\begin{DoxyCode}
30 \{
31     \textcolor{keyword}{struct }vlan\_ethhdr *veth;
32 
33     \textcolor{keywordflow}{if} (\hyperlink{skbuff_8h_af94d3f18640790df84539d4c0575a880}{skb\_cow\_head}(skb, VLAN\_HLEN) < 0) \{
34         kfree\_skb(skb);
35         \textcolor{keywordflow}{return} NULL;
36     \}
37     veth = (\textcolor{keyword}{struct }vlan\_ethhdr *)skb\_push(skb, VLAN\_HLEN);
38 
39     \textcolor{comment}{/* Move the mac addresses to the beginning of the new header. */}
40     memmove(skb->data, skb->data + VLAN\_HLEN, 2 * ETH\_ALEN);
41     skb->mac\_header -= VLAN\_HLEN;
42 
43     \textcolor{comment}{/* first, the ethernet type */}
44     veth->h\_vlan\_proto = htons(ETH\_P\_8021Q);
45 
46     \textcolor{comment}{/* now, the TCI */}
47     veth->h\_vlan\_TCI = htons(vlan\_tci);
48 
49     skb->protocol = htons(ETH\_P\_8021Q);
50 
51     \textcolor{keywordflow}{return} skb;
52 \}
\end{DoxyCode}
\hypertarget{if__vlan_8h_a5c4cef422095e8594dac7c32fe582d65}{}\index{if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}!vlan\+\_\+set\+\_\+encap\+\_\+proto@{vlan\+\_\+set\+\_\+encap\+\_\+proto}}
\index{vlan\+\_\+set\+\_\+encap\+\_\+proto@{vlan\+\_\+set\+\_\+encap\+\_\+proto}!if\+\_\+vlan.\+h@{if\+\_\+vlan.\+h}}
\subsubsection[{vlan\+\_\+set\+\_\+encap\+\_\+proto}]{\setlength{\rightskip}{0pt plus 5cm}static void vlan\+\_\+set\+\_\+encap\+\_\+proto (
\begin{DoxyParamCaption}
\item[{struct sk\+\_\+buff $\ast$}]{skb, }
\item[{struct vlan\+\_\+hdr $\ast$}]{vhdr}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}\label{if__vlan_8h_a5c4cef422095e8594dac7c32fe582d65}

\begin{DoxyCode}
113 \{
114     \_\_be16 \hyperlink{flow_8h_af1698a0033f39eb7a745097761b717d2}{proto};
115     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *rawp;
116 
117     \textcolor{comment}{/*}
118 \textcolor{comment}{     * Was a VLAN packet, grab the encapsulated protocol, which the layer}
119 \textcolor{comment}{     * three protocols care about.}
120 \textcolor{comment}{     */}
121 
122     proto = vhdr->h\_vlan\_encapsulated\_proto;
123     \textcolor{keywordflow}{if} (ntohs(proto) >= 1536) \{
124         skb->protocol = \hyperlink{flow_8h_af1698a0033f39eb7a745097761b717d2}{proto};
125         \textcolor{keywordflow}{return};
126     \}
127 
128     rawp = skb->data;
129     \textcolor{keywordflow}{if} (*(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} *) rawp == 0xFFFF)
130         \textcolor{comment}{/*}
131 \textcolor{comment}{         * This is a magic hack to spot IPX packets. Older Novell}
132 \textcolor{comment}{         * breaks the protocol design and runs IPX over 802.3 without}
133 \textcolor{comment}{         * an 802.2 LLC layer. We look for FFFF which isn't a used}
134 \textcolor{comment}{         * 802.2 SSAP/DSAP. This won't work for fault tolerant netware}
135 \textcolor{comment}{         * but does for the rest.}
136 \textcolor{comment}{         */}
137         skb->protocol = htons(ETH\_P\_802\_3);
138     \textcolor{keywordflow}{else}
139         \textcolor{comment}{/*}
140 \textcolor{comment}{         * Real 802.2 LLC}
141 \textcolor{comment}{         */}
142         skb->protocol = htons(ETH\_P\_802\_2);
143 \}
\end{DoxyCode}
