\hypertarget{linux_2dp__notify_8c}{}\section{/home/vladn/git/ovs/datapath/linux/dp\+\_\+notify.c File Reference}
\label{linux_2dp__notify_8c}\index{/home/vladn/git/ovs/datapath/linux/dp\+\_\+notify.\+c@{/home/vladn/git/ovs/datapath/linux/dp\+\_\+notify.\+c}}
{\ttfamily \#include $<$linux/netdevice.\+h$>$}\\*
{\ttfamily \#include $<$net/genetlink.\+h$>$}\\*
{\ttfamily \#include $<$net/net\+\_\+namespace.\+h$>$}\\*
{\ttfamily \#include $<$net/netns/generic.\+h$>$}\\*
{\ttfamily \#include \char`\"{}datapath.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}vport-\/internal\+\_\+dev.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}vport-\/netdev.\+h\char`\"{}}\\*
Include dependency graph for dp\+\_\+notify.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{linux_2dp__notify_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{linux_2dp__notify_8c_abfe6aca1ecdf831b014297563fc08731}{dp\+\_\+detach\+\_\+port\+\_\+notify} (struct \hyperlink{structvport}{vport} $\ast$\hyperlink{structvport}{vport})
\item 
void \hyperlink{linux_2dp__notify_8c_a5d5624a3bb21c222e3a6f18f56ff20b2}{ovs\+\_\+dp\+\_\+notify\+\_\+wq} (struct work\+\_\+struct $\ast$work)
\item 
static int \hyperlink{linux_2dp__notify_8c_acca2a908a0982dd42292177079cf5643}{dp\+\_\+device\+\_\+event} (struct notifier\+\_\+block $\ast$unused, unsigned long event, void $\ast$ptr)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
struct notifier\+\_\+block \hyperlink{linux_2dp__notify_8c_ab34ba4d6c1125efcec9480356f3393e6}{ovs\+\_\+dp\+\_\+device\+\_\+notifier}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{linux_2dp__notify_8c_abfe6aca1ecdf831b014297563fc08731}{}\index{linux/dp\+\_\+notify.\+c@{linux/dp\+\_\+notify.\+c}!dp\+\_\+detach\+\_\+port\+\_\+notify@{dp\+\_\+detach\+\_\+port\+\_\+notify}}
\index{dp\+\_\+detach\+\_\+port\+\_\+notify@{dp\+\_\+detach\+\_\+port\+\_\+notify}!linux/dp\+\_\+notify.\+c@{linux/dp\+\_\+notify.\+c}}
\subsubsection[{dp\+\_\+detach\+\_\+port\+\_\+notify}]{\setlength{\rightskip}{0pt plus 5cm}static void dp\+\_\+detach\+\_\+port\+\_\+notify (
\begin{DoxyParamCaption}
\item[{struct {\bf vport} $\ast$}]{vport}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2dp__notify_8c_abfe6aca1ecdf831b014297563fc08731}

\begin{DoxyCode}
29 \{
30     \textcolor{keyword}{struct }sk\_buff *notify;
31     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
32 
33     dp = vport->\hyperlink{structvport_a49fb6f6bf0ac4337853e9242e88ddc42}{dp};
34     notify = \hyperlink{datapath_8c_adf50e47c9c548390402b1da1608235c9}{ovs\_vport\_cmd\_build\_info}(vport, 0, 0, 
      \hyperlink{openvswitch_8h_ae012c39e873d42b086636b19a242c354a067967d6cc0d7b7283ad6d77cba6936f}{OVS\_VPORT\_CMD\_DEL});
35     \hyperlink{datapath_8c_a560b5f5f97a839287201f7486c53447e}{ovs\_dp\_detach\_port}(vport);
36     \textcolor{keywordflow}{if} (IS\_ERR(notify)) \{
37         \hyperlink{genetlink_8h_a4261ddbadfb4439b57bd106a5ab0a043}{genl\_set\_err}(&\hyperlink{datapath_8c_a69bf55f33e234bc4b78e6eeee1d603fd}{dp\_vport\_genl\_family}, 
      \hyperlink{datapath_8h_aef2302004ca1f45133eaef00bb3740eb}{ovs\_dp\_get\_net}(dp), 0,
38                  \hyperlink{compat_8h_ab49ad0e0c1bb8cda8015902526ae189c}{GROUP\_ID}(&\hyperlink{datapath_8c_a9dd8d4307b50fdee582eb4013d89eb7b}{ovs\_dp\_vport\_multicast\_group}),
39                  PTR\_ERR(notify));
40         \textcolor{keywordflow}{return};
41     \}
42 
43     \hyperlink{genetlink_8h_ab7ffe7df793569b5be1c2c7d5c35cac6}{genlmsg\_multicast\_netns}(&\hyperlink{datapath_8c_a69bf55f33e234bc4b78e6eeee1d603fd}{dp\_vport\_genl\_family},
44                 \hyperlink{datapath_8h_aef2302004ca1f45133eaef00bb3740eb}{ovs\_dp\_get\_net}(dp), notify, 0,
45                 \hyperlink{compat_8h_ab49ad0e0c1bb8cda8015902526ae189c}{GROUP\_ID}(&\hyperlink{datapath_8c_a9dd8d4307b50fdee582eb4013d89eb7b}{ovs\_dp\_vport\_multicast\_group}),
46                 GFP\_KERNEL);
47 \}
\end{DoxyCode}
\hypertarget{linux_2dp__notify_8c_acca2a908a0982dd42292177079cf5643}{}\index{linux/dp\+\_\+notify.\+c@{linux/dp\+\_\+notify.\+c}!dp\+\_\+device\+\_\+event@{dp\+\_\+device\+\_\+event}}
\index{dp\+\_\+device\+\_\+event@{dp\+\_\+device\+\_\+event}!linux/dp\+\_\+notify.\+c@{linux/dp\+\_\+notify.\+c}}
\subsubsection[{dp\+\_\+device\+\_\+event}]{\setlength{\rightskip}{0pt plus 5cm}static int dp\+\_\+device\+\_\+event (
\begin{DoxyParamCaption}
\item[{struct notifier\+\_\+block $\ast$}]{unused, }
\item[{unsigned long}]{event, }
\item[{void $\ast$}]{ptr}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{linux_2dp__notify_8c_acca2a908a0982dd42292177079cf5643}

\begin{DoxyCode}
79 \{
80     \textcolor{keyword}{struct }\hyperlink{structovs__net}{ovs\_net} *\hyperlink{structovs__net}{ovs\_net};
81     \textcolor{keyword}{struct }net\_device *dev = netdev\_notifier\_info\_to\_dev(ptr);
82     \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport} = NULL;
83 
84     \textcolor{keywordflow}{if} (!\hyperlink{linux_2vport-internal__dev_8c_a2056d15823f88a4caeb90001bce724bb}{ovs\_is\_internal\_dev}(dev))
85         vport = \hyperlink{linux_2vport-netdev_8c_adf074c6126d43c3f7ea008ac19d33112}{ovs\_netdev\_get\_vport}(dev);
86 
87     \textcolor{keywordflow}{if} (!vport)
88         \textcolor{keywordflow}{return} NOTIFY\_DONE;
89 
90     \textcolor{keywordflow}{if} (event == NETDEV\_UNREGISTER) \{
91         \textcolor{comment}{/* upper\_dev\_unlink and decrement promisc immediately */}
92         \hyperlink{linux_2vport-netdev_8c_ac03887d6d37218f96766a4fe8a29a7f6}{ovs\_netdev\_detach\_dev}(vport);
93 
94         \textcolor{comment}{/* schedule vport destroy, dev\_put and genl notification */}
95         ovs\_net = net\_generic(dev\_net(dev), \hyperlink{datapath_8h_ace140298dc2b59b3d77d59c0a210de29}{ovs\_net\_id});
96         queue\_work(system\_wq, &ovs\_net->\hyperlink{structovs__net_ac8cdb834420a37531f032e526ac61901}{dp\_notify\_work});
97     \}
98 
99     \textcolor{keywordflow}{return} NOTIFY\_DONE;
100 \}
\end{DoxyCode}
\hypertarget{linux_2dp__notify_8c_a5d5624a3bb21c222e3a6f18f56ff20b2}{}\index{linux/dp\+\_\+notify.\+c@{linux/dp\+\_\+notify.\+c}!ovs\+\_\+dp\+\_\+notify\+\_\+wq@{ovs\+\_\+dp\+\_\+notify\+\_\+wq}}
\index{ovs\+\_\+dp\+\_\+notify\+\_\+wq@{ovs\+\_\+dp\+\_\+notify\+\_\+wq}!linux/dp\+\_\+notify.\+c@{linux/dp\+\_\+notify.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+notify\+\_\+wq}]{\setlength{\rightskip}{0pt plus 5cm}void ovs\+\_\+dp\+\_\+notify\+\_\+wq (
\begin{DoxyParamCaption}
\item[{struct work\+\_\+struct $\ast$}]{work}
\end{DoxyParamCaption}
)}\label{linux_2dp__notify_8c_a5d5624a3bb21c222e3a6f18f56ff20b2}

\begin{DoxyCode}
50 \{
51     \textcolor{keyword}{struct }\hyperlink{structovs__net}{ovs\_net} *\hyperlink{structovs__net}{ovs\_net} = container\_of(work, \textcolor{keyword}{struct} ovs\_net, 
      \hyperlink{structovs__net_ac8cdb834420a37531f032e526ac61901}{dp\_notify\_work});
52     \textcolor{keyword}{struct }\hyperlink{structdatapath}{datapath} *dp;
53 
54     \hyperlink{datapath_8c_a092c1f450b78a173c890ed4c56839e1a}{ovs\_lock}();
55     list\_for\_each\_entry(dp, &ovs\_net->\hyperlink{structovs__net_a0490101f7ea82f5c290a92d447bd8f9d}{dps}, \hyperlink{structdatapath_ac5f44be07025a2addb5c393fba822000}{list\_node}) \{
56         \textcolor{keywordtype}{int} i;
57 
58         \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{datapath_8h_ac1bf9805d62227b8f76f130087e18018}{DP\_VPORT\_HASH\_BUCKETS}; i++) \{
59             \textcolor{keyword}{struct }\hyperlink{structvport}{vport} *\hyperlink{structvport}{vport};
60             \textcolor{keyword}{struct }hlist\_node *n;
61 
62             \hyperlink{list_8h_ae2f7dd7dbbe2f13fa51aca9fcb31a03f}{hlist\_for\_each\_entry\_safe}(vport, n, &dp->
      \hyperlink{structdatapath_abb0de528545b312de283b571cb6c4ede}{ports}[i], dp\_hash\_node) \{
63                 \textcolor{keyword}{struct }\hyperlink{structnetdev__vport}{netdev\_vport} *\hyperlink{structnetdev__vport}{netdev\_vport};
64 
65                 \textcolor{keywordflow}{if} (vport->\hyperlink{structvport_a5af933fc664c1194ac3bbc337da35586}{ops}->\hyperlink{structvport__ops_a7dd0d3776e78a2885063d3afd5e78148}{type} != \hyperlink{openvswitch_8h_a9a1b861aa99bd83177a2b10b34745b0aa825efa4a45bf501996d8d8fbb83887dd}{OVS\_VPORT\_TYPE\_NETDEV})
66                     \textcolor{keywordflow}{continue};
67 
68                 netdev\_vport = \hyperlink{vport-netdev_8h_a2cb441c6cf067ce3c79cb43836e9fc55}{netdev\_vport\_priv}(vport);
69                 \textcolor{keywordflow}{if} (!(\hyperlink{linux_2vport-netdev_8c_adf074c6126d43c3f7ea008ac19d33112}{ovs\_netdev\_get\_vport}(netdev\_vport->\hyperlink{structnetdev__vport_acf4ee248f7385e2f987fd2736f824ca9}{dev})))
70                     \hyperlink{linux_2dp__notify_8c_abfe6aca1ecdf831b014297563fc08731}{dp\_detach\_port\_notify}(vport);
71             \}
72         \}
73     \}
74     \hyperlink{datapath_8c_ac3ccfd98a880ed6d2480209be0d16680}{ovs\_unlock}();
75 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{linux_2dp__notify_8c_ab34ba4d6c1125efcec9480356f3393e6}{}\index{linux/dp\+\_\+notify.\+c@{linux/dp\+\_\+notify.\+c}!ovs\+\_\+dp\+\_\+device\+\_\+notifier@{ovs\+\_\+dp\+\_\+device\+\_\+notifier}}
\index{ovs\+\_\+dp\+\_\+device\+\_\+notifier@{ovs\+\_\+dp\+\_\+device\+\_\+notifier}!linux/dp\+\_\+notify.\+c@{linux/dp\+\_\+notify.\+c}}
\subsubsection[{ovs\+\_\+dp\+\_\+device\+\_\+notifier}]{\setlength{\rightskip}{0pt plus 5cm}struct notifier\+\_\+block ovs\+\_\+dp\+\_\+device\+\_\+notifier}\label{linux_2dp__notify_8c_ab34ba4d6c1125efcec9480356f3393e6}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    .notifier\_call = \hyperlink{linux_2dp__notify_8c_acca2a908a0982dd42292177079cf5643}{dp\_device\_event}
\}
\end{DoxyCode}
