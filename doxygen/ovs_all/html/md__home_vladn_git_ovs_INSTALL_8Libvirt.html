<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>ovs all: How to Use Open vSwitch with Libvirt</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ovs all
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md__home_vladn_git_ovs_INSTALL_8Libvirt.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">How to Use Open vSwitch with Libvirt </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document describes how to use Open vSwitch with Libvirt 0.9.11 or later. This document assumes that you followed <a class="el" href="INSTALL_8md.html">INSTALL.md</a> or installed Open vSwitch from distribution packaging such as a .deb or .rpm. The Open vSwitch support is included by default in Libvirt 0.9.11. Consult www.libvirt.org for instructions on how to build the latest Libvirt, if your Linux distribution by default comes with an older Libvirt release.</p>
<h2>Limitations </h2>
<p>Currently there is no Open vSwitch support for networks that are managed by libvirt (e.g. NAT). As of now, only bridged networks are supported (those where the user has to manually create the bridge).</p>
<h2>Setup </h2>
<p>First, create the Open vSwitch bridge by using the ovs-vsctl utility (this must be done with administrative privileges): </p><pre class="fragment">% ovs-vsctl add-br ovsbr
</pre><p>Once that is done, create a VM, if necessary, and edit its Domain XML file: </p><pre class="fragment">% virsh edit &lt;vm&gt;
</pre><p>Lookup in the Domain XML file the <code>&lt;interface&gt;</code> section. There should be one such XML section for each interface the VM has.</p>
<p>``` &lt;interface type="network"&gt; &lt;mac address="52:54:00:71:b1:b6"&gt; &lt;source network="default"&gt; &lt;address type="pci" domain="0x0000" bus="0x00" slot="0x03" function="0x0"&gt; &lt;/interface&gt; ```</p>
<p>And change it to something like this:</p>
<p>``` &lt;interface type="bridge"&gt; &lt;mac address="52:54:00:71:b1:b6"&gt; &lt;source bridge="ovsbr"&gt; &lt;virtualport type="openvswitch"&gt; &lt;address type="pci" domain="0x0000" bus="0x00" slot="0x03" function="0x0"&gt; &lt;/interface&gt; ```</p>
<p>The interface type must be set to "bridge". The <code>&lt;source&gt;</code> XML element specifies to which bridge this interface will be attached to. The <code>&lt;virtualport&gt;</code> element indicates that the bridge in <code>&lt;source&gt;</code> element is an Open vSwitch bridge.</p>
<p>Then (re)start the VM and verify if the guest's vnet interface is attached to the ovsbr bridge. </p><pre class="fragment">% ovs-vsctl show
</pre><h2>Troubleshooting </h2>
<p>If the VM does not want to start, then try to run the libvirtd process either from the terminal, so that all errors are printed in console, or inspect Libvirt/Open vSwitch log files for possible root cause.</p>
<h2>Bug Reporting </h2>
<p>Please report problems to <a href="#" onclick="location.href='mai'+'lto:'+'bug'+'s@'+'ope'+'nv'+'swi'+'tc'+'h.o'+'rg'; return false;">bugs@<span style="display: none;">.nosp@m.</span>open<span style="display: none;">.nosp@m.</span>vswit<span style="display: none;">.nosp@m.</span>ch.o<span style="display: none;">.nosp@m.</span>rg</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Sep 9 2015 19:08:08 for ovs all by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
