<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>ovs all: How to Use Open vSwitch with Docker</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ovs all
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md__home_vladn_git_ovs_INSTALL_8Docker.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">How to Use Open vSwitch with Docker </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document describes how to use Open vSwitch with Docker 1.2.0 or later. This document assumes that you installed Open vSwitch by following <a class="el" href="INSTALL_8md.html">INSTALL.md</a> or by using the distribution packages such as .deb or .rpm. Consult www.docker.com for instructions on how to install Docker.</p>
<h2>Limitations </h2>
<p>Currently there is no native integration of Open vSwitch in Docker, i.e., one cannot use the Docker client to automatically add a container's network interface to an Open vSwitch bridge during the creation of the container. This document describes addition of new network interfaces to an already created container and in turn attaching that interface as a port to an Open vSwitch bridge. If and when there is a native integration of Open vSwitch with Docker, the ovs-docker utility described in this document is expected to be retired.</p>
<h2>Setup </h2>
<ul>
<li>Create your container, e.g.:</li>
</ul>
<p>``` % docker run -d ubuntu:14.04 /bin/sh -c \ "while true; do echo hello world; sleep 1; done" ```</p>
<p>The above command creates a container with one network interface 'eth0' and attaches it to a Linux bridge called 'docker0'. 'eth0' by default gets an IP address in the 172.17.0.0/16 space. Docker sets up iptables NAT rules to let this interface talk to the outside world. Also since it is connected to 'docker0' bridge, it can talk to all other containers connected to the same bridge. If you prefer that no network interface be created by default, you can start your container with the option '&ndash;net=none', e,g.:</p>
<p>``` % docker run -d &ndash;net=none ubuntu:14.04 /bin/sh -c \ "while true; do echo hello world; sleep 1; done" ```</p>
<p>The above commands will return a container id. You will need to pass this value to the utility 'ovs-docker' to create network interfaces attached to an Open vSwitch bridge as a port. This document will reference this value as $CONTAINER_ID in the next steps.</p>
<ul>
<li>Add a new network interface to the container and attach it to an Open vSwitch bridge. e.g.:</li>
</ul>
<p><code>% ovs-docker add-port br-int eth1 $CONTAINER_ID</code></p>
<p>The above command will create a network interface 'eth1' inside the container and then attaches it to the Open vSwitch bridge 'br-int'. This is done by creating a veth pair. One end of the interface becomes 'eth1' inside the container and the other end attaches to 'br-int'.</p>
<p>The script also lets one to add IP address, MAC address, Gateway address and MTU for the interface. e.g.:</p>
<p>``` % ovs-docker add-port br-int eth1 $CONTAINER_ID &ndash;ipaddress=192.168.1.2/24 \ &ndash;macaddress=a2:c3:0d:49:7f:f8 &ndash;gateway=192.168.1.1 &ndash;mtu=1450 ```</p>
<ul>
<li>A previously added network interface can be deleted. e.g.:</li>
</ul>
<p><code>% ovs-docker del-port br-int eth1 $CONTAINER_ID</code></p>
<p>All the previously added Open vSwitch interfaces inside a container can be deleted. e.g.:</p>
<p><code>% ovs-docker del-ports br-int $CONTAINER_ID</code></p>
<p>It is important that the same $CONTAINER_ID be passed to both add-port and del-port[s] commands.</p>
<ul>
<li>More network control.</li>
</ul>
<p>Once a container interface is added to an Open vSwitch bridge, one can set VLANs, create Tunnels, add OpenFlow rules etc for more network control. Many times, it is important that the underlying network infrastructure is plumbed (or programmed) before the application inside the container starts. To handle this, one can create a micro-container, attach an Open vSwitch interface to that container, set the UUIDS in OVSDB as mentioned in <a class="el" href="IntegrationGuide_8md.html">IntegrationGuide.md</a> and then program the bridge to handle traffic coming out of that container. Now, you can start the main container asking it to share the network of the micro-container. When your application starts, the underlying network infrastructure would be ready. e.g.:</p>
<p>``` % docker run -d &ndash;net=container:$MICROCONTAINER_ID ubuntu:14.04 /bin/sh -c \ "while true; do echo hello world; sleep 1; done" ```</p>
<p>Please read the man pages of ovs-vsctl, ovs-ofctl, ovs-vswitchd, ovsdb-server and ovs-vswitchd.conf.db etc for more details about Open vSwitch.</p>
<p>Docker networking is quite flexible and can be used in multiple ways. For more information, please read: <a href="https://docs.docker.com/articles/networking">https://docs.docker.com/articles/networking</a></p>
<h2>Bug Reporting </h2>
<p>Please report problems to <a href="#" onclick="location.href='mai'+'lto:'+'bug'+'s@'+'ope'+'nv'+'swi'+'tc'+'h.o'+'rg'; return false;">bugs@<span style="display: none;">.nosp@m.</span>open<span style="display: none;">.nosp@m.</span>vswit<span style="display: none;">.nosp@m.</span>ch.o<span style="display: none;">.nosp@m.</span>rg</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Sep 9 2015 19:08:08 for ovs all by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
