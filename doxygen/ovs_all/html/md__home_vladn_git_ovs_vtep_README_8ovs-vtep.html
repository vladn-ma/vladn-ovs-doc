<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>ovs all: How to Use the VTEP Emulator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ovs all
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md__home_vladn_git_ovs_vtep_README_8ovs-vtep.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">How to Use the VTEP Emulator </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document explains how to use ovs-vtep, a VTEP emulator that uses Open vSwitch for forwarding.</p>
<h2>Requirements </h2>
<p>The VTEP emulator is a Python script that invokes calls to tools like vtep-ctl and ovs-vsctl and is useful only when OVS daemons like ovsdb-server and ovs-vswitchd are running. So those components should be installed. This can be done by either of the following methods.</p>
<ol type="1">
<li>Follow the instructions in the <a class="el" href="INSTALL_8md.html">INSTALL.md</a> file of the Open vSwitch repository (don't start any daemons yet).</li>
<li>Follow the instructions in <a class="el" href="INSTALL_8Debian_8md.html">INSTALL.Debian.md</a> file and then install the "openvswitch-vtep" package (if operating on a debian based machine). This will automatically start the daemons.</li>
</ol>
<h1>Design </h1>
<p>At the end of this process, you should have the following setup:</p>
<pre class="fragment">  +---------------------------------------------------+
  | Host Machine                                      |
  |                                                   |
  |                                                   |
  |       +---------+ +---------+                     |
  |       |         | |         |                     |
  |       |   VM1   | |   VM2   |                     |
  |       |         | |         |                     |
  |       +----o----+ +----o----+                     |
  |            |           |                          |
  | br0 +------o-----------o--------------------o--+  |
  |            p0          p1                  br0    |
  |                                                   |
  |                                                   |
  |                              +------+   +------+  |
  +------------------------------| eth0 |---| eth1 |--+
                                 +------+   +------+
                                 10.1.1.1   10.2.2.1
                    MANAGEMENT      |          |
                  +-----------------o----+     |
                                               |
                               DATA/TUNNEL     |
                             +-----------------o---+
</pre><p>Notes:</p>
<ol type="1">
<li>We will use Open vSwitch to create our "physical" switch labeled br0</li>
<li>Our "physical" switch br0 will have one internal port also named br0 and two "physical" ports, namely p0 and p1.</li>
<li>The host machine may have two external interfaces. We will use eth0 for management traffic and eth1 for tunnel traffic (One can use a single interface to achieve both). Please take note of their IP addresses in the diagram. You do not have to use exactly the same IP addresses. Just know that the above will be used in the steps below.</li>
<li><p class="startli">You can optionally connect physical machines instead of virtual machines to switch br0. In that case:</p>
<p class="startli">4.1. Make sure you have two extra physical interfaces in your host machine, eth2 and eth3.</p>
<p class="startli">4.2. In the rest of this doc, replace p0 with eth2 and p1 with eth3.</p>
</li>
<li>In addition to implementing p0 and p1 as physical interfaces, you can also optionally implement them as standalone TAP devices, or VM interfaces for simulation.</li>
<li>Creating and attaching the VMs is outside the scope of this document and is included in the diagram for reference purposes only.</li>
</ol>
<h2>Startup </h2>
<p>These instructions describe how to run with a single ovsdb-server instance that handles both the OVS and VTEP schema. You can skip steps 1-3 if you installed using the debian packages as mentioned in step 2 of the "Requirements" section.</p>
<ol type="1">
<li><p class="startli">Create the initial OVS and VTEP schemas:</p>
<p class="startli">``` ovsdb-tool create /etc/openvswitch/ovs.db vswitchd/vswitch.ovsschema ovsdb-tool create /etc/openvswitch/vtep.db vtep/vtep.ovsschema ```</p>
</li>
<li><p class="startli">Start ovsdb-server and have it handle both databases:</p>
<p class="startli">``` ovsdb-server &ndash;pidfile &ndash;detach &ndash;log-file \ &ndash;remote punix:/var/run/openvswitch/db.sock \ &ndash;remote=db:hardware_vtep,Global,managers \ /etc/openvswitch/ovs.db /etc/openvswitch/vtep.db ```</p>
</li>
<li><p class="startli">Start OVS as normal:</p>
<p class="startli">``` ovs-vswitchd &ndash;log-file &ndash;detach &ndash;pidfile \ unix:/var/run/openvswitch/db.sock ```</p>
</li>
<li><p class="startli">Create a "physical" switch and its ports in OVS:</p>
<p class="startli">``` ovs-vsctl add-br br0 ovs-vsctl add-port br0 p0 ovs-vsctl add-port br0 p1 ```</p>
</li>
<li><p class="startli">Configure the physical switch in the VTEP database:</p>
<p class="startli">``` vtep-ctl add-ps br0 vtep-ctl set Physical_Switch br0 tunnel_ips=10.2.2.1 ```</p>
</li>
<li><p class="startli">Start the VTEP emulator. If you installed the components by reading the <a class="el" href="INSTALL_8md.html">INSTALL.md</a> file, run the following from the same directory as this README.md:</p>
<p class="startli">``` ./ovs-vtep &ndash;log-file=/var/log/openvswitch/ovs-vtep.log \ &ndash;pidfile=/var/run/openvswitch/ovs-vtep.pid \ &ndash;detach br0 ```</p>
<p class="startli">If the installation was done by installing the openvswitch-vtep package, you can find ovs-vtep at /usr/share/openvswitch/scripts.</p>
</li>
<li><p class="startli">Configure the VTEP database's manager to point at an NVC:</p>
<p class="startli">``` vtep-ctl set-manager tcp:&lt;CONTROLLER ip&gt;=""&gt;:6640 ```</p>
<p class="startli">Where CONTROLLER IP is your controller's IP address that is accessible via the Host Machine's eth0 interface.</p>
</li>
</ol>
<h2>Simulating an NVC </h2>
<p>A VTEP implementation expects to be driven by a Network Virtualization Controller (NVC), such as NSX. If one does not exist, it's possible to use vtep-ctl to simulate one:</p>
<ol type="1">
<li><p class="startli">Create a logical switch:</p>
<p class="startli">``` vtep-ctl add-ls ls0 ```</p>
</li>
<li><p class="startli">Bind the logical switch to a port:</p>
<p class="startli">``` vtep-ctl bind-ls br0 p0 0 ls0 vtep-ctl set Logical_Switch ls0 tunnel_key=33 ```</p>
</li>
<li><p class="startli">Direct unknown destinations out a tunnel:</p>
<p class="startli">``` vtep-ctl add-mcast-remote ls0 unknown-dst 10.2.2.2 ```</p>
</li>
<li>Direct unicast destinations out a different tunnel: ``` vtep-ctl add-ucast-remote ls0 00:11:22:33:44:55 10.2.2.3 ``` </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Sep 9 2015 19:08:08 for ovs all by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
